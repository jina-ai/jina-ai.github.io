import{aB as d,u as o,d as p}from"./index-_IRCU2sq.js";const h=d("news",{state:()=>({authors:[],allBlogs:[],updatedAt:void 0,accessedAt:"",lastAccessedAt:"",initiating:!0,i18nMeta:{blogs:[],updatedAt:""}}),getters:{hasNewPost:s=>s.accessedAt&&s.allBlogs.length?s.allBlogs.some(a=>new Date(a.publishedAt).getTime()>new Date(s.accessedAt).getTime()):!1,featuredBlogs:s=>{const a=o();return s.allBlogs.filter(t=>t.featured).sort((t,e)=>new Date(e.publishedAt).getTime()-new Date(t.publishedAt).getTime()).map(t=>{const e=s.i18nMeta.blogs.find(n=>n.slug===t.slug&&n.lang===a.language);return{...t,title:(e==null?void 0:e.title)||t.title,excerpt:(e==null?void 0:e.excerpt)||t.excerpt}})},translatedAllBlogs:s=>{const a=o();return s.allBlogs.map(t=>{const e=s.i18nMeta.blogs.find(n=>n.slug===t.slug&&n.lang===a.language);return{...t,title:(e==null?void 0:e.title)||t.title,excerpt:(e==null?void 0:e.excerpt)||t.excerpt}})}},actions:{async getNews(s,a="authors,tags"){var n;const t=o();let e;if(t.language!==p){const i=await fetch(`/assets/blogs/${t.language}/${s}.json`);i.ok&&((n=i.headers.get("content-type"))!=null&&n.includes("application/json"))&&(e=await i.json())}if(!e){const i=await fetch(`https://jina-ai-gmbh.ghost.io/ghost/api/content/posts/slug/${s}/?${new URLSearchParams({key:"2652cf20335454671600707967",include:a})}`);if(i.ok){const{posts:g}=await i.json();g.length>0&&(e=g[0])}}if(e)return{id:e.id,url:e.url,html:e.html,excerpt:e.excerpt,featureImage:e.feature_image,featureImageAlt:e.feature_image_alt,publishedAt:e.published_at,updatedAt:e.updated_at,title:e.title,slug:e.slug,readingTime:e.reading_time,featured:e.featured,primaryTag:e.primary_tag,authors:e.authors.map(i=>({id:i.id,name:i.name,bio:i.bio,location:i.location,profileImage:i.profile_image,slug:i.slug,url:i.url,twitter:i.twitter})),tags:e.tags.map(i=>({id:i.id,name:i.name,slug:i.slug,url:i.url,visibility:i.visibility}))}},async getNewsList({filter:s,include:a="authors,tags",page:t,limit:e=6}){let n={include:a,limit:String(e),key:"2652cf20335454671600707967"};s!==void 0&&(n=Object.assign(n,{filter:s})),t!==void 0&&(n=Object.assign(n,{page:String(t)}));const i="https://jina-ai-gmbh.ghost.io/ghost/api/content/posts/?"+new URLSearchParams(n),g=await fetch(i),{posts:u}=await g.json();return u.map(l=>({id:l.id,url:l.url,html:l.html,excerpt:l.excerpt,featureImage:l.feature_image,featureImageAlt:l.feature_image_alt,publishedAt:l.published_at,updatedAt:l.updated_at,title:l.title,slug:l.slug,readingTime:l.reading_time,featured:l.featured,primaryTag:l.primary_tag,authors:l.authors.map(r=>({id:r.id,name:r.name,bio:r.bio,location:r.location,profileImage:r.profile_image,slug:r.slug,url:r.url,twitter:r.twitter})),tags:l.tags.map(r=>({id:r.id,name:r.name,slug:r.slug,url:r.url,visibility:r.visibility}))}))},async getSuggestionNews(s,a){var n;const t=[],e=this.translatedAllBlogs;if((n=a.tags)!=null&&n.length){const i=e.filter(g=>{var u,l;return((u=g.primaryTag)==null?void 0:u.slug)===((l=a.primaryTag)==null?void 0:l.slug)&&g.id!==a.id}).slice(0,s);if(t.push(...i),t.length<s){const g=e.filter(l=>{var r,c;return((r=l.primaryTag)==null?void 0:r.slug)!==((c=a.primaryTag)==null?void 0:c.slug)&&l.id!==a.id}),u=Math.floor(Math.random()*Math.max(g.length-1,0));t.push(...g.slice(u,u+s-t.length))}}else{const i=e.filter(g=>g.id!==a.id).slice(0,s);t.push(...i)}return t},async init(){try{this.initiating=!0,await this.getAllNews(),await this.getAuthors(),await this.getI18nMeta()}catch{}finally{this.initiating=!1}},async getI18nMeta(){var a;const s=await fetch("/assets/blogs/meta.json");if(s.ok&&((a=s.headers.get("content-type"))!=null&&a.includes("application/json"))){const t=await s.json();this.i18nMeta.blogs=t.blogs.map(e=>({lang:e.lang,slug:e.slug,translatedAt:e.translated_at,title:e.title,excerpt:e.excerpt})),this.i18nMeta.updatedAt=t.updated_at}},async getAllNews(){let s={limit:"all"};if(this.allBlogs.length>0&&this.updatedAt)s=Object.assign(s,{filter:`updated_at:>${this.updatedAt}`}),(await this.getNewsList(s)).reverse().forEach(t=>{const e=this.allBlogs.findIndex(n=>n.id===t.id);e!==-1?this.allBlogs[e]=t:this.allBlogs.unshift(t)});else{const a=await this.getNewsList(s);this.allBlogs=a}this.allBlogs=[...this.allBlogs.sort((a,t)=>new Date(t.publishedAt).getTime()-new Date(a.publishedAt).getTime())],this.updatedAt=new Date().toISOString()},async getAuthors(){const s="https://jina-ai-gmbh.ghost.io/ghost/api/content/authors/?"+new URLSearchParams({key:"2652cf20335454671600707967",limit:"all"}),a=await fetch(s),{authors:t}=await a.json();this.authors=t.map(e=>({id:e.id,name:e.name,bio:e.bio,location:e.location,profileImage:e.profile_image,slug:e.slug,url:e.url,twitter:e.twitter}))},async select(s){let a;return typeof s=="string"?a=[s]:a=s,this.allBlogs.filter(t=>a.some(e=>t.title.toLowerCase().includes(e.toLowerCase())))}},persist:{paths:["allBlogs","authors","updatedAt","accessedAt","lastAccessedAt"]}});export{h as u};

import{s as k,p as E,aB as v,aD as c,k as j,J as A}from"./index-CwAM9Eei.js";import{S as d,s as y,a as b,c as _}from"./_setToArray-Dt0Zvfo0.js";function S(){}function I(e,t,r,a){for(var o=e.length,s=r+(a?1:-1);a?s--:++s<o;)if(t(e[s],s,e))return s;return-1}function D(e){return e!==e}function K(e,t,r){for(var a=r-1,o=e.length;++a<o;)if(e[a]===t)return a;return-1}function O(e,t,r){return t===t?K(e,t,r):I(e,D,r)}function T(e,t){var r=e==null?0:e.length;return!!r&&O(e,t,0)>-1}var P=1/0,R=d&&1/y(new d([,-0]))[1]==P?function(e){return new d(e)}:S,L=200;function x(e,t,r){var a=-1,o=T,s=e.length,l=!0,i=[],u=i;if(s>=L){var g=R(e);if(g)return y(g);l=!1,o=_,u=new b}else u=i;e:for(;++a<s;){var h=e[a],p=h;if(h=h!==0?h:0,l&&p===p){for(var w=u.length;w--;)if(u[w]===p)continue e;i.push(h)}else o(u,p,r)||(u!==i&&u.push(p),i.push(h))}return i}function U(e){return e&&e.length?x(e):[]}const J=k({name:"QSpace",setup(){const e=E("div",{class:"q-space"});return()=>e}}),n="https://embeddings-dashboard-api.jina.ai",f="https://api.jina.ai",z=["price_1PqrlqEoTOtb5eZvFh1Vhdm6","price_1PqrnpEoTOtb5eZv3woXVYU1"];var B=(e=>(e.UNLOADED="unloaded",e.IDLE="idle",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error",e.UNSUPPORTED="unsupported",e.EXPIRED="expired",e.CLEANUP="cleanup",e))(B||{}),N=(e=>(e.CONSUME="consume",e.PURCHASE="purchase",e.TRIAL="trial",e.TRANSFER_IN="transfer in",e.TRANSFER_OUT="transfer out",e))(N||{}),C=(e=>(e.IN_PROGRESS="in-progress",e.FAILED="failed",e.COMPLETED="completed",e))(C||{});const V=v("embedding",{state:()=>({apiKey:"",apiKeyInfo:void 0,isApiKeyLoading:!1,isApiKeyInfoLoading:!1,models:[],allModels:[],products:[],testData:[],userDocuments:"",userSearchDocs:"",userVisualizeDocs:"",showMaximized:!1,classifiers:[],task:"",turnstileState:"unloaded"}),persist:{paths:["apiKey","testData","apiKeyInfo"]},getters:{apiKeyTokens:e=>{var t,r;return(r=(t=e.apiKeyInfo)==null?void 0:t.wallet.total_balance)!=null?r:0},isPaidUser:e=>{var t;return!!((t=e.apiKeyInfo)!=null&&t.email)},isPremiumPaidUser:e=>{var t,r;return!!((t=e.apiKeyInfo)!=null&&t.email)&&((r=e.apiKeyInfo)==null?void 0:r.metadata.speed_level)===2},isAutoCharge:e=>{var t,r;return!!((t=e.apiKeyInfo)!=null&&t.email)||((r=e.apiKeyInfo)==null?void 0:r.metadata.auto_recharge)}},actions:{setApiKeyInfo(e){e&&(this.apiKeyInfo=JSON.parse(JSON.stringify(e)))},async getReplicas(e,t){try{const r=await fetch(`${n}/api/v1/models/slug/${t}`,{method:"GET"});if(!r.ok)throw new Error(`getReplicas error! Status: ${r.status}`);return(await r.json()).num_replicas}catch(r){console.error("getReplicas error:",r)}},async generateApiKey(e){this.isApiKeyLoading=!0;const t=new FormData;t.set("cf-turnstile-response",e);try{const r=await fetch(`${n}/api/v1/api_key`,{method:"POST",body:t});if(!r.ok)throw new Error(`getApiKey error! Status: ${r.status}`);const a=await r.json();return this.apiKey=a.api_key,!0}catch(r){return console.error("getApiKey error:",r),!1}finally{this.isApiKeyLoading=!1}},async generate0TokenApiKey(e){var r;this.isApiKeyLoading=!0;const t=new FormData;t.set("cf-turnstile-response",e);try{const a=await fetch(`${n}/api/v1/api_key/empty`,{method:"POST",body:t});if(!a.ok)throw new Error(`${a.status}: ${((r=await a.json())==null?void 0:r.detail)||a.statusText}`);return(await a.json()).api_key}catch(a){c.create({message:a instanceof Error?a.message:String(a),color:"negative",icon:"error"})}finally{this.isApiKeyLoading=!1}},async revokeApiKey(e,t){var a;const r=new FormData;r.set("cf-turnstile-response",t);try{const o=await fetch(`${n}/api/v1/api_key`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`},body:r});if(!o.ok)throw new Error(`${o.status}: ${((a=await o.json())==null?void 0:a.detail)||o.statusText}`);return!0}catch(o){c.create({message:o instanceof Error?o.message:String(o),color:"negative",icon:"error"})}},async getCurrentKeyInfo(){this.isApiKeyInfoLoading=!0;try{const e=await fetch(`${n}/api/v1/api_key/fe_user?api_key=${this.apiKey}`);if(e.ok){this.apiKeyInfo=await e.json();return}this.apiKeyInfo=void 0,console.error(`getTokens error! Status: ${e.status}`)}catch(e){this.apiKeyInfo=void 0,console.error("getTokens error:",e)}finally{this.isApiKeyInfoLoading=!1}},async getKeyInfo(e){if(e){this.isApiKeyInfoLoading=!0;try{const t=await fetch(`${n}/api/v1/api_key/fe_user?api_key=${e}`);return t.ok?await t.json():void 0}catch{return}finally{this.isApiKeyInfoLoading=!1}}},async getModels(e=[]){try{let t=`${n}/api/v1/models`;e.length&&(t=`${t}?${e.map(o=>`tag=${o}`).join("&")}`);const r=await fetch(t);if(!r.ok)throw new Error(`getModels error! Status: ${r.status}`);const a=await r.json();e.length?this.models=a:this.allModels=a,console.log("getModels data:",a)}catch(t){console.error("getModels error:",t)}},async getProducts(){try{const e=await fetch(`${n}/api/v1/product`);if(!e.ok)throw new Error(`getProducts error! Status: ${e.status}`);const t=(await e.json()).filter(r=>z.includes(r.price_id));t.unshift({id:"0",product_id:"0",product_name:"1M tokens",product_description:"A pack of 1 million tokens",price:0,price_id:"0",currency:"USD",token_quantity:1e6}),console.log("getProducts data:",t),this.products=t}catch(e){console.error("getProducts error:",e)}},async getUsage(e){try{const t=await fetch(`${n}/api/v1/billing/transaction`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`getUsage error! Status: ${t.status}`);return await t.json()}catch(t){console.error("getUsage error:",t)}},async getLatestUsage(e){try{const t=await fetch(`${n}/api/v1/billing/paginated_transaction?num_records=1`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`getUsage error! Status: ${t.status}`);return(await t.json())[0]}catch(t){console.error("getUsage error:",t)}},async getTotalUsage(e){try{const t=await fetch(`${n}/api/v1/billing/total_consumption`,{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`getTotalUsage error! Status: ${t.status}`);return await t.json()}catch(t){console.error("getTotalUsage error:",t)}},async checkoutWithStripe(e,t){try{const r=await fetch(`${n}/api/v1/checkout_session`,{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},method:"POST",body:JSON.stringify(t),mode:"cors",credentials:"include"});if(!r.ok)throw new Error(`checkoutWithStripe error! Status: ${r.status}`);return await r.json()}catch(r){console.error("checkoutWithStripe error:",r)}},async bulkEmbedding(e,t){var s,l;const r={accept:"application/json",Authorization:`Bearer ${e}`},a=new FormData;a.append("model",t.model),a.append("email",(s=t.email)!=null?s:""),a.append("file",t.file);const o=await fetch(`${f}/v1/bulk-embeddings`,{method:"POST",headers:r,body:a});if(o.ok)return await o.json();throw new Error(`${o.status}: ${o.statusText||((l=await o.json())==null?void 0:l.detail)}`)},async checkBulk(e,t){var o;const r={accept:"application/json",Authorization:`Bearer ${e}`},a=await fetch(`${f}/v1/bulk-embeddings/${t}`,{method:"GET",headers:r});if(a.ok)return await a.json();throw new Error(`${a.status}: ${a.statusText||((o=await a.json())==null?void 0:o.detail)}`)},async getBulkResult(e,t){var o;const r={accept:"application/json",Authorization:`Bearer ${e}`},a=await fetch(`${f}/v1/bulk-embeddings/${t}/download-result`,{method:"POST",headers:r});if(a.ok){const{download_url:s}=await a.json();return s}else throw new Error(`${a.status}: ${a.statusText||((o=await a.json())==null?void 0:o.detail)}`)},async setAutoRecharge(e,t){var a;const r={price_id:t.priceId,success_url:t.successUrl,cancel_url:t.cancelUrl,email:t.email,metadata:{auto_recharge:!0,threshold:t.threshold,currency:t.currency}};try{const o=await fetch(`${n}/api/v1/auto_recharge`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(r)});if(o.ok)return(await o.json()).url;throw new Error(`${o.status}: ${((a=await o.json())==null?void 0:a.detail)||o.statusText}`)}catch(o){c.create({message:o instanceof Error?o.message:String(o),color:"negative",icon:"error"})}},async updateAutoRecharge(e,t){var r;try{const a=await fetch(`${n}/api/v1/auto_recharge/settings?threshold=${t}`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(a.ok)return!0;throw new Error(`${a.status}: ${((r=await a.json())==null?void 0:r.detail)||a.statusText}`)}catch(a){c.create({message:a instanceof Error?a.message:String(a),color:"negative",icon:"error"})}},async cancelAutoRecharge(e){var t;try{const r=await fetch(`${n}/api/v1/auto_recharge`,{method:"DELETE",headers:{accept:"application/json",Authorization:`Bearer ${e}`}});if(r.ok)return!0;throw new Error(`${r.status}: ${((t=await r.json())==null?void 0:t.detail)||r.statusText}`)}catch(r){c.create({message:r instanceof Error?r.message:String(r),color:"negative",icon:"error"})}},async getClassifiers(e){try{const t={accept:"application/json",Authorization:`Bearer ${e}`},r=await fetch(`${n}/api/v1/classifiers`,{method:"GET",headers:t});if(!r.ok)throw new Error(`Get classifiers error! Status: ${r.status}`);const a=await r.json();this.classifiers=a}catch(t){console.error("Get classifiers error:",t)}},async setBalanceNotification(e,t){var r;try{if(!Array.isArray(t.thresholds)||t.thresholds.length>3)throw new Error("Invalid thresholds: Must be array with max 3 values");const o={thresholds:U(t.thresholds),email:t.email},s=await fetch(`${n}/api/v1/billing/balance_notification`,{method:"POST",headers:{accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(o)});if(s.ok)return s.json();throw new Error(`${s.status}: ${((r=await s.json())==null?void 0:r.detail)||s.statusText}`)}catch(a){c.create({message:a instanceof Error?a.message:String(a),color:"negative",icon:"error"})}},async cancelBalanceNotification(e){var t;try{const r=await fetch(`${n}/api/v1/billing/balance_notification`,{method:"DELETE",headers:{accept:"application/json",Authorization:`Bearer ${e}`}});if(r.ok)return!0;throw new Error(`${r.status}: ${((t=await r.json())==null?void 0:t.detail)||r.statusText}`)}catch(r){c.create({message:r instanceof Error?r.message:String(r),color:"negative",icon:"error"})}},async transferToken(e,t){var r;try{const a=new FormData;a.set("cf-turnstile-response",t);const o=new URL(`${n}/api/v1/billing/transfer_balance`);o.searchParams.append("receiver_key",e.target),e.withRevoke&&o.searchParams.append("revoke_sender_key","true");const s=await fetch(o,{method:"POST",headers:{Authorization:`Bearer ${e.source}`},body:a});if(s.ok)return s.json();throw new Error(`${s.status}: ${((r=await s.json())==null?void 0:r.detail)||s.statusText}`)}catch(a){c.create({message:a instanceof Error?a.message:String(a),color:"negative",icon:"error"})}}}}),F=()=>!0;function M(e){const t={};return e.forEach(r=>{t[r]=F}),t}function m(){const{emit:e,proxy:t}=A(),r=j(null);function a(){r.value.show()}function o(){r.value.hide()}function s(i){e("ok",i),o()}function l(){e("hide")}return Object.assign(t,{show:a,hide:o}),{dialogRef:r,onDialogHide:l,onDialogOK:s,onDialogCancel:o}}const $=["ok","hide"];m.emits=$;m.emitsObject=M($);export{C as B,J as Q,f as S,N as T,m as a,B as b,I as c,U as d,T as e,V as u};

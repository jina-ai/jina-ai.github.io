import{s as Le,au as Ne,v as ze,aw as He,C as Fe,m as B,p as ne,T as Ve,J as Ye,as as Ge,aB as Je,e as Z,aC as N,j as re,a0 as oe,k as P,a2 as de,a3 as d,a4 as _,a5 as t,a6 as i,a7 as se,ad as H,ae as k,aq as I,af as f,ag as o,aD as xe,q as Q,ap as he,a8 as S,aE as We,aF as Xe,aG as ue,aH as Ze,aI as $e,aJ as ea,aK as me,ao as aa,aL as ta,ab as A,aa as Y,aM as Te,aN as Ie,n as Re,u as Me,am as le,aO as ia,aP as Se,aQ as na,aR as la,W as sa,aS as ra,aT as oa,aj as U,aU as da,ah as ye,ai as _e,ac as ca,a9 as ge,aA as ua}from"./index-Bv8a5Ls7.js";import{Q as x}from"./QItemLabel-bujT2Ufd.js";import{Q as D}from"./QTooltip-D1uXfgZq.js";import{a as Be,Q as ma,b as Ue}from"./QChip-BjN2t6iL.js";import{Q as Ce}from"./QList-B1LxVXYi.js";import{Q as ya}from"./QExpansionItem-BEcOsb0h.js";import{c as _a}from"./copy-to-clipboard-DebAzTyi.js";import{u as z,a as ga,T as fe,Q as fa}from"./use-dialog-plugin-component-Bnsw09_N.js";import{d as pa,f as pe,Q as De,a as O,b as Ae,c as ha,e as ba}from"./date-DUWMBmmr.js";import{C as ka}from"./ClosePopup-QWt5Y8ND.js";import{Q as Oe}from"./QLinearProgress-DQFG2yV-.js";const qe=Le({name:"QInnerLoading",props:{...Ne,...ze,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(n,{slots:l}){const s=Ye(),e=He(n,s.proxy.$q),{transitionProps:r,transitionStyle:g}=Fe(n),a=B(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(e.value===!0?" q-inner-loading--dark":"")),u=B(()=>"q-inner-loading__label"+(n.labelClass!==void 0?` ${n.labelClass}`:""));function m(){const C=[ne(Ge,{size:n.size,color:n.color})];return n.label!==void 0&&C.push(ne("div",{class:u.value,style:n.labelStyle},[n.label])),C}function v(){return n.showing===!0?ne("div",{class:a.value,style:g.value},l.default!==void 0?l.default():m()):null}return()=>ne(Ve,r.value,v)}}),be=Je("apiKey",{state:()=>({keys:[],isLoading:!1,keysInfoCache:{},isBusyState:new Set,isChecking:!1}),getters:{primaryKey:n=>{var l;return(l=n.keys.find(s=>s.isPrimary))==null?void 0:l.key},primaryKeyInfo:n=>{var l;return n.keysInfoCache[((l=n.keys.find(s=>s.isPrimary))==null?void 0:l.key)||""]}},actions:{async addKey(n,l){var s;if(!(!((s=Z.currentUser)!=null&&s.uid)||!n))try{const{data:e}=await N.request("apiKey","addKey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await N.getIdToken()}`},body:JSON.stringify({key:n,metadata:l})});return e&&(this.keys.unshift(e),this.getKeyInfo(n)),e}catch(e){console.error(e)}},async setPrimaryKey(n){var l;if((l=Z.currentUser)!=null&&l.uid){this.isBusyState.add(n);try{const{data:s}=await N.request("apiKey","setPrimaryKey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await N.getIdToken()}`},body:JSON.stringify({key:n,isPrimary:!0})});return s&&(this.keys.forEach(e=>(e.key===n?e.isPrimary=!0:e.isPrimary=!1,e)),z().apiKey=n),s}catch(s){console.error(s)}finally{this.isBusyState.delete(n)}}},async checkPrimaryKey(){var n;if((n=Z.currentUser)!=null&&n.uid&&!this.isChecking)try{this.isChecking=!0;const l=z();this.primaryKey&&this.primaryKey!==l.apiKey?l.isPaidUser?(this.keys.find(e=>e.key===l.apiKey)||await this.addKey(l.apiKey),await this.setPrimaryKey(l.apiKey)):l.apiKey=this.primaryKey:await this.getKeyInfo(l.apiKey)}finally{this.isChecking=!1}},async removeKey(n){var l;if((l=Z.currentUser)!=null&&l.uid){this.isBusyState.add(n);try{const{data:s}=await N.request("apiKey","removeKey",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await N.getIdToken()}`},body:JSON.stringify({key:n})});s&&(this.keys.splice(this.keys.findIndex(e=>e.key===n),1),delete this.keysInfoCache[n])}catch(s){console.error(s)}finally{this.isBusyState.delete(n)}}},async fetchKeys(n=!0){var l;if(!(!((l=Z.currentUser)!=null&&l.uid)||this.isLoading)){this.isLoading=!0;try{const{data:s}=await N.request("apiKey","keyList",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${await N.getIdToken()}`}});if(this.keys=s,n)for(const e of this.keys)this.getKeyInfo(e.key)}catch(s){console.error(s)}finally{this.isLoading=!1}}},async getKeyInfo(n,l=!1){var s,e,r;if(n&&!this.isBusyState.has(n))try{this.isBusyState.add(n);const g=await z().getKeyInfo(n);if(n===z().apiKey&&(z().apiKeyInfo=g),l){this.keysInfoCache[n]={...g,usage:((s=this.keysInfoCache[n])==null?void 0:s.usage)||[],last_used_at:(e=this.keysInfoCache[n])==null?void 0:e.last_used_at};return}const a=await z().getUsage(n);this.keysInfoCache[n]={...g,usage:a,last_used_at:(r=a==null?void 0:a[0])==null?void 0:r.updated_at}}finally{this.isBusyState.delete(n)}},isFreeKey(n){var l,s;return n?!((s=(l=this.keysInfoCache[n])==null?void 0:l.metadata)!=null&&s.speed_level):!1},isPaidKey(n){var l,s;return n?((s=(l=this.keysInfoCache[n])==null?void 0:l.metadata)==null?void 0:s.speed_level)===1:!1},isPremiumPaidKey(n){var l,s;return n?((s=(l=this.keysInfoCache[n])==null?void 0:l.metadata)==null?void 0:s.speed_level)===2:!1}}}),wa=re({__name:"UsageHistoryDialog",props:{apiKey:{}},setup(n,{expose:l}){l();const s=n,{t:e}=oe({useScope:"global"}),r=be(),{dialogRef:g}=ga(),a=()=>{var c;(c=C.value)==null||c.requestServerInteraction()},u=()=>{K.value=[]},m=c=>{var T,q;switch((T=c.request_path)==null?void 0:T.toLowerCase()){case"/encode":case"/checkfact":return v((q=c.metadata)==null?void 0:q.model_name);case"/embeddings":case"/rerank":case"/classify":case"/train":return`api.jina.ai/v1${c.request_path}`;case"/multi-embeddings":return"api.jina.ai/v1/multi-vector";case"/segment":return"api.jina.ai/v1/segment";default:return c.request_path}},v=c=>{if(!c)return"";switch(c.toLowerCase()){case"reader-crawl":return"r.jina.ai";case"reader-search":return"s.jina.ai";case"grounding-checkfact":return"g.jina.ai";case"reader-deepresearch":return"deepsearch.jina.ai";default:return c}},C=P(null),K=P([]),R=P([{name:"icon",label:"",field:"amount",sortable:!1,align:"right"},{name:"createdAt",label:e("embedding.usage_time"),field:"createdAt",sortable:!1,align:"left",format:c=>pa.formatDate(c,"YYYY-MM-DD")},{name:"amount",label:e("embedding.tokens"),field:"amount",sortable:!1,align:"right",format:c=>c>0?`+${c}`:`${c}`},{name:"reason",label:e("embedding.usage_reason"),field:"reason",sortable:!1,align:"left"},{name:"requestPath",label:e("embedding.request_path"),field:"request_path",sortable:!1,align:"left"},{name:"requestNumber",label:e("embedding.request_number"),field:"request_number",sortable:!1,align:"right",format:c=>c?pe(c):""}]),p={props:s,t:e,apiKeyStore:r,dialogRef:g,onUsageHistoryDialogShow:a,onUsageHistoryDialogHide:u,getEndpoint:m,formatModelName:v,usageTableRef:C,usageRows:K,usageColumns:R,getUsageHistory:async()=>{var T,q;await r.getKeyInfo(s.apiKey);const c=(q=(T=r.keysInfoCache)==null?void 0:T[s.apiKey])==null?void 0:q.usage;!c||c.length===0||(K.value=c.map(h=>{const $=new Date(h.updated_at);let j=h.quantity,b=e(`embedding.usage_reason_${h.type.replaceAll(" ","_")}`);return h.type===fe.CONSUME||h.type===fe.TRANSFER_OUT?(j=-j,h.metadata.model_name&&(b=b+": "+v(h.metadata.model_name))):(h.metadata.product_name&&(b=b+": "+h.metadata.product_name),h.metadata.order_quantity&&h.metadata.order_quantity>1&&(b=b+` (x ${h.metadata.order_quantity})`)),{createdAt:$,amount:j,reason:b,request_path:m(h),request_number:h.request_number,type:h.type}}))},get QTable(){return De},get TRANSACTION_TYPE(){return fe},get formatNumber(){return pe}};return Object.defineProperty(p,"__isScriptSetup",{enumerable:!1,value:!0}),p}});function va(n,l,s,e,r,g){return d(),_(We,{ref:"dialogRef",onShow:e.onUsageHistoryDialogShow,onHide:e.onUsageHistoryDialogHide},{default:t(()=>[i(se,{style:{width:"1000px","max-width":"80vw"}},{default:t(()=>[i(H,{class:"q-pa-md"},{default:t(()=>[i(k,{avatar:""},{default:t(()=>[i(I,{name:"history"})]),_:1}),i(k,null,{default:t(()=>[i(x,null,{default:t(()=>[f(o(e.t("embedding.usage_history")),1)]),_:1}),i(x,{caption:""},{default:t(()=>[f(o(e.t("embedding.usage_history_explain")),1)]),_:1})]),_:1}),i(k,{side:""},{default:t(()=>[xe(i(Q,{icon:"close",flat:"",round:"",dense:""},null,512),[[ka]])]),_:1})]),_:1}),i(he),i(e.QTable,{ref:"usageTableRef",flat:"",class:"bg-transparent","row-key":"createdAt",rows:e.usageRows,columns:e.usageColumns,loading:e.apiKeyStore.isBusyState.has(e.props.apiKey),onRequest:e.getUsageHistory,pagination:{rowsPerPage:10}},{"body-cell-icon":t(a=>[i(O,{key:"icon",props:a},{default:t(()=>[a.row.amount>0||a.row.type===e.TRANSACTION_TYPE.TRANSFER_IN&&a.row.amount==0?(d(),_(I,{key:0,name:"o_add_circle_outline",color:"primary"})):(d(),_(I,{key:1,name:"o_remove_circle_outline",color:"negative"}))]),_:2},1032,["props"])]),"body-cell-amount":t(a=>[i(O,{key:"amount",props:a},{default:t(()=>[f(o((a.row.amount>0||a.row.type===e.TRANSACTION_TYPE.TRANSFER_IN&&a.row.amount==0?"+":"")+e.formatNumber(a.row.amount)),1)]),_:2},1032,["props"])]),"body-cell-requestPath":t(a=>[i(O,{key:"request_path",props:a},{default:t(()=>[S("code",null,o(a.row.request_path),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1},512)}const Pa=de(wa,[["render",va],["__file","UsageHistoryDialog.vue"]]),Ka=re({__name:"RateLimitComponent",props:{showActionButtons:Boolean,maximizedWindow:{type:Boolean,default:!1}},setup(n,{expose:l}){l();const s=n,{t:e}=oe({useScope:"global"}),r=aa(),g=P([{icon:Xe,endpoint:"https://deepsearch.jina.ai/v1/chat/completions",name:e("deepsearch.title"),description:e("rate_limit.deepsearch"),requestType:"POST",woAPIkey:"2 RPM",wAPIkey:"10 RPM",wPremium:"30 RPM",tokenCounting:e("rate_limit.total_token_counting"),latency:"56.7s",weight:r.name==="deepsearch"?99:17},{icon:ue,endpoint:"https://r.jina.ai",name:e("reader.title"),description:e("rate_limit.rjinaai"),requestType:"GET/POST",woAPIkey:"20 RPM",wAPIkey:"200 RPM",wPremium:"1000 RPM",tokenCounting:e("rate_limit.output_token_counting"),latency:"4.6s",weight:r.name==="reader"?100:18},{icon:ue,endpoint:"https://s.jina.ai",name:e("reader.title"),description:e("rate_limit.sjinaai"),requestType:"GET/POST",woAPIkey:null,wAPIkey:"40 RPM",wPremium:"100 RPM",tokenCounting:e("rate_limit.output_token_counting"),latency:"8.7s",weight:r.name==="reader"?99:17},{icon:ue,endpoint:"https://g.jina.ai",name:e("reader.title"),description:e("rate_limit.gjinaai"),requestType:"GET/POST",woAPIkey:null,wAPIkey:"10 RPM",wPremium:"30 RPM",tokenCounting:e("rate_limit.total_token_counting"),latency:"22.7s",weight:r.name==="reader"?99:17},{icon:Ze,endpoint:"https://api.jina.ai/v1/segment",name:e("tokenizer.title"),description:e("rate_limit.tokenizer"),requestType:"GET/POST",woAPIkey:"20 RPM",wAPIkey:"200 RPM",wPremium:"1,000 RPM",tokenCounting:e("rate_limit.no_token_counting"),latency:"0.3s",weight:r.name==="segmenter"?100:1},{icon:$e,endpoint:"https://api.jina.ai/v1/embeddings",name:e("embedding.title"),description:e("rate_limit.embeddings"),requestType:"POST",woAPIkey:null,wAPIkey:"500 RPM & 1,000,000 TPM",wPremium:"2,000 RPM & 5,000,000 TPM",tokenCounting:e("rate_limit.input_token_counting"),latency:null,latencyDepends:e("rate_limit.depends"),latencyExplain:e("rate_limit.batch_explain"),weight:r.name==="embeddings"?100:20},{icon:ea,endpoint:"https://api.jina.ai/v1/rerank",name:e("reranker.title"),description:e("rate_limit.tokenizer"),requestType:"POST",woAPIkey:null,wAPIkey:"500 RPM & 1,000,000 TPM",wPremium:"2,000 RPM & 5,000,000 TPM",tokenCounting:e("rate_limit.input_token_counting"),latency:null,latencyDepends:e("rate_limit.depends"),latencyExplain:e("rate_limit.batch_explain"),weight:r.name==="reranker"?100:19},{icon:me,endpoint:"https://api.jina.ai/v1/classify",name:`${e("classifier.title")} (${e("classifier.compare_table.zero_shot")})`,description:e("rate_limit.classifier_zero_shot"),requestType:"POST",woAPIkey:null,wAPIkey:"200 RPM & 500,000 TPM",wPremium:"1,000 RPM & 3,000,000 TPM",tokenCounting:e("rate_limit.classifier_zero_shot_token_counting"),latency:null,latencyDepends:e("rate_limit.depends"),weight:r.name==="classifier"?100:15},{icon:me,endpoint:"https://api.jina.ai/v1/classify",name:`${e("classifier.title")} (${e("classifier.compare_table.few_shot")})`,description:e("rate_limit.classifier_few_shot"),requestType:"POST",woAPIkey:null,wAPIkey:"20 RPM & 200,000 TPM",wPremium:"60 RPM & 1,000,000 TPM",tokenCounting:e("rate_limit.classifier_few_shot_token_counting"),latency:null,latencyDepends:e("rate_limit.depends"),weight:r.name==="classifier"?98:15},{icon:me,endpoint:"https://api.jina.ai/v1/train",name:e("classifier.title"),description:e("rate_limit.classifier"),requestType:"POST",woAPIkey:null,wAPIkey:"20 RPM & 200,000 TPM",wPremium:"60 RPM & 1,000,000 TPM",tokenCounting:e("rate_limit.classifier_token_counting"),latency:null,latencyDepends:e("rate_limit.depends"),weight:r.name==="classifier"?99:15}]),a=P([{name:"icon",field:"icon",label:"",align:"left"},{name:"name",field:"name",label:e("rate_limit.product"),align:"left"},{name:"endpoint",field:"endpoint",label:e("rate_limit.endpoint"),align:"left"},{name:"description",field:"description",label:e("rate_limit.description"),align:"left",sortable:!0},{name:"woAPIkey",field:"woAPIkey",label:e("rate_limit.woAPIkey"),align:"right"},{name:"wAPIkey",field:"wAPIkey",label:e("rate_limit.wAPIkey"),align:"right"},{name:"wPremium",field:"wPremium",label:e("rate_limit.wPremium"),align:"right"},{name:"latency",field:"latency",label:e("rate_limit.latency"),align:"right"},{name:"tokenCounting",field:"tokenCounting",label:e("rate_limit.tokenCounting"),align:"left"},{name:"requestType",field:"requestType",label:e("rate_limit.requestType"),align:"left"}]),u=P(a.value.map(K=>K.name)),m=B(()=>g.value.sort((K,R)=>R.weight-K.weight)),v=P({rowsPerPage:10}),C={props:s,t:e,route:r,rows:g,columns:a,visibleColumns:u,sortedRows:m,initialPagination:v};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}}),Ta=["innerHTML"],Ia={class:"text-bold silver-foil"},Sa={class:"text-bold golden-foil"},Ca={class:"row q-pa-md justify-center full-width"},Aa={key:1},qa={class:"silver-foil text-bold"},xa={class:"golden-foil text-bold"},Ra={key:1};function Ma(n,l,s,e,r,g){return d(),_(se,{flat:"",class:"column no-wrap full-height"},{default:t(()=>[i(De,{class:"my-sticky-column-table",flat:"",square:"","title-class":"q-pa-md",title:e.t("rate_limit.title"),rows:e.sortedRows,columns:e.columns,"row-key":"endpoint",pagination:e.initialPagination,"hide-pagination":"","visible-columns":e.visibleColumns},ta({top:t(a=>[i(H,{class:"full-width q-pa-lg"},{default:t(()=>[i(k,null,{default:t(()=>[i(x,{class:"text-weight-bold"},{default:t(()=>[f(o(e.t("rate_limit.title")),1)]),_:1}),i(x,{caption:""},{default:t(()=>[S("span",{innerHTML:e.t("rate_limit.explain")},null,8,Ta)]),_:1})]),_:1}),i(fa),i(k,{side:""},{default:t(()=>[i(Oe,{modelValue:e.visibleColumns,"onUpdate:modelValue":l[0]||(l[0]=u=>e.visibleColumns=u),multiple:"",outlined:"",square:"",dense:"","options-dense":"","display-value":n.$q.lang.table.columns,"emit-value":"","map-options":"",options:e.columns,"option-value":"name","options-cover":"",style:{"min-width":"150px"}},null,8,["modelValue","display-value","options"])]),_:1}),s.maximizedWindow?A("",!0):(d(),_(k,{key:0,side:""},{default:t(()=>[i(Q,{flat:"",square:"",icon:a.inFullscreen?"fullscreen_exit":"fullscreen",onClick:a.toggleFullscreen},null,8,["icon","onClick"])]),_:2},1024))]),_:2},1024)]),"header-cell-wAPIkey":t(a=>[i(Ae,{props:a},{default:t(()=>[S("span",Ia,o(a.col.label),1)]),_:2},1032,["props"])]),"header-cell-wPremium":t(a=>[i(Ae,{props:a},{default:t(()=>[S("span",Sa,o(a.col.label),1)]),_:2},1032,["props"])]),"body-cell-icon":t(a=>[i(O,{props:a},{default:t(()=>[i(ma,{src:a.value,width:"36px"},null,8,["src"])]),_:2},1032,["props"])]),"body-cell-endpoint":t(a=>[i(O,{props:a},{default:t(()=>[S("code",null,o(a.value),1)]),_:2},1032,["props"])]),"body-cell-woAPIkey":t(a=>[i(O,{props:a},{default:t(()=>[a.value?(d(),Y("span",Aa,o(a.value),1)):(d(),_(I,{key:0,name:"block",color:"negative"}))]),_:2},1032,["props"])]),"body-cell-wAPIkey":t(a=>[i(O,{props:a},{default:t(()=>[S("span",qa,o(a.value),1),String(a.value).includes("X")?(d(),_(I,{key:0,name:"keyboard_double_arrow_up",color:"primary",class:"cursor-pointer"},{default:t(()=>[i(D,{"max-width":"300px"},{default:t(()=>[f(o(e.t("rate_limit.batch_explain")),1)]),_:1})]),_:1})):A("",!0)]),_:2},1032,["props"])]),"body-cell-wPremium":t(a=>[i(O,{props:a},{default:t(()=>[S("span",xa,o(a.value),1)]),_:2},1032,["props"])]),"body-cell-latency":t(a=>[i(O,{props:a},{default:t(()=>[a.value?(d(),Y("span",Ra,o(a.value),1)):(d(),_(Ue,{key:0,icon:"bolt",label:a.row.latencyDepends,size:"sm"},{default:t(()=>[f(o(a.value)+" ",1),a.row.latencyExplain?(d(),_(I,{key:0,name:"help",class:"cursor-pointer q-ml-sm"},{default:t(()=>[i(D,{"max-width":"300px"},{default:t(()=>[f(o(a.row.latencyExplain),1)]),_:2},1024)]),_:2},1024)):A("",!0)]),_:2},1032,["label"]))]),_:2},1032,["props"])]),_:2},[s.showActionButtons?{name:"bottom",fn:t(()=>[S("div",Ca,[i(Be,{outline:"",square:""},{default:t(()=>[i(Q,{outline:"",label:e.t("get_new_key"),square:"",icon:"key",href:"/?sui=apikey",padding:"md",target:"_blank"},null,8,["label"]),i(he),i(Q,{outline:"",label:e.t("header.contact_us"),square:"",icon:"handshake",to:"/contact-sales",padding:"md"},null,8,["label"])]),_:1})])]),key:"0"}:void 0]),1032,["title","rows","columns","pagination","visible-columns"])]),_:1})}const Ba=de(Ka,[["render",Ma],["__file","RateLimitComponent.vue"]]),Ua=re({__name:"AutoRechargeItem",props:Te({apiKey:{},disable:{type:Boolean},isAutoCharge:{type:Boolean},isPaidKey:{type:Boolean},navigateToPurchase:{type:Boolean}},{autoRecharge:{type:Boolean},autoRechargeModifiers:{},rechargeThreshold:{type:Number},rechargeThresholdModifiers:{}}),emits:Te(["update"],["update:autoRecharge","update:rechargeThreshold"]),setup(n,{expose:l,emit:s}){l();const e=n,r=s,g=Ie(n,"autoRecharge"),a=Ie(n,"rechargeThreshold"),{t:u}=oe({useScope:"global"}),m=Re(),v=Me(),{user:C}=le(v),K=z(),{products:R}=le(K),w=be(),{isBusyState:p}=le(w),c=[{label:"10K",value:1e4},{label:"1M",value:1e6},{label:"1B",value:1e9}],T=P(!1),q=B(()=>R.value.filter(b=>b.price>0).map(b=>({label:`$${b.price} / `+u(`embedding.${b.product_name.replace(".","_")}`),value:b.price_id}))),j={props:e,emit:r,autoRecharge:g,rechargeThreshold:a,t:u,$q:m,userStore:v,user:C,embeddingStore:K,products:R,apiKeyStore:w,isBusyState:p,rechargeThresholdOptions:c,hideSelected:T,productOptions:q,updateAutoRecharge:async b=>{var F;!e.isAutoCharge&&b?m.dialog({title:u("embedding.auto_recharge_enable_title"),message:u("embedding.auto_recharge_enable_message2"),options:{type:"radio",model:q.value[0].value,items:q.value},cancel:(F=e.navigateToPurchase)!=null?F:!1}).onOk(async E=>{var W,ae;p.value.delete(e.apiKey);const M=new URL(window.location.href),G=Date.now().toString();M.searchParams.set("price_id",E),M.searchParams.set("session_id",G),M.searchParams.set("register_status","success"),M.searchParams.set("api_key",ha(e.apiKey));const J=M.toString();M.searchParams.set("register_status","cancel");const ee=M.toString();if(a.value)try{p.value.add(e.apiKey);const te=await K.setAutoRecharge(e.apiKey,{successUrl:J,cancelUrl:ee,priceId:E,threshold:a.value,email:(ae=(W=C.value)==null?void 0:W.email)!=null?ae:void 0});te&&(window.location.href=te)}finally{p.value.delete(e.apiKey)}}).onCancel(()=>{g.value=!1}):e.isAutoCharge&&!b&&m.dialog({title:u("embedding.auto_recharge_confirm_title"),message:u("embedding.auto_recharge_confirm_message"),cancel:!0}).onOk(async()=>{p.value.add(e.apiKey);try{await K.cancelAutoRecharge(e.apiKey)||(g.value=!0)}finally{p.value.delete(e.apiKey)}r("update")}).onCancel(()=>{g.value=!0})},updateThreshold:async b=>{const F=a.value;g.value&&e.isAutoCharge&&(T.value=!0,m.dialog({title:u("key_manager.recharge_threshold_confirm_title"),message:u("key_manager.recharge_threshold_confirm_message",{_threshold:ba(b)}),cancel:!0}).onOk(async()=>{p.value.add(e.apiKey),T.value=!1;try{await K.updateAutoRecharge(e.apiKey,b)}finally{p.value.delete(e.apiKey)}}).onCancel(()=>{T.value=!1,a.value=F}))}};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}});function Da(n,l,s,e,r,g){return d(),_(H,{tag:"label",onClick:l[3]||(l[3]=Se(()=>{},["stop"]))},{default:t(()=>[e.$q.screen.gt.sm?(d(),_(k,{key:0,avatar:""},{default:t(()=>[i(I,{name:"currency_exchange"})]),_:1})):A("",!0),i(k,null,{default:t(()=>[i(x,{class:"text-bold"},{default:t(()=>[f(o(e.t("embedding.auto_recharge")),1)]),_:1}),i(x,{caption:"",lines:"2"},{default:t(()=>[f(o(s.isAutoCharge?e.t("embedding.auto_recharge_enable"):e.t("embedding.auto_recharge_description"))+" ",1),i(D,{"max-width":"40rem"},{default:t(()=>[f(o(s.isAutoCharge?e.t("embedding.auto_recharge_enable"):e.t("embedding.auto_recharge_description")),1)]),_:1})]),_:1})]),_:1}),i(k,{side:""},{default:t(()=>[i(ia,{modelValue:e.autoRecharge,"onUpdate:modelValue":[l[0]||(l[0]=a=>e.autoRecharge=a),e.updateAutoRecharge],color:"primary",disable:s.disable||e.isBusyState.has(s.apiKey),"checked-icon":"check","unchecked-icon":"close"},null,8,["modelValue","disable"])]),_:1}),i(k,{side:""},{default:t(()=>[i(Oe,{modelValue:e.rechargeThreshold,"onUpdate:modelValue":[l[1]||(l[1]=a=>e.rechargeThreshold=a),e.updateThreshold],options:e.rechargeThresholdOptions,"hide-selected":e.hideSelected,disable:e.isBusyState.has(s.apiKey),label:e.t("embedding.recharge_threshold"),style:{"min-width":"160px"},"option-label":a=>`< ${a.label} ${e.t("embedding.tokens")}`,onClick:l[2]||(l[2]=Se(()=>{},["prevent"])),"emit-value":"","map-options":""},null,8,["modelValue","hide-selected","disable","label","option-label"])]),_:1})]),_:1})}const Oa=de(Ua,[["render",Da],["__file","AutoRechargeItem.vue"]]),Qa=re({__name:"PurchaseComponent",props:{purchaseKey:{default:""},hideUsage:{type:Boolean,default:!1},hideKey:{type:Boolean,default:!1},hideStripeInfo:{type:Boolean,default:!1},hideFreePlan:{type:Boolean,default:!1},autoCharge:{type:Boolean},threshold:{}},setup(n,{expose:l}){l();const s=n,{t:e}=oe({useScope:"global"}),r=Re(),g=Me(),a=be(),u=z(),{apiKey:m,products:v,isApiKeyInfoLoading:C,isPremiumPaidUser:K,apiKeyInfo:R}=le(u),w=P(s.purchaseKey||m.value),p=P(R==null?void 0:R.value);na(async()=>{p.value=await u.getKeyInfo(w.value),T.value=s.autoCharge||!E.value||M.value,q.value=s.threshold||1e6});const c=P(0),T=P(!0),q=P(1e6),h=P(""),$=P(!0),j={"1M tokens":["paywall.no_commercial"],"1B tokens":["paywall.standard_key","paywall.full_commercial","paywall.key_manager"],"11B tokens":["paywall.premium_key","paywall.full_commercial","paywall.premium_key_manager","paywall.priority_support","paywall.free_hour_consult"]},b=B(()=>v.value.map(y=>({...y,isActive:()=>h.value===y.price_id,tag:()=>e(`embedding.${y.product_name}_targetUser`),title:()=>e(`embedding.${y.product_name.replace(".","_")}`),description:()=>e(`embedding.${y.product_name.replace(".","_")}_intuition1`),isFree:y.price===0,priceLabel:()=>y.price>0?`$${y.price}`:e("embedding.free"),priceDescription:()=>y.price>0?`${(y.price/y.token_quantity*1e6).toFixed(3)} ${e("embedding.per_m")}`:e("embedding.1M_free_description"),handler:()=>y.price>0?ee(y.price_id):void 0}))),F=B(()=>{var y,L;return(L=(y=p.value)==null?void 0:y.wallet.total_balance)!=null?L:0}),E=B(()=>{var y;return!!((y=p.value)!=null&&y.email)}),M=B(()=>{var y;return E.value&&!!((y=p.value)!=null&&y.metadata.auto_recharge)}),G=B(()=>!!w.value&&(p==null?void 0:p.value)!==void 0),J=B(()=>!G.value||C.value),ee=async y=>{var Pe,Ke;if(J.value||h.value)return;const L=v.value.find(ce=>ce.price_id===y),V=new URL(window.location.href),Qe=Date.now().toString();V.searchParams.set("price_id",y),V.searchParams.set("session_id",Qe),V.searchParams.set("purchase_status","cancel");const je=V.toString();V.searchParams.set("purchase_status","success");const Ee=V.toString();h.value=y;const X={price_id:y,success_url:Ee,cancel_url:je};(Pe=g.user)!=null&&Pe.email&&(X.email=g.user.email);const we=localStorage.getItem(la);we&&(X.metadata={sales_key:we}),T.value&&(X.metadata={...X.metadata,auto_recharge:!0,threshold:q.value}),L&&gtag("event","begin_checkout",{currency:L.currency,value:L.price,items:[{id:L.product_id,name:L.product_name}]});const ve=await u.checkoutWithStripe(w.value,X);if(h.value="",!ve)return;u.apiKey=w.value,((Ke=a.keys)==null?void 0:Ke.some(ce=>ce.key===w.value))||await a.addKey(w.value),await a.setPrimaryKey(u.apiKey),u.getCurrentKeyInfo(),window.location.href=ve.url},W=async()=>{p.value=await u.getKeyInfo(w.value),T.value=!E.value||M.value,m.value===w.value&&u.setApiKeyInfo(p.value)},ae=async()=>{G.value&&w.value!==m.value&&r.dialog({title:e("embedding.api_key_update_title"),message:e("embedding.api_key_update_message"),cancel:!0}).onOk(async()=>{m.value=w.value,W(),await a.addKey(w.value),a.setPrimaryKey(w.value)})},te=()=>{J.value||r.dialog({component:Pa,componentProps:{apiKey:w.value}})};sa(async()=>{await u.getProducts(),setInterval(()=>{c.value=(c.value+1)%ra.length},3e3)});const ie=P(!1),ke={props:s,t:e,$q:r,userStore:g,apiKeyStore:a,embeddingStore:u,apiKey:m,products:v,isApiKeyInfoLoading:C,isPremiumPaidUser:K,apiKeyInfo:R,inputApiKey:w,inputApiKeyInfo:p,currentIndex:c,autoRecharge:T,rechargeThreshold:q,currentPriceID:h,isPwd:$,tierFeatures:j,productCards:b,apiKeyTokens:F,isPaidUser:E,isAutoCharge:M,isInputApiKeyValid:G,isInputApiKeyDisabled:J,checkoutProduct:ee,getKeyInfo:W,updateApiKey:ae,openUsageHistoryDialog:te,isApiKeyCopyDone:ie,copyApiKey:()=>{!m.value||ie.value||(_a(m.value).then(()=>{r.notify({message:e("copy_to_clipboard_success"),icon:"done"}),ie.value=!0,gtag==null||gtag("event","embedding_copy_api_key",{location:document.location.href})}),setTimeout(()=>{ie.value=!1},1800))},get flatEnterprises(){return oa},get formatNumber(){return pe},RateLimitComponent:Ba,AutoRechargeItem:Oa};return Object.defineProperty(ke,"__isScriptSetup",{enumerable:!1,value:!0}),ke}}),ja=["innerHTML"],Ea=["innerHTML","data-text"],La={class:"row justify-center text-caption text-dim q-pt-md q-pb-sm"},Na={class:"row justify-center q-gutter-x-sm"};function za(n,l,s,e,r,g){return d(),_(Ce,{class:"q-pa-md q-gutter-y-sm"},{default:t(()=>[!s.hideUsage&&e.isInputApiKeyValid?(d(),_(H,{key:0},{default:t(()=>[e.$q.screen.gt.sm?(d(),_(k,{key:0,avatar:""},{default:t(()=>[i(I,{name:"data_usage"})]),_:1})):A("",!0),i(k,null,{default:t(()=>[i(x,{class:"text-bold"},{default:t(()=>[f(o(e.t("embedding.remaining")),1)]),_:1}),i(x,{class:U({"text-negative":e.apiKeyTokens<0})},{default:t(()=>[S("span",{innerHTML:e.t("embedding.remaining_left",{_leftTokens:e.formatNumber(e.apiKeyTokens)})},null,8,ja)]),_:1},8,["class"])]),_:1}),i(k,{side:""},{default:t(()=>[i(Be,{square:"",outline:""},{default:t(()=>[i(Q,{outline:"",square:"",icon:"refresh",disable:e.isInputApiKeyDisabled,onClick:e.getKeyInfo,loading:e.isApiKeyInfoLoading},{default:t(()=>[i(D,null,{default:t(()=>[f(o(e.t("embedding.refresh_token_count1")),1)]),_:1})]),_:1},8,["disable","loading"]),i(he),i(Q,{square:"",outline:"","no-caps":"",label:e.t("embedding.last_7_days"),disable:e.isInputApiKeyDisabled,onClick:e.openUsageHistoryDialog},null,8,["label","disable"])]),_:1})]),_:1})]),_:1})):A("",!0),s.hideKey?A("",!0):(d(),_(H,{key:1},{default:t(()=>[e.$q.screen.gt.sm?(d(),_(k,{key:0,avatar:""},{default:t(()=>[i(I,{name:"key",class:U({"golden-foil":e.isPremiumPaidUser,"silver-foil":e.isPaidUser})},null,8,["class"])]),_:1})):A("",!0),i(k,null,{default:t(()=>[i(da,{"input-style":"font-family: monospace",modelValue:e.inputApiKey,"onUpdate:modelValue":l[1]||(l[1]=a=>e.inputApiKey=a),"hide-bottom-space":"",type:e.isPwd?"password":"text",hint:e.t("embedding.key_to_top_up"),filled:"",square:"",label:e.inputApiKey?`${e.t("embedding.key_warn_v2")}`:e.t("embedding.key_enter_placeholder_to_topup"),error:!e.isInputApiKeyValid,"error-message":e.inputApiKey?e.t("embedding.input_api_key_error1"):"","input-class":"ellipsis"},{append:t(()=>[i(I,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:l[0]||(l[0]=a=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:t(()=>[i(Q,{flat:"",square:"",icon:e.isApiKeyCopyDone?"done":"content_copy",color:e.isApiKeyCopyDone?"primary":"",onClick:e.copyApiKey,stretch:""},{default:t(()=>[i(D,null,{default:t(()=>[f(o(e.t("copy")),1)]),_:1})]),_:1},8,["icon","color"])]),after:t(()=>[e.isInputApiKeyValid&&e.inputApiKey!==e.apiKey?(d(),_(Q,{key:0,icon:"save",onClick:e.updateApiKey,stretch:"",square:"",flat:""})):A("",!0)]),_:1},8,["modelValue","type","hint","label","error","error-message"])]),_:1})]),_:1})),s.hideStripeInfo?A("",!0):(d(),_(H,{key:2},{default:t(()=>[e.$q.screen.gt.sm?(d(),_(k,{key:0,avatar:"",side:"",class:"relative-position"},{default:t(()=>[i(I,{name:"fab fa-stripe"}),i(I,{name:"o_verified_user",size:"xs",class:"absolute-bottom-right q-mr-sm q-mb-xs text-positive"})]),_:1})):A("",!0),i(k,null,{default:t(()=>[i(x,{class:"text-bold"},{default:t(()=>[f(o(e.t("embedding.buy_more_quota")),1)]),_:1}),i(x,{caption:"",lines:"2"},{default:t(()=>[f(o(e.t("embedding.tax_may_apply")),1)]),_:1})]),_:1}),e.isPaidUser?(d(),_(k,{key:1,side:"",class:"q-pa-none"},{default:t(()=>[i(Q,{outline:"","icon-right":"open_in_new",label:e.t("embedding.manage_billing"),stretch:"",href:"https://stripe.jina.ai",target:"_blank","no-caps":""},{default:t(()=>[i(D,null,{default:t(()=>[f(o(e.t("embedding.manage_billing_tip")),1)]),_:1})]),_:1},8,["label"])]),_:1})):A("",!0)]),_:1})),i(se,{class:"row q-pa-md q-py-none bg-transparent",flat:""},{default:t(()=>[(d(!0),Y(ye,null,_e(e.productCards.filter(a=>!s.hideFreePlan||!a.isFree),(a,u)=>(d(),Y("div",{key:u,class:U(["col-12 col-sm-6 q-pa-sm cursor-pointer",{"col-lg-4":!s.hideFreePlan}])},[xe((d(),_(se,{bordered:"",flat:"",class:U(["full-width full-height column justify-between",!e.isInputApiKeyDisabled&&!e.currentPriceID&&!a.isFree?"q-hoverable bg-mixed-200":"cursor-not-allowed"]),square:"",style:ca(a.isActive()?"cursor: wait !important;":""),onClick:a.handler},{default:t(()=>[l[5]||(l[5]=S("span",{class:"q-focus-helper"},null,-1)),i(ge,{class:"column items-center non-selectable text-h2 q-pt-xl"},{default:t(()=>[i(Ue,{label:a.tag(),outline:"",square:"",style:{"border-radius":"0"},size:"sm",class:U(["q-my-xl",{"silver-border":a.product_name==="1B tokens","gold-border":a.product_name==="11B tokens"}])},null,8,["label","class"]),S("span",{innerHTML:a.title(),"data-text":a.title(),class:U(["text-weight-bold",{"text-dim":a.product_name==="1M tokens","silver-foil":a.product_name==="1B tokens","golden-foil":a.product_name==="11B tokens"}])},null,10,Ea),S("div",La,[f(o(e.t("embedding.includes"))+" ",1),i(D,{"max-width":"300px"},{default:t(()=>[f(o(a.description()),1)]),_:2},1024)]),S("div",Na,[(d(!0),Y(ye,null,_e(e.flatEnterprises,m=>(d(),_(I,{key:m.label,name:`img:${m.icon}`,size:"sm"},{default:t(()=>[i(D,null,{default:t(()=>[S("b",null,o(e.t(m.label)),1),l[4]||(l[4]=S("br",null,null,-1)),f(" "+o(e.t(m.caption)),1)]),_:2},1024)]),_:2},1032,["name"]))),128))])]),_:2},1024),i(ge,{class:"column items-center non-selectable"},{default:t(()=>[i(Ce,{dense:""},{default:t(()=>[(d(!0),Y(ye,null,_e(e.tierFeatures[a.product_name],(m,v)=>(d(),_(H,{key:m},{default:t(()=>[i(k,null,{default:t(()=>[i(x,{caption:""},{default:t(()=>[a.product_name!=="1M tokens"?(d(),_(I,{key:0,name:v===0?"key":"task_alt",class:U({"golden-foil":a.product_name==="11B tokens","silver-foil":a.product_name==="1B tokens"})},null,8,["name","class"])):A("",!0),f(" "+o(e.t(m)),1)]),_:2},1024),i(D,{"max-width":"300px"},{default:t(()=>[f(o(e.t(`${m}_description`)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024),i(ge,{class:U({"bg-mixed-300":!a.isFree})},{default:t(()=>[i(H,null,{default:t(()=>[i(k,null,{default:t(()=>[i(x,{class:U({"text-bold":!a.isFree})},{default:t(()=>[f(o(a.priceLabel()),1)]),_:2},1032,["class"]),i(x,{caption:""},{default:t(()=>[f(o(a.priceDescription()),1)]),_:2},1024)]),_:2},1024),a.isFree?A("",!0):(d(),_(k,{key:0,side:""},{default:t(()=>[i(I,{name:"add_shopping_cart"})]),_:1}))]),_:2},1024)]),_:2},1032,["class"]),i(qe,{showing:e.currentPriceID===a.price_id,label:e.t("embedding.wait_stripe"),"label-style":"font-size: 0.8em",size:"sm",class:"non-selectable lock-blur"},null,8,["showing","label"])]),_:2},1032,["class","style","onClick"])),[[ua,!a.isFree&&!e.isInputApiKeyDisabled&&!e.currentPriceID]])],2))),128)),i(qe,{showing:!e.isInputApiKeyValid,class:"lock-blur",label:e.t("embedding.right_api_key_to_charge"),size:"0"},null,8,["showing","label"])]),_:1}),i(ya,{label:e.t("rate_limit.understanding"),icon:e.$q.screen.gt.sm?"speed":void 0,"header-class":"text-bold",caption:e.t("rate_limit.understanding_description")},{default:t(()=>[i(e.RateLimitComponent,{"show-action-buttons":!1})]),_:1},8,["label","icon","caption"]),i(e.AutoRechargeItem,{"api-key":e.inputApiKey,"api-key-info":e.inputApiKeyInfo,"is-paid-key":e.isPaidUser,"is-auto-charge":e.isAutoCharge,"auto-recharge":e.autoRecharge,"onUpdate:autoRecharge":l[2]||(l[2]=a=>e.autoRecharge=a),"recharge-threshold":e.rechargeThreshold,"onUpdate:rechargeThreshold":l[3]||(l[3]=a=>e.rechargeThreshold=a),disable:e.isInputApiKeyDisabled,onUpdate:e.getKeyInfo},null,8,["api-key","api-key-info","is-paid-key","is-auto-charge","auto-recharge","recharge-threshold","disable"])]),_:1})}const it=de(Qa,[["render",za],["__scopeId","data-v-977991db"],["__file","PurchaseComponent.vue"]]);export{Oa as A,it as P,qe as Q,Ba as R,Pa as U,be as u};

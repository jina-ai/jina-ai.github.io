import{d5 as f,aB as y,a1 as b,dm as S,aC as w}from"./index-CWkEFhZt.js";import{u as C}from"./blogs-Dg7ODAid.js";const A=f.value.map(t=>({...t,type:"product"}));var L=(t=>(t.PRODUCT="product",t.NEWS="news",t.COMPANY="company",t.ELLIPSIS="ellipsis",t.HEADER="header",t.SEPARATOR="separator",t.ON_PAGE_RAG="onPageRAG",t.ASK_SOLUTION="askSolution",t.ASK_DEEPSEARCH="askDeepSearch",t))(L||{});function m(t){return t.toLowerCase().replace(/[-_.,!?;:]/g," ").replace(/\s+/g," ").trim()}function k(t,i){const a=t.length,e=i.length,s=Array(a+1).fill(0).map(()=>Array(e+1).fill(0));for(let n=1;n<=a;n++)for(let r=1;r<=e;r++)t[n-1]===i[r-1]?s[n][r]=s[n-1][r-1]+1:s[n][r]=Math.max(s[n-1][r],s[n][r-1]);return s[a][e]}function d(t,i){const a=m(t),e=m(i);if(e.length>a.length)return 0;const n=k(a,e)/e.length*50;let r=0;return a.includes(e)&&(r+=30),a.split(" ").some(c=>c===e||c.startsWith(e+" ")||c.endsWith(" "+e))&&(r+=20),n+r}function P(t,i){if(!i.trim()||i.length<2)return[];const a=Math.min(40+i.length*2,60);return t.map(e=>{const s=d(e.label,i),n=d(e.description,i)*.7;return{score:Math.max(s,n),result:{type:"news",label:e.label,icon:e.icon,description:e.description,time:e.time,slug:e.slug}}}).filter(e=>e.score>=a).sort((e,s)=>s.score-e.score).map(e=>e.result)}function E(t,i,a){if(!i.length)return t;const e=[...t];e.length>0&&e.push({type:"separator"}),e.push({type:"header",label:"header.news",number:i.length});const s=i.slice(0,a);e.push(...s);const n=i.slice(a);return n.length>0&&e.push({type:"ellipsis",label:"header.see_all_news",number:n.length,moreResults:n}),e}const R=y("search",{state:()=>({answerChunks:"",isBusy:!1,isStreaming:!1,isComposing:!1,searchImmediate:!1}),getters:{},actions:{async composeResult(t){this.isComposing=!0;try{const i=C(),a=3,e=i.translatedAllBlogs.map(n=>({label:n.title,icon:n.featureImage,value:n.title,description:n.excerpt,time:b(n.publishedAt).format("MMMM DD, YYYY"),slug:n.slug,type:"news"}));let s=[];if(t){const n=[{type:"askDeepSearch",label:t},{type:"separator"},{type:"onPageRAG",label:t},{type:"askSolution",label:t}];s.push(...n);const r=A.filter(l=>{const p=this.te(l.label)?this.t(l.label):l.label,h=this.te(l.description)?this.t(l.description):l.description;return p.toLowerCase().includes(t.toLowerCase())||h.toLowerCase().includes(t.toLowerCase())}).map(l=>({type:"product",label:l.label,icon:l.icon,link:l.link,description:l.description}));r.length&&(s.length&&s.push({type:"separator"}),s.push({label:"header.products",number:r.length,type:"header"}),s=s.concat(r.slice(0,a)),r.length>a&&s.push({label:"header.see_all_products",type:"ellipsis",number:r.length-a,moreResults:r.slice(a)}));const o=S.filter(l=>!l.external).filter(l=>this.t(l.label).toLowerCase().includes(t.toLowerCase())).map(l=>({type:"company",label:l.label,link:l.routerLink}));o.length&&(s.length&&s.push({type:"separator"}),s.push({label:"header.company",number:o.length,type:"header"}),s=s.concat(o.slice(0,a)),o.length>a&&s.push({label:"header.see_all_company",type:"ellipsis",number:o.length-a,moreResults:o.slice(a)}));const c=P(e,t);s=E(s,c,a)}return s}finally{this.isComposing=!1}},async search(t,i){var n,r;this.answerChunks="",this.isBusy=!0,this.isStreaming=!0;let a="";i==="onPageRAG"&&await fetch(`https://r.jina.ai/https://jina.ai${window.location.pathname}`).then(o=>o.text()).then(o=>{a=o});const e={parameters:{question:t,content:a}},s=i==="onPageRAG"?"https://api.promptperfect.jina.ai/BcHLFuKk3u9naJ4u4G1H":"https://api.promptperfect.jina.ai/EEBuotbLAugUDjr4mq1j";try{const o=await fetch(s,{headers:{"content-type":"application/json"},body:JSON.stringify(e),method:"POST"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);if((n=o.headers.get("content-type"))!=null&&n.includes("text/event-stream")){if(o.body){const c=o.body.getReader(),l=new TextDecoder;for(;;){const{done:p,value:h}=await c.read();if(p){this.isStreaming=!1;break}h&&(this.isBusy=!1,l.decode(h).split(`

`).forEach(g=>{const u=g.replace(/data: /g,"");u&&(this.answerChunks+=u)}))}}}else if((r=o.headers.get("content-type"))!=null&&r.includes("application/json")){const c=(await o.json()).data;this.answerChunks=c}else throw new Error("Unknown response type")}catch(o){w.create({color:"negative",message:this.t("landing_page.error",{message:o}),icon:"report_problem"})}finally{this.isBusy=!1}}}});export{L as R,R as u};

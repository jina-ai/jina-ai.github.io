{
  "slug": "precise-rag-with-jina-reranker-and-llamaindex",
  "id": "65e97909b22368000152a4c7",
  "uuid": "3bcc0e9b-38b1-4df4-bcf7-dbe893156630",
  "title": "Jina Reranker と LlamaIndex による高精度な RAG",
  "html": "<p><a href=\"https://www.sbert.net/examples/applications/cross-encoder/README.html?ref=jina-ai-gmbh.ghost.io\"><u>bi-encoder モデル</u></a>（<a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>など）は事前に計算された埋め込みのデータベースから多くの一致ドキュメントを素早く取得できますが、リランカーモデルはユーザーのクエリと取得したドキュメントをクロスエンコーディングする、より遅いものの正確なアプローチを使用してこのセットを絞り込むことができます。Jina AI は<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>最初のリランカーモデル</u></a>である<code>jina-reranker-v1-base-en</code>をリリースしました。この記事では、リランカーが RAG の精度を最適化するために不可欠である理由と、<a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>/<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Reranker</u></a>、<a href=\"https://www.llamaindex.ai/?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a>、および <code>Mixtral-8x7B-Instruct-v0.1</code> 言語モデル（<a href=\"https://huggingface.co/mistralai/Mixtral-8x7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace でホスト</u></a>）を使用して最先端の RAG システムを構築する方法について詳しく説明します。</p><p>必要なもの：</p><ul><li><a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings と Reranker API の統合キー</u></a></li><li><a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace アカウントとトークン</u></a></li></ul><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">Maximize the search relevancy and RAG accuracy at ease</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><p>Jina Embeddings と Reranker モデル、および Mixtral はリモートで実行され、RESTful API を介してアクセスされるため、特別なハードウェアは必要ありません。</p><h2 id=\"what-is-a-reranker\">リランカーとは何か</h2><p>チュートリアルを続ける前に、リランカーとは何かを理解することが重要です。リランカーとは何か、そしてなぜ Jina Reranker V1 があなたにとって最適な選択なのかを完全に理解するために、続行する前に Jina Reranker V1 のリリース記事をお読みください。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>要約すると、リランカーはクロスエンコーダーモデルで、<em>ドキュメント-クエリ</em>のペアを入力として受け取り、その入力ペアに対する関連性スコアを出力します。リランカーを使用することで、ユーザーは特定のクエリに対してドキュメントを最も関連性の高いものから低いものまで並べ替えることができます。</p><h2 id=\"why-use-jina-reranker-v1-base-en\"><code>jina-reranker-v1-base-en</code> を使用する理由</h2><p>リランキングは、埋め込みモデルのみを使用する場合よりもはるかに関連性の高い情報を提供します。私たちの<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><u>モデルリリース記事</u></a>では、Jina Reranker がオープンソースおよびクローズドソースの競合他社と比較して際立っており、ヒット率で <strong>8%</strong>、<a href=\"https://en.wikipedia.org/wiki/Mean_reciprocal_rank?ref=jina-ai-gmbh.ghost.io\"><strong><u>平均逆順位</u></strong></a>で <strong>33%</strong> の検索システムの改善を実現できることを実証しました。</p><p>これは、適用された RAG ソリューションを通じて得られる応答の品質に直接的な影響を与えます。この主張を裏付ける理論とともに、LlamaIndex で構築された RAG パイプラインに Jina Reranker がどのような効果をもたらすかを実例で示します。</p><h2 id=\"before-we-start-a-note-on-llamaindex-node-postprocessors\">始める前に：LlamaIndex のノード後処理について</h2><p><a href=\"https://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/root.html?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> のノード後処理は、クエリエンジン内で検索後かつ応答生成前にノードを変換またはフィルタリングするモジュールです。このパッケージの一部として、LlamaIndex は組み込みオプションとカスタム追加のための API の両方を提供しています。</p><p><strong>Jina Reranker は現在、LlamaIndex にノード後処理として</strong><a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><strong><u>統合</u></strong></a><strong>されています</strong>。応答の精度を向上させるために、取得されたノードはクエリとの関連性に基づいて再順序付けされ、上位 <strong><em>N</em></strong> 個のノードが返されます。</p><h2 id=\"follow-along-on-google-colab\">Google Colab で一緒に進める</h2><p>このチュートリアルには、<a href=\"https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>Google Colab</u></a> またはローカルで実行できる付属のノートブックがあります。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">llama_index/docs/docs/examples/node_postprocessor/JinaRerank.ipynb at main · run-llama/llama_index</div><div class=\"kg-bookmark-description\">LlamaIndex is a data framework for your LLM applications - run-llama/llama_index</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/assets/pinned-octocat-093da3e6fa40.svg\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">run-llama</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2000e9ce9c43753a6316de82e8309737edaa6377de7b47d2d8b08a4a3caa8a71/run-llama/llama_index\" alt=\"\"></div></a></figure><h3 id=\"the-dataset-2024-nike-kids-product-catalog\">データセット：2024 Nike Kids 製品カタログ</h3><p>RAG アプリケーションにおける Jina Reranker のパフォーマンス向上を示すために、<a href=\"https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&ref=jina-ai-gmbh.ghost.io\"><u>2024 Nike Kids 製品カタログ</u></a>をデータセットとして選択しました。このドキュメントには、2024 年に Nike が提供する子供向け製品の構造化されたセットが含まれています。このデータセットを選んだのは、リランカーの効果が明確に示され、多くのユーザーに分かりやすいためです。</p><h3 id=\"install-the-prerequisites\">前提条件のインストール</h3><p>必要な要件をインストールするには、以下を実行します：</p><pre><code class=\"language-bash\">pip install llama-index-postprocessor-jinaai-rerank\npip install llama-index-embeddings-jinaai\npip install llama-index\npip install llama-index-llms-huggingface\npip install \"huggingface_hub[inference]\"</code></pre><h3 id=\"access-mixtral-llm\">Mixtral LLM へのアクセス</h3><p><code>Mixtral-8x7B-Instruct-v0.1</code> LLM を使用するには、<a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace</u></a> トークンが必要です。</p><pre><code class=\"language-Python\">from llama_index.llms.huggingface import HuggingFaceInferenceAPI\n\nhf_inference_api_key = \"&lt;your HuggingFace access token here&gt;\"\n\nmixtral_llm = HuggingFaceInferenceAPI(\n    model_name=\"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n    token=hf_inference_api_key,\n)\n</code></pre><h3 id=\"access-jina-embeddings-and-jina-reranker\">Jina Embeddings と Jina Reranker へのアクセス</h3><p>Jina Embeddings と Jina Reranker を使用するには、専用の<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>API キー</u></a>が必要です。これを <code>api_key</code> という変数に保存し、LlamaIndex から Jina Embeddings モデルを呼び出します：</p><pre><code class=\"language-Python\">from llama_index.embeddings.jinaai import JinaEmbedding\n\napi_key = \"&lt;your Jina key here&gt;\"\njina_embeddings = JinaEmbedding(api_key=api_key)</code></pre><p>同様に、Jina Reranker モデルを呼び出すことができます。<code>top_n</code> パラメータを設定することで、最終出力で返される最も関連性の高いドキュメントの数を決定できます。この場合、<code>top_n=2</code>:</p><pre><code class=\"language-Python\">from llama_index.postprocessor.jinaai_rerank import JinaRerank\n\njina_rerank = JinaRerank(api_key=api_key, top_n=2)</code></pre><h3 id=\"download-the-2024-nike-kids-product-catalog\">2024年 Nike キッズ製品カタログのダウンロード</h3><p>データをダウンロードするには、以下のコードを実行します：</p><pre><code class=\"language-Python\">from llama_index.core import SimpleDirectoryReader\nimport requests\n\nurl = '&lt;https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&gt;'\nresponse = requests.get(url)\n\nwith open('Nike_Catalog.pdf', 'wb') as f:\n&nbsp;&nbsp;&nbsp;&nbsp;f.write(response.content)\n\nreader = SimpleDirectoryReader(\n&nbsp;&nbsp;&nbsp;&nbsp;input_files=[\"Nike_Catalog.pdf\"]\n)\n\ndocuments = reader.load_data()</code></pre><h3 id=\"generate-and-index-embeddings-with-jina-embeddings\">Jina Embeddings によるエンベディングの生成とインデックス作成</h3><p>セットアップが完了したので、エンベディングベクトル（ノード）を生成してインデックスを作成します。Jina Embeddings v2 モデルは最大 8192 トークンの入力を受け付けるため、このような文書の場合、さらなるテキストの分割やセクションのトークン数のチェックは必要ありません。文書のエンベッドとインデックス作成を行うには、以下のコードを実行します：</p><pre><code class=\"language-Python\">from llama_index.core import VectorStoreIndex\n\nindex = VectorStoreIndex.from_documents(\n&nbsp;&nbsp;&nbsp;&nbsp;documents=documents, embed_model=jina_embeddings\n)</code></pre><h3 id=\"query-for-results-without-jina-reranker\">Jina Reranker を使用しないクエリ結果の取得</h3><p>このテキストセットから特定の情報を検索する際、LlamaIndex の <code>query_engine</code> は以下の処理を行います：</p><ol><li>Jina Embeddings V2 を使用してクエリのエンベディングを作成します。</li><li>インデックスを使用して、クエリエンベディングとのコサイン類似度が最も高い <code>top_k = 10</code> の保存されたエンベディングを取得し、そのインデックス内の位置を返します。</li><li>ベクトルデータ配列内の対応するテキストを検索します。</li></ol><p>最高の Nike ジャージの生地について質問してみましょう：</p><pre><code>query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p><strong>結果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; EQUIPMENT87NIKE BRASILIA SMALL DUFFEL 9.5&nbsp;\nDM3976 $37.00\nSIZES: Misc&nbsp; OFFER DATE: 07/01/22&nbsp; END DATE: 07/01/25\nTough 600D polyester • Durable 300D polyester • Detachable shoulder\nstrap&nbsp;• Ventilated shoe or wet/dry storage • Secure zip pocket • \nLimited lifetime guarantee&nbsp;• Screened Swoosh design trademark\nDIMENSIONS:&nbsp; 20\" L x 10\" W x 11\" H&nbsp;\n010 Black/Black/(White) 068 Iron Grey/Black/(White)\n...</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/z2OKhAFnHCXw3aI4W1KUZNxzt8WOEERSG-prrBcmGwBEDTAFGavSN8eiHnvFF6R0L-dlwRUY3U8R7ysinoGTSSL-9_vr0RdCmrIRSy_xffvKz-Trqa1Yr49YGNb7R-GsDpCqilIW3cluVER4St5rUts\" class=\"kg-image\" alt=\"Three Nike Brasilia Small Duffel Bags, $37 each, in black, grey, navy with features listed and offer dates from 07/01/22 to 0\" loading=\"lazy\" width=\"594\" height=\"592\"></figure><h3 id=\"query-for-results-with-reranker\">Reranker を使用したクエリ結果の取得</h3><p>次に、RAG アプリケーションが異なる、より<em>関連性の高い</em>結果を生成するかどうかを確認するために、reranker を適用します。そのためには、<code>query_engine</code> に <code>node_postprocessors</code> を追加する必要があります：</p><pre><code class=\"language-Python\">query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm, node_postprocessors=[jina_rerank]\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p>reranker を使用しない前のケースと比較して、<code>query_engine</code> には <code>[jina_rerank]</code> に設定された <a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><u>node_postprocessors</u></a> パラメータが含まれるようになったことに注意してください。</p><p><strong>結果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; FOOTBALL – STOCK10\nDJ5731 $47.00\nSIZES:&nbsp; XS, S, M, L, XL, 2XL, 3XL\nFABRIC:&nbsp; Body/panels lining: 100% polyester. Pad: 100%\nethylene vinyl acetate.\nOFFER DATE:&nbsp; 04/01/23\nEND DATE:&nbsp; 04/01/27\nTake the field ready to give it your all in the Nike Recruit\nPants. They're made from lightweight, stretchy&nbsp;fabric with\nsweat-wicking power to help keep you dry and moving freely\nwhen the game heats up. With&nbsp;integrated pads shaped for a\ncomfortable fit, you'll be prepared for a performance you can\nbe proud of.&nbsp;Choose from 6 different colors to outfit your\nteam. Nike Dri-FIT technology moves sweat away from your&nbsp;skin\nfor quicker evaporation, helping you stay dry and comfortable.\nLightweight knit fabric stretches with&nbsp;you to let you move\nnaturally. Thigh, knee, hip and tailbone pads are shaped for\nan optimal fit, without&nbsp;compromising on coverage. A\nbody-hugging fit is designed to help keep the padding in place\nand close to&nbsp;the body. Belt at the waist lets you dial in your\nperfect fit to maximize comfort. Elastic at hems.\nHip width: 15\", Inseam length: 11.75\" (size medium).\n010 Black/(White) 060 Team Anthracite/(White) 100 White/(Black)\n419 Team Navy/(White) 493 Team Royal/(White) 657 Team Scarlet/(White)</code></pre><p></p><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/X0ngGFoOz8S_KlRhAlQs4rOooKsV92d06-UBa7BsFPiTilgTD9xuQfgIblG7dTq0BQp4ZA9DlBCjFvA6D62eUVDmxxOO38va5mlnutPr4Zlu6l70tvbGtmrS2V0rpn-OE__tarMtR1MxAmD2oQ3m2qg\" class=\"kg-image\" alt=\"Product display of boys' Nike DF Stock Recruit Pants with sizes, pricing, and various color options highlighted.\" loading=\"lazy\" width=\"1600\" height=\"982\"></figure><h2 id=\"conclusion\"><strong>結論</strong></h2><p>見ての通り、reranker を使用しないクエリでは、「通気性のためのメッシュバック」と「ソフトな肌触りのスリムフィット」に言及したトップ結果が得られました。対照的に、reranker を使用することで、「最適な通気性のために設計」され、「試合当日のプレッシャーの下でも乾燥した状態を保つ水分吸収デザイン」を備え、「リラックスした、着やすいフィットの軽量生地」を特徴とするトップ結果が得られました。</p><p>2 番目の結果は、私たちが投げかけたクエリに対してはるかに正確で適切なものでした。最後の 2 つの投稿で、私たちは理論的および実践的な観点から、RAG パイプラインに Jina Reranker を追加することで検索精度が向上し、それから得られる応答の質が改善されることを示しました。</p>",
  "comment_id": "65e97909b22368000152a4c7",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/banner_Reranker_-LlamaIndex.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-07T09:21:29.000+01:00",
  "updated_at": "2024-04-02T11:12:49.000+02:00",
  "published_at": "2024-03-07T15:00:01.000+01:00",
  "custom_excerpt": "Just Rerank It! Jina Reranker and LlamaIndex take your RAG up to the next level.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "65e85e35b22368000152a4bf",
    "name": "Francesco Kruk",
    "slug": "francesco",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/precise-rag-with-jina-reranker-and-llamaindex/",
  "excerpt": "まさにそう！ Jina Reranker と LlamaIndex であなたの RAG を次のレベルに引き上げましょう。",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Collaborative graphic with \"RERANKER\" and \"Llamalindex\" logos over a purple background with crossed white abstract lines.",
  "feature_image_caption": null
}
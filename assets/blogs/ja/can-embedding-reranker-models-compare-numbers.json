{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "Embedding/Reranker モデルは数値を比較できるのか？",
  "html": "<p>本日、ウィーンの ICML カンファレンスで私に投げかけられた質問です。</p><p>コーヒーブレイク中、ある Jina ユーザーが LLM コミュニティでの最近の議論から生まれた質問をしてきました。彼は、多くの LLM が逆の結果を出す中で、私たちの埋め込みモデルが 9.11 は 9.9 より<em>小さい</em>と判断できるかどうかを尋ねました。</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>「正直なところ、分かりません」と私は答えました。彼がこの機能が自身のアプリケーションにとって重要であることを説明し、<strong>トークン化が問題の根本かもしれない</strong>と提案したとき、私は頷きながら - すでに答えを見つけるための実験のアイデアが頭の中を駆け巡っていました。</p><p>この記事では、私たちの埋め込みモデル <code>jina-embeddings-v2-base-en</code>（2023年10月リリース）と Reranker の <code>jina-reranker-v2-multilingual</code>（2024年6月リリース）が数値を正確に比較できるかテストしたいと思います。9.11 と 9.9 の単純な比較を超えて、小さな整数、大きな数値、浮動小数点数、負の数、通貨、日付、時刻など、さまざまな種類の数値を含む実験セットを設計しました。目的は、異なる数値フォーマットを扱う際の私たちのモデルの効果を評価することです。</p><h2 id=\"experimental-setup\">実験セットアップ</h2><p>完全な実装は以下の Colab で見ることができます：</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>実験のデザインはとてもシンプルです。例えば、埋め込みモデルが [1, 100] の間の数値を理解できるかをチェックするために、以下のステップを実行します：</p><ol><li><strong>ドキュメントの構築</strong>：<code>1</code> から <code>100</code> までの各数値に対して「文字列リテラル」ドキュメントを生成します。</li><li><strong>Embedding API に送信</strong>：<a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Embedding API</a> を使用して各ドキュメントの埋め込みを取得します。</li><li><strong>コサイン類似度の計算</strong>：すべての2つのドキュメントのペアごとにコサイン類似度を計算し、類似度行列を作成します。</li><li><strong>散布図の作成</strong>：結果を散布図で可視化します。類似度行列の各要素 $(i, j)$ は以下のポイントにマッピングされます：X軸：$(i - j)$、Y軸：$(i, j)$ の類似度値</li></ol><p>デルタ $(i - j)$ がゼロ、つまり $i = j$ の場合、意味的類似度は最高になるはずです。デルタ $(i - j)$ が大きくなるにつれて、類似度は減少するはずです。<strong>理想的には、類似度はデルタ値に比例して直線的に変化するはずです。</strong>もしこのような直線性が観察されない場合、モデルは数値を理解できておらず、9.11 が 9.9 より大きいといったエラーを生む可能性があります。</p><p>Reranker モデルも同様の手順に従います。主な違いは、構築されたドキュメントを反復処理する際に、プロンプト <code>\"what is the closest item to...\"</code> を先頭に追加して各ドキュメントを <code>query</code> として設定し、他のすべてを <code>documents</code> としてランク付けする点です。<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Reranker API</a> から返される関連性スコアを直接意味的類似度の尺度として使用します。コアの実装は以下のようになります。</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">モデルは [1, 2, 3, ..., 100] の間の数値を比較できるか？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">各デルタの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">これらのプロットの読み方</h3><p>さらなる実験に進む前に、まずこれらのプロットの適切な読み方を説明させてください。最初に、上記の2つのプロットから私が観察したのは、埋め込みモデルはうまく機能していますが、reranker モデルはあまり良い結果を示していないということです。では、私たちは何を見ており、なぜそうなのでしょうか？</p><p>X軸は、ドキュメントセットから均一にサンプリングされた $d_i$ と $d_j$ のインデックス $(i,j)$ のデルタ、つまり $i-j$ を表します。このデルタは $[-100, 100]$ の範囲です。ドキュメントセットは構築上ソートされているため、$|i-j|$ が小さいほど、$d_i$ と $d_j$ は意味的に近く、$i$ と $j$ の距離が遠いほど、$d_i$ と $d_j$ の類似度は低くなります。そのため、Y軸で表される類似度は $X=0$ でスパイクを示し、左右に移動するにつれて直線的に低下します。</p><p>理想的には、これは鋭いピークまたは「上向き矢印」の形状 <code>^</code> を作るはずです。しかし、必ずしもそうはなりません。X軸を特定の点、例えば $X=25$ に固定して、Y軸に沿って見ると、類似度の値が0.80から0.95の範囲で変動していることがわかります。つまり、デルタが同じ25であっても、$\\mathrm{sim}(d_27, d_2)$ は0.81、$\\mathrm{sim}(d_42, d_17)$ は0.91というように異なる値を示す可能性があります。</p><p>シアン色のトレンドラインは、各X値における平均類似度と標準偏差を示しています。また、ドキュメントセットが均等に間隔を置いて配置されているため、連続するドキュメント間の間隔が等しくなり、類似度は直線的に低下するはずであることにも注意してください。</p><p>埋め込みプロットは<strong>常に対称的で、$X=0$ で最大のY値1.0</strong>を示すことに注意してください。これは、$d_i$ と $d_j$ のコサイン類似度が対称的で、$\\cos(0)=1$ であるためです。</p><p>一方、reranker プロットは、reranker モデルにおけるクエリとドキュメントの役割が異なるため、<strong>常に非対称</strong>です。<strong>最大値は必ずしも1.0ではありません</strong>。なぜなら、$X=0$ は <code>\"what is the closest item to 4\"</code> と <code>\"4\"</code> の関連性スコアを計算することを意味するからです。考えてみれば、$X=0$ が最大のY値をもたらすという保証はありません。</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">モデルは負の数 [-100, -99, -98, ..., -1] を比較できるか？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">各デルタの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。ここではモデルが負の空間での意味的類似度を判断できるかテストしたいと思います。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">モデルはより大きな間隔の数値 [1000, 2000, 3000, ..., 100000] を比較できるか？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、1000 間隔で数値を比較した場合のセマンティック類似性をモデルが判断できるかテストしたいと考えています。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">モデルは任意の範囲の数値を比較できるか？例：[376, 377, 378, ..., 476]</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、任意の範囲の数値を比較する際のセマンティック類似性をモデルが判断できるかテストするため、ランダムな範囲に数値を移動させました。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">モデルは大きな数値を比較できるか？[4294967296, 4294967297, 4294967298, ..., 4294967396]</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、非常に大きな数値を比較する際のセマンティック類似性をモデルが判断できるかテストしたいと考えています。前回の実験と同様の考え方で、範囲をさらに大きな数値に移動させました。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">モデルは小数を比較できるか？[0.0001, 0.0002, 0.0003, ...,0.1]（固定桁数なし）</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、小数を比較する際のセマンティック類似性をモデルが判断できるかテストしたいと考えています。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">モデルは通貨の数値を比較できるか？[$1, $2, $3, ..., $100]</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、通貨形式の数値を比較する際のセマンティック類似性をモデルが判断できるかテストしたいと考えています。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">モデルは日付を比較できるか？[2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31]</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、YYYY-MM-DD形式の日付を比較する際のセマンティック類似性をモデルが判断できるかテストしたいと考えています。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">デルタごとの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">モデルは時刻を比較できるか？[19:00:07, 19:00:08, 19:00:09,..., 20:39:07]</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">ここでは、時刻形式の数値、つまり</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">を比較する際の意味的類似性をモデルが判断できるかテストします。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">各デルタの平均と分散を示す散布図。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"observations\">観察結果</h2><p>上記のプロットから以下の観察結果が得られました：</p><h3 id=\"reranker-models\"><strong>Reranker モデル</strong></h3><ul><li>Reranker モデルは数値の比較に苦労しています。[1, 100]の間の数値を比較する最も単純なケースでも、パフォーマンスは十分とは言えません。</li><li>Reranker の使用においては、<code>what is the closest item to x</code> のような特別なプロンプト構成を使用していることに注意が必要です。これも結果に影響を与える可能性があります。</li></ul><h3 id=\"embedding-models\"><strong>Embedding モデル</strong></h3><ul><li>Embedding モデルは、[1, 100]の範囲内の小さな整数や[-100, 1]の範囲内の負の数の比較においては、比較的良好な性能を示します。しかし、この範囲を他の値にシフトしたり、間隔を増やしたり、より大きな、あるいは小さな浮動小数点数を扱ったりすると、性能は大幅に低下します。</li><li>通常10ステップごとに定期的なスパイクが観察されます。この挙動は、トークナイザーが文字列を処理する方法、つまり「10」または「1」と「0」にトークン化する可能性に関連している可能性があります。</li></ul><h3 id=\"date-and-time-understanding\"><strong>日付と時刻の理解</strong></h3><ul><li>興味深いことに、Embedding モデルは日付と時刻をよく理解しており、ほとんどの場合正しく比較できています。日付のプロットでは30/31ステップごとにスパイクが現れ、これは月の日数に対応しています。時刻のプロットでは60ステップごとにスパイクが現れ、これは1時間の分数に対応しています。</li><li>Reranker モデルもある程度この理解を示しています。</li></ul><h3 id=\"visualizing-similarity-to-zero\">「ゼロ」との類似性の可視化</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">2024年7月29日更新</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>もう1つの興味深い実験として、おそらくより直感的なのは、任意の数値とゼロ（つまり原点）との類似性または関連性スコアを直接可視化することです。ゼロの埋め込みを参照点として固定し、数値が大きくなるにつれて意味的類似性が線形的に減少するかどうかを確認したいと考えました。Reranker の場合、クエリを <code>\"0\"</code> または <code>\"What is the closest number to number zero?\"</code> に固定し、数値が増加するにつれて関連性スコアが減少するかどうかを確認するために、すべての数値をランク付けできます。結果は以下の通りです：</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">ここでは、「原点埋め込み」を「ゼロ」の埋め込みに固定し、任意の数値とゼロとの意味的類似性がその数値の値に比例するかどうかを確認します。具体的には、</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">を使用します。各デルタの平均と分散を示す散布図です。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">、右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"conclusion\">結論</h2><p>この記事では、現在の Embedding モデルと Reranker モデルが数値比較をどのように扱うかを示しています。比較的シンプルな実験設定にもかかわらず、現在のモデルにおける基本的な欠陥を露呈し、次世代の Embedding と Reranker の開発に向けて貴重な洞察を提供しています。</p><p>モデルが数値を正確に比較できるかどうかを決定する2つの重要な要因があります：</p><p><strong>第一に、トークン化：</strong>語彙に0-9の数字のみが含まれている場合、11は別々のトークン1と1として、または単一のトークン11としてトークン化される可能性があります。この選択は、数値の理解に影響を与えます。</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">異なるトークナイザーは9.11を異なる方法で解釈します。これは文脈的学習に影響を与える可能性があります。出典：</span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">The Tokenizer Playground on HuggingFace。</span></a></p></figcaption></figure><p><strong>第二に、学習データ：</strong>学習コーパスはモデルの数値推論能力に大きな影響を与えます。例えば、学習データが主にセマンティックバージョニングが一般的なソフトウェアドキュメントや GitHub リポジトリを含む場合、モデルは9.9の次のマイナーバージョンが9.11であるため、9.11が9.9より大きいと解釈する可能性があります。</p><p>Embedding や Reranker などの密な検索モデルの算術能力は、RAG や高度な検索・推論を含むタスクにとって重要です。強力な数値推論能力は、特に JSON のような構造化データを扱う際の検索品質を大幅に向上させることができます。</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "多くの LLM は、9.11 が実際には 9.9 より小さいということを理解できません。私たちの埋め込みモデルやリランカーモデルはもっと上手く処理できるでしょうか？",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
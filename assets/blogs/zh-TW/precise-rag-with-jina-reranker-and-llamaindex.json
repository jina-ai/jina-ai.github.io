{
  "slug": "precise-rag-with-jina-reranker-and-llamaindex",
  "id": "65e97909b22368000152a4c7",
  "uuid": "3bcc0e9b-38b1-4df4-bcf7-dbe893156630",
  "title": "使用 Jina Reranker 和 LlamaIndex 進行精確的 RAG",
  "html": "<p>像 <a href=\"https://www.sbert.net/examples/applications/cross-encoder/README.html?ref=jina-ai-gmbh.ghost.io\"><u>雙編碼器模型</u></a> 如 <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a> 可以從預先計算的嵌入向量資料庫中快速檢索多個匹配文件，而重排序器模型則可以通過使用較慢但更精確的交叉編碼方式來改善用戶查詢和檢索到的文件。Jina AI 已經<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>發布了我們的第一個重排序器模型</u></a>，<code>jina-reranker-v1-base-en</code>，在本文中，我們將深入探討為什麼重排序器對於優化 RAG 準確度至關重要，以及如何使用 <a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>/<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Reranker</u></a>、<a href=\"https://www.llamaindex.ai/?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> 和 <code>Mixtral-8x7B-Instruct-v0.1</code> 語言模型（<a href=\"https://huggingface.co/mistralai/Mixtral-8x7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\"><u>託管在 HuggingFace 上</u></a>）來建構最先進的 RAG 系統。</p><p>你需要：</p><ul><li>一個 <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings 和 Reranker API 的組合金鑰</u></a>。</li><li>一個 <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace 帳號和令牌</u></a>。</li></ul><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">Maximize the search relevancy and RAG accuracy at ease</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><p>由於 Jina Embeddings 和 Reranker 模型以及 Mixtral 都是遠端運行並通過 RESTful API 訪問，你不需要任何特殊硬體。</p><h2 id=\"what-is-a-reranker\">什麼是重排序器？</h2><p>在繼續教程之前，重要的是要先說明重排序器是什麼。為了完全理解重排序器的概念以及為什麼 Jina Reranker V1 是你的最佳選擇，我們建議你在繼續之前先閱讀我們的 Jina Reranker V1 發布文章。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>簡而言之，重排序器是交叉編碼器模型，它接收<em>文件-查詢</em>對作為輸入，並為該輸入對輸出一個綜合相關性分數。使用重排序器，用戶可以針對給定的查詢將文件按照從最相關到最不相關的順序排序。</p><h2 id=\"why-use-jina-reranker-v1-base-en\">為什麼要使用 <code>jina-reranker-v1-base-en</code>？</h2><p>重排序可以提供比單純使用嵌入式模型更相關的資訊。在我們的<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><u>模型發布文章</u></a>中，我們證明了 Jina Reranker 相較於開源和閉源競爭對手都表現出色，它可以將搜索系統的<strong>命中率提高 8%，</strong><a href=\"https://en.wikipedia.org/wiki/Mean_reciprocal_rank?ref=jina-ai-gmbh.ghost.io\"><strong><u>平均倒數排名</u></strong></a><strong>提高 33%</strong>。</p><p>這直接影響到通過 RAG 解決方案獲得的回應品質。在理論支持這一說法的基礎上，我們將向你展示一個實際示例，讓你親眼看到 Jina Reranker 對使用 LlamaIndex 構建的 RAG 管道有什麼影響。</p><h2 id=\"before-we-start-a-note-on-llamaindex-node-postprocessors\">開始之前：關於 LlamaIndex 節點後處理器的說明</h2><p><a href=\"https://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/root.html?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> 中的節點後處理器是在檢索之後、回應合成之前轉換或過濾節點的模組。作為這個套件的一部分，LlamaIndex 提供了內建選項以及用於自定義添加的 API。</p><p><strong>Jina Reranker 現已</strong><a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><strong><u>整合</u></strong></a><strong>到 LlamaIndex 作為一個節點後處理器</strong>。為了提高回應準確度，檢索到的節點會根據與查詢的相關性重新排序，並返回前 <strong><em>N</em></strong> 個節點。</p><h2 id=\"follow-along-on-google-colab\">在 Google Colab 上跟著做</h2><p>本教程有一個配套的筆記本，你可以在 <a href=\"https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>Google Colab</u></a> 或本地運行。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">llama_index/docs/docs/examples/node_postprocessor/JinaRerank.ipynb at main · run-llama/llama_index</div><div class=\"kg-bookmark-description\">LlamaIndex is a data framework for your LLM applications - run-llama/llama_index</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/assets/pinned-octocat-093da3e6fa40.svg\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">run-llama</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2000e9ce9c43753a6316de82e8309737edaa6377de7b47d2d8b08a4a3caa8a71/run-llama/llama_index\" alt=\"\"></div></a></figure><h3 id=\"the-dataset-2024-nike-kids-product-catalog\">資料集：2024 Nike 兒童產品目錄</h3><p>為了展示 Jina Reranker 對 RAG 應用的性能提升，我們選擇了 <a href=\"https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&ref=jina-ai-gmbh.ghost.io\"><u>2024 Nike 兒童產品目錄</u></a>作為我們的資料集。該文件包含了 Nike 在 2024 年提供的兒童產品結構化清單。我們選擇這個資料集是因為它能清楚地展示使用重排序器的效果，並且與大多數用戶都有關聯。</p><h3 id=\"install-the-prerequisites\">安裝必要條件</h3><p>要安裝必要條件，請運行：</p><pre><code class=\"language-bash\">pip install llama-index-postprocessor-jinaai-rerank\npip install llama-index-embeddings-jinaai\npip install llama-index\npip install llama-index-llms-huggingface\npip install \"huggingface_hub[inference]\"</code></pre><h3 id=\"access-mixtral-llm\">訪問 Mixtral LLM</h3><p>要使用 <code>Mixtral-8x7B-Instruct-v0.1</code> LLM，你需要一個 <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace</u></a> 令牌。</p><pre><code class=\"language-Python\">from llama_index.llms.huggingface import HuggingFaceInferenceAPI\n\nhf_inference_api_key = \"&lt;你的 HuggingFace 訪問令牌&gt;\"\n\nmixtral_llm = HuggingFaceInferenceAPI(\n    model_name=\"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n    token=hf_inference_api_key,\n)\n</code></pre><h3 id=\"access-jina-embeddings-and-jina-reranker\">訪問 Jina Embeddings 和 Jina Reranker</h3><p>要使用我們的 Jina Embeddings 和 Jina Reranker，你需要一個專用的 <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>API 金鑰</u></a>。將其存儲在名為 <code>api_key</code> 的變數中，並從 LlamaIndex 調用 Jina Embeddings 模型：</p><pre><code class=\"language-Python\">from llama_index.embeddings.jinaai import JinaEmbedding\n\napi_key = \"&lt;你的 Jina 金鑰&gt;\"\njina_embeddings = JinaEmbedding(api_key=api_key)</code></pre><p>同樣地，你可以調用 Jina Reranker 模型。通過設定 <code>top_n</code> 參數，你可以決定在最終輸出中返回多少個最相關的文件。在這種情況下，我們設定<code>top_n=2</code>:</p><pre><code class=\"language-Python\">from llama_index.postprocessor.jinaai_rerank import JinaRerank\n\njina_rerank = JinaRerank(api_key=api_key, top_n=2)</code></pre><h3 id=\"download-the-2024-nike-kids-product-catalog\">下載 2024 年 Nike 兒童產品目錄</h3><p>執行以下程式碼來下載資料：</p><pre><code class=\"language-Python\">from llama_index.core import SimpleDirectoryReader\nimport requests\n\nurl = '&lt;https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&gt;'\nresponse = requests.get(url)\n\nwith open('Nike_Catalog.pdf', 'wb') as f:\n&nbsp;&nbsp;&nbsp;&nbsp;f.write(response.content)\n\nreader = SimpleDirectoryReader(\n&nbsp;&nbsp;&nbsp;&nbsp;input_files=[\"Nike_Catalog.pdf\"]\n)\n\ndocuments = reader.load_data()</code></pre><h3 id=\"generate-and-index-embeddings-with-jina-embeddings\">使用 Jina Embeddings 生成和索引嵌入向量</h3><p>現在設置完成後，我們將生成嵌入向量（節點）並建立索引。Jina Embeddings v2 模型可接受最多 8192 個 tokens 的輸入，這個長度足夠大，因此對於這樣的文件，我們不需要進行任何額外的文本分段或檢查任何部分是否有太多 tokens。要嵌入和索引文件，請執行以下程式碼：</p><pre><code class=\"language-Python\">from llama_index.core import VectorStoreIndex\n\nindex = VectorStoreIndex.from_documents(\n&nbsp;&nbsp;&nbsp;&nbsp;documents=documents, embed_model=jina_embeddings\n)</code></pre><h3 id=\"query-for-results-without-jina-reranker\">不使用 Jina Reranker 的查詢結果</h3><p>當我們從這組文本中查詢特定資訊時，LlamaIndex 的 <code>query_engine</code> 會執行以下操作：</p><ol><li>使用 Jina Embeddings V2 為查詢創建嵌入向量。</li><li>使用索引獲取與查詢嵌入向量餘弦相似度最高的 <code>top_k = 10</code> 個存儲的嵌入向量，並返回其在索引中的位置。</li><li>在向量數據陣列中查找對應的文本。</li></ol><p>讓我們詢問哪件 Nike 球衣的面料最好：</p><pre><code>query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p><strong>結果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; EQUIPMENT87NIKE BRASILIA SMALL DUFFEL 9.5&nbsp;\nDM3976 $37.00\nSIZES: Misc&nbsp; OFFER DATE: 07/01/22&nbsp; END DATE: 07/01/25\nTough 600D polyester • Durable 300D polyester • Detachable shoulder\nstrap&nbsp;• Ventilated shoe or wet/dry storage • Secure zip pocket • \nLimited lifetime guarantee&nbsp;• Screened Swoosh design trademark\nDIMENSIONS:&nbsp; 20\" L x 10\" W x 11\" H&nbsp;\n010 Black/Black/(White) 068 Iron Grey/Black/(White)\n...</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/z2OKhAFnHCXw3aI4W1KUZNxzt8WOEERSG-prrBcmGwBEDTAFGavSN8eiHnvFF6R0L-dlwRUY3U8R7ysinoGTSSL-9_vr0RdCmrIRSy_xffvKz-Trqa1Yr49YGNb7R-GsDpCqilIW3cluVER4St5rUts\" class=\"kg-image\" alt=\"Three Nike Brasilia Small Duffel Bags, $37 each, in black, grey, navy with features listed and offer dates from 07/01/22 to 0\" loading=\"lazy\" width=\"594\" height=\"592\"></figure><h3 id=\"query-for-results-with-reranker\">使用 Reranker 的查詢結果</h3><p>我們現在要應用 reranker 來查看 RAG 應用程式是否會產生不同的、更加<em>相關</em>的結果。為此，我們需要將 <code>node_postprocessors</code> 添加到 <code>query_engine</code>：</p><pre><code class=\"language-Python\">query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm, node_postprocessors=[jina_rerank]\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p>請注意，與之前不使用 reranker 的情況相比，<code>query_engine</code> 現在還包含了 <a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><u>node_postprocessors</u></a> 參數，設定為 <code>[jina_rerank]</code>。</p><p><strong>結果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; FOOTBALL – STOCK10\nDJ5731 $47.00\nSIZES:&nbsp; XS, S, M, L, XL, 2XL, 3XL\nFABRIC:&nbsp; Body/panels lining: 100% polyester. Pad: 100%\nethylene vinyl acetate.\nOFFER DATE:&nbsp; 04/01/23\nEND DATE:&nbsp; 04/01/27\nTake the field ready to give it your all in the Nike Recruit\nPants. They're made from lightweight, stretchy&nbsp;fabric with\nsweat-wicking power to help keep you dry and moving freely\nwhen the game heats up. With&nbsp;integrated pads shaped for a\ncomfortable fit, you'll be prepared for a performance you can\nbe proud of.&nbsp;Choose from 6 different colors to outfit your\nteam. Nike Dri-FIT technology moves sweat away from your&nbsp;skin\nfor quicker evaporation, helping you stay dry and comfortable.\nLightweight knit fabric stretches with&nbsp;you to let you move\nnaturally. Thigh, knee, hip and tailbone pads are shaped for\nan optimal fit, without&nbsp;compromising on coverage. A\nbody-hugging fit is designed to help keep the padding in place\nand close to&nbsp;the body. Belt at the waist lets you dial in your\nperfect fit to maximize comfort. Elastic at hems.\nHip width: 15\", Inseam length: 11.75\" (size medium).\n010 Black/(White) 060 Team Anthracite/(White) 100 White/(Black)\n419 Team Navy/(White) 493 Team Royal/(White) 657 Team Scarlet/(White)</code></pre><p></p><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/X0ngGFoOz8S_KlRhAlQs4rOooKsV92d06-UBa7BsFPiTilgTD9xuQfgIblG7dTq0BQp4ZA9DlBCjFvA6D62eUVDmxxOO38va5mlnutPr4Zlu6l70tvbGtmrS2V0rpn-OE__tarMtR1MxAmD2oQ3m2qg\" class=\"kg-image\" alt=\"Product display of boys' Nike DF Stock Recruit Pants with sizes, pricing, and various color options highlighted.\" loading=\"lazy\" width=\"1600\" height=\"982\"></figure><h2 id=\"conclusion\"><strong>結論</strong></h2><p>如我們所見，不使用 reranker 的查詢導致的頂部結果提到了\"網眼背部提供透氣性\"和\"修身剪裁具有柔軟的手感\"。相比之下，使用 reranker 後，我們得到的頂部結果是\"專為最佳透氣性而設計\"，具有\"可以讓你在比賽日壓力下保持乾爽清涼的吸濕排汗設計\"，並具有\"輕量級面料，採用寬鬆、舒適的剪裁\"。</p><p>第二個結果更加準確，更符合我們提出的查詢。通過我們最後兩篇文章，我們從理論和實踐的角度展示了將 Jina Reranker 添加到你的 RAG 流程中可以增加檢索準確性，並提高從中獲得的回應質量。</p>",
  "comment_id": "65e97909b22368000152a4c7",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/banner_Reranker_-LlamaIndex.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-07T09:21:29.000+01:00",
  "updated_at": "2024-04-02T11:12:49.000+02:00",
  "published_at": "2024-03-07T15:00:01.000+01:00",
  "custom_excerpt": "Just Rerank It! Jina Reranker and LlamaIndex take your RAG up to the next level.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "65e85e35b22368000152a4bf",
    "name": "Francesco Kruk",
    "slug": "francesco",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/precise-rag-with-jina-reranker-and-llamaindex/",
  "excerpt": "讓你 Rerank！Jina Reranker 和 LlamaIndex 將你的 RAG 提升到更高層次",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Collaborative graphic with \"RERANKER\" and \"Llamalindex\" logos over a purple background with crossed white abstract lines.",
  "feature_image_caption": null
}
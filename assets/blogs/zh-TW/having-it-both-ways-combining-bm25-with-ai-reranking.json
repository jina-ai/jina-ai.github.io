{
  "slug": "having-it-both-ways-combining-bm25-with-ai-reranking",
  "id": "6628fe61da339c00015740b9",
  "uuid": "13ce7c1f-bcdf-4746-93dd-5095291a2ed8",
  "title": "兩全其美：結合 BM25 和 AI 重新排序",
  "html": "<p>跟上資訊檢索技術的發展很重要，但維護現有且經過實證、已經展現商業價值的組件同樣重要。</p><p>儘管 <a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker?ref=jina-ai-gmbh.ghost.io\">AI 驅動的向量搜尋</a>不斷成長，事實上大多數公司仍依賴傳統搜尋技術，通常使用 <a href=\"https://en.wikipedia.org/wiki/Okapi_BM25?ref=jina-ai-gmbh.ghost.io\">BM25 演算法</a>的變體。這是一項可靠且經過時間考驗的技術。完全切換到新系統不僅是一個重大的步驟，往往也會因為需要大量資源和徹底改造營運而變得不切實際。此外，BM25 是詞彙搜尋引擎的基石，常用於 Elasticsearch 和 Solr 等廣泛使用的搜尋引擎平台。對許多使用情境來說，它已經能提供良好的結果。</p><p>因此，儘管有令人信服的證據表明基於 AI 的搜尋能<a href=\"https://db-engines.com/en/ranking_trend?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">顯著提升用戶滿意度和結果品質</a>，許多公司仍然猶豫是否要完全轉向神經網路搜尋。</p><h2 id=\"retrieval-agnostic-neural-reranking\">與檢索無關的神經網路重排序</h2><p>Reranker 是搜尋系統領域的一項突破性進展。它被設計用來增強像 <a href=\"https://www.elastic.co/elasticsearch?ref=jina-ai-gmbh.ghost.io\">Elasticsearch</a> 這樣的現有搜尋引擎，作為一個額外的層級，像附加元件一樣優化搜尋品質。它不需要知道它所連接的是什麼樣的搜尋技術，只需要接收一個匹配列表並重新排序以獲得更好的結果。</p><p>Jina Reranker 為傳統搜尋技術增添了更深層的理解能力。像 BM25 這樣的演算法在基於詞頻檢索文件方面做得很好，但在評估檢索文本的含義與用戶意圖的相關性時卻有困難。這正是 AI 所擅長的：Reranker 幫助產生更符合用戶需求的結果。</p><p>因此，對於想要將 AI 模型的強大優勢帶入搜尋框架的企業來說，添加 Jina Reranker 可能是一個明智的決定，且不會帶來替換現有搜尋基礎設施的負擔。這是關於優化搜尋結果，使其不僅可接受，而且出色：更相關、更準確。</p><h2 id=\"why-jina-reranker\">為什麼選擇 Jina Reranker？</h2><p>在重排序模型中，<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">Jina Reranker 模型</a>以其在<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\">性能基準</a>測試中的<a href=\"https://jina.ai/news/smaller-faster-cheaper-jina-rerankers-turbo-and-tiny?ref=jina-ai-gmbh.ghost.io\">領先表現</a>而脫穎而出。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>在本文中，我們將展示如何為電子商務平台實現推薦系統。首先，我們將分析單獨使用 BM25 檢索器的性能。然後，我們將 Jina Reranker 加入檢索管道，看看結果如何變得更相關和更有效。</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">💡</div><div class=\"kg-callout-text\">您可以在 <a href=\"https://colab.research.google.com/github/jina-ai/workshops/blob/main/notebooks/embeddings/bm25/Retrieval_Reranker.ipynb?ref=jina-ai-gmbh.ghost.io\">Colab</a> 上跟著做，或者<a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/bm25/Retrieval_Reranker.ipynb?ref=jina-ai-gmbh.ghost.io\">下載 notebook</a>。</div></div><h2 id=\"add-jina-reranker-to-your-existing-workflow\">將 Jina Reranker 加入您的現有工作流程：</h2><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-08 at 11.44.21\" loading=\"lazy\" width=\"2000\" height=\"468\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/size/w1600/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 1600w, https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 2000w\" sizes=\"(min-width: 720px) 720px\"></figure><p>以下是整合 Jina Reranker 的更新工作流程的細節：</p><ul><li><strong>初始檢索</strong>：當輸入查詢時，BM25 搜尋引擎主要基於查詢詞與文檔的匹配來檢索相關文檔。</li><li><strong>重排序</strong>：<code>jina-reranker-v1-base-en</code> 接收這些初始結果，並使用最先進的 AI 來評估每個檢索文檔與用戶查詢的相關性。</li><li><strong>回傳結果</strong>：Jina Reranker 然後重新排序搜尋結果，確保最相關的文檔顯示在頂部。</li></ul><p>我們的<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">易用 API</a> 和完整文檔將指導您完成整個過程，只需對系統進行最小的改動。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">Maximize the search relevancy and RAG accuracy at ease</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><h2 id=\"see-it-in-action-enhancing-e-commerce-search-with-jina-reranker\">實際應用：用 Jina Reranker 增強電子商務搜尋</h2><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg\" class=\"kg-image\" alt=\"BM25+Rerank dark (1)\" loading=\"lazy\" width=\"1600\" height=\"900\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 1600w\" sizes=\"(min-width: 720px) 720px\"><figcaption><i><em class=\"italic\" style=\"white-space: pre-wrap;\">查詢通過 BM25，檢索的文檔由 Jina Reranker 進行優化。</em></i></figcaption></figure><p>讓我們通過一個實際的電子商務範例來展示 Jina Reranker 在實際應用中的影響。這裡的目標是根據用戶的查詢來搜尋產品列表。</p><p>為了說明這一點，我們將使用流行的 AI 搜尋和編排框架 <a href=\"https://haystack.deepset.ai/?ref=jina-ai-gmbh.ghost.io\">Haystack by deepset</a> 設置兩個搜尋管道。第一個管道單獨使用 BM25。第二個將 <code>jina-reranker-v1-base-en</code> 整合到 BM25 系統中。如果您有現有的 Elasticsearch 集群，可以輕鬆地將 Haystack 的 <code>InMemoryDocumentStore</code> 組件替換為 <code>ElasticsearchDocumentStore</code> 來進行相同的實驗。</p><p>我們將使用 Kaggle 上的<a href=\"https://www.kaggle.com/datasets/kuchhbhi/fashion-ecommerce-data?ref=jina-ai-gmbh.ghost.io\">範例數據集</a>。您可以直接在<a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/bm25/fashion_data.csv?ref=jina-ai-gmbh.ghost.io\">這裡</a>下載 CSV。這個並排比較展示了將 Jina Reranker 整合到搜尋工作流程中帶來的改進。</p><p>首先，安裝所有必要的組件：</p><pre><code class=\"language-bash\">pip install --q haystack-ai jina-haystack\n</code></pre><p>將 Jina API Key 設置為環境變數。您可以在<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">這裡</a>生成一個。</p><pre><code class=\"language-Python\">import os\nimport getpass\n\nos.environ[\"JINA_API_KEY\"] = getpass.getpass()\n</code></pre><p>基於產品名稱查詢產品。例如：</p><pre><code class=\"language-Python\">short_query = \"Nightwear for Women\"\n</code></pre><p>將每個 CSV 行轉換為 <code>Document</code>：</p><pre><code class=\"language-Python\">import csv\nfrom haystack import Document\n\ndocuments = []\nwith open(\"fashion_data.csv\") as f:\n    data = csv.reader(f, delimiter=\";\")\n    for row in data:\n      row_text = ''.join(row)\n      row_doc = Document(content=row_text, meta={\"prod_id\": row[0], \"prod_image\": row[1]})\n      documents.append(row_doc)\n</code></pre><h2 id=\"pipeline-1-bm25-only\">Pipeline #1：僅使用 BM25</h2><pre><code class=\"language-Python\">from haystack import Pipeline\nfrom haystack.document_stores.types import DuplicatePolicy\nfrom haystack.document_stores.in_memory import InMemoryDocumentStore\nfrom haystack.components.retrievers.in_memory import InMemoryBM25Retriever\n\ndocument_store=InMemoryDocumentStore()\ndocument_store.write_documents(documents=documents, policy=DuplicatePolicy.OVERWRITE)\n\nretriever = InMemoryBM25Retriever(document_store=document_store)\n\nrag_pipeline = Pipeline()\nrag_pipeline.add_component(\"retriever\", retriever)\n</code></pre><pre><code class=\"language-Python\">result = rag_pipeline.run(\n            {\n                \"retriever\": {\"query\": query, \"top_k\": 50},\n            }\n        )\n\nfor doc in result[\"retriever\"][\"documents\"]:\n    print(\"Product ID:\", doc.meta[\"prod_id\"])\n    print(\"Product Image:\", doc.meta[\"prod_image\"])\n    print(\"Score:\", doc.score)\n    print(\"-\"*100)\n</code></pre><p>以下是 BM25 返回的 50 個結果的縮圖：<br></p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_f2dc26e35fe66ac84c1d641a47bebbce.png\" class=\"kg-image\" alt=\"image\" loading=\"lazy\" width=\"446\" height=\"1088\"></figure><p>我們可以看到，這些結果與睡衣相關，部分匹配查詢，但最相關的匹配項（網格中加粗的圖片）似乎在 BM25 檢索的眾多產品中迷失了。在實際應用中，僅使用 BM25 意味著用戶會在頁面頂部主要收到不相關的結果。</p><h2 id=\"pipeline-2-bm25-jina-reranker\">Pipeline #2：BM25 + Jina Reranker</h2><p>以下腳本概述了如何逐步構建這個 pipeline：</p><pre><code class=\"language-Python\">from haystack_integrations.components.rankers.jina import JinaRanker\n\nranker_retriever = InMemoryBM25Retriever(document_store=document_store)\n\nranker = JinaRanker()\n\nranker_pipeline = Pipeline()\nranker_pipeline.add_component(\"ranker_retriever\", ranker_retriever)\nranker_pipeline.add_component(\"ranker\", ranker)\n\nranker_pipeline.connect(\"ranker_retriever.documents\", \"ranker.documents\")\n</code></pre><pre><code class=\"language-Python\">result = ranker_pipeline.run(\n            {\n                \"ranker_retriever\": {\"query\": query, \"top_k\": 50},\n                \"ranker\": {\"query\": query, \"top_k\": 10},\n            }\n        )\n\nfor doc in result[\"ranker\"][\"documents\"]:\n    print(\"Product ID:\", doc.meta[\"prod_id\"])\n    print(\"Product Image:\", doc.meta[\"prod_image\"])\n    print(\"Score:\", doc.score)\n    print(\"-\"*100)\n</code></pre><p>以下是 Jina Reranker 返回的前 10 個結果：</p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_05929b0008a1ced2bf724dd8b89d0ec5.png\" class=\"kg-image\" alt=\"image\" loading=\"lazy\" width=\"442\" height=\"218\"></figure><p>與 BM25 相比，Jina Reranker 返回了更相關的答案集合。在我們的電商環境中，這意味著更好的用戶體驗和更高的購買可能性。</p><h2 id=\"impact-of-integrating-jina-reranker-with-bm25\">整合 Jina Reranker 與 BM25 的影響</h2><p>根據我們在電商領域的案例研究，很明顯 Jina Reranker 與 Elasticsearch 等傳統搜尋引擎的整合標誌著搜尋技術的重大躍進。以下是這種整合如何改善搜尋體驗的概述：</p><ul><li><strong>提升命中率</strong>：Jina Reranker 和傳統搜尋的融合顯著提高了相關結果的出現頻率。這使搜尋過程更準確，更貼近用戶查詢。</li><li><strong>改善用戶體驗</strong>：搜尋結果的質量有明顯提升。這表明 Jina Reranker 和 BM25 的組合能力更能滿足用戶的特定需求，提升整體搜尋體驗。</li><li><strong>複雜查詢的高精度</strong>：在處理困難搜尋時，這種協同作用確保了對查詢和相關內容有更詳細的理解。這轉化為更精準、更準確的結果。</li></ul><h2 id=\"ready-to-elevate-your-search-experience\">準備提升您的搜尋體驗？</h2><p>Jina Reranker 是提高搜尋結果相關性的理想解決方案。它可以無縫整合到您現有的搜尋系統中，並且只需少量程式碼即可快速實現。</p><p>如果您對到目前為止閱讀的內容感興趣，並渴望看到 Jina Reranker 能帶來的改變，何不試一試呢？開始您的旅程，親身體驗 <a href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io\">Jina AI's Search Foundation models</a> 在您自己環境中的變革力量。</p>",
  "comment_id": "6628fe61da339c00015740b9",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_56e4debd659c41d7b40a33256ccdce6c.jpeg",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-04-24T14:43:13.000+02:00",
  "updated_at": "2024-07-08T21:11:33.000+02:00",
  "published_at": "2024-04-24T15:38:08.000+02:00",
  "custom_excerpt": "Learn how to integrate Jina Reranker with lexical search engines to take advantage of superior semantic understanding while avoiding the downsides of migrating to a fully-fledged vector search infrastructure.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "6620de1e7f510100015da95e",
      "name": "Yuting Zhang",
      "slug": "yuting",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/Yuting-Portrait-1.jpeg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/yuting/"
    },
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "6620de1e7f510100015da95e",
    "name": "Yuting Zhang",
    "slug": "yuting",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/Yuting-Portrait-1.jpeg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/yuting/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/having-it-both-ways-combining-bm25-with-ai-reranking/",
  "excerpt": "瞭解如何將 Jina Reranker 整合到詞法檢索引擎中，以充分利用優越的語意理解能力，同時避免遷移到完整向量搜尋基礎架構時的缺點。",
  "reading_time": 6,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Black background embellished with binary code, featuring a central tech-inspired emblem with multicolored dots, BM25 tag, con",
  "feature_image_caption": null
}
{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "嵌入式模型/重排序模型能比較數字嗎？",
  "html": "<p>這是我今天在維也納的 ICML 會議上被問到的一個問題。</p><p>在茶歇時間，一位 Jina 使用者向我提出了一個源自 LLM 社群近期討論的問題。他問我們的嵌入模型是否能判斷出 9.11 比 9.9 要<em>小</em>，這是很多 LLM 會判斷錯誤的任務。</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>「老實說，我不知道，」我回答道。當他詳細說明這個功能對他的應用程式的重要性，並指出<strong>分詞可能是問題的根源</strong>時，我不禁點頭表示同意——我的腦海已經開始醞釀著一個實驗來揭示答案。</p><p>在這篇文章中，我想測試我們的嵌入模型 <code>jina-embeddings-v2-base-en</code>（2023 年 10 月發布）和重排序模型 <code>jina-reranker-v2-multilingual</code>（2024 年 6 月發布）是否能準確比較數字。為了將範圍擴展到 9.11 和 9.9 的簡單比較之外，我設計了一系列實驗，包括各種類型的數字：小整數、大數字、浮點數、負數、貨幣、日期和時間。目標是評估我們的模型在處理不同數字格式時的有效性。</p><h2 id=\"experimental-setup\">實驗設置</h2><p>完整的實現可以在以下 Colab 中找到：</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>實驗的設計相當直觀。例如，要檢查嵌入模型是否理解 [1, 100] 之間的數字，步驟如下：</p><ol><li><strong>構建文件</strong>：為 <code>1</code> 到 <code>100</code> 的每個數字生成「字符串字面量」文件。</li><li><strong>發送到嵌入 API</strong>：使用 <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">嵌入 API</a> 獲取每個文件的嵌入。</li><li><strong>計算餘弦相似度</strong>：計算每兩個文件之間的成對餘弦相似度以創建相似度矩陣。</li><li><strong>繪製散點圖</strong>：使用散點圖可視化結果。相似度矩陣中的每個元素 $(i, j)$ 映射到一個點：X 軸：$(i - j)$；Y 軸：$(i, j)$ 的相似度值</li></ol><p>如果 delta $(i - j)$ 為零，即 $i = j$，則語義相似度應該最高。隨著 delta $(i - j)$ 增加，相似度應該降低。<strong>理想情況下，相似度應該與 delta 值呈線性關係。</strong>如果我們觀察不到這種線性關係，那麼模型可能無法理解數字，並可能產生像 9.11 大於 9.9 這樣的錯誤。</p><p>重排序模型採用類似的程序。主要區別在於我們遍歷構建的文件，通過在前面加上提示 <code>\"what is the closest item to...\"</code> 將每個文件設置為 <code>query</code>，並將其他所有文件作為 <code>documents</code> 進行排名。<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">重排序 API</a> 返回的相關性分數直接用作語義相似度度量。核心實現如下所示。</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">模型能比較 [1, 2, 3, ..., 100] 之間的數字嗎？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">如何閱讀這些圖表</h3><p>在進行更多實驗之前，讓我先解釋如何正確閱讀這些圖表。首先，從上面兩張圖中我觀察到嵌入模型表現良好，而重排序模型表現不太理想。那麼，我們在看什麼，為什麼會這樣呢？</p><p>X 軸代表索引 $(i,j)$ 的 delta，即 $i-j$，當我們從我們的文件集合中均勻採樣 $d_i$ 和 $d_j$ 時。這個 delta 範圍從 $[-100, 100]$。由於我們的文件集在構建時是有序的，即 $|i-j|$ 越小，$d_i$ 和 $d_j$ 在語義上越接近；$i$ 和 $j$ 相距越遠，$d_i$ 和 $d_j$ 之間的相似度越低。這就是為什麼你會看到相似度（由 Y 軸表示）在 $X=0$ 處達到峰值，然後向左右線性下降。</p><p>理想情況下，這應該會形成一個尖峰或「上箭頭」形狀，像 <code>^</code>。但情況並非總是如此。如果你固定 X 軸的一個點，比如 $X=25$，沿著 Y 軸看，你會發現相似度值從 0.80 到 0.95 不等。這意味著，儘管它們的 delta 都是 25，$\\mathrm{sim}(d_27, d_2)$ 可能是 0.81，而 $\\mathrm{sim}(d_42, d_17)$ 可能是 0.91。</p><p>青色趨勢線顯示了每個 X 值的平均相似度及其標準差。另外，請注意相似度應該線性下降，因為我們的文件集是均勻分佈的，確保了連續文件之間的間隔相等。</p><p>請注意，嵌入圖表<strong>總是對稱的，在 $X=0$ 處 Y 值最大為 1.0</strong>。這是因為 $d_i$ 和 $d_j$ 的餘弦相似度是對稱的，且 $\\cos(0)=1$。</p><p>相反，重排序圖表<strong>總是不對稱的</strong>，這是由於查詢和文件在重排序模型中扮演不同的角色。<strong>最大值可能不是 1.0</strong>，因為 $X=0$ 意味著我們使用重排序器來計算 <code>\"what is the closest item to 4\"</code> 與 <code>\"4\"</code> 的相關性分數。如果你仔細思考，$X=0$ 並不能保證會導致 Y 值最大。</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">模型能比較 [-100, -99, -98, ..., -1] 之間的負數嗎？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。這裡我們想測試模型是否能判斷負數空間中的語義相似度。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">模型能比較更大間隔的數字 [1000, 2000, 3000, ..., 100000] 嗎？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">我們想要測試模型是否能在比較間隔為 1000 的數字時判斷語義相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">模型能否比較任意範圍內的數字，例如 [376, 377, 378, ..., 476]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能在任意範圍內比較數字的語義相似性，所以我們將數字移動到某個隨機範圍 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">。帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">模型能否比較大數字 [4294967296, 4294967297, 4294967298, ..., 4294967396]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能比較非常大的數字的語義相似性。類似上一個實驗的想法，我們將範圍進一步移動到一個大數字。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">模型能否比較浮點數 [0.0001, 0.0002, 0.0003, ...,0.1]？（不固定位數）</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能比較浮點數的語義相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">模型能否比較貨幣數字 [$1, $2, $3, ..., $100]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能比較貨幣形式數字的語義相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">模型能否比較日期 [2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能比較日期格式（YYYY-MM-DD）的語義相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">帶有每個 delta 的平均值和方差的散點圖。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">模型能否比較時間 [19:00:07, 19:00:08, 19:00:09,..., 20:39:07]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在這裡，我們想要測試模型是否能夠理解時間格式（即 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">）數字之間的語義相似性。 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">散點圖顯示了每個 delta 的平均值和方差。左圖：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右圖：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"observations\">觀察結果</h2><p>以下是對上述圖表的一些觀察：</p><h3 id=\"reranker-models\"><strong>重排序模型</strong></h3><ul><li>重排序模型在比較數字方面表現不佳。即使是在最簡單的 [1, 100] 範圍內比較數字的情況下，其表現也不理想。</li><li>值得注意的是，我們在使用重排序器時採用了特殊的查詢提示結構，即 <code>what is the closest item to x</code>，這可能也會影響結果。</li></ul><h3 id=\"embedding-models\"><strong>嵌入模型</strong></h3><ul><li>嵌入模型在比較 [1, 100] 範圍內的小整數或 [-100, 1] 範圍內的負數時表現尚可。但當將這個範圍移動到其他值、增加更多區間，或處理更大或更小的浮點數時，其表現會顯著下降。</li><li>在某些固定間隔（通常是每 10 步）可以觀察到規律性的突波。這種行為可能與分詞器處理字符串的方式有關，可能是將字符串分詞為 \"10\" 或 \"1\" 和 \"0\"。</li></ul><h3 id=\"date-and-time-understanding\"><strong>日期和時間理解</strong></h3><ul><li>有趣的是，嵌入模型似乎對日期和時間有很好的理解，大多數情況下都能正確比較。在日期圖中，每 30/31 步就出現突波，這對應於一個月的天數。在時間圖中，每 60 步出現突波，這對應於一小時的分鐘數。</li><li>重排序模型似乎也在某種程度上捕捉到了這種理解。</li></ul><h3 id=\"visualizing-similarity-to-zero\">可視化與\"零\"的相似度</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">更新於 2024 年 7 月 29 日</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>另一個可能更直觀的實驗是直接可視化任何數字與零（即原點）之間的相似度或相關性分數。通過將參考點固定為零的嵌入，我們想看看隨著數字變大，語義相似度是否線性降低。對於重排序器，我們可以將查詢固定為 <code>\"0\"</code> 或 <code>\"What is the closest number to number zero?\"</code>，並對所有數字進行排名，以查看它們的相關性分數是否隨著數字增加而降低。結果如下所示：</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">在這裡，我們將\"原點嵌入\"固定為\"零\"的嵌入，並檢查任何數字與零之間的語義相似度是否與該數字的值成比例。具體來說，我們使用 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">。圖中顯示了每個 delta 的散點圖及其平均值和方差。左圖：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右圖：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"conclusion\">結論</h2><p>本文展示了我們目前的嵌入和重排序模型如何處理數字比較。儘管實驗設置相對簡單，但它揭示了當前模型中的一些基本缺陷，並為我們下一代嵌入和重排序器的開發提供了寶貴的見解。</p><p>決定模型是否能準確比較數字的兩個關鍵因素： </p><p><strong>首先是分詞：</strong>如果詞彙表只包含數字 0-9，那麼 11 可能被分詞為獨立的標記 1 和 1，或作為單個標記 11。這種選擇會影響模型對數值的理解。</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">不同的分詞器會導致對 9.11 有不同的解釋。這可能會影響下游的上下文學習。來源：</span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">HuggingFace 上的 The Tokenizer Playground</span></a></p></figcaption></figure><p><strong>其次是訓練數據：</strong>訓練語料庫顯著影響模型的數值推理能力。例如，如果訓練數據主要包含軟體文檔或 GitHub 倉庫，其中語義版本控制很常見，模型可能會理解 9.11 大於 9.9，因為 9.11 是緊隨 9.9 之後的次要版本。</p><p>密集檢索模型（如嵌入和重排序器）的算術能力對於涉及 RAG 和高級檢索與推理的任務至關重要。強大的數值推理能力可以顯著提高搜索質量，特別是在處理像 JSON 這樣的結構化數據時。</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "許多大型語言模型無法理解 9.11 其實比 9.9 小。我們的 embedding 和 reranker 模型在這方面表現如何呢？",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
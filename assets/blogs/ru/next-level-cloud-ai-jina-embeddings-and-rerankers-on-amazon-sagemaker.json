{
  "slug": "next-level-cloud-ai-jina-embeddings-and-rerankers-on-amazon-sagemaker",
  "id": "65fabb91502fd000011c667e",
  "uuid": "45cd5187-838d-46b7-a8a0-d890fcda9041",
  "title": "Новый уровень облачного ИИ: Jina Embeddings и Rerankers на Amazon SageMaker",
  "html": "<p><a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\">Jina Embeddings</a> и <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\">Jina Reranker</a> теперь доступны для использования с <a href=\"https://aws.amazon.com/pm/sagemaker/?ref=jina-ai-gmbh.ghost.io\">Amazon SageMaker</a> через <a href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\">AWS Marketplace</a>. Для корпоративных пользователей, которые высоко ценят безопасность, надежность и согласованность в своих облачных операциях, это размещает передовые AI-решения Jina AI в их частных развертываниях AWS, где они могут пользоваться всеми преимуществами проверенной, стабильной инфраструктуры AWS.</p><p>Благодаря полному набору моделей для embeddings и reranking в AWS Marketplace, пользователи SageMaker могут воспользоваться революционными окнами входного контекста размером 8k и ведущими многоязычными embeddings по конкурентным ценам. Вам не нужно платить за передачу моделей в AWS или из него, цены прозрачны, а выставление счетов интегрировано с вашей учетной записью AWS.</p><p>Модели, доступные в настоящее время на Amazon SageMaker, включают:</p><ul><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-5iljbegvoi66w?ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - English</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-6w6k6ckusixpw?ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Small - English</a></li><li>Двуязычные модели Jina Embeddings v2:<ul><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-dz3ubvmivnwry?ref=jina-ai-gmbh.ghost.io\">Немецкий/Английский</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-hxalozh37jka4?ref=jina-ai-gmbh.ghost.io\">Китайский/Английский</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-rnb324fpie3n6?ref=jina-ai-gmbh.ghost.io\">Испанский/Английский</a></li></ul></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-tk7t7bz6fp5ng?ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - Code</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-avmxk2wxbygd6?ref=jina-ai-gmbh.ghost.io\">Jina Reranker v1 Base - English</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-6kxbf5xqrluf4?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Jina ColBERT v1 - English</a></li><li><a href=\"https://aws.amazon.com/marketplace/pp/prodview-mgomngrh4c4k4?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Jina ColBERT Reranker v1 - English</a></li></ul><p>Полный список моделей смотрите на <a href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\">странице поставщика Jina AI в AWS Marketplace</a> и воспользуйтесь семидневным бесплатным пробным периодом.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">AWS Marketplace: Jina AI</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/v2/socialPreview.png\" alt=\"\"></div></a></figure><p>В этой статье мы рассмотрим создание приложения <a href=\"https://jina.ai/news/full-stack-rag-with-jina-embeddings-v2-and-llamaindex/?ref=jina-ai-gmbh.ghost.io\">Retrieval-augmented generation</a> (RAG) исключительно с использованием компонентов Amazon SageMaker. Мы будем использовать модели <strong>Jina Embeddings v2 - English</strong>, <strong>Jina Reranker v1</strong> и языковую модель <a href=\"https://huggingface.co/mistralai/Mistral-7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\">Mistral-7B-Instruct</a>.</p><p>Вы также можете следовать инструкциям в Python Notebook, который можно <a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/sagemaker/sagemaker.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">скачать</a> или <a href=\"https://colab.research.google.com/github/jina-ai/workshops/blob/main/notebooks/embeddings/sagemaker/sagemaker.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">запустить в Google Colab</a>.</p><h2 id=\"retrieval-augmented-generation\">Retrieval-Augmented Generation</h2><p>Retrieval-augmented generation — это альтернативная парадигма в генеративном AI. Вместо того чтобы использовать большие языковые модели (LLM) для прямого ответа на запросы пользователей на основе того, что было изучено при обучении, она использует их способность к плавному производству языка, перенося логику и поиск информации во внешний аппарат, более подходящий для этого.</p><p>Перед вызовом LLM системы RAG активно извлекают релевантную информацию из какого-либо внешнего источника данных и затем передают ее в LLM как часть промпта. Роль LLM заключается в синтезе внешней информации в связный ответ на запросы пользователей, минимизируя риск галлюцинаций и повышая релевантность и полезность результата.</p><p>Схематично система RAG имеет как минимум четыре компонента:</p><ul><li>Источник данных, обычно векторная база данных, подходящая для поиска информации с помощью AI.</li><li>Система поиска информации, которая обрабатывает запрос пользователя как поисковый запрос и извлекает данные, релевантные для ответа на него.</li><li>Система, часто включающая AI-based reranker, которая выбирает часть извлеченных данных и обрабатывает их в промпт для LLM.</li><li>LLM, например, одна из моделей GPT или модель с открытым исходным кодом, как Mistral, которая принимает запрос пользователя и предоставленные ей данные и генерирует ответ для пользователя.</li></ul><p>Модели embeddings хорошо подходят для поиска информации и часто используются для этой цели. Модель текстовых embeddings принимает тексты в качестве входных данных и выводит <a href=\"https://jina.ai/news/how-embeddings-drive-ai-a-guide?ref=jina-ai-gmbh.ghost.io\">embedding</a> — высокоразмерный вектор, пространственное отношение которого к другим embeddings указывает на их семантическое сходство, т.е. схожие темы, содержание и связанные значения. Они часто используются при поиске информации, поскольку чем ближе embeddings, тем вероятнее пользователь будет доволен ответом. Их также относительно легко дообучить для улучшения производительности в конкретных областях.</p><p>Модели <a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">text reranker</a> используют аналогичные принципы AI для сравнения коллекций текстов с запросом и сортировки их по семантическому сходству. Использование специализированной модели reranker вместо опоры только на модель embeddings часто значительно повышает точность результатов поиска. Reranker в приложении RAG выбирает некоторые результаты поиска информации, чтобы максимизировать вероятность того, что правильная информация содержится в промпте для LLM.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><h2 id=\"benchmarking-performance-of-embedding-models-as-sagemaker-endpoints\"><strong>Тестирование производительности моделей Embedding как конечных точек SageMaker</strong></h2><p>Мы протестировали производительность и надежность модели <strong>Jina Embeddings v2 Base - English</strong> в качестве конечной точки SageMaker, работающей на инстансе <a href=\"https://aws.amazon.com/ec2/instance-types/g4/?ref=jina-ai-gmbh.ghost.io\">g4dn.xlarge</a>. В этих экспериментах мы непрерывно добавляли по одному новому пользователю каждую секунду, каждый из которых отправлял запрос, ждал ответа и повторял после его получения.</p><ul><li>Для запросов <em>менее 100 токенов</em>, при количестве до 150 одновременных пользователей, время ответа <em>на запрос</em> оставалось ниже 100 мс. Затем время ответа линейно увеличивалось от 100 мс до 1500 мс с появлением большего числа одновременных пользователей.<ul><li>При примерно <em>300 одновременных пользователях</em> мы получили более 5 сбоев от API и завершили тест.</li></ul></li><li>Для запросов от 1K до 8K токенов, при количестве до 20 одновременных пользователей, время ответа <em>на запрос</em> оставалось ниже 8 секунд. Затем время ответа линейно увеличивалось от 8 до 60 секунд с появлением большего числа одновременных пользователей.<ul><li>При примерно <em>140 одновременных пользователях</em> мы получили более 5 сбоев от API и завершили тест.</li></ul></li></ul><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/03/image-3.png\" class=\"kg-image\" alt=\"Four comparative graphs displaying &quot;Small Context&quot; versus &quot;Large Context&quot; results over time, assessing performance metrics.\" loading=\"lazy\" width=\"2000\" height=\"1250\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/03/image-3.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/03/image-3.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/size/w1600/2024/03/image-3.png 1600w, https://jina-ai-gmbh.ghost.io/content/images/2024/03/image-3.png 2000w\" sizes=\"(min-width: 720px) 720px\"><figcaption><span style=\"white-space: pre-wrap;\">Результаты тестовых запусков (слева: малый контекст, справа: большой контекст), показывающие влияние увеличения количества пользователей со временем на время отклика и частоту отказов. </span></figcaption></figure><p>На основании этих результатов можно сделать вывод, что для большинства пользователей с обычными задачами по встраиванию инстансы g4dn.xlarge или g5.xlarge должны удовлетворять их ежедневные потребности. Однако для крупных задач по <em>индексированию</em>, которые обычно выполняются гораздо реже, чем задачи <em>поиска</em>, пользователи могут предпочесть более производительный вариант. Полный список доступных инстансов Sagemaker можно найти в обзоре AWS <a href=\"https://aws.amazon.com/ec2/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">EC2</a>.</p><h2 id=\"configure-your-aws-account\">Настройка учетной записи AWS</h2><p>Сначала вам понадобится учетная запись AWS. Если у вас еще нет учетной записи AWS, вы можете <a href=\"https://portal.aws.amazon.com/billing/signup?ref=jina-ai-gmbh.ghost.io\">зарегистрироваться</a> на сайте AWS.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://portal.aws.amazon.com/billing/signup?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">AWS Console - Signup</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://portal.aws.amazon.com/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Signup</span></div></div></a></figure><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">⚠️</div><div class=\"kg-callout-text\">Вы не сможете выполнить этот учебник с учетной записью Free Tier, поскольку Amazon не предоставляет бесплатный доступ к SageMaker. Вы должны добавить способ оплаты в учетную запись, чтобы подписаться на модели Jina AI, даже если вы используете <a href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">нашу семидневную бесплатную пробную версию</a>.</div></div><h3 id=\"set-up-aws-tools-in-your-python-environment\">Настройка инструментов AWS в вашей среде Python</h3><p>Установите в вашей среде Python инструменты и библиотеки AWS, необходимые для этого учебника:</p><pre><code class=\"language-bash\">pip install awscli jina-sagemaker\n</code></pre><p>Вам понадобится получить ключ доступа и секретный ключ доступа для вашей учетной записи AWS. Для этого следуйте <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html?ref=jina-ai-gmbh.ghost.io\">инструкциям на сайте AWS</a>.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Managing access keys for IAM users - AWS Identity and Access Management</div><div class=\"kg-bookmark-description\">Create, modify, view, or update access keys (credentials) for programmatic calls to AWS.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://docs.aws.amazon.com/assets/images/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">AWS Identity and Access Management</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://docs.aws.amazon.com/images/IAM/latest/UserGuide/images/security-credentials-user.shared.console.png\" alt=\"\"></div></a></figure><p>Также вам нужно будет выбрать <a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html?ref=jina-ai-gmbh.ghost.io\">регион AWS</a> для работы.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Concepts.RegionsAndAvailabilityZones.html?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Regions, Availability Zones, and Local Zones - Amazon Relational Database Service</div><div class=\"kg-bookmark-description\">Learn how Amazon cloud computing resources are hosted in multiple locations world-wide, including AWS Regions and Availability Zones.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://docs.aws.amazon.com/assets/images/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">Amazon Relational Database Service</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://docs.aws.amazon.com/images/AmazonRDS/latest/UserGuide/images/Con-AZ-Local.png\" alt=\"\"></div></a></figure><p>Затем установите значения в переменных окружения. В Python или в блокноте Python вы можете сделать это с помощью следующего кода:</p><pre><code class=\"language-bash\">import os\n\nos.environ[\"AWS_ACCESS_KEY_ID\"] = &lt;YOUR_ACCESS_KEY_ID&gt;\nos.environ[\"AWS_SECRET_ACCESS_KEY\"] = &lt;YOUR_SECRET_ACCESS_KEY&gt;\nos.environ[\"AWS_DEFAULT_REGION\"] = &lt;YOUR_AWS_REGION&gt;\nos.environ[\"AWS_DEFAULT_OUTPUT\"] = \"json\"\n</code></pre><p>Установите формат вывода по умолчанию как <code>json</code>.</p><p>Вы также можете сделать это через <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html?ref=jina-ai-gmbh.ghost.io\">командное приложение AWS</a> или путем настройки <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html?ref=jina-ai-gmbh.ghost.io\">конфигурационного файла AWS</a> в вашей локальной файловой системе. Дополнительные сведения см. в <a href=\"https://docs.aws.amazon.com/index.html?ref=jina-ai-gmbh.ghost.io\">документации на сайте AWS</a>.</p><h3 id=\"create-a-role\">Создание роли</h3><p>Вам также понадобится <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html?ref=jina-ai-gmbh.ghost.io\">роль AWS</a> с достаточными разрешениями для использования ресурсов, необходимых для этого учебника.</p><p>Эта роль должна:</p><ol><li>Иметь включенный доступ <strong>AmazonSageMakerFullAccess</strong>.</li><li>Либо:<ol><li>Иметь полномочия на подписку AWS Marketplace и иметь включенные все три разрешения:<ol><li><strong>aws-marketplace:ViewSubscriptions</strong></li><li><strong>aws-marketplace:Unsubscribe</strong></li><li><strong>aws-marketplace:Subscribe</strong></li></ol></li><li>Либо ваша учетная запись AWS должна иметь подписку на <a href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\">jina-embedding-model</a>.</li></ol></li></ol><p>Сохраните ARN (<a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/reference-arns.html?ref=jina-ai-gmbh.ghost.io\">Amazon Resource Name</a>) роли в переменной с именем <code>role</code>:</p><pre><code class=\"language-python\">role = &lt;YOUR_ROLE_ARN&gt;\n</code></pre><p>Дополнительную информацию см. в документации по ролям на сайте AWS.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">IAM roles - AWS Identity and Access Management</div><div class=\"kg-bookmark-description\">Learn how and when to use IAM roles.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://docs.aws.amazon.com/assets/images/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">AWS Identity and Access Management</span></div></div></a></figure><h3 id=\"subscribe-to-jina-ai-models-on-aws-marketplace\">Подписка на модели Jina AI на AWS Marketplace</h3><p>В этой статье мы будем использовать модель Jina Embeddings v2 base English. Подпишитесь на неё на <a href=\"https://aws.amazon.com/marketplace/pp/prodview-5iljbegvoi66w?ref=jina-ai-gmbh.ghost.io\">AWS Marketplace</a>.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://aws.amazon.com/marketplace/pp/prodview-5iljbegvoi66w?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">AWS Marketplace: Jina Embeddings v2 Base - en</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">en</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/v2/socialPreview.png\" alt=\"\"></div></a></figure><p>Информацию о ценах вы увидите, прокрутив страницу вниз. AWS взимает почасовую плату за модели из marketplace, поэтому вам будет выставлен счет за время с момента запуска конечной точки модели до её остановки. В этой статье мы покажем вам, как сделать и то, и другое.</p><p>Мы также будем использовать модель Jina Reranker v1 - English, на которую вам нужно будет подписаться.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://aws.amazon.com/marketplace/pp/prodview-avmxk2wxbygd6?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">AWS Marketplace: Jina Reranker v1 Base - en</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/favicon.ico\" alt=\"\"><span class=\"kg-bookmark-author\">en</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://d32gc0xr2ho6pa.cloudfront.net/img/general/v2/socialPreview.png\" alt=\"\"></div></a></figure><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">Jina AI в настоящее время предлагает семидневную бесплатную пробную версию своих моделей. Вам все равно нужно будет платить за экземпляры AWS, на которых они работают, но в течение пробного периода вам не нужно дополнительно платить за модели.</div></div><p>После подписки получите ARN моделей для вашего региона AWS и сохраните их в переменных <code>embedding_package_arn</code> и <code>reranker_package_arn</code> соответственно. Код в этом руководстве будет ссылаться на них, используя эти имена переменных.</p><p>Если вы не знаете, как получить ARN, поместите название вашего региона Amazon в переменную <code>region</code> и используйте следующий код:</p><pre><code class=\"language-python\">region = os.environ[\"AWS_DEFAULT_REGION\"]\n\ndef get_arn_for_model(region_name, model_name):\n    model_package_map = {\n        \"us-east-1\": f\"arn:aws:sagemaker:us-east-1:253352124568:model-package/{model_name}\",\n        \"us-east-2\": f\"arn:aws:sagemaker:us-east-2:057799348421:model-package/{model_name}\",\n        \"us-west-1\": f\"arn:aws:sagemaker:us-west-1:382657785993:model-package/{model_name}\",\n        \"us-west-2\": f\"arn:aws:sagemaker:us-west-2:594846645681:model-package/{model_name}\",\n        \"ca-central-1\": f\"arn:aws:sagemaker:ca-central-1:470592106596:model-package/{model_name}\",\n        \"eu-central-1\": f\"arn:aws:sagemaker:eu-central-1:446921602837:model-package/{model_name}\",\n        \"eu-west-1\": f\"arn:aws:sagemaker:eu-west-1:985815980388:model-package/{model_name}\",\n        \"eu-west-2\": f\"arn:aws:sagemaker:eu-west-2:856760150666:model-package/{model_name}\",\n        \"eu-west-3\": f\"arn:aws:sagemaker:eu-west-3:843114510376:model-package/{model_name}\",\n        \"eu-north-1\": f\"arn:aws:sagemaker:eu-north-1:136758871317:model-package/{model_name}\",\n        \"ap-southeast-1\": f\"arn:aws:sagemaker:ap-southeast-1:192199979996:model-package/{model_name}\",\n        \"ap-southeast-2\": f\"arn:aws:sagemaker:ap-southeast-2:666831318237:model-package/{model_name}\",\n        \"ap-northeast-2\": f\"arn:aws:sagemaker:ap-northeast-2:745090734665:model-package/{model_name}\",\n        \"ap-northeast-1\": f\"arn:aws:sagemaker:ap-northeast-1:977537786026:model-package/{model_name}\",\n        \"ap-south-1\": f\"arn:aws:sagemaker:ap-south-1:077584701553:model-package/{model_name}\",\n        \"sa-east-1\": f\"arn:aws:sagemaker:sa-east-1:270155090741:model-package/{model_name}\",\n    }\n\n    return model_package_map[region_name]\n\nembedding_package_arn = get_arn_for_model(region, \"jina-embeddings-v2-base-en\")\nreranker_package_arn = get_arn_for_model(region, \"jina-reranker-v1-base-en\")\n</code></pre><h2 id=\"load-the-dataset\">Загрузка набора данных</h2><p>В этом руководстве мы будем использовать коллекцию видео с YouTube-канала <a href=\"https://www.youtube.com/@tudelftonlinelearning1226?ref=jina-ai-gmbh.ghost.io\">TU Delft Online Learning</a>. Этот канал производит различные образовательные материалы по предметам STEM. Его программирование лицензировано по <a href=\"https://creativecommons.org/licenses/by/3.0/legalcode?ref=jina-ai-gmbh.ghost.io\">CC-BY</a>.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://www.youtube.com/@tudelftonlinelearning1226?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">TU Delft Online Learning</div><div class=\"kg-bookmark-description\">Хотите сделать карьеру в науке, дизайне или инженерии? Тогда присоединяйтесь к сообществу онлайн-учащихся в TU Delft!\nВ TU Delft онлайн-обучение означает активное обучение. Наши курсы разработаны, чтобы обеспечить вам увлекательный учебный опыт. Содержание курсов сложное и требовательное, способствующее вашему личностному росту и профессиональному развитию, при этом вы можете наслаждаться гибкостью и доступностью, которые предлагают наши онлайн-курсы, чтобы совмещать обучение с другими приоритетами вашей жизни. Начните учиться сегодня: https://online-learning.tud…</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://www.youtube.com/s/desktop/4feff1e2/img/favicon_144x144.png\" alt=\"\"><span class=\"kg-bookmark-author\">YouTube</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://yt3.googleusercontent.com/ytc/AIdro_kH5d18Xqqj-MKv9k_tf2KNFufCpMY8qEXdQzEy=s900-c-k-c0x00ffffff-no-rj\" alt=\"\"></div></a></figure><p>Мы загрузили 193 видео с канала и обработали их с помощью модели распознавания речи <a href=\"https://openai.com/research/whisper?ref=jina-ai-gmbh.ghost.io\">Whisper</a> с открытым исходным кодом от OpenAI. Мы использовали самую маленькую модель <a href=\"https://huggingface.co/openai/whisper-tiny?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><code>openai/whisper-tiny</code></a> для преобразования видео в транскрипты.</p><p>Транскрипты были организованы в CSV-файл, который вы можете <a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/sagemaker/tu_delft.csv?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">скачать отсюда</a>.</p><p>Каждая строка файла содержит:</p><ul><li>Название видео</li><li>URL видео на YouTube</li><li>Текстовую расшифровку видео</li></ul><p>Чтобы загрузить эти данные в Python, сначала установите <code>pandas</code> и <code>requests</code>:</p><pre><code class=\"language-bash\">pip install requests pandas\n</code></pre><p>Загрузите данные CSV непосредственно в DataFrame Pandas с именем <code>tu_delft_dataframe</code>:</p><pre><code class=\"language-python\">import pandas\n\n# Load the CSV file\ntu_delft_dataframe = pandas.read_csv(\"https://raw.githubusercontent.com/jina-ai/workshops/feat-sagemaker-post/notebooks/embeddings/sagemaker/tu_delft.csv\")\n</code></pre><p>Вы можете проверить содержимое, используя метод DataFrame <code>head()</code>. В ноутбуке это должно выглядеть примерно так:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/03/Screenshot-2024-03-15-at-14.30.35.png\" class=\"kg-image\" alt=\"Фрейм данных, показывающий названия вебинаров, такие как &quot;Green Teams in Hospitals,&quot; с их URL-адресами YouTube и вводными текстовыми отрывками,\" loading=\"lazy\" width=\"1440\" height=\"580\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/03/Screenshot-2024-03-15-at-14.30.35.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/03/Screenshot-2024-03-15-at-14.30.35.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/03/Screenshot-2024-03-15-at-14.30.35.png 1440w\" sizes=\"(min-width: 720px) 720px\"></figure><p>Вы также можете посмотреть видео, используя URL-адреса из этого набора данных, и убедиться, что распознавание речи несовершенно, но в основном верно.</p><h2 id=\"start-the-jina-embeddings-v2-endpoint\">Запуск конечной точки Jina Embeddings v2</h2><p>Приведенный ниже код запустит экземпляр <code>ml.g4dn.xlarge</code> на AWS для запуска модели встраивания. Это может занять несколько минут.</p><pre><code class=\"language-python\">import boto3\nfrom jina_sagemaker import Client\n\n# Choose a name for your embedding endpoint. It can be anything convenient.\nembeddings_endpoint_name = \"jina_embedding\"\n\nembedding_client = Client(region_name=boto3.Session().region_name)\nembedding_client.create_endpoint(\n    arn=embedding_package_arn,\n    role=role,\n    endpoint_name=embeddings_endpoint_name,\n    instance_type=\"ml.g4dn.xlarge\",\n    n_instances=1,\n)\n\nembedding_client.connect_to_endpoint(endpoint_name=embeddings_endpoint_name)\n</code></pre><p>Измените <code>instance_type</code>, чтобы выбрать другой тип облачного экземпляра AWS, если это необходимо.</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">⚠️</div><div class=\"kg-callout-text\">AWS начнет выставлять вам счет за время, как только эта команда вернется. Вам будет выставляться счет почасово, пока вы не остановите этот экземпляр. Чтобы сделать это, следуйте инструкциям в разделе <a href=\"#shutting-down\" rel=\"noreferrer\"><b><strong style=\"white-space: pre-wrap;\">Завершение работы</strong></b></a>.</div></div><h2 id=\"build-and-index-the-dataset\">Создание и индексация набора данных</h2><p>Теперь, когда мы загрузили данные и запустили модель Jina Embeddings v2, мы можем подготовить и проиндексировать данные. Мы будем хранить данные в векторном хранилище <a href=\"https://faiss.ai/index.html?ref=jina-ai-gmbh.ghost.io\">FAISS</a>, векторной базе данных с открытым исходным кодом, специально разработанной для приложений ИИ.</p><p>Сначала установите оставшиеся предварительные требования для нашего RAG-приложения:</p><pre><code class=\"language-bash\">pip install tdqm numpy faiss-cpu\n</code></pre><h3 id=\"chunking\">Разбиение на чанки</h3><p>Нам нужно будет взять отдельные транскрипты и разбить их на более мелкие части, т.е. \"чанки\", чтобы мы могли поместить несколько текстов в промпт для LLM. Приведенный ниже код разбивает отдельные транскрипты на границах предложений, гарантируя, что все чанки по умолчанию содержат не более 128 слов.</p><pre><code class=\"language-python\">def chunk_text(text, max_words=128):\n    \"\"\"\n    Divide text into chunks where each chunk contains the maximum number \n    of full sentences with fewer words than `max_words`.\n    \"\"\"\n    sentences = text.split(\".\")\n    chunk = []\n    word_count = 0\n\n    for sentence in sentences:\n        sentence = sentence.strip(\".\")\n        if not sentence:\n          continue\n\n        words_in_sentence = len(sentence.split())\n        if word_count + words_in_sentence &lt;= max_words:\n            chunk.append(sentence)\n            word_count += words_in_sentence\n        else:\n            # Yield the current chunk and start a new one\n            if chunk:\n              yield \". \".join(chunk).strip() + \".\"\n            chunk = [sentence]\n            word_count = words_in_sentence\n\n    # Yield the last chunk if it's not empty\n    if chunk:\n        yield \" \".join(chunk).strip() + \".\"</code></pre><h3 id=\"get-embeddings-for-each-chunk\">Получение Embeddings для каждого чанка</h3><p>Нам нужен embedding для каждого чанка, чтобы сохранить его в базе данных FAISS. Чтобы получить их, мы передаем текстовые чанки в конечную точку модели embeddings Jina AI, используя метод <code>embedding_client.embed()</code>. Затем мы добавляем текстовые чанки и векторы embeddings в pandas dataframe <code>tu_delft_dataframe</code> как новые столбцы <code>chunks</code> и <code>embeddings</code>:</p><pre><code class=\"language-python\">import numpy as np\nfrom tqdm import tqdm\n\ntqdm.pandas()\n\ndef generate_embeddings(text_df):\n    chunks = list(chunk_text(text_df[\"Text\"]))\n    embeddings = []\n\n    for i, chunk in enumerate(chunks):\n      response = embedding_client.embed(texts=[chunk])\n      chunk_embedding = response[0][\"embedding\"]\n      embeddings.append(np.array(chunk_embedding))\n\n    text_df[\"chunks\"] = chunks\n    text_df[\"embeddings\"] = embeddings\n    return text_df\n\nprint(\"Embedding text chunks ...\")\ntu_delft_dataframe = generate_embeddings(tu_delft_dataframe)\n## если вы используете Google Colab или Python notebook,\n## удалите строку выше и раскомментируйте следующую строку:\n# tu_delft_dataframe = tu_delft_dataframe.progress_apply(generate_embeddings, axis=1)\n</code></pre><h3 id=\"set-up-semantic-search-using-faiss\">Настройка семантического поиска с помощью Faiss</h3><p>Код ниже создает базу данных FAISS и вставляет чанки и векторы embeddings путем итерации по <code>tu_delft_pandas</code>:</p><pre><code class=\"language-python\">import faiss\n\ndim = 768  # размерность embeddings Jina v2\nindex_with_ids = faiss.IndexIDMap(faiss.IndexFlatIP(dim))\nk = 0\n\ndoc_ref = dict()\n\nfor idx, row in tu_delft_dataframe.iterrows():\n    embeddings = row[\"embeddings\"]\n    for i, embedding in enumerate(embeddings):\n        normalized_embedding = np.ascontiguousarray(np.array(embedding, dtype=\"float32\").reshape(1, -1))\n        faiss.normalize_L2(normalized_embedding)\n        index_with_ids.add_with_ids(normalized_embedding, k)\n        doc_ref[k] = (row[\"chunks\"][i], idx)\n        k += 1\n</code></pre><h2 id=\"start-the-jina-reranker-v1-endpoint\">Запуск конечной точки Jina Reranker v1</h2><p>Как и в случае с моделью Jina Embedding v2 выше, этот код запустит экземпляр <code>ml.g4dn.xlarge</code> на AWS для работы модели ранжирования. Аналогично, выполнение может занять несколько минут.</p><pre><code class=\"language-python\">import boto3\nfrom jina_sagemaker import Client\n\n# Выберите имя для вашей конечной точки ранжирования. Это может быть любое удобное имя.\nreranker_endpoint_name = \"jina_reranker\"\n\nreranker_client = Client(region_name=boto3.Session().region_name)\nreranker_client.create_endpoint(\n    arn=reranker_package_arn,\n    role=role,\n    endpoint_name=reranker_endpoint_name,\n    instance_type=\"ml.g4dn.xlarge\",\n    n_instances=1,\n)\n\nreranker_client.connect_to_endpoint(endpoint_name=reranker_endpoint_name)\n</code></pre><h2 id=\"define-query-functions\">Определение функций запроса</h2><p>Далее мы определим функцию, которая находит наиболее похожие чанки транскрипции для любого текстового запроса.</p><p>Это двухэтапный процесс:</p><ol><li>Преобразование пользовательского ввода в вектор embedding используя метод <code>embedding_client.embed()</code>, как мы делали на этапе подготовки данных.</li><li>Передача embedding в индекс FAISS для получения лучших совпадений. В функции ниже по умолчанию возвращаются 20 лучших совпадений, но вы можете управлять этим с помощью параметра <code>n</code>.</li></ol><p>Функция <code>find_most_similar_transcript_segment</code> вернет лучшие совпадения путем сравнения косинусов сохраненных embeddings с embedding запроса.</p><pre><code class=\"language-python\">def find_most_similar_transcript_segment(query, n=20):\n    query_embedding = embedding_client.embed(texts=[query])[0][\"embedding\"]  # Предполагается, что запрос достаточно короткий и не требует разбиения на чанки\n    query_embedding = np.ascontiguousarray(np.array(query_embedding, dtype=\"float32\").reshape(1, -1))\n    faiss.normalize_L2(query_embedding)\n\n    D, I = index_with_ids.search(query_embedding, n)  # Получаем top n совпадений\n\n    results = []\n    for i in range(n):\n        distance = D[0][i]\n        index_id = I[0][i]\n        transcript_segment, doc_idx = doc_ref[index_id]\n        results.append((transcript_segment, doc_idx, distance))\n\n    # Сортируем результаты по расстоянию\n    results.sort(key=lambda x: x[2])\n\n    return [(tu_delft_dataframe.iloc[r[1]][\"Title\"].strip(), r[0]) for r in results]\n</code></pre><p>Мы также определим функцию, которая обращается к конечной точке ранжирования <code>reranker_client</code>, передает ей результаты из <code>find_most_similar_transcript_segment</code> и возвращает только три наиболее релевантных результата. Она вызывает конечную точку ранжирования с помощью метода <code>reranker_client.rerank()</code>.</p><pre><code class=\"language-python\">def rerank_results(query_found, query, n=3):\n    ret = reranker_client.rerank(\n        documents=[f[1] for f in query_found], \n        query=query, \n        top_n=n,\n    )\n    return [query_found[r['index']] for r in ret[0]['results']]\n</code></pre><h2 id=\"use-jumpstart-to-load-mistral-instruct\">Использование JumpStart для загрузки Mistral-Instruct</h2><p>Для этого руководства мы будем использовать модель <code>mistral-7b-instruct</code>, которая <a href=\"https://aws.amazon.com/blogs/machine-learning/mistral-7b-foundation-models-from-mistral-ai-are-now-available-in-amazon-sagemaker-jumpstart/?ref=jina-ai-gmbh.ghost.io\">доступна через Amazon SageMaker JumpStart</a>, как часть LLM системы RAG.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://aws.amazon.com/blogs/machine-learning/mistral-7b-foundation-models-from-mistral-ai-are-now-available-in-amazon-sagemaker-jumpstart/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Базовые модели Mistral 7B от Mistral AI теперь доступны в Amazon SageMaker JumpStart | Amazon Web Services</div><div class=\"kg-bookmark-description\">Сегодня мы рады объявить, что базовые модели Mistral 7B, разработанные Mistral AI, доступны клиентам через Amazon SageMaker JumpStart для развертывания в один клик для выполнения вывода. С 7 миллиардами параметров Mistral 7B легко настраивается и быстро развертывается. Вы можете опробовать эту модель с SageMaker JumpStart, […]</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://a0.awsstatic.com/main/images/site/touch-icon-ipad-144-smile.png\" alt=\"\"><span class=\"kg-bookmark-author\">Amazon Web Services</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://d2908q01vomqb2.cloudfront.net/f1f836cb4ea6efb2a0b1b99f41ad8b103eff4b59/2023/10/09/mistral-7b-sagemaker-jumpstart.jpg\" alt=\"\"></div></a></figure><p>Запустите следующий код для загрузки и развертывания Mistral-Instruct:</p><pre><code class=\"language-python\">from sagemaker.jumpstart.model import JumpStartModel\n\njumpstart_model = JumpStartModel(model_id=\"huggingface-llm-mistral-7b-instruct\", role=role)\nmodel_predictor = jumpstart_model.deploy()\n</code></pre><p>Конечная точка для доступа к этой LLM сохраняется в переменной <code>model_predictor</code>.</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">⚠️</div><div class=\"kg-callout-text\">Использование этой модели также является платной услугой AWS, поэтому не забудьте отключить ее, когда закончите с этим руководством. См. раздел <a href=\"#shutting-down\" rel=\"noreferrer\"><b>Завершение работы</b></a>, чтобы остановить это развертывание по окончании.</div></div><h3 id=\"mistral-instruct-with-jumpstart\">Mistral-Instruct с JumpStart</h3><p>Ниже приведен код для создания шаблона промпта для Mistral-Instruct для этого приложения с использованием <a href=\"https://docs.python.org/3/library/string.html?ref=jina-ai-gmbh.ghost.io#template-strings\">встроенного класса шаблонов строк Python</a>. Предполагается, что для каждого запроса есть три соответствующих чанка транскрипции, которые будут представлены модели.</p><p>Вы можете экспериментировать с этим шаблоном самостоятельно, чтобы модифицировать это приложение или попробовать получить лучшие результаты.</p><pre><code class=\"language-python\">from string import Template\n\nprompt_template = Template(\"\"\"\n  &lt;s&gt;[INST] Ответьте на вопрос ниже, используя только предоставленный контекст.\n  Вопрос пользователя основан на транскриптах видео с YouTube-канала.\n  Контекст представлен в виде ранжированного списка информации в формате\n    (название-видео, сегмент-транскрипта), который релевантен для ответа на\n    вопрос пользователя.\n  В ответе следует использовать только представленный контекст. Если на вопрос\n    нельзя ответить на основе контекста, скажите об этом.\n\n  Контекст:\n  1. Название видео: $title_1, сегмент транскрипта: $segment_1\n  2. Название видео: $title_2, сегмент транскрипта: $segment_2\n  3. Название видео: $title_3, сегмент транскрипта: $segment_3\n\n  Вопрос: $question\n\n  Ответ: [/INST]\n\"\"\")\n</code></pre><p>С этим компонентом у нас теперь есть все части полного RAG-приложения.</p><h2 id=\"querying-the-model\">Запросы к модели</h2><p>Запрос к модели - это трехэтапный процесс.</p><ol><li>Поиск релевантных чанков для заданного запроса.</li><li>Сборка промпта.</li><li>Отправка промпта модели Mistral-Instruct и получение ответа.</li></ol><p>Для поиска релевантных чанков мы используем функцию <code>find_most_similar_transcript_segment</code>, которую мы определили выше.</p><pre><code class=\"language-python\">question = \"Когда была введена в эксплуатацию первая морская ветряная электростанция?\"\nsearch_results = find_most_similar_transcript_segment(question)\nreranked_results = rerank_results(search_results, question)\n</code></pre><p>Вы можете просмотреть результаты поиска в переранжированном порядке:</p><pre><code class=\"language-python\">for title, text, _ in reranked_results:\n    print(title + \"\\n\" + text + \"\\n\")\n</code></pre><p>Результат:</p><pre><code class=\"language-text\">Offshore Wind Farm Technology - Course Introduction\nSince the first offshore wind farm commissioned in 1991 in Denmark, scientists and engineers have adapted and improved the technology of wind energy to offshore conditions.  This is a rapidly evolving field with installation of increasingly larger wind turbines in deeper waters.  At sea, the challenges are indeed numerous, with combined wind and wave loads, reduced accessibility and uncertain-solid conditions.  My name is Axel Vire, I'm an assistant professor in Wind Energy at U-Delf and specializing in offshore wind energy.  This course will touch upon the critical aspect of wind energy, how to integrate the various engineering disciplines involved in offshore wind energy.  Each week we will focus on a particular discipline and use it to design and operate a wind farm.\n\nOffshore Wind Farm Technology - Course Introduction\nI'm a researcher and lecturer at the Wind Energy and Economics Department and I will be your moderator throughout this course.  That means I will answer any questions you may have.  I'll strengthen the interactions between the participants and also I'll get you in touch with the lecturers when needed.  The course is mainly developed for professionals in the field of offshore wind energy.  We want to broaden their knowledge of the relevant technical disciplines and their integration.  Professionals with a scientific background who are new to the field of offshore wind energy will benefit from a high-level insight into the engineering aspects of wind energy.  Overall, the course will help you make the right choices during the development and operation of offshore wind farms.\n\nOffshore Wind Farm Technology - Course Introduction\nDesigned wind turbines that better withstand wind, wave and current loads  Identify great integration strategies for offshore wind turbines and gain understanding of the operational and maintenance of offshore wind turbines and farms  We also hope that you will benefit from the course and from interaction with other learners who share your interest in wind energy  And therefore we look forward to meeting you online.\n</code></pre><p>Мы можем использовать эту информацию непосредственно в шаблоне запроса:</p><pre><code class=\"language-python\">prompt_for_llm = prompt_template.substitute(\n    question = question,\n    title_1 = search_results[0][0],\n    segment_1 = search_results[0][1],\n    title_2 = search_results[1][0],\n    segment_2 = search_results[1][1],\n    title_3 = search_results[2][0],\n    segment_3 = search_results[2][1],\n)\n</code></pre><p>Выведем получившуюся строку, чтобы увидеть, какой запрос фактически отправляется в LLM:</p><pre><code class=\"language-python\">print(prompt_for_llm)\n</code></pre><pre><code class=\"language-text\">&lt;s&gt;[INST] Answer the question below only using the given context.\n  The question from the user is based on transcripts of videos from a YouTube\n    channel.\n  The context is presented as a ranked list of information in the form of\n    (video-title, transcript-segment), that is relevant for answering the\n    user's question.\n  The answer should only use the presented context. If the question cannot be\n    answered based on the context, say so.\n\n  Context:\n  1. Video-title: Offshore Wind Farm Technology - Course Introduction, transcript-segment: Since the first offshore wind farm commissioned in 1991 in Denmark, scientists and engineers have adapted and improved the technology of wind energy to offshore conditions.  This is a rapidly evolving field with installation of increasingly larger wind turbines in deeper waters.  At sea, the challenges are indeed numerous, with combined wind and wave loads, reduced accessibility and uncertain-solid conditions.  My name is Axel Vire, I'm an assistant professor in Wind Energy at U-Delf and specializing in offshore wind energy.  This course will touch upon the critical aspect of wind energy, how to integrate the various engineering disciplines involved in offshore wind energy.  Each week we will focus on a particular discipline and use it to design and operate a wind farm.\n  2. Video-title: Offshore Wind Farm Technology - Course Introduction, transcript-segment: For example, we look at how to characterize the wind and wave conditions at a given location.  How to best place the wind turbines in a farm and also how to retrieve the electricity back to shore.  We look at the main design drivers for offshore wind turbines and their components.  We'll see how these aspects influence one another and the best choices to reduce the cost of energy.  This course is organized by the two-delfd wind energy institute, an interfaculty research organization focusing specifically on wind energy.  You will therefore benefit from the expertise of the lecturers in three different faculties of the university.  Aerospace engineering, civil engineering and electrical engineering.  Hi, my name is Ricardo Pareda.\n  3. Video-title: Systems Analysis for Problem Structuring part 1B the mono actor perspective example, transcript-segment: So let's assume the demarcation of the problem and the analysis of objectives has led to the identification of three criteria.  The security of supply, the percentage of offshore power generation and the costs of energy provision.  We now reason backwards to explore what factors have an influence on these system outcomes.  Really, the offshore percentage is positively influenced by the installed Wind Power capacity at sea, a key system factor.  Capacity at sea in turn is determined by both the size and the number of wind farms at sea.  The Ministry of Economic Affairs cannot itself invest in new wind farms but hopes to simulate investors and energy companies by providing subsidies and by expediting the granting process of licenses as needed.\n\n  Question: When was the first offshore wind farm commissioned?\n\n  Answer: [/INST]\n</code></pre><p>Передаем этот запрос в конечную точку LLM — <code>model_predictor</code> — через метод <code>model_predictor.predict()</code>:</p><pre><code class=\"language-python\">answer = model_predictor.predict({\"inputs\": prompt_for_llm})\n</code></pre><p>Это возвращает список, но поскольку мы передали только один запрос, это будет список с одним элементом. Каждый элемент представляет собой <code>dict</code> с текстом ответа под ключом <code>generated_text</code>:</p><pre><code class=\"language-python\">answer = answer[0]['generated_text']\nprint(answer)\n</code></pre><p>Результат:</p><pre><code class=\"language-text\">The first offshore wind farm was commissioned in 1991. (Context: Video-title: Offshore Wind Farm Technology - Course Introduction, transcript-segment: Since the first offshore wind farm commissioned in 1991 in Denmark, ...)\n</code></pre><p>Давайте упростим запросы, написав функцию, которая выполняет все шаги: принимает строковый вопрос в качестве параметра и возвращает ответ в виде строки:</p><pre><code class=\"language-python\">def ask_rag(question):\n    search_results = find_most_similar_transcript_segment(question)\n    reranked_results = rerank_results(search_results, question)\n    prompt_for_llm = prompt_template.substitute(\n        question = question,\n        title_1 = search_results[0][0],\n        segment_1 = search_results[0][1],\n        title_2 = search_results[1][0],\n        segment_2 = search_results[1][1],\n        title_3 = search_results[2][0],\n        segment_3 = search_results[2][1],\n    )\n    answer = model_predictor.predict({\"inputs\": prompt_for_llm})\n    return answer[0][\"generated_text\"]\n</code></pre><p>Теперь мы можем задать ещё несколько вопросов. Ответы будут зависеть от содержания видео-транскриптов. Например, мы можем задавать детальные вопросы, когда ответ присутствует в данных, и получать ответ:</p><pre><code class=\"language-python\">ask_rag(\"What is a Kaplan Meyer estimator?\")\n</code></pre><pre><code class=\"language-text\">The Kaplan Meyer estimator is a non-parametric estimator for the survival \nfunction, defined for both censored and not censored data. It is represented \nas a series of declining horizontal steps that approaches the truths of the \nsurvival function if the sample size is sufficiently large enough. The value \nof the empirical survival function obtained is assumed to be constant between \ntwo successive distinct observations.\n</code></pre><pre><code class=\"language-python\">ask_rag(\"Who is Reneville Solingen?\")\n</code></pre><pre><code class=\"language-text\">Reneville Solingen is a professor at Delft University of Technology in Global \nSoftware Engineering. She is also a co-author of the book \"The Power of Scrum.\"\n</code></pre><pre><code class=\"language-python\">answer = ask_rag(\"What is the European Green Deal?\")\nprint(answer)\n</code></pre><pre><code class=\"language-text\">The European Green Deal is a policy initiative by the European Union to combat \nclimate change and decarbonize the economy, with a goal to make Europe carbon \nneutral by 2050. It involves the use of green procurement strategies in various \nsectors, including healthcare, to reduce carbon emissions and promote corporate \nsocial responsibility.\n</code></pre><p>Мы также можем задавать вопросы, выходящие за рамки доступной информации:</p><pre><code class=\"language-python\">ask_rag(\"What countries export the most coffee?\")\n</code></pre><pre><code class=\"language-text\">Based on the context provided, there is no clear answer to the user's \nquestion about which countries export the most coffee as the context \nonly discusses the Delft University's cafeteria discounts and sustainable \ncoffee options, as well as lithium production and alternatives for use in \nelectric car batteries.\n</code></pre><pre><code class=\"language-python\">ask_rag(\"How much wood could a woodchuck chuck if a woodchuck could chuck wood?\")\n</code></pre><pre><code class=\"language-text\">The context does not provide sufficient information to answer the question. \nThe context is about thermit welding of rails, stress concentration factors, \nand a lyrics video. There is no mention of woodchucks or the ability of \nwoodchuck to chuck wood in the context.\n</code></pre><p>Попробуйте свои собственные запросы. Вы также можете изменить способ запроса к LLM, чтобы увидеть, улучшит ли это ваши результаты.</p><h2 id=\"shutting-down\">Завершение работы</h2><p>Поскольку вам выставляется счет почасово за используемые модели и инфраструктуру AWS для их запуска, очень важно остановить все три модели AI, когда вы закончите этот учебник:</p><ul><li>Конечную точку модели встраивания <code>embedding_client</code></li><li>Конечную точку модели переранжирования <code>reranker_client</code></li><li>Конечную точку большой языковой модели <code>model_predictor</code></li></ul><p>Чтобы отключить все три конечные точки модели, выполните следующий код:</p><pre><code class=\"language-python\"># shut down the embedding endpoint\nembedding_client.delete_endpoint()\nembedding_client.close()\n# shut down the reranker endpoint\nreranker_client.delete_endpoint()\nreranker_client.close()\n# shut down the LLM endpoint\nmodel_predictor.delete_model()\nmodel_predictor.delete_endpoint()\n</code></pre><h2 id=\"get-started-now-with-jina-ai-models-on-aws-marketplace\">Начните работу с моделями Jina AI на AWS Marketplace прямо сейчас</h2><p>Благодаря нашим моделям встраивания и переранжирования на SageMaker, корпоративные пользователи AI на AWS теперь имеют мгновенный доступ к выдающемуся ценностному предложению Jina AI без ущерба для преимуществ их существующих облачных операций. Все преимущества безопасности, надежности, согласованности и предсказуемого ценообразования AWS встроены изначально.</p><p>В Jina AI мы усердно работаем над тем, чтобы предоставить современные технологии бизнесу, который может извлечь выгоду из внедрения AI в свои существующие процессы. Мы стремимся предлагать надежные, высокопроизводительные модели по доступным ценам через удобные и практичные интерфейсы, минимизируя ваши инвестиции в AI при максимизации отдачи.</p><p>Посетите <a href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\">страницу Jina AI на AWS Marketplace</a>, чтобы увидеть список всех моделей встраивания и переранжирования, которые мы предлагаем, и попробовать наши модели бесплатно в течение семи дней.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://aws.amazon.com/marketplace/seller-profile?id=seller-stch2ludm6vgy&ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">AWS Marketplace: Jina AI</div><div class=\"kg-bookmark-description\"></div>Мы будем рады узнать о ваших вариантах использования и обсудить, как продукты Jina AI могут соответствовать потребностям вашего бизнеса. Свяжитесь с нами через <a href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io\">наш веб-сайт</a> или наш <a href=\"https://discord.jina.ai/?ref=jina-ai-gmbh.ghost.io\">канал Discord</a>, чтобы поделиться своим мнением и быть в курсе наших последних моделей.",
  "comment_id": "65fabb91502fd000011c667e",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Blog-images--27-.jpg",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-20T11:33:53.000+01:00",
  "updated_at": "2024-03-25T19:10:29.000+01:00",
  "published_at": "2024-03-25T16:00:51.000+01:00",
  "custom_excerpt": "Learn to use Jina Embeddings and Reranking models in a full-stack AI application on AWS, using only components available in Amazon SageMaker and the AWS Marketplace.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "632ae7353e4e55003d52598e",
      "name": "Scott Martens",
      "slug": "scott",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/11/photo-of-me-cropped.jpg",
      "cover_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/11/shanshui-ernie-crop.png",
      "bio": "A rogue AI created by Canada's Weapon X program.\n\nContent Creator @ Jina AI",
      "website": "https://jina.ai",
      "location": "Berlin",
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/scott/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "632ae7353e4e55003d52598e",
    "name": "Scott Martens",
    "slug": "scott",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/11/photo-of-me-cropped.jpg",
    "cover_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/11/shanshui-ernie-crop.png",
    "bio": "A rogue AI created by Canada's Weapon X program.\n\nContent Creator @ Jina AI",
    "website": "https://jina.ai",
    "location": "Berlin",
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/scott/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/next-level-cloud-ai-jina-embeddings-and-rerankers-on-amazon-sagemaker/",
  "excerpt": "Научитесь использовать модели Jina Embeddings и Reranking в полноценном AI-приложении на AWS, используя только компоненты, доступные в Amazon SageMaker и AWS Marketplace.",
  "reading_time": 21,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Abstract image with colorful wavy background featuring AWS, Embeddings, and Reranker logos.",
  "feature_image_caption": null
}
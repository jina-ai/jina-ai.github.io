{
  "slug": "precise-rag-with-jina-reranker-and-llamaindex",
  "id": "65e97909b22368000152a4c7",
  "uuid": "3bcc0e9b-38b1-4df4-bcf7-dbe893156630",
  "title": "Точное RAG с помощью Jina Reranker и LlamaIndex",
  "html": "<p>В то время как <a href=\"https://www.sbert.net/examples/applications/cross-encoder/README.html?ref=jina-ai-gmbh.ghost.io\"><u>модели bi-encoder</u></a>, такие как <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>, могут быстро находить множество подходящих документов из базы данных предварительно вычисленных эмбеддингов, модели ранжирования могут уточнить этот набор, используя более медленный, но более точный подход кросс-кодирования запросов пользователей и найденных документов. Jina AI <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>выпустила нашу первую модель ранжирования</u></a>, <code>jina-reranker-v1-base-en</code>, и в этой статье мы подробно объясним, почему ранжировщик необходим для оптимизации точности RAG и как начать создавать современную RAG-систему с использованием <a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>/<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Reranker</u></a>, <a href=\"https://www.llamaindex.ai/?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> и языковой модели <code>Mixtral-8x7B-Instruct-v0.1</code> (<a href=\"https://huggingface.co/mistralai/Mixtral-8x7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\"><u>размещенной на HuggingFace</u></a>).</p><p>Вам понадобится:</p><ul><li><a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Комбинированный ключ для API Jina Embeddings и Reranker</u></a>.</li><li><a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>Аккаунт и токен HuggingFace</u></a>.</li></ul><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">Maximize the search relevancy and RAG accuracy at ease</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><p>Поскольку модели Jina Embeddings и Reranker, а также Mixtral работают удаленно и доступны через RESTful API, вам не потребуется специальное оборудование.</p><h2 id=\"what-is-a-reranker\">Что такое ранжировщик?</h2><p>Прежде чем продолжить учебник, важно пояснить, что такое ранжировщики. Для полного понимания того, что такое ранжировщик и почему Jina Reranker V1 — лучший выбор для вас, мы рекомендуем сначала прочитать нашу публикацию о выпуске Jina Reranker V1.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>Вкратце, ранжировщики — это модели кросс-кодировщика, которые принимают на вход пару <em>документ-запрос</em> и выдают комбинированную оценку релевантности для этой пары. Используя ранжировщики, пользователи могут сортировать документы от наиболее до наименее релевантных для данного запроса.</p><h2 id=\"why-use-jina-reranker-v1-base-en\">Почему стоит использовать <code>jina-reranker-v1-base-en</code>?</h2><p>Переранжирование обеспечивает гораздо более релевантную информацию, чем использование только модели эмбеддингов. В нашем <a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><u>посте о выпуске модели</u></a> мы продемонстрировали, что Jina Reranker выделяется на фоне своих конкурентов с открытым и закрытым исходным кодом и может улучшить поисковые системы на <strong>8% по показателю попаданий и на 33% по </strong><a href=\"https://en.wikipedia.org/wiki/Mean_reciprocal_rank?ref=jina-ai-gmbh.ghost.io\"><strong><u>среднему обратному рангу</u></strong></a>.</p><p>Это напрямую влияет на качество ответов, полученных через примененное RAG-решение. Подкрепив это теоретически, мы покажем вам практический пример, чтобы вы могли своими глазами увидеть, какой эффект Jina Reranker оказывает на RAG-конвейер, построенный с помощью LlamaIndex.</p><h2 id=\"before-we-start-a-note-on-llamaindex-node-postprocessors\">Перед началом: Замечание о постпроцессорах узлов LlamaIndex</h2><p>Постпроцессоры узлов в <a href=\"https://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/root.html?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> — это модули, которые трансформируют или фильтруют узлы после извлечения и перед синтезом ответа в поисковом движке. В составе этого пакета LlamaIndex предлагает как встроенные опции, так и API для пользовательских дополнений.</p><p><strong>Jina Reranker теперь </strong><a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><strong><u>интегрирован</u></strong></a><strong> в LlamaIndex как постпроцессор узлов</strong>. Для повышения точности ответов извлеченные узлы переупорядочиваются на основе релевантности запросу, и возвращаются топ <strong><em>N</em></strong> узлов.</p><h2 id=\"follow-along-on-google-colab\">Следуйте за нами в Google Colab</h2><p>К этому учебнику прилагается блокнот, который вы можете запустить в <a href=\"https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>Google Colab</u></a> или локально.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">llama_index/docs/docs/examples/node_postprocessor/JinaRerank.ipynb at main · run-llama/llama_index</div><div class=\"kg-bookmark-description\">LlamaIndex is a data framework for your LLM applications - run-llama/llama_index</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/assets/pinned-octocat-093da3e6fa40.svg\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">run-llama</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2000e9ce9c43753a6316de82e8309737edaa6377de7b47d2d8b08a4a3caa8a71/run-llama/llama_index\" alt=\"\"></div></a></figure><h3 id=\"the-dataset-2024-nike-kids-product-catalog\">Набор данных: Каталог детских товаров Nike 2024</h3><p>Чтобы продемонстрировать повышение производительности Jina Reranker для RAG-приложений, мы выбрали <a href=\"https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&ref=jina-ai-gmbh.ghost.io\"><u>Каталог детских товаров Nike 2024</u></a> в качестве нашего набора данных. Документ содержит структурированный набор детских товаров, предлагаемых Nike в 2024 году. Мы выбрали этот набор данных, так как он наглядно демонстрирует эффект использования ранжировщика и понятен большинству пользователей.</p><h3 id=\"install-the-prerequisites\">Установка необходимых компонентов</h3><p>Для установки требований выполните:</p><pre><code class=\"language-bash\">pip install llama-index-postprocessor-jinaai-rerank\npip install llama-index-embeddings-jinaai\npip install llama-index\npip install llama-index-llms-huggingface\npip install \"huggingface_hub[inference]\"</code></pre><h3 id=\"access-mixtral-llm\">Доступ к Mixtral LLM</h3><p>Для использования LLM <code>Mixtral-8x7B-Instruct-v0.1</code> вам нужен токен <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace</u></a>.</p><pre><code class=\"language-Python\">from llama_index.llms.huggingface import HuggingFaceInferenceAPI\n\nhf_inference_api_key = \"&lt;ваш токен доступа HuggingFace здесь&gt;\"\n\nmixtral_llm = HuggingFaceInferenceAPI(\n    model_name=\"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n    token=hf_inference_api_key,\n)\n</code></pre><h3 id=\"access-jina-embeddings-and-jina-reranker\">Доступ к Jina Embeddings и Jina Reranker</h3><p>Для использования наших Jina Embeddings и Jina Reranker вам нужен специальный <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>API-ключ</u></a>. Сохраните его в переменной <code>api_key</code> и вызовите модель Jina Embeddings из LlamaIndex:</p><pre><code class=\"language-Python\">from llama_index.embeddings.jinaai import JinaEmbedding\n\napi_key = \"&lt;ваш ключ Jina здесь&gt;\"\njina_embeddings = JinaEmbedding(api_key=api_key)</code></pre><p>Аналогично вы можете вызвать модель Jina Reranker. Установив параметр <code>top_n</code>, вы можете решить, сколько наиболее релевантных документов вернуть в конечном выводе. В данном случае мы установим<code>top_n=2</code>:</p><pre><code class=\"language-Python\">from llama_index.postprocessor.jinaai_rerank import JinaRerank\n\njina_rerank = JinaRerank(api_key=api_key, top_n=2)</code></pre><h3 id=\"download-the-2024-nike-kids-product-catalog\">Скачать каталог детских товаров Nike 2024</h3><p>Чтобы скачать данные, выполните следующий код:</p><pre><code class=\"language-Python\">from llama_index.core import SimpleDirectoryReader\nimport requests\n\nurl = '&lt;https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&gt;'\nresponse = requests.get(url)\n\nwith open('Nike_Catalog.pdf', 'wb') as f:\n    f.write(response.content)\n\nreader = SimpleDirectoryReader(\n    input_files=[\"Nike_Catalog.pdf\"]\n)\n\ndocuments = reader.load_data()</code></pre><h3 id=\"generate-and-index-embeddings-with-jina-embeddings\">Создание и индексация эмбеддингов с помощью Jina Embeddings</h3><p>Теперь, когда настройка завершена, мы создадим векторы эмбеддингов (узлы) и проиндексируем их. Модели Jina Embeddings v2 принимают входные данные размером до 8192 токенов, что достаточно для документа такого размера, поэтому нам не нужно выполнять дополнительную сегментацию текста или проверять, не содержит ли какой-либо раздел слишком много токенов. Для создания эмбеддингов и индексации документа выполните следующий код:</p><pre><code class=\"language-Python\">from llama_index.core import VectorStoreIndex\n\nindex = VectorStoreIndex.from_documents(\n    documents=documents, embed_model=jina_embeddings\n)</code></pre><h3 id=\"query-for-results-without-jina-reranker\">Запрос результатов без использования Jina Reranker</h3><p>Когда мы запрашиваем конкретную информацию из этого набора текстов, LlamaIndex <code>query_engine</code> выполняет следующее:</p><ol><li>С помощью Jina Embeddings V2 создает эмбеддинг для запроса.</li><li>Использует индекс для получения <code>top_k = 10</code> сохраненных эмбеддингов с наибольшим косинусным сходством с эмбеддингом запроса и возвращает их позиции в индексе.</li><li>Находит соответствующий текст в массиве векторных данных.</li></ol><p>Давайте спросим, какие лучшие спортивные штаны с подкладкой продает Nike:</p><pre><code>query_engine = index.as_query_engine(\n    similarity_top_k=10, llm=mixtral_llm\n)\nresponse = query_engine.query(\n    \"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p><strong>Результат</strong>:</p><pre><code class=\"language-Text\">NIKE KIDS  EQUIPMENT87NIKE BRASILIA SMALL DUFFEL 9.5 \nDM3976 $37.00\nSIZES: Misc  OFFER DATE: 07/01/22  END DATE: 07/01/25\nTough 600D polyester • Durable 300D polyester • Detachable shoulder\nstrap • Ventilated shoe or wet/dry storage • Secure zip pocket • \nLimited lifetime guarantee • Screened Swoosh design trademark\nDIMENSIONS:  20\" L x 10\" W x 11\" H \n010 Black/Black/(White) 068 Iron Grey/Black/(White)\n...</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/z2OKhAFnHCXw3aI4W1KUZNxzt8WOEERSG-prrBcmGwBEDTAFGavSN8eiHnvFF6R0L-dlwRUY3U8R7ysinoGTSSL-9_vr0RdCmrIRSy_xffvKz-Trqa1Yr49YGNb7R-GsDpCqilIW3cluVER4St5rUts\" class=\"kg-image\" alt=\"Three Nike Brasilia Small Duffel Bags, $37 each, in black, grey, navy with features listed and offer dates from 07/01/22 to 0\" loading=\"lazy\" width=\"594\" height=\"592\"></figure><h3 id=\"query-for-results-with-reranker\">Запрос результатов с использованием Reranker</h3><p>Теперь мы хотим применить реранкер, чтобы проверить, даст ли RAG-приложение другой, более <em>релевантный</em> результат. Для этого нам нужно добавить <code>node_postprocessors</code> в <code>query_engine</code>:</p><pre><code class=\"language-Python\">query_engine = index.as_query_engine(\n    similarity_top_k=10, llm=mixtral_llm, node_postprocessors=[jina_rerank]\n)\nresponse = query_engine.query(\n    \"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p>Обратите внимание, что по сравнению с предыдущим случаем без реранкера, <code>query_engine</code> теперь также содержит параметр <a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><u>node_postprocessors</u></a>, установленный на <code>[jina_rerank]</code>.</p><p><strong>Результат</strong>:</p><pre><code class=\"language-Text\">NIKE KIDS  FOOTBALL – STOCK10\nDJ5731 $47.00\nSIZES:  XS, S, M, L, XL, 2XL, 3XL\nFABRIC:  Body/panels lining: 100% polyester. Pad: 100%\nethylene vinyl acetate.\nOFFER DATE:  04/01/23\nEND DATE:  04/01/27\nTake the field ready to give it your all in the Nike Recruit\nPants. They're made from lightweight, stretchy fabric with\nsweat-wicking power to help keep you dry and moving freely\nwhen the game heats up. With integrated pads shaped for a\ncomfortable fit, you'll be prepared for a performance you can\nbe proud of. Choose from 6 different colors to outfit your\nteam. Nike Dri-FIT technology moves sweat away from your skin\nfor quicker evaporation, helping you stay dry and comfortable.\nLightweight knit fabric stretches with you to let you move\nnaturally. Thigh, knee, hip and tailbone pads are shaped for\nan optimal fit, without compromising on coverage. A\nbody-hugging fit is designed to help keep the padding in place\nand close to the body. Belt at the waist lets you dial in your\nperfect fit to maximize comfort. Elastic at hems.\nHip width: 15\", Inseam length: 11.75\" (size medium).\n010 Black/(White) 060 Team Anthracite/(White) 100 White/(Black)\n419 Team Navy/(White) 493 Team Royal/(White) 657 Team Scarlet/(White)</code></pre><p></p><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/X0ngGFoOz8S_KlRhAlQs4rOooKsV92d06-UBa7BsFPiTilgTD9xuQfgIblG7dTq0BQp4ZA9DlBCjFvA6D62eUVDmxxOO38va5mlnutPr4Zlu6l70tvbGtmrS2V0rpn-OE__tarMtR1MxAmD2oQ3m2qg\" class=\"kg-image\" alt=\"Product display of boys' Nike DF Stock Recruit Pants with sizes, pricing, and various color options highlighted.\" loading=\"lazy\" width=\"1600\" height=\"982\"></figure><h2 id=\"conclusion\"><strong>Заключение</strong></h2><p>Как мы видим, запрос без реранкера приводит к результату, в котором упоминается \"сетчатая спинка для воздухопроницаемости\" и \"облегающий крой с мягким на ощупь материалом\". В сравнении с этим, при использовании реранкера мы получаем результат, в котором описываются штаны, \"разработанные для оптимальной воздухопроницаемости\", с \"влагоотводящей конструкцией\", которая \"помогает сохранять сухость и прохладу под давлением матча\", и \"легкой тканью в свободном, удобном крое\".</p><p>Второй результат намного точнее и более соответствует нашему запросу. В наших последних двух постах мы показали как с теоретической, так и с практической точки зрения, что добавление Jina Reranker в ваш RAG-конвейер повышает точность поиска и улучшает качество получаемых ответов.</p>",
  "comment_id": "65e97909b22368000152a4c7",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/banner_Reranker_-LlamaIndex.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-07T09:21:29.000+01:00",
  "updated_at": "2024-04-02T11:12:49.000+02:00",
  "published_at": "2024-03-07T15:00:01.000+01:00",
  "custom_excerpt": "Just Rerank It! Jina Reranker and LlamaIndex take your RAG up to the next level.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "65e85e35b22368000152a4bf",
    "name": "Francesco Kruk",
    "slug": "francesco",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/precise-rag-with-jina-reranker-and-llamaindex/",
  "excerpt": "Просто выполните ре-ранжирование! Jina Reranker и LlamaIndex поднимут ваш RAG на новый уровень.",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Collaborative graphic with \"RERANKER\" and \"Llamalindex\" logos over a purple background with crossed white abstract lines.",
  "feature_image_caption": null
}
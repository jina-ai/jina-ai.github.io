{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "I modelli di Embedding/Reranking sono in grado di confrontare i numeri?",
  "html": "<p>Questa è una domanda che mi è stata posta oggi alla conferenza ICML a Vienna.</p><p>Durante la pausa caffè, un utente di Jina mi ha avvicinato con una domanda nata da recenti discussioni nella comunità LLM. Mi ha chiesto se il nostro modello di embedding potesse riconoscere che 9.11 è <em>più piccolo</em> di 9.9, un compito in cui molti LLM forniscono il risultato opposto.</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>\"Onestamente, non lo so\", ho risposto. Mentre spiegava l'importanza di questa capacità per la sua applicazione e suggeriva che <strong>la tokenizzazione potrebbe essere la causa del problema</strong>, mi sono trovato ad annuire - la mia mente stava già elaborando idee per un esperimento per scoprire la risposta.</p><p>In questo articolo, voglio testare se il nostro modello di embedding, <code>jina-embeddings-v2-base-en</code> (rilasciato a ottobre 2023), e il Reranker, <code>jina-reranker-v2-multilingual</code> (rilasciato a giugno 2024), possono confrontare accuratamente i numeri. Per estendere l'ambito oltre il semplice confronto tra 9.11 e 9.9, ho progettato una serie di esperimenti che includono vari tipi di numeri: piccoli interi, numeri grandi, decimali, numeri negativi, valute, date e orari. L'obiettivo è valutare l'efficacia dei nostri modelli nel gestire diversi formati numerici.</p><h2 id=\"experimental-setup\">Setup Sperimentale</h2><p>L'implementazione completa può essere trovata nel Colab qui sotto:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>Il design dell'esperimento è abbastanza semplice. Per esempio, per verificare se il modello di embedding comprende i numeri tra [1, 100]. I passaggi sono i seguenti:</p><ol><li><strong>Costruire i Documenti</strong>: Generare documenti con \"stringhe letterali\" per ogni numero da <code>1</code> a <code>100</code>.</li><li><strong>Inviare all'API di Embedding</strong>: Utilizzare <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">l'API di Embedding</a> per ottenere gli embedding per ogni documento.</li><li><strong>Calcolare la Similarità del Coseno</strong>: Calcolare la similarità del coseno a coppie per ogni coppia di documenti per creare una matrice di similarità.</li><li><strong>Creare lo Scatter Plot</strong>: Visualizzare i risultati utilizzando uno scatter plot. Ogni elemento $(i, j)$ nella matrice di similarità è mappato in un punto con: Asse X: $(i - j)$; Asse Y: il valore di similarità di $(i, j)$</li></ol><p>Se il delta $(i - j)$ è zero, cioè $i = j$, allora la similarità semantica dovrebbe essere massima. Man mano che il delta $(i - j)$ aumenta, la similarità dovrebbe diminuire. <strong>Idealmente, la similarità dovrebbe essere linearmente proporzionale al valore delta.</strong> Se non possiamo osservare tale linearità, è probabile che il modello non riesca a comprendere i numeri e possa produrre errori come dire che 9.11 è maggiore di 9.9.</p><p>Il modello Reranker segue una procedura simile. La differenza principale è che iteriamo attraverso i documenti costruiti, impostando ciascuno come <code>query</code> aggiungendo il prompt <code>\"what is the closest item to...\"</code> e classificando tutti gli altri come <code>documents</code>. Il punteggio di rilevanza restituito da <a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">l'API del Reranker</a> viene utilizzato direttamente come misura di similarità semantica. L'implementazione principale è la seguente.</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">I Modelli Possono Confrontare Numeri tra [1, 2, 3, ..., 100]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Scatter plot con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">Come Leggere Questi Grafici</h3><p>Prima di procedere con altri esperimenti, permettetemi di spiegare come leggere correttamente questi grafici. Innanzitutto, la mia osservazione dai due grafici sopra è che il modello di embedding funziona bene, mentre il modello reranker non si comporta altrettanto bene. Quindi, cosa stiamo osservando e perché?</p><p>L'asse X rappresenta il delta degli indici $(i,j)$, o $i-j$, quando campioniamo uniformemente $d_i$ e $d_j$ dai nostri set di documenti. Questo delta varia da $[-100, 100]$. Poiché il nostro set di documenti è ordinato per costruzione, cioè più piccolo è $|i-j|$, più vicini sono semanticamente $d_i$ e $d_j$; più lontani sono $i$ e $j$, minore è la similarità tra $d_i$ e $d_j$. Ecco perché si vede la similarità (rappresentata dall'asse Y) raggiungere un picco a $X=0$ e poi diminuire linearmente spostandosi a sinistra e a destra.</p><p>Idealmente, questo dovrebbe creare un picco netto o una forma a \"freccia verso l'alto\" come <code>^</code>. Tuttavia, non è sempre così. Se si fissa l'asse X in un punto, diciamo $X=25$, e si guarda lungo l'asse Y, si trovano valori di similarità che vanno da 0.80 a 0.95. Ciò significa che $\\mathrm{sim}(d_27, d_2)$ potrebbe essere 0.81 mentre $\\mathrm{sim}(d_42, d_17)$ potrebbe essere 0.91 nonostante il loro delta sia sempre 25.</p><p>La linea di tendenza ciano mostra la similarità media per ogni valore X con la deviazione standard. Inoltre, notare che la similarità dovrebbe diminuire linearmente perché il nostro set di documenti è distribuito uniformemente, garantendo intervalli uguali tra documenti contigui.</p><p>Notare che i grafici di embedding saranno <strong>sempre simmetrici, con il valore Y massimo di 1.0</strong> a $X=0$ Questo perché la similarità del coseno è simmetrica per $d_i$ e $d_j$, e $\\cos(0)=1$.</p><p>D'altra parte, i grafici del reranker sono <strong>sempre asimmetrici</strong> a causa dei diversi ruoli della query e dei documenti nel modello reranker. <strong>Il valore massimo probabilmente non è 1.0</strong> perché $X=0$ significa che usiamo il reranker per calcolare il punteggio di rilevanza di <code>\"what is the closest item to 4\"</code> vs <code>\"4\"</code>. Se ci pensi, non c'è garanzia che $X=0$ porti al valore Y massimo.</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">I Modelli Possono Confrontare Numeri Negativi tra [-100, -99, -98, ..., -1]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Scatter plot con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. Qui vogliamo testare se il modello può riconoscere la similarità semantica nello spazio negativo. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">I Modelli Possono Confrontare Numeri con Intervalli Più Grandi [1000, 2000, 3000, ..., 100000]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri con un intervallo di 1000. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">I Modelli Possono Confrontare Numeri da un Intervallo Arbitrario, es. [376, 377, 378, ..., 476]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri in un intervallo arbitrario, quindi spostiamo i numeri in un intervallo casuale </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> . Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">I Modelli Possono Confrontare Numeri Grandi tra [4294967296, 4294967297, 4294967298, ..., 4294967396]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri molto grandi. Seguendo l'idea dell'esperimento precedente, spostiamo l'intervallo ancora più in alto verso un numero grande. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">I Modelli Possono Confrontare Numeri Decimali tra [0.0001, 0.0002, 0.0003, ...,0.1]? (senza cifre fisse)</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri decimali. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">I Modelli Possono Confrontare Valute tra [$1, $2, $3, ..., $100]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri in valuta. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">I Modelli Possono Confrontare Date tra [2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Qui vogliamo verificare se il modello può rilevare la similarità semantica quando confrontiamo numeri in formato data, cioè AAAA-MM-GG. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. Sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">I Modelli Possono Confrontare Orari tra [19:00:07, 19:00:08, 19:00:09,..., 20:39:07]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Qui vogliamo testare se il modello può riconoscere la similarità semantica quando confrontiamo numeri in formato orario, ovvero </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Grafico a dispersione con media e varianza su ogni delta. A sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; A destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"observations\">Osservazioni</h2><p>Ecco alcune osservazioni dai grafici sopra riportati:</p><h3 id=\"reranker-models\"><strong>Modelli Reranker</strong></h3><ul><li>I modelli reranker hanno difficoltà nel confrontare i numeri. Anche nel caso più semplice di confronto tra numeri nell'intervallo [1, 100], le loro prestazioni sono mediocri.</li><li>È importante notare la particolare costruzione del prompt utilizzata per le query nel nostro utilizzo del reranker, ovvero <code>what is the closest item to x</code>, poiché questo potrebbe influenzare i risultati.</li></ul><h3 id=\"embedding-models\"><strong>Modelli di Embedding</strong></h3><ul><li>I modelli di embedding funzionano ragionevolmente bene quando confrontano piccoli numeri interi nell'intervallo [1, 100] o numeri negativi nell'intervallo [-100, 1]. Tuttavia, le loro prestazioni peggiorano significativamente quando si sposta questo intervallo ad altri valori, si aggiungono più intervalli o si trattano numeri decimali più grandi o più piccoli.</li><li>Si possono osservare picchi regolari a determinati intervalli, solitamente ogni 10 passi. Questo comportamento potrebbe essere legato al modo in cui il tokenizer elabora le stringhe, potenzialmente tokenizzando una stringa in \"10\" o \"1\" e \"0\".</li></ul><h3 id=\"date-and-time-understanding\"><strong>Comprensione di Date e Orari</strong></h3><ul><li>Curiosamente, i modelli di embedding sembrano avere una buona comprensione di date e orari, confrontandoli correttamente nella maggior parte dei casi. Per i grafici delle date, i picchi appaiono ogni 30/31 passi, corrispondenti al numero di giorni in un mese. Per i grafici degli orari, i picchi appaiono ogni 60 passi, corrispondenti ai minuti in un'ora.</li><li>Anche i modelli reranker sembrano catturare questa comprensione in una certa misura.</li></ul><h3 id=\"visualizing-similarity-to-zero\">Visualizzazione della Similarità con \"Zero\"</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">Aggiornato il 29 luglio 2024</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>Un altro esperimento interessante, probabilmente più intuitivo, è visualizzare direttamente il punteggio di similarità o rilevanza tra qualsiasi numero e lo zero (cioè l'origine). Fissando il punto di riferimento come l'embedding di zero, vogliamo vedere se la similarità semantica diminuisce linearmente man mano che i numeri diventano più grandi. Per il reranker, possiamo fissare la query a <code>\"0\"</code> o <code>\"What is the closest number to number zero?\"</code> e classificare tutti i numeri per vedere se i loro punteggi di rilevanza diminuiscono all'aumentare dei numeri. I risultati sono mostrati di seguito:</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">Qui, fissiamo l'\"embedding di origine\" all'embedding di \"zero\" e verifichiamo se la similarità semantica tra qualsiasi numero e zero è proporzionale al valore del numero. Specificamente, usiamo </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">. È mostrato il grafico a dispersione con media e varianza per ogni delta. A sinistra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; A destra: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"conclusion\">Conclusione</h2><p>Questo articolo illustra come i nostri attuali modelli di embedding e reranker gestiscono i confronti numerici. Nonostante la configurazione sperimentale relativamente semplice, espone alcuni difetti fondamentali nei modelli attuali e fornisce preziosi spunti per lo sviluppo del nostro prossimo embedding e reranker.</p><p>Due fattori chiave determinano se un modello può confrontare accuratamente i numeri: </p><p><strong>Primo, la tokenizzazione:</strong> Se il vocabolario include solo le cifre 0-9, allora 11 potrebbe essere tokenizzato in token separati 1 e 1, o come un singolo token 11. Questa scelta influenza la comprensione dei valori numerici da parte del modello.</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Tokenizer diversi portano a diverse interpretazioni di 9.11. Questo può influenzare l'apprendimento contestuale a valle. Fonte: </span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">The Tokenizer Playground su HuggingFace.</span></a></p></figcaption></figure><p><strong>Secondo, i dati di training:</strong> Il corpus di training influenza significativamente le capacità di ragionamento numerico del modello. Ad esempio, se i dati di training includono principalmente documentazione software o repository GitHub dove il versionamento semantico è comune, il modello potrebbe interpretare che 9.11 è maggiore di 9.9, poiché 9.11 è la versione minore che segue 9.9.</p><p>La capacità aritmetica dei modelli di recupero denso, come gli embedding e i reranker, è cruciale per le attività che coinvolgono RAG e il recupero e ragionamento avanzato. Forti capacità di ragionamento numerico possono migliorare significativamente la qualità della ricerca, in particolare quando si tratta di dati strutturati come JSON.</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "Molti LLM non riescono a capire che 9.11 è in realtà più piccolo di 9.9. I nostri modelli di embedding e reranking possono fare di meglio?",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
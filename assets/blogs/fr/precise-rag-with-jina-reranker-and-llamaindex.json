{
  "slug": "precise-rag-with-jina-reranker-and-llamaindex",
  "id": "65e97909b22368000152a4c7",
  "uuid": "3bcc0e9b-38b1-4df4-bcf7-dbe893156630",
  "title": "RAG précis avec Jina Reranker et LlamaIndex",
  "html": "<p>Alors que les <a href=\"https://www.sbert.net/examples/applications/cross-encoder/README.html?ref=jina-ai-gmbh.ghost.io\"><u>modèles bi-encodeurs</u></a> comme <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a> peuvent rapidement retrouver de nombreux documents correspondants dans une base de données d'embeddings pré-calculés, les modèles de reclassement peuvent affiner cet ensemble en utilisant une approche plus lente mais plus précise de cross-encoding des requêtes utilisateurs et des documents récupérés. Jina AI a <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>publié notre premier modèle de reclassement</u></a>, <code>jina-reranker-v1-base-en</code>, et dans cet article, nous présenterons en détail pourquoi un reclasseur est essentiel pour optimiser la précision du RAG et comment commencer à construire un système RAG à la pointe de la technologie en utilisant <a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>/<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Reranker</u></a>, <a href=\"https://www.llamaindex.ai/?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a>, et le modèle de langage <code>Mixtral-8x7B-Instruct-v0.1</code> (<a href=\"https://huggingface.co/mistralai/Mixtral-8x7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\"><u>hébergé sur HuggingFace</u></a>).</p><p>Vous aurez besoin de :</p><ul><li>Une <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>clé combinée pour l'API Jina Embeddings et Reranker</u></a>.</li><li>Un <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>compte HuggingFace et un token</u></a>.</li></ul><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">Maximize the search relevancy and RAG accuracy at ease</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><p>Comme les modèles Jina Embeddings et Reranker ainsi que Mixtral fonctionnent à distance et sont accessibles via une API RESTful, vous n'aurez besoin d'aucun matériel spécial.</p><h2 id=\"what-is-a-reranker\">Qu'est-ce qu'un reclasseur ?</h2><p>Avant de poursuivre le tutoriel, il est important de souligner ce que sont les reclasseurs. Pour une compréhension complète de ce qu'est un reclasseur et pourquoi Jina Reranker V1 est le meilleur choix pour vous, nous vous encourageons à lire notre article sur la sortie de Jina Reranker V1 avant de continuer.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Maximizing Search Relevance and RAG Accuracy with Jina Reranker</div><div class=\"kg-bookmark-description\">Boost your search and RAG accuracy with Jina Reranker. Our new model improves the accuracy and relevance by 20% over simple vector search. Try it now for free!</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>En résumé, les reclasseurs sont des modèles cross-encoder qui prennent en entrée une paire <em>document-requête</em> et émettent un score de pertinence combiné pour cette paire d'entrée. En utilisant les reclasseurs, les utilisateurs peuvent trier les documents du plus au moins pertinent pour une requête donnée.</p><h2 id=\"why-use-jina-reranker-v1-base-en\">Pourquoi utiliser <code>jina-reranker-v1-base-en</code> ?</h2><p>Le reclassement fournit des informations beaucoup plus pertinentes que l'utilisation d'un modèle d'embedding seul. Dans notre <a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><u>article de sortie du modèle</u></a>, nous avons démontré que Jina Reranker se démarque par rapport à ses concurrents open et closed-source et qu'il peut améliorer les systèmes de recherche de <strong>8 % en taux de réussite et de 33 % en </strong><a href=\"https://en.wikipedia.org/wiki/Mean_reciprocal_rank?ref=jina-ai-gmbh.ghost.io\"><strong><u>rang réciproque moyen</u></strong></a>.</p><p>Cela a un impact direct sur la qualité des réponses obtenues via la solution RAG appliquée. Avec la théorie qui soutient cette affirmation, nous vous montrerons un exemple pratique pour que vous puissiez voir par vous-même l'effet que Jina Reranker a sur un pipeline RAG construit avec LlamaIndex.</p><h2 id=\"before-we-start-a-note-on-llamaindex-node-postprocessors\">Avant de commencer : Une note sur les Node-Postprocessors de LlamaIndex</h2><p>Les node-postprocessors dans <a href=\"https://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/root.html?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> sont des modules qui transforment ou filtrent les nœuds après la récupération et avant la synthèse de la réponse dans un moteur de requête. Dans ce package, LlamaIndex propose à la fois des options intégrées et une API pour des ajouts personnalisés.</p><p><strong>Jina Reranker a maintenant été </strong><a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><strong><u>intégré</u></strong></a><strong> à LlamaIndex comme node postprocessor</strong>. Pour augmenter la précision des réponses, les nœuds récupérés sont réordonnés en fonction de leur pertinence par rapport à la requête, et les <strong><em>N</em></strong> meilleurs nœuds sont renvoyés.</p><h2 id=\"follow-along-on-google-colab\">Suivez sur Google Colab</h2><p>Ce tutoriel est accompagné d'un notebook que vous pouvez exécuter sur <a href=\"https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>Google Colab</u></a> ou localement.</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">llama_index/docs/docs/examples/node_postprocessor/JinaRerank.ipynb at main · run-llama/llama_index</div><div class=\"kg-bookmark-description\">LlamaIndex is a data framework for your LLM applications - run-llama/llama_index</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/assets/pinned-octocat-093da3e6fa40.svg\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">run-llama</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2000e9ce9c43753a6316de82e8309737edaa6377de7b47d2d8b08a4a3caa8a71/run-llama/llama_index\" alt=\"\"></div></a></figure><h3 id=\"the-dataset-2024-nike-kids-product-catalog\">Le jeu de données : Catalogue de produits Nike Kids 2024</h3><p>Pour démontrer l'amélioration des performances de Jina Reranker pour les applications RAG, nous avons choisi le <a href=\"https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&ref=jina-ai-gmbh.ghost.io\"><u>Catalogue de produits Nike Kids 2024</u></a> comme jeu de données. Le document contient un ensemble structuré de produits pour enfants proposés par Nike en 2024. Nous avons sélectionné ce jeu de données car il montre clairement l'effet de l'utilisation d'un reclasseur et est facilement compréhensible pour la plupart des utilisateurs.</p><h3 id=\"install-the-prerequisites\">Installez les prérequis</h3><p>Pour installer les prérequis, exécutez :</p><pre><code class=\"language-bash\">pip install llama-index-postprocessor-jinaai-rerank\npip install llama-index-embeddings-jinaai\npip install llama-index\npip install llama-index-llms-huggingface\npip install \"huggingface_hub[inference]\"</code></pre><h3 id=\"access-mixtral-llm\">Accès au LLM Mixtral</h3><p>Pour utiliser le LLM <code>Mixtral-8x7B-Instruct-v0.1</code>, vous avez besoin d'un token <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace</u></a>.</p><pre><code class=\"language-Python\">from llama_index.llms.huggingface import HuggingFaceInferenceAPI\n\nhf_inference_api_key = \"&lt;votre token d'accès HuggingFace ici&gt;\"\n\nmixtral_llm = HuggingFaceInferenceAPI(\n    model_name=\"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n    token=hf_inference_api_key,\n)\n</code></pre><h3 id=\"access-jina-embeddings-and-jina-reranker\">Accès à Jina Embeddings et Jina Reranker</h3><p>Pour utiliser nos modèles Jina Embeddings et Jina Reranker, vous avez besoin d'une <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>clé API</u></a> dédiée. Stockez-la dans une variable appelée <code>api_key</code> et appelez le modèle Jina Embeddings depuis LlamaIndex :</p><pre><code class=\"language-Python\">from llama_index.embeddings.jinaai import JinaEmbedding\n\napi_key = \"&lt;votre clé Jina ici&gt;\"\njina_embeddings = JinaEmbedding(api_key=api_key)</code></pre><p>De même, vous pouvez appeler le modèle Jina Reranker. En définissant le paramètre <code>top_n</code>, vous pouvez décider combien de documents les plus pertinents retourner dans la sortie finale. Dans ce cas, nous définissons<code>top_n=2</code>:</p><pre><code class=\"language-Python\">from llama_index.postprocessor.jinaai_rerank import JinaRerank\n\njina_rerank = JinaRerank(api_key=api_key, top_n=2)</code></pre><h3 id=\"download-the-2024-nike-kids-product-catalog\">Télécharger le catalogue des produits Nike Kids 2024</h3><p>Pour télécharger les données, exécutez le code suivant :</p><pre><code class=\"language-Python\">from llama_index.core import SimpleDirectoryReader\nimport requests\n\nurl = '&lt;https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&gt;'\nresponse = requests.get(url)\n\nwith open('Nike_Catalog.pdf', 'wb') as f:\n&nbsp;&nbsp;&nbsp;&nbsp;f.write(response.content)\n\nreader = SimpleDirectoryReader(\n&nbsp;&nbsp;&nbsp;&nbsp;input_files=[\"Nike_Catalog.pdf\"]\n)\n\ndocuments = reader.load_data()</code></pre><h3 id=\"generate-and-index-embeddings-with-jina-embeddings\">Générer et indexer les embeddings avec Jina Embeddings</h3><p>Maintenant que la configuration est terminée, nous allons générer les vecteurs d'embedding (nœuds) et les indexer. Les modèles Jina Embeddings v2 acceptent des entrées jusqu'à 8192 tokens, ce qui est suffisamment grand pour que, pour un document comme celui-ci, nous n'ayons pas besoin de faire de segmentation de texte supplémentaire ni de vérifier si une section contient trop de tokens. Pour intégrer et indexer le document, exécutez le code suivant :</p><pre><code class=\"language-Python\">from llama_index.core import VectorStoreIndex\n\nindex = VectorStoreIndex.from_documents(\n&nbsp;&nbsp;&nbsp;&nbsp;documents=documents, embed_model=jina_embeddings\n)</code></pre><h3 id=\"query-for-results-without-jina-reranker\">Requêter les résultats sans Jina Reranker</h3><p>Lorsque nous recherchons des informations spécifiques dans cet ensemble de textes, le <code>query_engine</code> de LlamaIndex effectue les opérations suivantes :</p><ol><li>Avec Jina Embeddings V2, il crée un embedding pour la requête.</li><li>Il utilise l'index pour obtenir les <code>top_k = 10</code> embeddings stockés ayant le plus haut cosinus avec l'embedding de la requête et renvoie sa position dans l'index.</li><li>Il recherche le texte correspondant dans le tableau de données vectorielles.</li></ol><p>Demandons quel est le meilleur maillot Nike en termes de tissu :</p><pre><code>query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p><strong>Résultat</strong>:</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; EQUIPMENT87NIKE BRASILIA SMALL DUFFEL 9.5&nbsp;\nDM3976 $37.00\nSIZES: Misc&nbsp; OFFER DATE: 07/01/22&nbsp; END DATE: 07/01/25\nTough 600D polyester • Durable 300D polyester • Detachable shoulder\nstrap&nbsp;• Ventilated shoe or wet/dry storage • Secure zip pocket • \nLimited lifetime guarantee&nbsp;• Screened Swoosh design trademark\nDIMENSIONS:&nbsp; 20\" L x 10\" W x 11\" H&nbsp;\n010 Black/Black/(White) 068 Iron Grey/Black/(White)\n...</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/z2OKhAFnHCXw3aI4W1KUZNxzt8WOEERSG-prrBcmGwBEDTAFGavSN8eiHnvFF6R0L-dlwRUY3U8R7ysinoGTSSL-9_vr0RdCmrIRSy_xffvKz-Trqa1Yr49YGNb7R-GsDpCqilIW3cluVER4St5rUts\" class=\"kg-image\" alt=\"Three Nike Brasilia Small Duffel Bags, $37 each, in black, grey, navy with features listed and offer dates from 07/01/22 to 0\" loading=\"lazy\" width=\"594\" height=\"592\"></figure><h3 id=\"query-for-results-with-reranker\">Requêter les résultats avec Reranker</h3><p>Nous voulons maintenant appliquer le reranker pour voir si l'application RAG produit un résultat différent et plus <em>pertinent</em>. Pour ce faire, nous devons ajouter le <code>node_postprocessors</code> au <code>query_engine</code> :</p><pre><code class=\"language-Python\">query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm, node_postprocessors=[jina_rerank]\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p>Notez que par rapport au cas précédent sans le reranker, le <code>query_engine</code> contient maintenant aussi le paramètre <a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><u>node_postprocessors</u></a> défini sur <code>[jina_rerank]</code>.</p><p><strong>Résultat</strong>:</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; FOOTBALL – STOCK10\nDJ5731 $47.00\nSIZES:&nbsp; XS, S, M, L, XL, 2XL, 3XL\nFABRIC:&nbsp; Body/panels lining: 100% polyester. Pad: 100%\nethylene vinyl acetate.\nOFFER DATE:&nbsp; 04/01/23\nEND DATE:&nbsp; 04/01/27\nTake the field ready to give it your all in the Nike Recruit\nPants. They're made from lightweight, stretchy&nbsp;fabric with\nsweat-wicking power to help keep you dry and moving freely\nwhen the game heats up. With&nbsp;integrated pads shaped for a\ncomfortable fit, you'll be prepared for a performance you can\nbe proud of.&nbsp;Choose from 6 different colors to outfit your\nteam. Nike Dri-FIT technology moves sweat away from your&nbsp;skin\nfor quicker evaporation, helping you stay dry and comfortable.\nLightweight knit fabric stretches with&nbsp;you to let you move\nnaturally. Thigh, knee, hip and tailbone pads are shaped for\nan optimal fit, without&nbsp;compromising on coverage. A\nbody-hugging fit is designed to help keep the padding in place\nand close to&nbsp;the body. Belt at the waist lets you dial in your\nperfect fit to maximize comfort. Elastic at hems.\nHip width: 15\", Inseam length: 11.75\" (size medium).\n010 Black/(White) 060 Team Anthracite/(White) 100 White/(Black)\n419 Team Navy/(White) 493 Team Royal/(White) 657 Team Scarlet/(White)</code></pre><p></p><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/X0ngGFoOz8S_KlRhAlQs4rOooKsV92d06-UBa7BsFPiTilgTD9xuQfgIblG7dTq0BQp4ZA9DlBCjFvA6D62eUVDmxxOO38va5mlnutPr4Zlu6l70tvbGtmrS2V0rpn-OE__tarMtR1MxAmD2oQ3m2qg\" class=\"kg-image\" alt=\"Product display of boys' Nike DF Stock Recruit Pants with sizes, pricing, and various color options highlighted.\" loading=\"lazy\" width=\"1600\" height=\"982\"></figure><h2 id=\"conclusion\"><strong>Conclusion</strong></h2><p>Comme nous pouvons le constater, la requête sans le reranker conduit à un premier résultat qui mentionne \"mesh back for breathability\" et \"slim fit with soft hand feel\". En comparaison, en utilisant un reranker, nous obtenons un premier résultat qui est \"engineered for optimal breathability\", possède un \"moisture-wicking design\" qui \"helps keep you dry and cool under match-day pressure\", et présente \"lightweight fabric in a relaxed, easy fit\".</p><p>Le second résultat est beaucoup plus précis et approprié pour la requête que nous avons posée. Avec nos deux derniers articles, nous avons montré tant d'un point de vue théorique que pratique que l'ajout de Jina Reranker à votre pipeline RAG augmente la précision de la récupération et améliore la qualité des réponses que vous en obtenez.</p>",
  "comment_id": "65e97909b22368000152a4c7",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/banner_Reranker_-LlamaIndex.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-07T09:21:29.000+01:00",
  "updated_at": "2024-04-02T11:12:49.000+02:00",
  "published_at": "2024-03-07T15:00:01.000+01:00",
  "custom_excerpt": "Just Rerank It! Jina Reranker and LlamaIndex take your RAG up to the next level.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "65e85e35b22368000152a4bf",
    "name": "Francesco Kruk",
    "slug": "francesco",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/precise-rag-with-jina-reranker-and-llamaindex/",
  "excerpt": "Réordonnez simplement ! Jina Reranker et LlamaIndex portent votre RAG au niveau supérieur.",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Collaborative graphic with \"RERANKER\" and \"Llamalindex\" logos over a purple background with crossed white abstract lines.",
  "feature_image_caption": null
}
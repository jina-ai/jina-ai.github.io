{
  "slug": "using-deepseek-r1-reasoning-model-in-deepsearch",
  "id": "67dd5037143bda0001036423",
  "uuid": "3ebc2ba7-b65b-408b-9466-ca902b28756a",
  "title": "Usando el modelo de razonamiento DeepSeek R1 en DeepSearch",
  "html": "<p><a href=\"https://jina.ai/news/a-practical-guide-to-implementing-deepsearch-deepresearch\">En nuestra opini√≥n, DeepSearch es esencialmente un gran bucle while.</a> Dado un presupuesto m√°ximo de tokens, alterna entre buscar, leer y pensar hasta encontrar la mejor respuesta. Una de las tareas clave del LLM es determinar qu√© acci√≥n tomar a continuaci√≥n bas√°ndose en el estado actual de la memoria. ¬øDeber√≠a continuar buscando? ¬øLeer la p√°gina web? ¬øO responder la pregunta directamente?</p><p>En nuestra implementaci√≥n de <a href=\"https://github.com/jina-ai/node-DeepResearch\">node-deepresearch</a>, usamos un LLM <em>est√°ndar</em> (<code>gemini-2.0-flash</code>) para elegir la acci√≥n. Lo llamamos \"est√°ndar\" ya que el proceso de razonamiento est√° expl√≠citamente delineado mediante ingenier√≠a de prompts, y luego opera como secuencia-entrada, secuencia-salida con la acci√≥n elegida devuelta en un objeto JSON. Entonces surge una pregunta natural: ¬øreemplazar este paso de decisi√≥n con un modelo dedicado de razonamiento mejorar√≠a el rendimiento de DeepSearch?</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2025/04/Heading--91-.png\" class=\"kg-image\" alt=\"\" loading=\"lazy\" width=\"1200\" height=\"630\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2025/04/Heading--91-.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2025/04/Heading--91-.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/2025/04/Heading--91-.png 1200w\" sizes=\"(min-width: 720px) 720px\"><figcaption><span style=\"white-space: pre-wrap;\">El paso de decisi√≥n de acci√≥n del gran bucle while en nuestra implementaci√≥n de DeepSearch determina, bas√°ndose en el contexto y memoria actuales, cu√°l debe ser la siguiente acci√≥n.</span></figcaption></figure><p>En esta publicaci√≥n, exploramos el uso de <a href=\"https://github.com/deepseek-ai/DeepSeek-R1\">DeepSeek R1</a> 671b, un LLM de razonamiento para reemplazar a <code>gemini-2.0-flash</code> en este paso de decisi√≥n. Creemos que las habilidades de razonamiento de R1 ayudar√°n a resolver los problemas complejos en la b√∫squeda web y el an√°lisis de resultados.</p><p>Para probar este concepto, lo pusimos a prueba en un ejemplo pr√°ctico: planificar un itinerario completo de vacaciones de tres d√≠as, y luego evaluar su desempe√±o. Los agentes que realizan tareas de b√∫squeda profunda probablemente encuentren los mismos tipos de problemas que los humanos, as√≠ que en nuestra tarea de vacaciones el modelo puede encontrar algunos de los siguientes problemas:</p><ul><li><strong>Vac√≠os de conocimiento (informaci√≥n dependiente de otra informaci√≥n)</strong>: Por ejemplo, quieres visitar la Torre Eiffel, pero no sabes si est√° abierta en d√≠as festivos. Necesitas averiguar tanto el horario de la torre en d√≠as festivos como las fechas de los d√≠as festivos franceses.</li><li><strong>Informaci√≥n incorrecta o desactualizada</strong>: Un blog de viajes de 2020 sugiere que un restaurante espec√≠fico en Roma est√° abierto los domingos, pero al llegar, descubres que ha cambiado sus horarios y ahora est√° cerrado los domingos.</li><li><strong>Informaci√≥n contradictoria</strong>: Un sitio web de viajes afirma que un hotel particular en Nueva York ofrece desayuno gratuito, mientras que otro sitio indica que el desayuno no est√° incluido en la tarifa de la habitaci√≥n.</li><li><strong>Informaci√≥n ambigua</strong>: Una publicaci√≥n en un foro de viajes menciona \"una gran playa cerca de Barcelona\" sin especificar qu√© playa o dar direcciones claras, lo que dificulta localizar la ubicaci√≥n exacta.</li></ul><p>R1 puede desglosar tareas complejas en pasos accionables, identificar vac√≠os e inconsistencias, y navegar obst√°culos como sitios web bloqueados y muros de suscripci√≥n. Tiene las capacidades de razonamiento para recopilar el conocimiento necesario y sintetizar una respuesta. Sin embargo, no puede planear unas vacaciones por s√≠ solo ‚Äî eso requiere buscar en la web y entender los resultados que obtiene. Tenemos que potenciarlo, coloc√°ndolo en un marco y mejorando sus capacidades, antes de que est√© listo para el trabajo.</p><h2 id=\"implementation\">Implementaci√≥n</h2><figure class=\"kg-card kg-bookmark-card kg-card-hascaption\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/18sqU8_eWqFleKqpd-SnGDNmZ_P1KLfXw?usp=sharing#scrollTo=2jFWdbnp_6ws\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina-ai-gmbh.ghost.io/content/images/icon/favicon-32.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/thumbnail/colab_favicon_256px-7.png\" alt=\"\" onerror=\"this.style.display = 'none'\"></div></a><figcaption><p><span style=\"white-space: pre-wrap;\">Para ejecutar el notebook, necesitar√°s claves API gratuitas de </span><a href=\"https://jina.ai\"><span style=\"white-space: pre-wrap;\">Jina AI</span></a><span style=\"white-space: pre-wrap;\"> y </span><a href=\"https://openrouter.ai\"><span style=\"white-space: pre-wrap;\">OpenRouter</span></a><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><p>Si bien R1 es el motor de nuestro agente, tambi√©n agregamos algunas herramientas, un objeto de estado y, por supuesto, un prompt (bastante grande). Aqu√≠ hay una representaci√≥n simplificada:</p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2025/03/image-29.png\" class=\"kg-image\" alt=\"\" loading=\"lazy\" width=\"1639\" height=\"2256\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2025/03/image-29.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2025/03/image-29.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/size/w1600/2025/03/image-29.png 1600w, https://jina-ai-gmbh.ghost.io/content/images/2025/03/image-29.png 1639w\" sizes=\"(min-width: 720px) 720px\"></figure><ul><li><strong>Las herramientas</strong> pueden ser llamadas por el modelo para buscar y extraer informaci√≥n de la web, y los resultados se almacenan en el estado.</li><li><strong>El estado</strong> mantiene un registro de los resultados de las herramientas, el estado de la tarea y el conocimiento. Se almacena en el propio prompt.</li><li><strong>Un √∫nico prompt</strong> proporciona instrucciones, especificando la tarea y c√≥mo abordarla, adem√°s de almacenar el estado.</li></ul><p>Veremos cada uno de estos en m√°s detalle m√°s adelante en la publicaci√≥n, especialmente el prompt. Pero, en resumen, el sistema funciona as√≠:</p><p>Comenzamos con el prompt con un objeto de estado sin poblar. Mientras la tarea est√° en progreso (es decir, intentando producir una respuesta) el agente ejecuta el siguiente bucle hasta que produce una respuesta:</p><ol><li>El modelo examina la tarea y su estado desde el prompt, y razona c√≥mo usar mejor sus herramientas para obtener una respuesta.</li><li>El modelo produce un objeto JSON especificando su estado (<code>IN PROGRESS</code> o <code>DONE</code>), actualizaciones de memoria, llamadas a herramientas y la respuesta (inicialmente <code>null</code>).</li><li>El agente llama a las herramientas de forma as√≠ncrona y los resultados se incorporan de nuevo al prompt, as√≠ como el objeto JSON del paso 3.</li><li>El prompt (que contiene esta nueva informaci√≥n) se alimenta de nuevo al modelo para ejecutar otro bucle.</li></ol><p>Tan pronto como el modelo proporciona una respuesta en su salida, la tarea termina y se entrega la respuesta.</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">üí°</div><div class=\"kg-callout-text\">Para tener una mejor idea de c√≥mo funciona el agente en acci√≥n, sugerimos que pruebes <a href=\"https://colab.research.google.com/drive/18sqU8_eWqFleKqpd-SnGDNmZ_P1KLfXw?usp=sharing#scrollTo=2jFWdbnp_6ws\">el notebook</a> por ti mismo y examines la salida en cada iteraci√≥n.</div></div><p>Ahora que tenemos una visi√≥n general de alto nivel, veamos las herramientas, el estado y el prompt en orden:</p><h2 id=\"tools\">Herramientas</h2><p>Dado que R1 no puede buscar ni extraer informaci√≥n de la web por s√≠ mismo, accedemos a la API Reader de Jina para expandir sus capacidades. Esto incluye dos modos:</p><ul><li><strong>Modo b√∫squeda</strong>: busca en la web t√©rminos relevantes y devuelve resultados del motor de b√∫squeda (incluyendo URLs, t√≠tulos y descripciones de cada resultado).</li><li><strong>Modo lectura</strong>: extrae p√°ginas de los resultados de b√∫squeda y las devuelve en formato Markdown.</li></ul><p>Debido a la ventana de contexto limitada de R1, no podemos simplemente volcar una p√°gina completa en la secci√≥n <code>Tool Results</code> del prompt. Necesitamos herramientas adicionales para seleccionar solo la informaci√≥n m√°s relevante antes de pasarla al modelo:</p><ul><li><a href=\"https://python.langchain.com/docs/concepts/text_splitters/\"><strong>Divisor de texto recursivo por caracteres de LangChain</strong></a>: Dividimos las salidas largas en segmentos con <code>RecursiveCharacterTextSplitter</code>, dividiendo recursivamente en p√°rrafos y oraciones hasta obtener el tama√±o de segmento deseado. Esto asegura que la salida sea f√°cilmente digerible por la limitada ventana de contexto de R1.</li><li><a href=\"https://jina.ai/reranker\"><strong>Jina Reranker</strong></a>: Reordenamos los segmentos con <code>jina-reranker-v2-base-multilingual</code> y combinamos los segmentos mejor clasificados en un √∫nico resultado.</li></ul><p>Desafortunadamente, DeepSeek R1 no admite el uso de herramientas de la misma manera que <code>o3-mini</code>. Por ejemplo, con <code>o3-mini</code>, podr√≠amos usar algo como lo siguiente:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-python\">def scrape_page(url: str):\n    \"\"\"Scrape a web page with Jina Reader\"\"\"\n\ntools = [\n    {\n        \"type\": \"function\",\n        \"function\": {\n            \"name\": \"scrape_page\",\n            \"description\": \"Scrape the content of a webpage\",\n            \"parameters\": {\n                \"url\": {\"type\": \"string\", \"description\": \"The URL to scrape\"}\n            }\n        }\n    }\n]\n\nclient = OpenAI()\nresponse = client.completions.create(\n    model=\"o3-mini\",\n    prompt=f\"Scrape www.skyscanner.net/routes/gr/de/germany-to-crete.html\",\n    tools=tools\n)\n</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Ejemplo de c√≥digo o3-mini para soportar el uso de herramientas</span></p></figcaption></figure><p>Pero esto no es tan f√°cil con R1: No tiene un par√°metro <code>tools</code> que podamos pasar a la API, y no devolver√° <code>tool_calls</code> estructurados como parte de su respuesta. En pocas palabras, no fue entrenado para usar herramientas (<a href=\"https://github.com/deepseek-ai/DeepSeek-R1/issues/9\">y no las soportar√° pronto</a>). Al menos, no las soporta en el sentido tradicional. Sin embargo, <em>podemos</em> pedirle a R1 que produzca llamadas a herramientas en formato JSON, y alimentar los resultados de las llamadas a herramientas de vuelta al modelo para analizarlos:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Debes responder con un objeto JSON v√°lido que contenga:\n```json\n{\n  \"tool_calls\": [\n    {\"tool\": \"search\", \"input\": \"Vuelos m√°s baratos de Alemania a Creta mayo 2025\"},\n    {\"tool\": \"scrape\", \"input\": \"&lt;https://www.skyscanner.net/routes/gr/de/germany-to-crete.html&gt;\"}\n  ]\n}\n```</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Llamadas a herramientas como parte del prompt de R1</span></p></figcaption></figure><p>Despu√©s de que el modelo genera llamadas a herramientas en la iteraci√≥n <em>n</em>, se ejecutan las herramientas y los resultados se incrustan en la secci√≥n <code>Tool Results</code> del prompt para que el modelo razone con ellos en la iteraci√≥n <em>n+1</em>:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Tool Results:\n\nSource 1Ô∏è: search: Cheapest flights from Germany to Crete May 2025\nResult:\n\n```\nTitle: Affordable flights: Germany - Heraklion (Crete) (HER) | Eurowings URL Source: https://www.eurowings.com/en/booking/offers/flights-from/DE/to/GR/HER.html Description: Affordable flights from Germany to Heraklion (Crete) ‚úà Eurowings brings you closer to your dream destination from as little as ‚Ç¨89.99*. Book now and enjoy.\nTitle: Are you a person or a robot? URL Source: https://www.skyscanner.com/routes/fran/her/frankfurt-to-crete-heraklion.html Description: Book a one-way ticket from Frankfurt to Heraklion Airport from $78 or travel return from just $154. The prices shown are based on availability and could change ...\n```\n</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Resultados de las herramientas, mostrando resultados de b√∫squeda para vuelos Alemania-Creta</span></p></figcaption></figure><h2 id=\"state\">Estado</h2><p>El estado mantiene un registro del estado de la tarea (<code>Status</code>) y el conocimiento (<code>Memory</code>) que el modelo necesita analizar y actualizar. En resumen, es la memoria de trabajo y los bancos de memoria del sistema. Esto se almacena en una secci√≥n del prompt llamada <code>{{ workspace }}</code> y comienza como una pizarra en blanco:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Status: IN_PROGRESS\nMemory: \n... no memory blocks ..\n</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Objeto de estado vac√≠o</span></p></figcaption></figure><p>A medida que el modelo razona sobre la tarea, ejecuta herramientas y recopila resultados, el estado se puebla con bloques de memoria (derivados de la salida de las herramientas), cada uno con su propio ID asignado aleatoriamente. Para nuestro ejemplo de planificaci√≥n de vacaciones, el estado podr√≠a verse as√≠ despu√©s de ejecutar una iteraci√≥n del agente:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Status: IN_PROGRESS\nMemory: \n&lt;nuz-032&gt;Potential warm May destinations: Malaga (Spain), Crete (Greece), Algarve (Portugal)&lt;/nuz-032&gt;\n&lt;xwj-969&gt;URL to scrape for Crete hotel details: &lt;https://www.tripadvisor.com/HotelsList-Crete-Beachfront-Cheap-Hotels-zfp13280541.html&gt;&lt;/xwj-969&gt;\n&lt;vsc-583&gt;URL to scrape for flight details: &lt;https://www.expedia.com/lp/flights/fra/her/frankfurt-to-heraklion&gt;&lt;/vsc-583&gt;\n</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Estado poblado por DeepSeek R1</span></p></figcaption></figure><p>Los bloques de memoria se actualizan incluyendo una lista de <code>memory_updates</code> en la respuesta JSON del modelo:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-json\">{\n\t\"memory_updates\": [\n\t  {\"operation\": \"add\", \"content\": \"Round-trip flight from Berlin to Tenerife in May 2025 ranges from ‚Ç¨59.99 to ‚Ç¨200 round-trip as per the Skyscanner and Iberia sources.\"},\n\t  {\"operation\": \"delete\", \"id\": \"nuz-032\"},\n\t  ...\n\t]\n}</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Actualizaciones de memoria como parte de la salida JSON de R1</span></p></figcaption></figure><ul><li>La <strong>operaci√≥n <code>add</code></strong> agrega un bloque de memoria y puede usarse para almacenar informaci√≥n importante como pistas, hallazgos, vac√≠os de informaci√≥n y acciones ya realizadas.</li><li>La <strong>operaci√≥n <code>delete</code></strong> elimina un bloque de memoria, permitiendo que el modelo elimine informaci√≥n antigua, innecesaria o falsa y mantenga un espacio de trabajo limpio.</li></ul><div class=\"kg-card kg-callout-card kg-callout-card-yellow\"><div class=\"kg-callout-emoji\">üí°</div><div class=\"kg-callout-text\">Tambi√©n probamos una operaci√≥n <code>replace</code>, pero encontramos que el modelo generaba grandes bloques de informaci√≥n (dependiendo excesivamente de <code>replace</code>), y decidimos eliminar esta opci√≥n.</div></div><p>En comparaci√≥n con la emisi√≥n de llamadas a herramientas, R1 est√° menos familiarizado con la gesti√≥n de su propia memoria. Si bien el modelo fue espec√≠ficamente entrenado para razonar problemas matem√°ticos complejos y tareas de programaci√≥n‚Äîentrenamiento que le permite producir objetos JSON precisos y ejecutar llamadas a herramientas‚Äîno fue entrenado para gestionar estados tipo memoria (ni ning√∫n otro modelo que conozcamos).</p><p>Almacenar informaci√≥n usando un estado compacto tipo memoria proporciona varias ventajas sobre almacenar toda la salida del modelo en cada ronda. Este enfoque condensa la informaci√≥n dentro del prompt, evitando el desbordamiento del contexto mientras mejora el enfoque del modelo en el conocimiento relevante. Lo mantenemos como JSON porque es f√°cil de actualizar pero el JSON se renderiza en un formato legible por humanos en el prompt mismo.</p><p>Aun as√≠, la gesti√≥n de memoria sigue estando fuera del dominio principal de R1; necesitamos implementar m√∫ltiples instrucciones para guiar al modelo en el manejo adecuado de las operaciones de memoria. Aqu√≠ est√° la parte de nuestro prompt que trata con eso:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">... otros contenidos del prompt ...\n\n## Memory Block Usage\n- Each memory block has a unique ID in format &lt;abc-123&gt;content&lt;/abc-123&gt;\n- Create separate blocks for distinct pieces of information:\n  * Discovered URLs (both explored and pending)\n  * Information gaps that need investigation\n  * Actions already taken (to avoid repetition)\n  * Promising leads for future exploration\n  * Key facts and findings\n  * Contradictions or inconsistencies found\n- Keep each block focused on a single idea or piece of information\n- Always cite sources when recording information from tool results\n- Use IDs to track and manage your knowledge (e.g., deleting outdated information)\n- Make sure to store sources (URLs) for the facts and findings you store\n\n## Lead Management\n- Since you can only make 3 tool calls per round, store promising leads for later\n- Create dedicated memory blocks for URLs to scrape later\n- Maintain blocks for potential search queries to explore in future rounds\n- Prioritize leads based on relevance to the task\n\n... otros contenidos del prompt ...</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Instrucciones de manejo de memoria en el prompt</span></p></figcaption></figure><h2 id=\"prompt\">Prompt</h2><p>Creamos el prompt usando el <a href=\"https://jinja.palletsprojects.com/en/stable/templates/\">formato de plantilla Jinja</a>. Consiste en varias secciones:</p><ul><li><strong>Contexto</strong> (en este caso, la fecha actual).</li><li><strong>Instrucciones</strong>, que cubren c√≥mo funciona todo y le dicen al modelo qu√© herramientas est√°n disponibles.</li><li><strong>Estado</strong>, discutido anteriormente.</li><li><strong>Salidas de herramientas</strong>, de las herramientas <code>search</code> y <code>scrape</code>.</li></ul><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">{% macro format_tool_results(tool_records) %}\n{% for to in tool_records %}\nSource {{ loop.index }}Ô∏è: {{ to.tool }}: {{ to.input }}\nResult:\n```\n{{ to.output }}\n```\n{% endfor %}\n{% endmacro %}\n\nThe date: `{{ current_date }}`.\nYou are an information analysis and exploration agent that builds solutions through systematic investigation.\n\n## Investigation Cycle\nYou operate in a continuous investigation cycle:\n\n1. Review current workspace (your memory blocks)\n2. Analyze new tool results (or initial task if first round)\n3. Update memory with new insights and track investigation progress\n4. Decide on next tools to call based on identified leads and information gaps\n5. Repeat until task completion\n\n## Memory Structure\nYour memory persists between investigation cycles and consists of:\n- **Status**: Always the first line, indicates if the task is IN_PROGRESS or DONE\n- **Memory**: A collection of discrete information blocks, each with a unique ID\n\n## Memory Block Usage\n- Each memory block has a unique ID in format &lt;abc-123&gt;content&lt;/abc-123&gt;\n- Create separate blocks for distinct pieces of information:\n  * Discovered URLs (both explored and pending)\n  * Information gaps that need investigation\n  * Actions already taken (to avoid repetition)\n  * Promising leads for future exploration\n  * Key facts and findings\n  * Contradictions or inconsistencies found\n- Keep each block focused on a single idea or piece of information\n- Always cite sources when recording information from tool results\n- Use IDs to track and manage your knowledge (e.g., deleting outdated information)\n- Make sure to store sources (URLs) for the facts and findings you store\n\n## Lead Management\n- Since you can only make 3 tool calls per round, store promising leads for later\n- Create dedicated memory blocks for URLs to scrape later\n- Maintain blocks for potential search queries to explore in future rounds\n- Prioritize leads based on relevance to the task\n\n## Available Tools\n- **search**: Use for broad information gathering on new topics or concepts\n  * Example: {\"tool\": \"search\", \"input\": \"renewable energy statistics 2023\"}\n- **scrape**: Use for extracting specific details from discovered URLs\n  * Example: {\"tool\": \"scrape\", \"input\": \"https://example.com/energy-report\"}\n\n## Tool Usage Guidelines\n- **When to use search**: For new concepts, filling knowledge gaps, or exploring new directions\n- **When to use scrape**: For URLs discovered that likely contain detailed information\n- **Maximum 3 tool calls per round**\n- **Never repeat the exact same tool call**\n- **Always record valuable information from tool results in memory blocks**\n\n## Response Format\nYou must respond with a valid JSON object containing:\n\n```json\n{\n  \"status_update\": \"IN_PROGRESS or DONE\",\n  \"memory_updates\": [\n    {\"operation\": \"add\", \"content\": \"New insight or lead to investigate\"},\n    {\"operation\": \"delete\", \"id\": \"abc-123\"}\n  ],\n  \"tool_calls\": [\n    {\"tool\": \"search\", \"input\": \"specific search query\"},\n    {\"tool\": \"scrape\", \"input\": \"https://discovered-url.com\"}\n  ],\n  \"answer\": \"Your final, comprehensive answer when status is DONE\"\n}\n```\n\n## Important Rules\n- The \"add\" operation creates a new memory block\n\tYou do not need to specify an ID, it will be added automatically by the system.\n- The \"delete\" operation requires the specific ID of the block to remove\n- Never invent or fabricate information - only use facts from your memory or tool results\n- Never make up URLs - only use URLs discovered through tool results\n- CRITICAL: Any information not recorded in your memory blocks will be lost in the next round\n  For example, if you find a potential webpage to scrap, you must store the URL and your intention\n  Example: `{\"operation\": \"add\", \"content\": \"Found relevant URL: https://... to scrape ...\"}`\n- Set status to \"DONE\" only when you have fully addressed the task\n- Only include the \"answer\" field when status is \"DONE\"\n\nTask:\n```\n{{ task }}\n```\n\nCurrent workspace:\n```\n{{ workspace }}\n```\n\nTool Results:\n{{ format_tool_results(tool_records) if tool_records else '... no previous tool results ...'}}\n\nIMPORTANT: Generate a valid JSON response following the format above.\n\nThink carefully about:\n- what information do you need to preserve\n- which tools to call next\n- how to build your answer systematically with focused memory blocks</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Prompt completo usado en nuestro sistema de b√∫squeda profunda</span></p></figcaption></figure><div class=\"kg-card kg-callout-card kg-callout-card-yellow\"><div class=\"kg-callout-emoji\">üí°</div><div class=\"kg-callout-text\">La funci√≥n macro de Jinja en la parte superior del prompt simplemente renderiza los resultados de las herramientas en un formato m√°s limpio.</div></div><h2 id=\"evaluation\">Evaluaci√≥n</h2><p>Pusimos nuestro sistema a prueba con nuestro ejemplo de planificaci√≥n de vacaciones. Aqu√≠ est√° la tarea incorporada en el prompt:</p><pre><code class=\"language-text\">Help me plan a 3 day holiday in Europe in May for under 2000 EUR\n1. I need specific flight and hotel recommendations.\n2. I want the destination to be warm.\n3. I want to have a beach nearby the hotel.\nI live in Germany.</code></pre><p>Aqu√≠ est√° el resultado final (despu√©s de cinco iteraciones del ciclo):</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">**3-Day Crete Holiday Plan (Total ‚âà ‚Ç¨600-800)**\n\n‚úàÔ∏è *Flights (From Frankfurt):*  \n- Skyscanner: ‚Ç¨154 round trip (May 2025 dates)  \n  Source: &lt;https://www.skyscanner.com/routes/fran/her/frankfurt-to-crete-heraklion.html&gt;  \n- Backup: Eurowings ‚Ç¨180 round trip  \n\nüè® *Beachfront Hotels:*  \n1. **Georgioupolis Beach Hotel**  \n   - Direct beach access, bike rentals ‚Ç¨10  \n   - Source: &lt;https://www.tripadvisor.com/HotelsList-Crete-Beachfront-Cheap-Hotels-zfp13280541.html&gt;  \n\n2. **JT Apartments**  \n   - ‚Ç¨57/night, 9.5/10 rating, 5-min walk to beach  \n   - Source: &lt;https://www.booking.com/region/gr/crete.html&gt;  \n\n3. **FNK Apartments**  \n   - Sea views, 9.6/10 rating  \n\nüí∞ *Budget Breakdown:*  \n- Flights: ‚Ç¨154  \n- Hotel (3 nights): ‚Ç¨171-250  \n- Remaining: ‚Ç¨1,600+ for meals/activities  \n\n*Note:* All hotels are &lt;5 mins from beaches. Crete averages 25¬∞C in May (Source: TravelSupermarket).\n</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Resultado para la b√∫squeda de vacaciones, despu√©s de cinco iteraciones</span></p></figcaption></figure><p>Esa respuesta <em>parece</em> leg√≠tima. Pero, ¬ølo es realmente? Despu√©s de todo, se sabe que los modelos alucinan, y con un sistema de m√∫ltiples partes m√≥viles, es probable que algo pueda salir mal. Verifiquemos algunos detalles en la salida de R1:</p><h3 id=\"destination-and-total-budget\">Destino y Presupuesto total</h3><p>Los c√°lculos para cada elemento suman correctamente (veremos si cada elemento es preciso m√°s adelante). Despu√©s de todo, R1 fue entrenado en problemas matem√°ticos. El destino tambi√©n es correcto; Creta es un lugar popular.</p><h3 id=\"flights\">Vuelos</h3><p>Los precios de los vuelos <em>casi</em> suman correctamente, pero veamos d√≥nde salieron mal las cosas. En primer lugar, aqu√≠ est√°n los precios reales de <em>Skyscanner</em> de Frankfurt a Heraklion, para mayo de 2025, ida y vuelta:</p><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2025/03/image-25.png\" class=\"kg-image\" alt=\"\" loading=\"lazy\" width=\"2000\" height=\"2384\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2025/03/image-25.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2025/03/image-25.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/size/w1600/2025/03/image-25.png 1600w, https://jina-ai-gmbh.ghost.io/content/images/2025/03/image-25.png 2048w\" sizes=\"(min-width: 720px) 720px\"><figcaption><span style=\"white-space: pre-wrap;\">Resultados reales de b√∫squeda de Skyscanner para vuelos Frankfurt-Heraklion para mayo 2025</span></figcaption></figure><p>¬°Podemos ver que los precios est√°n todos alrededor de los 200 EUR, y no los 154 EUR prometidos para ida y vuelta! Pero, ¬øde d√≥nde viene el error? Mirando los registros, encontramos un bloque de memoria relacionado que se agreg√≥ en la ronda 3:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-json\">{\"operation\": \"add\", \"content\": \"Crete flight options: Eurowings ‚Ç¨89.99* one-way ...\"}</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Bloque de memoria relacionado con vuelos Alemania-Creta</span></p></figcaption></figure><p>Este bloque parece inferirse del resultado de b√∫squeda adjunto:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Source 1Ô∏è: search: Cheapest flights from Germany to Crete May 2025\nResult:\n```\n... other results ...\nTitle: Are you a person or a robot?\nURL Source: https://www.skyscanner.com/routes/fran/her/frankfurt-to-crete-heraklion.html\nDescription: Book a one-way ticket from Frankfurt to Heraklion Airport from $78 or travel \nreturn from just $154. The prices shown are based on availability and could change ...\n```</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Resultado de b√∫squeda para vuelos Alemania-Creta</span></p></figcaption></figure><p>El modelo nunca intent√≥ extraer esta p√°gina web para confirmar los resultados, pero probablemente no habr√≠a hecho una diferencia. Sin embargo, al menos deber√≠a haber notado que los resultados de b√∫squeda no inclu√≠an \"mayo\" como per√≠odo.</p><h3 id=\"hotel\">Hotel</h3><p>Los hoteles son correctos, pero identificamos algunas mejoras que podr√≠an hacerse. En primer lugar, nos gustar√≠a que el modelo se hubiera esforzado m√°s en encontrar los precios del Georgioupolis Beach Hotel y FNK Apartments - aunque proporciona otra informaci√≥n, lamentablemente faltan los precios. Para ver a qu√© nos referimos, aqu√≠ est√° la salida sin procesar de la <a href=\"https://www.booking.com/region/gr/crete.html\">URL</a> extra√≠da que se us√≥ para generar las recomendaciones de hoteles. Solo muestra precios para el primer y √∫ltimo resultado, omitiendo los tres del medio:</p><figure class=\"kg-card kg-code-card\"><pre><code class=\"language-markdown\">Fuente 3Ô∏è: scraping: https://www.booking.com/region/gr/crete.html\nResultado:\n```\nMostrar m√°s Mostrar menos\n\nMoritz Alemania\n\n*   ### [JT Apartments](https://www.booking.com/hotel/gr/jt-apatments.html?label=gen173nr-1FCAYoXEIFY3JldGVIM1gEaJUCiAEBmAExuAEZyAEM2AEB6AEB-AECiAIBqAIDuALSvqC-BsACAdICJDc5ZWE5ZDJkLTI2ZWEtNGNiMS04MzNlLTJhNWIyMGI5Y2M3NdgCBeACAQ&amp;sid=f21cdd5fe9eb08dcac7d3a0304f9ccc9)\n\nKissamos\n\nDesde $57 por noche\n\n9.5 Excepcional 313 rese√±as\n\nRecomiendo encarecidamente alojarse en JT Apartments. Cuando entramos al apartamento nos encontramos con una agradable sorpresa. Todo estaba bien equipado. El vecindario es tranquilo, supermercado cerca. La playa est√° a un corto paseo. Es una excelente ubicaci√≥n si quieres visitar las playas m√°s hermosas de Creta. Gracias a ustedes nuestra estad√≠a fue exactamente como la hab√≠amos so√±ado :)\n\nMostrar m√°s Mostrar menos\n\nKatarzyna Polonia\nMostrar m√°s Mostrar menos\n\nAitor Alemania\n\n*   ### [FNK Apartments with Sea View](https://www.booking.com/hotel/gr/f-amp-k-apartments.html?label=gen173nr-1FCAYoXEIFY3JldGVIM1gEaJUCiAEBmAExuAEZyAEM2AEB6AEB-AECiAIBqAIDuALSvqC-BsACAdICJDc5ZWE5ZDJkLTI2ZWEtNGNiMS04MzNlLTJhNWIyMGI5Y2M3NdgCBeACAQ&amp;sid=f21cdd5fe9eb08dcac7d3a0304f9ccc9)\n\nAgia Pelagia\n\n9.6 Excepcional 64 rese√±as\n\nEstuvimos en Creta durante una semana. Durante este tiempo, nos alojamos en FnK Apartments. Froso y Konstantinos fueron anfitriones s√∫per amables y maravillosos para nosotros. Siempre estaban listos para ayudar si ten√≠amos preguntas o necesidades de cualquier tipo. El apartamento en s√≠ tiene una hermosa vista de Agia Pelagia y las bah√≠as circundantes (e incluso el hermoso amanecer). ¬°Solo podemos recomendar FnK Apartments!\n\nMostrar m√°s Mostrar menos\n\nMoritz Alemania\nMostrar m√°s Mostrar menos\n\nmary Estados Unidos\n\n*   ### [Artemis Hotel Apartments](https://www.booking.com/hotel/gr/artemis-hersonisos.html?label=gen173nr-1FCAYoXEIFY3JldGVIM1gEaJUCiAEBmAExuAEZyAEM2AEB6AEB-AECiAIBqAIDuALSvqC-BsACAdICJDc5ZWE5ZDJkLTI2ZWEtNGNiMS04MzNlLTJhNWIyMGI5Y2M3NdgCBeACAQ&amp;sid=f21cdd5fe9eb08dcac7d3a0304f9ccc9)\n\nLimenas Hersonissou, Hersonissos\n\n9.0 Maravilloso 419 rese√±as\n\nSi quieres sentirte bienvenido, ser tratado como amigos, saber que recibir√°s ayuda en todo, te recomendamos encarecidamente alojarte en el hotel. ¬°Gracias de todo coraz√≥n a Konstantine por el trato c√°lido y muy personal! ¬°En nuestra pr√≥xima visita a Creta, estaremos encantados de alojarnos nuevamente en el Hotel Artemis!\n\nMostrar m√°s Mostrar menos\n\nIrina Israel\nMostrar m√°s Mostrar menos\n\nAnn Marie Irlanda\n\n*   ### [Pinelopi Hotel](https://www.booking.com/hotel/gr/pinelopi.html?label=gen173nr-1FCAYoXEIFY3JldGVIM1gEaJUCiAEBmAExuAEZyAEM2AEB6AEB-AECiAIBqAIDuALSvqC-BsACAdICJDc5ZWE5ZDJkLTI2ZWEtNGNiMS04MzNlLTJhNWIyMGI5Y2M3NdgCBeACAQ&amp;sid=f21cdd5fe9eb08dcac7d3a0304f9ccc9)\n\nPlatanes\n\n7.8 Bueno 198 rese√±as\n\nExcelente ubicaci√≥n cerca de la playa, excelentes tabernas y tambi√©n en una buena ubicaci√≥n para viajar en coche. Zona tranquila, perfecta para unas maravillosas vacaciones. Habitaciones espaciosas equipadas con todo lo necesario. Excelente relaci√≥n calidad-precio. La zona de la piscina era excelente y puedes relajarte all√≠ en cualquier momento del d√≠a. El estacionamiento cerca del hotel era perfecto. Seguramente volver√© al Hotel Pinelopi cuando visite Creta nuevamente.\n\nMostrar m√°s Mostrar menos\n\nRita Rumania\nMostrar m√°s Mostrar menos\n\nKatarzyna Polonia\n\n*   ### [Elizabeth Suites](https://www.booking.com/hotel/gr/elizabeth-suites.html?label=gen173nr-1FCAYoXEIFY3JldGVIM1gEaJUCiAEBmAExuAEZyAEM2AEB6AEB-AECiAIBqAIDuALSvqC-BsACAdICJDc5ZWE5ZDJkLTI2ZWEtNGNiMS04MzNlLTJhNWIyMGI5Y2M3NdgCBeACAQ&amp;sid=f21cdd5fe9eb08dcac7d3a0304f9ccc9)\n\nKato Daratso\n\nDesde $74 por noche\n\n9.1 Maravilloso 86 rese√±as\n\nTuvimos una excelente estad√≠a que fue a√∫n m√°s personal gracias a Epas, el propietario, que siempre ten√≠a una sonrisa y fue muy servicial, y el personal era encantador, especialmente Anna. Desayunamos un par de d√≠as y fueron m√°s que abundantes. Los apartamentos estaban en una posici√≥n perfecta para playas y restaurantes. Recomendamos encarecidamente The Elizabeth Suites, hicieron nuestras primeras vacaciones en Creta üòä\n\nMostrar m√°s Mostrar menos\n\nJean Reino Unido\n```</code></pre><figcaption><p><span style=\"white-space: pre-wrap;\">Resultados crudos extra√≠dos de listados de hoteles en Creta en booking.com</span></p></figcaption></figure><p>En segundo lugar, identificamos un problema adicional al usar Reranker con su predefinido <code>top_n</code> de 5 resultados ‚Äî resulta que la p√°gina extra√≠da conten√≠a m√°s de cinco resultados relevantes - podr√≠amos haber abordado esto verificando realmente la puntuaci√≥n de relevancia de cada resultado, en lugar de tomar solo los cinco primeros (o la cantidad que sea) resultados. Sin embargo, la configuraci√≥n ideal de reordenamiento var√≠a seg√∫n las tareas. Una mejor manera de manejar este problema ser√≠a simplemente usar la p√°gina completa extra√≠da - lo cual lamentablemente no es posible debido a la limitada longitud de contexto de R1.</p><h3 id=\"overall-performance-and-potential-improvements\">Rendimiento General y Posibles Mejoras</h3><p>El modelo comenz√≥ bien inicialmente, pero notamos que raramente intentaba cambiar de estrategias o desarrollar planes complejos a menos que se le indicara espec√≠ficamente. Si bien R1 naturalmente emplea estos enfoques para problemas de matem√°ticas y programaci√≥n (√°reas en las que fue espec√≠ficamente entrenado), no aplica el mismo razonamiento a tareas de b√∫squeda. Si bien podr√≠amos ajustar m√°s el prompt (o incluso usar m√∫ltiples prompts) para abordar esta limitaci√≥n, ese no era nuestro objetivo principal.</p><p>Tambi√©n observamos que R1 no manejaba adecuadamente la informaci√≥n sensible al tiempo. En resumen, si los resultados de b√∫squeda no mencionan expl√≠citamente una fecha incorrecta, el modelo asume que la informaci√≥n es v√°lida sin mayor verificaci√≥n. Por ejemplo, al planear un vuelo para el 1 de mayo:</p><ul><li>Alemania a Creta $80 1 de mayo: <strong>Correcto</strong> - El modelo puede confiar en esta informaci√≥n.</li><li>Alemania a Creta $80 1 de enero: <strong>Incorrecto</strong> - El modelo identifica y descarta esto apropiadamente.</li><li>Alemania a Creta $80: <strong>Falso positivo</strong> - Cuando no se especifica fecha, el modelo no verifica la informaci√≥n y asume incorrectamente su validez.</li></ul><p>Si continu√°ramos con este proyecto, podr√≠amos considerar implementar varias mejoras potenciales:</p><ul><li>Rastrear el conteo de bloques de memoria y solicitar al modelo que <strong>resuma entradas</strong> cuando el estado se vuelve demasiado grande.</li><li>Instruir al modelo para que <strong>agote todas las pistas</strong> antes de finalizar la exploraci√≥n y responder consultas.</li><li>Enfatizar la <strong>verificaci√≥n de informaci√≥n sensible al tiempo</strong>.</li><li>Asegurar que el modelo <strong>verifique dos veces los resultados</strong> extrayendo datos de las URLs devueltas por la herramienta de b√∫squeda.</li><li>Probar nuestro sistema con <strong>futuros modelos de razonamiento que admitan ventanas de contexto m√°s grandes</strong>, aunque esto requerir√≠a una refactorizaci√≥n y pruebas sustanciales para adaptar el prompt a un modelo diferente.</li></ul><h2 id=\"conclusion\">Conclusi√≥n</h2><p>Incluso desde el lanzamiento bastante reciente de R1, el panorama ha evolucionado significativamente. Han surgido proyectos que entrenan modelos de razonamiento a costos notablemente bajos‚Äîalgunos por tan solo $5. Esta democratizaci√≥n significa que entrenar modelos especializados es m√°s accesible que nunca. Nuestros experimentos con R1 proporcionan una l√≠nea base √∫til mientras continuamos explorando c√≥mo los LLMs enfocados en el razonamiento pueden mejorarse con herramientas para abordar tareas complejas de b√∫squeda.</p><p>Si bien nuestro ejemplo de planificaci√≥n de vacaciones demostr√≥ resultados prometedores (especialmente para un proyecto de demostraci√≥n r√°pida), tambi√©n revel√≥ los l√≠mites de R1 en el manejo de tareas de b√∫squeda y memoria en comparaci√≥n con sus fortalezas en matem√°ticas y programaci√≥n. Si bien el sistema produjo exitosamente un plan de viaje dentro de las restricciones presupuestarias, qued√≥ corto en √°reas como la verificaci√≥n de informaci√≥n sensible al tiempo y la exploraci√≥n exhaustiva de todas las opciones disponibles, destacando la brecha entre el enfoque de entrenamiento del modelo y su aplicaci√≥n a diferentes dominios.</p>",
  "comment_id": "67dd5037143bda0001036423",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2025/04/Heading--92-.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2025-03-21T12:40:39.000+01:00",
  "updated_at": "2025-04-01T09:38:45.000+02:00",
  "published_at": "2025-04-01T09:38:45.000+02:00",
  "custom_excerpt": "Standard LLM or reasoning model, which is better for DeepSearch? In this post, we explored using DeepSeek-R1 in the DeepSearch implementation for choosing the next action.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "64ae64a4733bc60001949ca4",
      "name": "Andrei Ungureanu",
      "slug": "andrei",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/07/Me.jpg",
      "cover_image": null,
      "bio": "Software / AI Engineer, with a passion for content creation.",
      "website": null,
      "location": "Beijing, China",
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/andrei/"
    },
    {
      "id": "632ade4a3e4e55003d525971",
      "name": "Alex C-G",
      "slug": "alexcg",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/09/alex.jpg",
      "cover_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/11/twitter_banner.jpg",
      "bio": "Open-source Evangelist @ Jina AI. Old, grim, and full of Vim",
      "website": null,
      "location": "Berlin, Germany",
      "facebook": null,
      "twitter": "@alexcg",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/alexcg/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "64ae64a4733bc60001949ca4",
    "name": "Andrei Ungureanu",
    "slug": "andrei",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/07/Me.jpg",
    "cover_image": null,
    "bio": "Software / AI Engineer, with a passion for content creation.",
    "website": null,
    "location": "Beijing, China",
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/andrei/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/using-deepseek-r1-reasoning-model-in-deepsearch/",
  "excerpt": "¬øLLM est√°ndar o modelo de razonamiento, cu√°l es mejor para DeepSearch? En esta publicaci√≥n, exploramos el uso de DeepSeek-R1 en la implementaci√≥n de DeepSearch para elegir la siguiente acci√≥n.",
  "reading_time": 17,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": null,
  "feature_image_caption": null
}
{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "¿Pueden los modelos de Embedding/Reranker comparar números?",
  "html": "<p>Esta fue una pregunta que me hicieron hoy en la conferencia ICML en Viena.</p><p>Durante el descanso para el café, un usuario de Jina se me acercó con una pregunta que surgió de discusiones recientes en la comunidad de LLM. Me preguntó si nuestro modelo de embeddings podía determinar que 9.11 es <em>menor</em> que 9.9, una tarea donde muchos LLMs dicen lo contrario.</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>\"Honestamente, no lo sé\", respondí. Mientras él explicaba la importancia de esta capacidad para su aplicación y sugería que <strong>la tokenización podría ser la raíz del problema</strong>, me encontré asintiendo - mi mente ya estaba corriendo con ideas para un experimento para descubrir la respuesta.</p><p>En este artículo, quiero probar si nuestro modelo de embeddings, <code>jina-embeddings-v2-base-en</code> (lanzado en octubre de 2023), y el Reranker, <code>jina-reranker-v2-multilingual</code> (lanzado en junio de 2024), pueden comparar números con precisión. Para extender el alcance más allá de la simple comparación de 9.11 y 9.9, he diseñado un conjunto de experimentos que incluyen varios tipos de números: enteros pequeños, números grandes, decimales, números negativos, moneda, fechas y horas. El objetivo es evaluar la efectividad de nuestros modelos en el manejo de diferentes formatos numéricos.</p><h2 id=\"experimental-setup\">Configuración Experimental</h2><p>La implementación completa se puede encontrar en el Colab a continuación:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>El diseño del experimento es bastante sencillo. Por ejemplo, para verificar si el modelo de embeddings entiende números entre [1, 100]. Los pasos son los siguientes:</p><ol><li><strong>Construir Documentos</strong>: Generar documentos de \"literales de cadena\" para cada número desde <code>1</code> hasta <code>100</code>.</li><li><strong>Enviar a la API de Embeddings</strong>: Usar <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">la API de Embeddings</a> para obtener embeddings para cada documento.</li><li><strong>Calcular Similitud del Coseno</strong>: Calcular la similitud del coseno por pares para cada dos documentos para crear una matriz de similitud.</li><li><strong>Hacer Gráfico de Dispersión</strong>: Visualizar los resultados usando un gráfico de dispersión. Cada elemento $(i, j)$ en la matriz de similitud se mapea a un punto con: Eje X: $(i - j)$; Eje Y: el valor de similitud de $(i, j)$</li></ol><p>Si el delta $(i - j)$ es cero, es decir, $i = j$, entonces la similitud semántica debería ser la más alta. A medida que el delta $(i - j)$ aumenta, la similitud debería disminuir. <strong>Idealmente, la similitud debería ser linealmente proporcional al valor delta.</strong> Si no podemos observar tal linealidad, entonces es probable que el modelo no pueda entender los números y pueda producir errores como que 9.11 es mayor que 9.9.</p><p>El modelo Reranker sigue un procedimiento similar. La diferencia clave es que iteramos a través de los documentos construidos, estableciendo cada uno como <code>query</code> anteponiendo el prompt <code>\"what is the closest item to...\"</code> y clasificando todos los demás como <code>documents</code>. La puntuación de relevancia devuelta por <a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">la API del Reranker</a> se usa directamente como medida de similitud semántica. La implementación central se ve así.</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">¿Pueden los Modelos Comparar Números Entre [1, 2, 3, ..., 100]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">Cómo Leer Estos Gráficos</h3><p>Antes de continuar con más experimentos, permítanme primero explicar cómo leer correctamente estos gráficos. En primer lugar, mi observación de los dos gráficos anteriores es que el modelo de embeddings funciona bien, mientras que el modelo reranker no lo hace tan bien. Entonces, ¿qué estamos viendo y por qué?</p><p>El eje X representa el delta de los índices $(i,j)$, o $i-j$, cuando muestreamos uniformemente $d_i$ y $d_j$ de nuestros conjuntos de documentos. Este delta varía de $[-100, 100]$. Dado que nuestro conjunto de documentos está ordenado por construcción, es decir, cuanto menor sea $|i-j|$, más cercanos son semánticamente $d_i$ y $d_j$; cuanto más alejados estén $i$ y $j$, menor será la similitud entre $d_i$ y $d_j$. Por eso ves que la similitud (representada por el eje Y) se dispara en $X=0$ y luego cae linealmente al moverte a izquierda y derecha.</p><p>Idealmente, esto debería crear un pico pronunciado o una forma de \"flecha hacia arriba\" como <code>^</code>. Sin embargo, ese no es siempre el caso. Si fijas el eje X en un punto, digamos $X=25$, y miras a lo largo del eje Y, encontrarás valores de similitud que van de 0.80 a 0.95. Eso significa que $\\mathrm{sim}(d_27, d_2)$ puede ser 0.81 mientras que $\\mathrm{sim}(d_42, d_17)$ puede ser 0.91 a pesar de que sus deltas son todos 25.</p><p>La línea de tendencia cian muestra la similitud media en cada valor X con la desviación estándar. Además, nota que la similitud debería caer linealmente porque nuestro conjunto de documentos está espaciado uniformemente, asegurando intervalos iguales entre documentos contiguos.</p><p>Ten en cuenta que los gráficos de embeddings serán <strong>siempre simétricos, con el valor Y más grande de 1.0</strong> en $X=0$. Esto es porque la similitud del coseno es simétrica para $d_i$ y $d_j$, y $\\cos(0)=1$.</p><p>Por otro lado, los gráficos del reranker son <strong>siempre asimétricos</strong> debido a los diferentes roles de la consulta y los documentos en el modelo reranker. <strong>El valor máximo probablemente no sea 1.0</strong> porque $X=0$ significa que usamos el reranker para calcular la puntuación de relevancia de <code>\"what is the closest item to 4\"</code> vs <code>\"4\"</code>. Si lo piensas, no hay garantía de que $X=0$ lleve al valor Y máximo.</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">¿Pueden los Modelos Comparar Números Negativos Entre [-100, -99, -98, ..., -1]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. Aquí queremos probar si el modelo puede determinar la similitud semántica en el espacio negativo. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">¿Pueden los Modelos Comparar Números con Intervalos Más Grandes [1000, 2000, 3000, ..., 100000]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos números con un intervalo de 1000. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">¿Pueden los Modelos Comparar Números de un Rango Arbitrario, por ejemplo [376, 377, 378, ..., 476]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos números en un rango arbitrario, así que movemos los números a un rango aleatorio </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">. Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">¿Pueden los Modelos Comparar Números Grandes Entre [4294967296, 4294967297, 4294967298, ..., 4294967396]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos números muy grandes. Similar a la idea del último experimento, movemos el rango más allá a un número grande. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">¿Pueden los Modelos Comparar Números Decimales Entre [0.0001, 0.0002, 0.0003, ...,0.1]? (sin dígitos fijos)</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos decimales. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">¿Pueden los Modelos Comparar Números de Moneda Entre [$1, $2, $3, ..., $100]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos números en formato de moneda. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">¿Pueden los Modelos Comparar Fechas Entre [2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Aquí queremos probar si el modelo puede determinar la similitud semántica cuando comparamos números en formato de fecha, es decir, AAAA-MM-DD. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">¿Pueden los Modelos Comparar Horas Entre [19:00:07, 19:00:08, 19:00:09,..., 20:39:07]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Aquí queremos probar si el modelo puede detectar la similitud semántica cuando comparamos números en formato de tiempo, es decir, </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Gráfico de dispersión con media y varianza en cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"observations\">Observaciones</h2><p>Aquí hay algunas observaciones de los gráficos anteriores:</p><h3 id=\"reranker-models\"><strong>Modelos Reranker</strong></h3><ul><li>Los modelos reranker tienen dificultades para comparar números. Incluso en el caso más simple de comparar números entre [1, 100], su rendimiento es deficiente.</li><li>Es importante notar la construcción especial de prompt utilizada para las consultas en nuestro uso del reranker, es decir, <code>what is the closest item to x</code>, ya que esto también puede impactar los resultados.</li></ul><h3 id=\"embedding-models\"><strong>Modelos de Embedding</strong></h3><ul><li>Los modelos de embedding tienen un rendimiento razonablemente bueno al comparar números enteros pequeños en el rango [1, 100] o números negativos en [-100, 1]. Sin embargo, su rendimiento se degrada significativamente al desplazar este intervalo a otros valores, agregar más intervalos o tratar con flotantes más grandes o más pequeños.</li><li>Se pueden observar picos regulares en ciertos intervalos, generalmente cada 10 pasos. Este comportamiento puede estar relacionado con cómo el tokenizer procesa las cadenas, potencialmente tokenizando una cadena en \"10\" o \"1\" y \"0\".</li></ul><h3 id=\"date-and-time-understanding\"><strong>Comprensión de Fecha y Hora</strong></h3><ul><li>Curiosamente, los modelos de embedding parecen tener una buena comprensión de fechas y horas, comparándolas correctamente la mayoría del tiempo. Para los gráficos de fechas, aparecen picos cada 30/31 pasos, correspondientes al número de días en un mes. Para los gráficos de tiempo, aparecen picos cada 60 pasos, correspondientes a los minutos en una hora.</li><li>Los modelos reranker también parecen captar esta comprensión hasta cierto punto.</li></ul><h3 id=\"visualizing-similarity-to-zero\">Visualización de la Similitud con \"Cero\"</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">Actualizado el 29 de julio de 2024</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>Otro experimento interesante, que es probablemente más intuitivo, es visualizar directamente la puntuación de similitud o relevancia entre cualquier número y cero (es decir, el origen). Al fijar el punto de referencia como el embedding de cero, queremos ver si la similitud semántica disminuye linealmente a medida que los números se hacen más grandes. Para el reranker, podemos fijar la consulta a <code>\"0\"</code> o <code>\"What is the closest number to number zero?\"</code> y clasificar todos los números para ver si sus puntuaciones de relevancia disminuyen a medida que los números aumentan. Los resultados se muestran a continuación:</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">Aquí, fijamos el \"embedding de origen\" al embedding de \"cero\" y comprobamos si la similitud semántica entre cualquier número y cero es proporcional al valor del número. Específicamente, usamos </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">. Se muestra el gráfico de dispersión con media y varianza para cada delta. Izquierda: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Derecha: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"conclusion\">Conclusión</h2><p>Este artículo ilustra cómo nuestros modelos actuales de embedding y reranker manejan las comparaciones numéricas. A pesar de la configuración experimental relativamente simple, expone algunas fallas fundamentales en los modelos actuales y proporciona información valiosa para el desarrollo de nuestro próximo embedding y reranker.</p><p>Dos factores clave determinan si un modelo puede comparar números con precisión: </p><p><strong>Primero, la tokenización:</strong> Si el vocabulario solo incluye dígitos 0-9, entonces 11 podría tokenizarse en tokens separados 1 y 1, o como un solo token 11. Esta elección impacta la comprensión del modelo de los valores numéricos.</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Diferentes tokenizers resultan en diferentes interpretaciones de 9.11. Esto puede afectar el aprendizaje contextual posterior. Fuente: </span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">The Tokenizer Playground en HuggingFace.</span></a></p></figcaption></figure><p><strong>Segundo, los datos de entrenamiento:</strong> El corpus de entrenamiento influye significativamente en las capacidades de razonamiento numérico del modelo. Por ejemplo, si los datos de entrenamiento incluyen principalmente documentación de software o repositorios de GitHub donde el versionado semántico es común, el modelo podría interpretar que 9.11 es mayor que 9.9, ya que 9.11 es la versión menor que sigue a 9.9.</p><p>La capacidad aritmética de los modelos de recuperación densa, como embeddings y rerankers, es crucial para tareas que involucran RAG y recuperación y razonamiento avanzados. Las fuertes capacidades de razonamiento numérico pueden mejorar significativamente la calidad de búsqueda, particularmente cuando se trata de datos estructurados como JSON.</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "Muchos LLMs no logran entender que 9.11 es en realidad menor que 9.9. ¿Pueden nuestros modelos de embedding y reranking hacerlo mejor?",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "Können Embedding-/Reranker-Modelle Zahlen vergleichen?",
  "html": "<p>Dies war eine Frage, die mir heute auf der ICML-Konferenz in Wien gestellt wurde.</p><p>Während der Kaffeepause kam ein Jina-Nutzer mit einer Frage auf mich zu, die aus den jüngsten Diskussionen in der LLM-Community stammte. Er fragte, ob unser Embedding-Modell erkennen könne, dass 9.11 <em>kleiner</em> ist als 9.9 - eine Aufgabe, bei der viele LLMs das Gegenteil behaupten.</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>\"Ehrlich gesagt, weiß ich es nicht\", antwortete ich. Als er die Wichtigkeit dieser Fähigkeit für seine Anwendung erläuterte und andeutete, dass <strong>die Tokenisierung möglicherweise die Ursache des Problems sein könnte</strong>, nickte ich zustimmend - in meinem Kopf entstanden bereits Ideen für ein Experiment, um die Antwort zu finden.</p><p>In diesem Artikel möchte ich testen, ob unser Embedding-Modell <code>jina-embeddings-v2-base-en</code> (veröffentlicht im Oktober 2023) und der Reranker <code>jina-reranker-v2-multilingual</code> (veröffentlicht im Juni 2024) Zahlen korrekt vergleichen können. Um über den einfachen Vergleich von 9.11 und 9.9 hinauszugehen, habe ich eine Reihe von Experimenten entwickelt, die verschiedene Arten von Zahlen umfassen: kleine Ganzzahlen, große Zahlen, Gleitkommazahlen, negative Zahlen, Währungen, Datumsangaben und Uhrzeiten. Ziel ist es, die Effektivität unserer Modelle beim Umgang mit verschiedenen numerischen Formaten zu bewerten.</p><h2 id=\"experimental-setup\">Versuchsaufbau</h2><p>Die vollständige Implementierung finden Sie im Colab unten:</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>Der Aufbau des Experiments ist recht einfach. Um beispielsweise zu prüfen, ob das Embedding-Modell Zahlen zwischen [1, 100] versteht, sind folgende Schritte erforderlich:</p><ol><li><strong>Dokumente erstellen</strong>: Generieren von \"String-Literal\"-Dokumenten für jede Zahl von <code>1</code> bis <code>100</code>.</li><li><strong>An Embedding API senden</strong>: Verwendung der <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Embedding API</a>, um Embeddings für jedes Dokument zu erhalten.</li><li><strong>Kosinus-Ähnlichkeit berechnen</strong>: Berechnung der paarweisen Kosinus-Ähnlichkeit für je zwei Dokumente zur Erstellung einer Ähnlichkeitsmatrix.</li><li><strong>Streudiagramm erstellen</strong>: Visualisierung der Ergebnisse mittels Streudiagramm. Jedes Element $(i, j)$ in der Ähnlichkeitsmatrix wird auf einen Punkt abgebildet mit: X-Achse: $(i - j)$; Y-Achse: der Ähnlichkeitswert von $(i, j)$</li></ol><p>Wenn die Differenz $(i - j)$ null ist, also $i = j$, sollte die semantische Ähnlichkeit am höchsten sein. Je größer die Differenz $(i - j)$ wird, desto geringer sollte die Ähnlichkeit sein. <strong>Idealerweise sollte die Ähnlichkeit linear proportional zum Differenzwert sein.</strong> Wenn wir eine solche Linearität nicht beobachten können, ist es wahrscheinlich, dass das Modell die Zahlen nicht versteht und Fehler wie \"9.11 ist größer als 9.9\" produzieren könnte.</p><p>Das Reranker-Modell folgt einem ähnlichen Verfahren. Der Hauptunterschied besteht darin, dass wir durch die erstellten Dokumente iterieren, wobei jedes als <code>query</code> festgelegt wird, indem wir den Prompt <code>\"what is the closest item to...\"</code> voranstellen und alle anderen als <code>documents</code> einordnen. Der von der <a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Reranker API</a> zurückgegebene Relevanz-Score wird direkt als semantisches Ähnlichkeitsmaß verwendet. Die Kernimplementierung sieht wie folgt aus.</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">Können Modelle Zahlen zwischen [1, 2, 3, ..., 100] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Streudiagramm mit Mittelwert und Varianz für jede Differenz. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">Wie liest man diese Diagramme?</h3><p>Bevor wir mit weiteren Experimenten fortfahren, möchte ich zunächst erklären, wie man diese Diagramme richtig liest. Meine erste Beobachtung aus den beiden obigen Diagrammen ist, dass das Embedding-Modell gut funktioniert, während das Reranker-Modell nicht so gut abschneidet. Was sehen wir also und warum?</p><p>Die X-Achse repräsentiert die Differenz der Indizes $(i,j)$, also $i-j$, wenn wir $d_i$ und $d_j$ gleichmäßig aus unseren Dokumentensets auswählen. Diese Differenz reicht von $[-100, 100]$. Da unser Dokumentenset konstruktionsbedingt sortiert ist, d.h. je kleiner $|i-j|$, desto semantisch näher sind sich $d_i$ und $d_j$; je weiter $i$ und $j$ voneinander entfernt sind, desto geringer ist die Ähnlichkeit zwischen $d_i$ und $d_j$. Deshalb sehen Sie die Ähnlichkeit (dargestellt durch die Y-Achse) bei $X=0$ spitzen und dann linear abfallen, wenn Sie sich nach links und rechts bewegen.</p><p>Idealerweise sollte dies einen scharfen Gipfel oder eine \"Aufwärtspfeil\"-Form wie <code>^</code> erzeugen. Das ist jedoch nicht immer der Fall. Wenn Sie die X-Achse an einem Punkt fixieren, sagen wir $X=25$, und entlang der Y-Achse schauen, finden Sie Ähnlichkeitswerte von 0,80 bis 0,95. Das bedeutet, $\\mathrm{sim}(d_27, d_2)$ könnte 0,81 sein, während $\\mathrm{sim}(d_42, d_17)$ 0,91 sein könnte, obwohl ihre Differenz jeweils 25 beträgt.</p><p>Die türkisfarbene Trendlinie zeigt den mittleren Ähnlichkeitswert an jedem X-Wert mit der Standardabweichung. Beachten Sie auch, dass die Ähnlichkeit linear abfallen sollte, da unser Dokumentenset gleichmäßig verteilt ist und gleiche Intervalle zwischen aufeinanderfolgenden Dokumenten sicherstellt.</p><p>Beachten Sie, dass Embedding-Plots <strong>immer symmetrisch sind, mit dem größten Y-Wert von 1,0</strong> bei $X=0$. Dies liegt daran, dass die Kosinus-Ähnlichkeit für $d_i$ und $d_j$ symmetrisch ist und $\\cos(0)=1$.</p><p>Im Gegensatz dazu sind Reranker-Plots <strong>immer asymmetrisch</strong> aufgrund der unterschiedlichen Rollen von Query und Dokumenten im Reranker-Modell. <strong>Der Maximalwert ist wahrscheinlich nicht 1,0</strong>, da $X=0$ bedeutet, dass wir den Reranker verwenden, um den Relevanz-Score von <code>\"what is the closest item to 4\"</code> vs <code>\"4\"</code> zu berechnen. Wenn man darüber nachdenkt, gibt es keine Garantie, dass $X=0$ zum maximalen Y-Wert führt.</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">Können Modelle negative Zahlen zwischen [-100, -99, -98, ..., -1] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Streudiagramm mit Mittelwert und Varianz für jede Differenz. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">. Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit im negativen Bereich erkennen kann. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">Können Modelle Zahlen mit größeren Intervallen [1000, 2000, 3000, ..., 100000] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Zahlen mit einem Intervall von 1000 vergleichen. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">Können Modelle Zahlen aus einem beliebigen Bereich vergleichen, z.B. [376, 377, 378, ..., 476]?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Zahlen in einem beliebigen Bereich vergleichen, also verschieben wir die Zahlen in einen zufälligen Bereich </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> . Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">Können Modelle große Zahlen zwischen [4294967296, 4294967297, 4294967298, ..., 4294967396] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir sehr große Zahlen vergleichen. Ähnlich wie beim letzten Experiment verschieben wir den Bereich weiter zu einer großen Zahl. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">Können Modelle Fließkommazahlen zwischen [0.0001, 0.0002, 0.0003, ...,0.1] vergleichen? (ohne feste Nachkommastellen)</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Fließkommazahlen vergleichen. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">Können Modelle Währungsbeträge zwischen [$1, $2, $3, ..., $100] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Zahlen in Währungsform vergleichen. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">Können Modelle Daten zwischen [2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Zahlen im Datumsformat vergleichen, d.h. JJJJ-MM-TT. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">Können Modelle Uhrzeiten zwischen [19:00:07, 19:00:08, 19:00:09,..., 20:39:07] vergleichen?</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Hier wollen wir testen, ob das Modell die semantische Ähnlichkeit erkennen kann, wenn wir Zahlen im Zeitformat vergleichen, d.h. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">. </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\"> Streudiagramm mit Mittelwert und Varianz für jedes Delta. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"observations\">Beobachtungen</h2><p>Hier sind einige Beobachtungen aus den obigen Diagrammen:</p><h3 id=\"reranker-models\"><strong>Reranker-Modelle</strong></h3><ul><li>Reranker-Modelle haben Schwierigkeiten beim Vergleich von Zahlen. Selbst im einfachsten Fall des Vergleichs von Zahlen zwischen [1, 100] ist ihre Leistung unterdurchschnittlich.</li><li>Es ist wichtig, die spezielle Prompt-Konstruktion zu beachten, die für Abfragen in unserem Reranker verwendet wird, d.h. <code>what is the closest item to x</code>, da dies die Ergebnisse ebenfalls beeinflussen kann.</li></ul><h3 id=\"embedding-models\"><strong>Embedding-Modelle</strong></h3><ul><li>Embedding-Modelle funktionieren relativ gut beim Vergleich kleiner ganzer Zahlen im Bereich [1, 100] oder negativer Zahlen im Bereich [-100, 1]. Ihre Leistung verschlechtert sich jedoch erheblich, wenn dieser Bereich zu anderen Werten verschoben wird, mehr Intervalle hinzugefügt werden oder größere oder kleinere Fließkommazahlen verarbeitet werden.</li><li>Regelmäßige Spitzen sind in bestimmten Intervallen zu beobachten, normalerweise alle 10 Schritte. Dieses Verhalten könnte damit zusammenhängen, wie der Tokenizer die Strings verarbeitet, möglicherweise indem er einen String in \"10\" oder \"1\" und \"0\" tokenisiert.</li></ul><h3 id=\"date-and-time-understanding\"><strong>Datums- und Zeitverständnis</strong></h3><ul><li>Interessanterweise scheinen Embedding-Modelle ein gutes Verständnis von Datum und Uhrzeit zu haben und vergleichen diese meist korrekt. Bei Datumsdiagrammen erscheinen Spitzen alle 30/31 Schritte, entsprechend der Anzahl der Tage in einem Monat. Bei Zeitdiagrammen erscheinen Spitzen alle 60 Schritte, entsprechend den Minuten in einer Stunde.</li><li>Die Reranker-Modelle scheinen dieses Verständnis ebenfalls bis zu einem gewissen Grad zu erfassen.</li></ul><h3 id=\"visualizing-similarity-to-zero\">Visualisierung der Ähnlichkeit zu \"Null\"</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">Aktualisiert am 29. Juli 2024</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>Ein weiteres interessantes Experiment, das wahrscheinlich intuitiver ist, ist die direkte Visualisierung des Ähnlichkeits- oder Relevanzwerts zwischen einer beliebigen Zahl und Null (d.h. dem Ursprung). Indem wir den Referenzpunkt als das Embedding von Null festlegen, möchten wir sehen, ob die semantische Ähnlichkeit linear abnimmt, wenn die Zahlen größer werden. Beim Reranker können wir die Abfrage auf <code>\"0\"</code> oder <code>\"What is the closest number to number zero?\"</code> festlegen und alle Zahlen rangieren, um zu sehen, ob ihre Relevanzwerte abnehmen, wenn die Zahlen steigen. Die Ergebnisse sind unten dargestellt:</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">Hier fixieren wir das \"Ursprungs-Embedding\" auf das Embedding von \"Null\" und prüfen, ob die semantische Ähnlichkeit zwischen einer beliebigen Zahl und Null proportional zum Wert der Zahl ist. Konkret verwenden wir </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">. Das Streudiagramm mit Mittelwert und Varianz für jedes Delta ist dargestellt. Links: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">; Rechts: </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">.</span></p></figcaption></figure><h2 id=\"conclusion\">Fazit</h2><p>Dieser Artikel zeigt, wie unsere aktuellen Embedding- und Reranker-Modelle mit Zahlenvergleichen umgehen. Trotz des relativ einfachen Versuchsaufbaus zeigt er einige grundlegende Mängel in den aktuellen Modellen auf und liefert wertvolle Erkenntnisse für die Entwicklung unserer nächsten Embedding- und Reranker-Generation.</p><p>Zwei Schlüsselfaktoren bestimmen, ob ein Modell Zahlen genau vergleichen kann:</p><p><strong>Erstens, Tokenisierung:</strong> Wenn das Vokabular nur die Ziffern 0-9 enthält, könnte 11 entweder in separate Token 1 und 1 oder als einzelnes Token 11 tokenisiert werden. Diese Wahl beeinflusst das Verständnis des Modells für numerische Werte.</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">Verschiedene Tokenizer führen zu unterschiedlichen Interpretationen von 9.11. Dies kann das nachgelagerte kontextuelle Lernen beeinflussen. Quelle: </span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">The Tokenizer Playground auf HuggingFace.</span></a></p></figcaption></figure><p><strong>Zweitens, Trainingsdaten:</strong> Das Trainingskorpus beeinflusst die numerischen Fähigkeiten des Modells erheblich. Wenn die Trainingsdaten zum Beispiel hauptsächlich Software-Dokumentation oder GitHub-Repositories enthalten, wo semantische Versionierung üblich ist, könnte das Modell interpretieren, dass 9.11 größer als 9.9 ist, da 9.11 die Minor-Version nach 9.9 ist.</p><p>Die arithmetische Fähigkeit von Dense-Retrieval-Modellen wie Embeddings und Rerankern ist entscheidend für Aufgaben im Zusammenhang mit RAG und fortgeschrittenem Retrieval und Reasoning. Starke numerische Fähigkeiten können die Suchqualität deutlich verbessern, insbesondere bei der Verarbeitung strukturierter Daten wie JSON.</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "Viele LLMs können nicht erkennen, dass 9.11 eigentlich kleiner ist als 9.9. Können unsere Embedding- und Reranker-Modelle das besser?",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
{
  "slug": "jina-embeddings-and-reranker-on-azure-scalable-business-ready-ai-solutions",
  "id": "662f563fda339c0001574205",
  "uuid": "c7c7790b-c420-4a89-b14d-58b4c017075b",
  "title": "Jina Embeddings 和 Reranker 在 Azure 上：可扩展的企业级 AI 解决方案",
  "html": "<p>Jina Embeddings 和 Rerankers 现已在 Azure Marketplace 上线。对于将数据安全和运营效率放在首位的企业来说，这一集成至关重要。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/jina-ai-launches-worlds-first-open-source-8k-text-embedding-rivaling-openai/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Jina AI 推出全球首个开源 8K 文本嵌入模型，与 OpenAI 展开竞争</div><div class=\"kg-bookmark-description\">Jina AI 推出 jina-embeddings-v2，这是全球首个具有 8K 上下文长度的开源模型。该创新与 OpenAI 的专有模型实力相当，现已在 Huggingface 上公开发布，标志着文本嵌入领域的重要里程碑。</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2023/10/Explore-image-storytelling-beyond-pixels--11-.png\" alt=\"\"></div></a></figure><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">通过 Jina Reranker 最大化搜索相关性和 RAG 准确性</div><div class=\"kg-bookmark-description\">使用 Jina Reranker 提升您的搜索和 RAG 准确性。我们的新模型相比简单向量搜索提高了 20% 的准确性和相关性。现在免费试用！</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>我们提供七个模型：</p><ol><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-embeddings-v2-base-code?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - code</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-embeddings-v2-base-de?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - de</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-embeddings-v2-base-zh?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - zh</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-embeddings-v2-base-es?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - es</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-embeddings-v2-base-en?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Embeddings v2 Base - en</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-reranker-v1-base-en?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Reranker v1 Base - en</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-reranker-v1-turbo-en?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Reranker v1 Turbo - en</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-reranker-v1-tiny-en?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina Reranker v1 Tiny - en</a></li><li><a href=\"https://azuremarketplace.microsoft.com/en-us/marketplace/apps/jinaai.jina-colbert-v1-en?tab=Overview&ref=jina-ai-gmbh.ghost.io\">Jina ColBERT v1 - en</a></li></ol><h2 id=\"built-for-privacy-and-performance\">为隐私和性能而构建</h2><p>确保您的数据安全是我们的首要任务。我们与 Azure 的合作使我们能够提供满足数据隐私和效率需求的 AI 解决方案。Azure 无与伦比的隐私标准确保了对您数据的最严格保护，使其成为医疗保健、金融和其他需要关键数据保护的行业的可信平台。如果您是 Azure 的现有客户，那么您可以通过现有订阅获得 Jina AI 最先进的<a href=\"https://jina.ai/news/jina-ai-launches-worlds-first-open-source-8k-text-embedding-rivaling-openai/?ref=jina-ai-gmbh.ghost.io\">嵌入</a>和<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\">重排序</a>模型的所有优势。</p><h2 id=\"seamless-integration-and-high-scalability\">无缝集成和高可扩展性</h2><p>在 Azure 上部署不仅确保了隐私，还为您提供了与现有 Azure 服务的无缝集成。这提供了平滑的过渡，并允许您扩展 AI 部署，以满足波动的需求，同时不影响性能。</p><h2 id=\"get-started-with-azure\">Azure 入门</h2><p>在本教程中，我们将创建一个音乐搜索应用。我们想要使用模糊查询而不是歌曲的确切标题来搜索，这真正考验了我们<a href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io#enterprises\">搜索底座模型</a>的质量。</p><p>为此，第一步是在 Azure 上设置所有内容。</p><h3 id=\"sign-up-for-azure\">注册 Azure</h3><p>确保您拥有带有有效付款方式的 Azure 账户订阅。如果您还没有账户，可以在 <a href=\"https://azure.microsoft.com/en-us/free?ref=jina-ai-gmbh.ghost.io\">Azure 首页</a>注册。</p><h3 id=\"deploying-jina-models-on-azure\">在 Azure 上部署 Jina 模型</h3><p>在 <a href=\"https://azuremarketplace.microsoft.com/en-us/?ref=jina-ai-gmbh.ghost.io\">Azure Marketplace</a> 上，您可以通过搜索\"jina\"找到所有 Jina AI 的嵌入和重排序模型。从中选择最适合您需求的模型。</p><figure class=\"kg-card kg-image-card\"><img src=\"https://hackmd.io/_uploads/Bk7koSpeC.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-17 at 15.12.54\" loading=\"lazy\" width=\"674\" height=\"526\"></figure><p>在部署设置的基本选项卡中，您需要提供有关部署的一些详细信息。默认配置设置为使用四个 CPU 核心和 8GB 内存。根据您的具体需求，您可以调整这些设置以更好地满足您的应用需求。</p><figure class=\"kg-card kg-image-card\"><img src=\"https://hackmd.io/_uploads/S1i3uBSWC.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-23 at 16.41.29\" loading=\"lazy\" width=\"729\" height=\"588\"></figure><p>这将开始部署。可能需要几分钟时间。之后，您应该看到以下屏幕：</p><figure class=\"kg-card kg-image-card\"><img src=\"https://hackmd.io/_uploads/HJJn3rpeR.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-17 at 15.16.21\" loading=\"lazy\" width=\"1693\" height=\"1139\"></figure><p>您的模型现在已部署并准备使用。</p><h2 id=\"tutorial-search-for-songs\">教程：搜索歌曲</h2><p>在本教程中，您将使用 Azure 部署来为流行音乐数据文件集合构建一个基本搜索引擎。</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">💡</div><div class=\"kg-callout-text\">您也可以在 <a href=\"https://colab.research.google.com/drive/1ciuZiG_E8WFUAtx1hvTkVUIKT4LafSbm?usp=sharing&ref=jina-ai-gmbh.ghost.io\">Colab</a> 上跟随本教程或<a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/azure/embeddings-reranker.ipynb?ref=jina-ai-gmbh.ghost.io\">下载它</a>并在您自己的笔记本中运行。</div></div><h3 id=\"load-the-dataset\">加载数据集</h3><pre><code class=\"language-python\">from datasets import load_dataset\n\ndataset = load_dataset(\"sander-wood/wikimusictext\")\n</code></pre><p>这将加载 WikiMusicText（<a href=\"https://huggingface.co/datasets/sander-wood/wikimusictext?ref=jina-ai-gmbh.ghost.io\">WikiMT</a>）数据集。</p><h3 id=\"start-jina-embeddings-v2-and-reranker-endpoints\">启动 Jina Embeddings v2 和 Reranker 端点</h3><p>首先，在 Azure 门户中部署嵌入和重排序端点。您需要决定使用哪个区域，并为嵌入服务和重排序服务分别分配一个 DNS 前缀。然后，在下面的代码中将该信息存储在变量 <code>embeddings_url</code> 和 <code>reranker_url</code> 中。</p><p>函数 <code>jina_embed</code> 和 <code>jina_rerank</code> 通过向 Azure 上托管的 API 发出请求来生成文本嵌入和执行重排序。</p><pre><code class=\"language-Python\">import json\n\nimport requests\n\nembeddings_url = \"http://&lt;Your DNS prefix&gt;.&lt;Your region&gt;.azurecontainer.io:8080/invocations\"\nreranker_url = \"http://&lt;Your DNS prefix&gt;.&lt;Your region&gt;.azurecontainer.io:8080/invocations\"\n\ndef jina_embed(text):\n    headers = {\"Content-Type\": \"application/json\"}\n    json_data = {\"data\": [{\"text\": text}]}\n\n    response = requests.post(embeddings_url, headers=headers, data=json.dumps(json_data))\n    return response.json()[\"data\"][0][\"embedding\"]\n\ndef jina_rerank(query, search_results):\n    headers = {\"Content-Type\": \"application/json\"}\n\n    json_data = {\n        \"data\": {\n            \"documents\": [\n                {\"text\": search_result[0]} for search_result in search_results\n            ],\n            \"query\": query,\n            \"top_n\": 3,\n        }\n    }\n\n    response = requests.post(reranker_url, headers=headers, data=json.dumps(json_data))\n    return response.json()[\"data\"][0][\"results\"]\n</code></pre><h3 id=\"load-the-dataset-1\">加载数据集</h3><p>这些数据是为 AI 模型训练所收集的，因此将数据分为训练集和测试集。为简单起见，在本教程中我们只使用训练数据。以下代码将训练数据转换为 <code>pandas</code> DataFrame：</p><pre><code class=\"language-Python\">ds = dataset['train']\ninput_df = ds.dataset.to_pandas()\n</code></pre><h3 id=\"generate-embeddings-and-make-an-index-in-faiss\">生成嵌入并在 FAISS 中创建索引</h3><p>此函数处理文本数据并以嵌入的形式提取特征。这将需要一些时间。</p><pre><code class=\"language-Python\">import numpy as np\nfrom tqdm import tqdm\n\ntqdm.pandas()\n\n\ndef generate_embeddings(input_df):\n    all_embeddings = []\n\n    for t in input_df.text:\n        review_embeddings = []\n        all_embeddings.append(np.array(jina_embed(t)))\n\n    input_df[\"embeddings\"] = all_embeddings\n\n    return input_df\n\n\nenhanced_dataframe = generate_embeddings(input_df)\n</code></pre><p>此代码遍历 DataFrame 的 <code>text</code> 列中的每个条目，并调用 <code>jina_embed()</code> 获取嵌入。我们将嵌入以 NumPy 数组的形式存储在 <code>all_embeddings</code> 列表中。然后将它们添加到 DataFrame 的一个名为 <code>embeddings</code> 的新列中。</p><p>我们可以通过打印 <code>enhanced_dataframe</code> 的值来可视化我们刚才所做的事情：</p><figure class=\"kg-card kg-image-card\"><img src=\"https://hackmd.io/_uploads/rk_IR2mZ0.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-22 at 12.39.07\" loading=\"lazy\" width=\"1476\" height=\"419\"></figure><p>最后一列以可读形式包含了嵌入。</p><p>现在我们需要创建一个 FAISS（<a href=\"https://faiss.ai/?ref=jina-ai-gmbh.ghost.io\">Facebook AI Similarity Search</a>）索引来存储和搜索嵌入：</p><pre><code class=\"language-Python\">import faiss\n\ndim = 768  # dimension of Jina v2 embeddings\nindex_with_ids = faiss.IndexIDMap(faiss.IndexFlatIP(dim))\n\nfor idx, row in enhanced_dataframe.iterrows():\n    embeddings = row[\"embeddings\"]\n    normalized_embedding = np.ascontiguousarray(\n        np.array(embeddings, dtype=\"float32\").reshape(1, -1)\n    )\n    faiss.normalize_L2(normalized_embedding)\n    index_with_ids.add_with_ids(normalized_embedding, idx)\n</code></pre><p>此代码还对嵌入向量进行归一化，以简化和加快搜索速度。</p><h3 id=\"retrieve-matches-for-query\">检索查询的匹配项</h3><p>函数 <code>find_similar_texts</code> 在您刚刚创建的索引中搜索最接近的匹配项：</p><pre><code class=\"language-Python\">def find_similar_texts(query, n=20):\n    query_embedding = jina_embed(query)\n    query_embedding = np.ascontiguousarray(\n        np.array(query_embedding, dtype=\"float32\").reshape(1, -1)\n    )\n    faiss.normalize_L2(query_embedding)\n\n    similarities, indices = index_with_ids.search(query_embedding, n)\n\n    results = []\n    for i in range(n):\n        similarity = similarities[0][i]\n        index_id = indices[0][i]\n        results.append((enhanced_dataframe.loc[index_id, \"text\"], similarity))\n\n    return results\n\n</code></pre><h3 id=\"rerank-to-get-most-relevant-matches\">重排序以获取最相关的匹配项</h3><p>从 FAISS 索引检索结果后，我们将把结果集发送到 <code>jina_rerank</code> 函数，为所有答案分配相关性分数，并返回按相关性排序的结果列表。</p><p>让我们使用一个需要大量语义理解的查询来测试我们的解决方案：</p><pre><code class=\"language-Python\">query = \"What are some jazz songs that reached the top of the music charts in 1960s?\"\nsearch_results = find_similar_texts(query)\n\nmost_relevant_results = jina_rerank(query, search_results)\npprint.pprint(most_relevant_results)\n\n</code></pre><p>以下是最相关的结果：</p><pre><code class=\"language-Python\">[{'id': 'c26a67d979cb73474e9f80221b14b5c9',\n  'index': 0,\n  'document': {'id': 'd2183fd857661fbf9ca60a22e91888a0',\n   'text': 'An instrumental version by Heywood and Hugo Winterhalter reached No. 2 on the Billboard Hot 100 chart and No. 7 on the R&amp;B chart in 1956. A version sung by Andy Williams was also popular that year. The tune has been covered by a number of jazz performers beginning in the 1960s.'},\n  'relevance_score': 0.7132052183151245,\n  'usage': {'id': '037b9d22a5f13b68258ab51cbab1a7ad', 'total_tokens': 64}},\n {'id': 'a9205e69a4e76ca49717b8497a2798bf',\n  'index': 4,\n  'document': {'id': '25e78e92da17f01df111a7ed2716b057',\n   'text': '\"Take Five\" is a jazz standard composed by Paul Desmond and originally recorded by the Dave Brubeck Quartet for their album Time Out on July 1, 1959. Two years later it became a surprise hit and the biggest-selling jazz single ever. The single was inducted into the Grammy Hall of Fame in 1996. It became the first jazz single to surpass a million in sales.'},\n  'relevance_score': 0.204337015748024,\n  'usage': {'id': '6d55f32b339b83350ffb9489fbf31f5d', 'total_tokens': 80}},\n {'id': '50a610653b307f6f1ae6ec796b72ca83',\n  'index': 9,\n  'document': {'id': '70278633234c32775b1a28b364f6783a',\n   'text': 'Oh, You Crazy Moon is a jazz standard by Jimmy Van Heusen, with lyrics by Johnny Burke. It was recorded by Mel Torme in 1960 and Frank Sinatra in 1965.'},\n  'relevance_score': 0.16270869970321655,\n  'usage': {'id': '79eabc46bf3c659d3ad3e4d4d7e7a8f2', 'total_tokens': 40}}]\n</code></pre><p>就是这样了。您可以尝试使用不同的查询，看看会得到什么样的结果。</p><h2 id=\"jina-embeddings-and-rerankers-enterprise-ready-ai-on-azure\">Jina Embeddings 和 Rerankers：Azure 上的企业级 AI</h2><p>Jina AI 致力于为企业带来最先进的 AI，用于企业所需的实际应用。将我们的模型放在 Azure Marketplace 上消除了将 AI 添加到业务流程的障碍，使集成变得简单，并作为现有 Azure 计划的一部分对您计费。</p><p>我们重视所有正在使用或考虑使用 <a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\">Jina Embeddings</a> 和 <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\">Jina Reranker</a> 的用户的意见。您可以通过<a href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io\">我们的网站</a>联系我们，或加入我们的 <a href=\"https://discord.jina.ai/?ref=jina-ai-gmbh.ghost.io\">Discord 频道</a>分享反馈，并及时了解 Jina AI 快速发展的产品。我们相信包容性的 AI 生态系统，很乐意与您讨论您的使用场景。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Jina AI - Your Search Foundation, Supercharged.</div><div class=\"kg-bookmark-description\">Jina AI offers best-in-class embeddings, reranker and prompt optimizer, enabling advanced multimodal AI.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"><span class=\"kg-bookmark-author\">Your Search Foundation, Supercharged.</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner.png\" alt=\"\"></div></a></figure><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://discord.jina.ai/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Join the Jina AI Discord Server!</div><div class=\"kg-bookmark-description\">Check out the Jina AI community on Discord - hang out with 4981 other members and enjoy free voice and text chat.</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://static.ghost.org/v5.0.0/images/link-icon.svg\" alt=\"\"><span class=\"kg-bookmark-author\">Discord</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://cdn.discordapp.com/splashes/1106542220112302130/80f2c2128aefeb55209a5bdb2130bb92.jpg?size=512\" alt=\"\"></div></a></figure>",
  "comment_id": "662f563fda339c0001574205",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_531a49fb5bbbe8ebd6325b091e753f53.jpeg",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-04-29T10:11:43.000+02:00",
  "updated_at": "2024-04-29T20:09:58.000+02:00",
  "published_at": "2024-04-29T16:00:30.000+02:00",
  "custom_excerpt": "Jina Embeddings and Rerankers are now available on Azure Marketplace. Enterprises that prioritize privacy and security can now easily integrate Jina AI's state-of-the-art models right in their existing Azure ecosystem.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "643967708f2e0b003d559311",
      "name": "Susana Guzmán",
      "slug": "susana",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/04/WhatsApp-Image-2022-12-06-at-15.46.39.jpeg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": "Berlin",
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/susana/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "643967708f2e0b003d559311",
    "name": "Susana Guzmán",
    "slug": "susana",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/04/WhatsApp-Image-2022-12-06-at-15.46.39.jpeg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": "Berlin",
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/susana/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/jina-embeddings-and-reranker-on-azure-scalable-business-ready-ai-solutions/",
  "excerpt": "Jina Embeddings 和 Rerankers 现已在 Azure Marketplace 上线。重视隐私和安全的企业现在可以在其现有的 Azure 生态系统中轻松集成 Jina AI 的最先进模型。",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Futuristic black background with a purple 3D grid, featuring the \"Embeddings\" and \"Reranker\" logos with a stylized \"A\".",
  "feature_image_caption": null
}
{
  "slug": "precise-rag-with-jina-reranker-and-llamaindex",
  "id": "65e97909b22368000152a4c7",
  "uuid": "3bcc0e9b-38b1-4df4-bcf7-dbe893156630",
  "title": "使用 Jina Reranker 和 LlamaIndex 实现精确的 RAG",
  "html": "<p>虽然像 <a href=\"https://www.sbert.net/examples/applications/cross-encoder/README.html?ref=jina-ai-gmbh.ghost.io\"><u>bi-encoder 模型</u></a>（例如 <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>）可以从预先计算的嵌入数据库中快速检索到许多匹配文档，但重排序模型可以通过使用较慢但更精确的方法对用户的查询和检索到的文档进行交叉编码来细化这个集合。Jina AI 已经<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>发布了我们的第一个重排序模型</u></a>，<code>jina-reranker-v1-base-en</code>。在本文中，我们将深入探讨为什么重排序器对于优化 RAG 准确性至关重要，以及如何使用 <a href=\"https://jina.ai/embeddings/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings</u></a>/<a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Reranker</u></a>、<a href=\"https://www.llamaindex.ai/?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> 和 <code>Mixtral-8x7B-Instruct-v0.1</code> 语言模型（<a href=\"https://huggingface.co/mistralai/Mixtral-8x7B-Instruct-v0.1?ref=jina-ai-gmbh.ghost.io\"><u>托管在 HuggingFace 上</u></a>）来构建一个最先进的 RAG 系统。</p><p>你需要：</p><ul><li>一个 <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>Jina Embeddings 和 Reranker API 的组合密钥</u></a>。</li><li>一个 <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace 账户和令牌</u></a>。</li></ul><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">轻松提高搜索相关性和 RAG 准确性</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><p>由于 Jina Embeddings、Reranker 模型以及 Mixtral 都是远程运行并通过 RESTful API 访问的，你不需要任何特殊的硬件。</p><h2 id=\"what-is-a-reranker\">什么是重排序器？</h2><p>在继续教程之前，重要的是要首先了解重排序器是什么。为了全面理解重排序器的概念以及为什么 Jina Reranker V1 是你的最佳选择，我们建议你在继续之前阅读我们的 Jina Reranker V1 发布文章。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">使用 Jina Reranker 最大化搜索相关性和 RAG 准确性</div><div class=\"kg-bookmark-description\">使用 Jina Reranker 提升你的搜索和 RAG 准确性。我们的新模型比简单的向量搜索提高了 20% 的准确性和相关性。现在免费试用！</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>简而言之，重排序器是交叉编码器模型，它接收<em>文档-查询</em>对作为输入，并为该输入对生成一个综合相关性分数。使用重排序器，用户可以针对给定查询将文档从最相关到最不相关排序。</p><h2 id=\"why-use-jina-reranker-v1-base-en\">为什么使用 <code>jina-reranker-v1-base-en</code>？</h2><p>重排序提供了比仅使用嵌入模型更相关的信息。在我们的<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><u>模型发布文章</u></a>中，我们展示了 Jina Reranker 相比其开源和闭源竞争对手的优势，它可以将搜索系统的<strong>命中率提高 8%，</strong><a href=\"https://en.wikipedia.org/wiki/Mean_reciprocal_rank?ref=jina-ai-gmbh.ghost.io\"><strong><u>平均倒数排名</u></strong></a><strong>提高 33%</strong>。</p><p>这对通过 RAG 解决方案获得的响应质量有直接影响。有理论支持这一说法，我们将向你展示一个实际示例，让你亲眼看到 Jina Reranker 对使用 LlamaIndex 构建的 RAG 管道的影响。</p><h2 id=\"before-we-start-a-note-on-llamaindex-node-postprocessors\">开始之前：关于 LlamaIndex 节点后处理器的说明</h2><p><a href=\"https://docs.llamaindex.ai/en/stable/module_guides/querying/node_postprocessors/root.html?ref=jina-ai-gmbh.ghost.io\"><u>LlamaIndex</u></a> 中的节点后处理器是在检索之后、响应合成之前转换或过滤节点的模块。作为此包的一部分，LlamaIndex 既提供内置选项，也提供自定义添加的 API。</p><p><strong>Jina Reranker 现已</strong><a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><strong><u>集成</u></strong></a><strong>到 LlamaIndex 作为节点后处理器</strong>。为了提高响应准确性，检索到的节点基于与查询的相关性重新排序，并返回排名前 <strong><em>N</em></strong> 的节点。</p><h2 id=\"follow-along-on-google-colab\">在 Google Colab 上跟随学习</h2><p>本教程有一个配套的笔记本，你可以在 <a href=\"https://colab.research.google.com/github/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\"><u>Google Colab</u></a> 或本地运行。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://github.com/run-llama/llama_index/blob/main/docs/docs/examples/node_postprocessor/JinaRerank.ipynb?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">llama_index/docs/docs/examples/node_postprocessor/JinaRerank.ipynb at main · run-llama/llama_index</div><div class=\"kg-bookmark-description\">LlamaIndex 是你的 LLM 应用程序的数据框架 - run-llama/llama_index</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://github.githubassets.com/assets/pinned-octocat-093da3e6fa40.svg\" alt=\"\"><span class=\"kg-bookmark-author\">GitHub</span><span class=\"kg-bookmark-publisher\">run-llama</span></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://opengraph.githubassets.com/2000e9ce9c43753a6316de82e8309737edaa6377de7b47d2d8b08a4a3caa8a71/run-llama/llama_index\" alt=\"\"></div></a></figure><h3 id=\"the-dataset-2024-nike-kids-product-catalog\">数据集：2024 年耐克儿童产品目录</h3><p>为了展示 Jina Reranker 对 RAG 应用程序的性能提升，我们选择了 <a href=\"https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&ref=jina-ai-gmbh.ghost.io\"><u>2024 年耐克儿童产品目录</u></a>作为我们的数据集。该文档包含了耐克 2024 年提供的儿童产品结构化集合。我们选择这个数据集是因为它清晰地展示了使用重排序器的效果，并且与大多数用户相关。</p><h3 id=\"install-the-prerequisites\">安装先决条件</h3><p>要安装所需的依赖，请运行：</p><pre><code class=\"language-bash\">pip install llama-index-postprocessor-jinaai-rerank\npip install llama-index-embeddings-jinaai\npip install llama-index\npip install llama-index-llms-huggingface\npip install \"huggingface_hub[inference]\"</code></pre><h3 id=\"access-mixtral-llm\">访问 Mixtral LLM</h3><p>要使用 <code>Mixtral-8x7B-Instruct-v0.1</code> LLM，你需要一个 <a href=\"https://huggingface.co/settings/tokens?ref=jina-ai-gmbh.ghost.io\"><u>HuggingFace</u></a> 令牌。</p><pre><code class=\"language-Python\">from llama_index.llms.huggingface import HuggingFaceInferenceAPI\n\nhf_inference_api_key = \"&lt;在此处填入你的 HuggingFace 访问令牌&gt;\"\n\nmixtral_llm = HuggingFaceInferenceAPI(\n    model_name=\"mistralai/Mixtral-8x7B-Instruct-v0.1\",\n    token=hf_inference_api_key,\n)\n</code></pre><h3 id=\"access-jina-embeddings-and-jina-reranker\">访问 Jina Embeddings 和 Jina Reranker</h3><p>要使用我们的 Jina Embeddings 和 Jina Reranker，你需要一个专用的 <a href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><u>API 密钥</u></a>。将其存储在名为 <code>api_key</code> 的变量中，并从 LlamaIndex 调用 Jina Embeddings 模型：</p><pre><code class=\"language-Python\">from llama_index.embeddings.jinaai import JinaEmbedding\n\napi_key = \"&lt;在此处填入你的 Jina 密钥&gt;\"\njina_embeddings = JinaEmbedding(api_key=api_key)</code></pre><p>类似地，你可以调用 Jina Reranker 模型。通过设置 <code>top_n</code> 参数，你可以决定在最终输出中返回多少个最相关的文档。在这种情况下，我们设置<code>top_n=2</code>:</p><pre><code class=\"language-Python\">from llama_index.postprocessor.jinaai_rerank import JinaRerank\n\njina_rerank = JinaRerank(api_key=api_key, top_n=2)</code></pre><h3 id=\"download-the-2024-nike-kids-product-catalog\">下载 2024 年 Nike 儿童产品目录</h3><p>运行以下代码来下载数据：</p><pre><code class=\"language-Python\">from llama_index.core import SimpleDirectoryReader\nimport requests\n\nurl = '&lt;https://niketeam-asset-download.nike.net/catalogs/2024/2024_Nike%20Kids_02_09_24.pdf?cb=09302022&gt;'\nresponse = requests.get(url)\n\nwith open('Nike_Catalog.pdf', 'wb') as f:\n&nbsp;&nbsp;&nbsp;&nbsp;f.write(response.content)\n\nreader = SimpleDirectoryReader(\n&nbsp;&nbsp;&nbsp;&nbsp;input_files=[\"Nike_Catalog.pdf\"]\n)\n\ndocuments = reader.load_data()</code></pre><h3 id=\"generate-and-index-embeddings-with-jina-embeddings\">使用 Jina Embeddings 生成和索引嵌入向量</h3><p>现在设置已完成，我们将生成嵌入向量（节点）并对其建立索引。Jina Embeddings v2 模型接受最多 8192 个 token 的输入，对于这样的文档来说足够大，我们不需要进行任何额外的文本分段或检查任何部分是否包含太多 token。运行以下代码来嵌入和索引文档：</p><pre><code class=\"language-Python\">from llama_index.core import VectorStoreIndex\n\nindex = VectorStoreIndex.from_documents(\n&nbsp;&nbsp;&nbsp;&nbsp;documents=documents, embed_model=jina_embeddings\n)</code></pre><h3 id=\"query-for-results-without-jina-reranker\">不使用 Jina Reranker 进行查询</h3><p>当我们从这组文本中查询特定信息时，LlamaIndex 的 <code>query_engine</code> 会执行以下操作：</p><ol><li>使用 Jina Embeddings V2 为查询创建嵌入向量。</li><li>使用索引获取与查询嵌入向量余弦相似度最高的前 <code>top_k = 10</code> 个存储嵌入向量，并返回其在索引中的位置。</li><li>在向量数据数组中查找相应的文本。</li></ol><p>让我们询问在面料方面最好的 Nike 球衣是什么：</p><pre><code>query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p><strong>结果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; EQUIPMENT87NIKE BRASILIA SMALL DUFFEL 9.5&nbsp;\nDM3976 $37.00\nSIZES: Misc&nbsp; OFFER DATE: 07/01/22&nbsp; END DATE: 07/01/25\nTough 600D polyester • Durable 300D polyester • Detachable shoulder\nstrap&nbsp;• Ventilated shoe or wet/dry storage • Secure zip pocket • \nLimited lifetime guarantee&nbsp;• Screened Swoosh design trademark\nDIMENSIONS:&nbsp; 20\" L x 10\" W x 11\" H&nbsp;\n010 Black/Black/(White) 068 Iron Grey/Black/(White)\n...</code></pre><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/z2OKhAFnHCXw3aI4W1KUZNxzt8WOEERSG-prrBcmGwBEDTAFGavSN8eiHnvFF6R0L-dlwRUY3U8R7ysinoGTSSL-9_vr0RdCmrIRSy_xffvKz-Trqa1Yr49YGNb7R-GsDpCqilIW3cluVER4St5rUts\" class=\"kg-image\" alt=\"Three Nike Brasilia Small Duffel Bags, $37 each, in black, grey, navy with features listed and offer dates from 07/01/22 to 0\" loading=\"lazy\" width=\"594\" height=\"592\"></figure><h3 id=\"query-for-results-with-reranker\">使用 Reranker 进行查询</h3><p>现在我们想应用 reranker 来看看 RAG 应用是否会产生不同的、更加相关的结果。为此，我们需要将 <code>node_postprocessors</code> 添加到 <code>query_engine</code> 中：</p><pre><code class=\"language-Python\">query_engine = index.as_query_engine(\n&nbsp;&nbsp;&nbsp;&nbsp;similarity_top_k=10, llm=mixtral_llm, node_postprocessors=[jina_rerank]\n)\nresponse = query_engine.query(\n&nbsp;&nbsp;&nbsp;&nbsp;\"What are the best padded pants that Nike sells?\",\n)\n\nprint(response.source_nodes[0].text)</code></pre><p>注意，与之前不使用 reranker 的情况相比，<code>query_engine</code> 现在还包含了设置为 <code>[jina_rerank]</code> 的 <a href=\"https://docs.llamaindex.ai/en/stable/examples/node_postprocessor/JinaRerank.html?ref=jina-ai-gmbh.ghost.io\"><u>node_postprocessors</u></a> 参数。</p><p><strong>结果</strong>：</p><pre><code class=\"language-Text\">NIKE KIDS&nbsp; FOOTBALL – STOCK10\nDJ5731 $47.00\nSIZES:&nbsp; XS, S, M, L, XL, 2XL, 3XL\nFABRIC:&nbsp; Body/panels lining: 100% polyester. Pad: 100%\nethylene vinyl acetate.\nOFFER DATE:&nbsp; 04/01/23\nEND DATE:&nbsp; 04/01/27\nTake the field ready to give it your all in the Nike Recruit\nPants. They're made from lightweight, stretchy&nbsp;fabric with\nsweat-wicking power to help keep you dry and moving freely\nwhen the game heats up. With&nbsp;integrated pads shaped for a\ncomfortable fit, you'll be prepared for a performance you can\nbe proud of.&nbsp;Choose from 6 different colors to outfit your\nteam. Nike Dri-FIT technology moves sweat away from your&nbsp;skin\nfor quicker evaporation, helping you stay dry and comfortable.\nLightweight knit fabric stretches with&nbsp;you to let you move\nnaturally. Thigh, knee, hip and tailbone pads are shaped for\nan optimal fit, without&nbsp;compromising on coverage. A\nbody-hugging fit is designed to help keep the padding in place\nand close to&nbsp;the body. Belt at the waist lets you dial in your\nperfect fit to maximize comfort. Elastic at hems.\nHip width: 15\", Inseam length: 11.75\" (size medium).\n010 Black/(White) 060 Team Anthracite/(White) 100 White/(Black)\n419 Team Navy/(White) 493 Team Royal/(White) 657 Team Scarlet/(White)</code></pre><p></p><figure class=\"kg-card kg-image-card\"><img src=\"https://lh7-us.googleusercontent.com/X0ngGFoOz8S_KlRhAlQs4rOooKsV92d06-UBa7BsFPiTilgTD9xuQfgIblG7dTq0BQp4ZA9DlBCjFvA6D62eUVDmxxOO38va5mlnutPr4Zlu6l70tvbGtmrS2V0rpn-OE__tarMtR1MxAmD2oQ3m2qg\" class=\"kg-image\" alt=\"Product display of boys' Nike DF Stock Recruit Pants with sizes, pricing, and various color options highlighted.\" loading=\"lazy\" width=\"1600\" height=\"982\"></figure><h2 id=\"conclusion\"><strong>结论</strong></h2><p>正如我们所见，没有使用 reranker 的查询得到的排名最高的结果提到了\"透气网布背部\"和\"柔软触感的修身版型\"。相比之下，使用 reranker 后，我们得到的排名最高的结果具有\"专为最佳透气性设计\"、有\"能让你在比赛日压力下保持干爽凉爽的吸汗设计\"，并且采用\"轻便面料，宽松舒适的版型\"。</p><p>第二个结果更加准确，更符合我们的查询要求。通过我们最后两篇文章，我们从理论和实践角度都证明了在 RAG 管道中添加 Jina Reranker 可以提高检索准确性，改善从中获得的响应质量。</p>",
  "comment_id": "65e97909b22368000152a4c7",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/banner_Reranker_-LlamaIndex.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-03-07T09:21:29.000+01:00",
  "updated_at": "2024-04-02T11:12:49.000+02:00",
  "published_at": "2024-03-07T15:00:01.000+01:00",
  "custom_excerpt": "Just Rerank It! Jina Reranker and LlamaIndex take your RAG up to the next level.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    },
    {
      "id": "641c23a2f4d50d003d590474",
      "name": "Saahil Ognawala",
      "slug": "saahil",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2023/03/profile-option-2.jpg",
      "cover_image": null,
      "bio": "Senior Product Manager at Jina AI",
      "website": "http://www.saahilognawala.com/",
      "location": "Munich, DE",
      "facebook": null,
      "twitter": "@saahil",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/saahil/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "65e85e35b22368000152a4bf",
    "name": "Francesco Kruk",
    "slug": "francesco",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/precise-rag-with-jina-reranker-and-llamaindex/",
  "excerpt": "重新排序赢在突出！Jina Reranker 和 LlamaIndex 让你的 RAG 更上一层楼。",
  "reading_time": 7,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Collaborative graphic with \"RERANKER\" and \"Llamalindex\" logos over a purple background with crossed white abstract lines.",
  "feature_image_caption": null
}
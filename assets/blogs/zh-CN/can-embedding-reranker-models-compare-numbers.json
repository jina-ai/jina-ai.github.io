{
  "slug": "can-embedding-reranker-models-compare-numbers",
  "id": "66a15523ac62ce0001aa02c8",
  "uuid": "7e5e7622-20e9-4060-9b1d-8a3b4e2588ba",
  "title": "Embedding/Reranker 模型能比较数值大小吗？",
  "html": "<p>这是我今天在维也纳 ICML 会议上被问到的一个问题。</p><p>在咖啡休息时间，一位 Jina 用户向我提出了一个源自 LLM 社区最近讨论的问题。他问我们的 embedding 模型是否能判断出 9.11 <em>小于</em> 9.9，而许多 LLM 在这个任务中会得出相反的结论。</p><figure class=\"kg-card kg-embed-card\"><blockquote class=\"twitter-tweet\"><p lang=\"en\" dir=\"ltr\">9.11 is bigger than 9.9. <a href=\"https://t.co/zBrdLGAoH2?ref=jina-ai-gmbh.ghost.io\">pic.twitter.com/zBrdLGAoH2</a></p>— Riley Goodside (@goodside) <a href=\"https://twitter.com/goodside/status/1812977352085020680?ref_src=twsrc%5Etfw&ref=jina-ai-gmbh.ghost.io\">July 15, 2024</a></blockquote>\n<script async=\"\" src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script></figure><p>\"说实话，我不知道，\"我回答道。当他详细解释这个能力对他的应用程序的重要性，并提出<strong>分词可能是问题的根源</strong>时，我点头表示同意 —— 我的脑海中已经开始涌现进行实验以找出答案的想法。</p><p>在这篇文章中，我想测试我们的 embedding 模型 <code>jina-embeddings-v2-base-en</code>（2023 年 10 月发布）和 Reranker 模型 <code>jina-reranker-v2-multilingual</code>（2024 年 6 月发布）是否能准确比较数字。为了将测试范围扩展到 9.11 和 9.9 的简单比较之外，我设计了一系列包含各种类型数字的实验：小整数、大数、浮点数、负数、货币、日期和时间。目标是评估我们的模型在处理不同数字格式时的效果。</p><h2 id=\"experimental-setup\">实验设置</h2><p>完整实现可以在下面的 Colab 中找到：</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/11kUxYhHMLqYhw5HVKEYdHv0EfdZIyBBy?ref=jina-ai-gmbh.ghost.io#scrollTo=G7Cy9zSb2Ukg\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/7f9df66b1941b18be03f2115a7ab9255/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>实验设计相当简单。例如，要检查 embedding 模型是否理解 [1, 100] 之间的数字，步骤如下：</p><ol><li><strong>构建文档</strong>：为 <code>1</code> 到 <code>100</code> 的每个数字生成\"字符串字面量\"文档。</li><li><strong>调用 Embedding API</strong>：使用 <a href=\"https://jina.ai/embeddings?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Embedding API</a> 为每个文档获取 embedding。</li><li><strong>计算余弦相似度</strong>：计算每两个文档之间的成对余弦相似度，创建相似度矩阵。</li><li><strong>绘制散点图</strong>：使用散点图可视化结果。相似度矩阵中的每个元素 $(i, j)$ 映射到一个点，其中：X 轴：$(i - j)$；Y 轴：$(i, j)$ 的相似度值</li></ol><p>如果增量 $(i - j)$ 为零，即 $i = j$，则语义相似度应该最高。随着增量 $(i - j)$ 的增加，相似度应该降低。<strong>理想情况下，相似度应该与增量值成线性比例。</strong>如果我们观察不到这种线性关系，那么模型很可能无法理解数字，并可能产生诸如 9.11 大于 9.9 这样的错误。</p><p>Reranker 模型遵循类似的程序。主要区别在于我们遍历构建的文档，将每个文档设置为 <code>query</code>，在前面添加提示 <code>\"what is the closest item to...\"</code>，并将所有其他文档作为 <code>documents</code> 进行排序。<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">Reranker API</a> 返回的相关性分数直接用作语义相似度度量。核心实现如下所示。</p><pre><code class=\"language-python\">def rerank_documents(documents):\n    reranker_url = \"https://api.jina.ai/v1/rerank\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Initialize similarity matrix\n    similarity_matrix = np.zeros((len(documents), len(documents)))\n\n    for idx, d in enumerate(documents):\n        payload = {\n            \"model\": \"jina-reranker-v2-base-multilingual\",\n            \"query\": f\"what is the closest item to {d}?\",\n            \"top_n\": len(documents),\n            \"documents\": documents\n        }\n    ...</code></pre><h2 id=\"can-models-compare-numbers-between-1-2-3-100\">模型能否比较 [1, 2, 3, ..., 100] 之间的数字？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0-100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0-100---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">每个增量的散点图及其均值和方差。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(1, 101)]</span></code></p></figcaption></figure><h3 id=\"how-to-read-these-plots\">如何阅读这些图表</h3><p>在继续更多实验之前，让我先解释如何正确阅读这些图表。首先，从上面两张图中我的观察是，embedding 模型表现良好，而 reranker 模型表现不太理想。那么，我们在看什么，为什么会这样？</p><p>X 轴表示当我们从文档集合中均匀采样 $d_i$ 和 $d_j$ 时，索引 $(i,j)$ 的增量或 $i-j$。这个增量范围是 $[-100, 100]$。由于我们的文档集在构建时是有序的，即 $|i-j|$ 越小，$d_i$ 和 $d_j$ 在语义上越接近；$i$ 和 $j$ 相距越远，$d_i$ 和 $d_j$ 之间的相似度就越低。这就是为什么你会看到相似度（Y 轴表示）在 $X=0$ 处达到峰值，然后向左右两侧线性下降。</p><p>理想情况下，这应该形成一个尖峰或\"向上箭头\"形状，就像 <code>^</code>。但情况并非总是如此。如果你固定 X 轴上的一点，比如 $X=25$，沿着 Y 轴看，你会发现相似度值的范围从 0.80 到 0.95。这意味着，尽管增量都是 25，但 $\\mathrm{sim}(d_27, d_2)$ 可能是 0.81，而 $\\mathrm{sim}(d_42, d_17)$ 可能是 0.91。</p><p>青色趋势线显示了每个 X 值处的平均相似度及其标准差。另外，请注意相似度应该线性下降，因为我们的文档集是均匀间隔的，确保了相邻文档之间的等距间隔。</p><p>注意，embedding 图表<strong>总是对称的，并在 $X=0$ 处具有最大 Y 值 1.0</strong>。这是因为对于 $d_i$ 和 $d_j$ 来说，余弦相似度是对称的，且 $\\cos(0)=1$。</p><p>相反，reranker 图表<strong>总是不对称的</strong>，这是因为在 reranker 模型中查询和文档扮演不同的角色。<strong>最大值可能不是 1.0</strong>，因为 $X=0$ 意味着我们使用 reranker 计算 <code>\"what is the closest item to 4\"</code> 与 <code>\"4\"</code> 之间的相关性分数。仔细想想，没有保证 $X=0$ 会导致 Y 值最大。</p><h2 id=\"can-models-compare-negative-numbers-between10099981\">模型能否比较 [-100, -99, -98, ..., -1] 之间的负数？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---100--1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">每个增量的散点图及其均值和方差。左：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。这里我们想测试模型是否能在负数空间中判断语义相似度。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(-i) for i in range(1, 101)]</span></code></p></figcaption></figure><h2 id=\"can-models-compare-numbers-with-larger-intervals-1000-2000-3000-100000\">模型能否比较更大区间 [1000, 2000, 3000, ..., 100000] 的数字？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--1000-100000-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--1000-100000---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\"> 在这里，我们想测试模型在比较间隔为 1000 的数字时是否能判断语义相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i*1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-numbers-from-an-arbitrary-range-eg-376-377-378-476\">模型能否比较任意范围内的数字，例如 [376, 377, 378, ..., 476]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--376-476-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--376-476---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想测试模型是否能在任意范围内比较数字的语义相似性，所以我们将数字移到某个随机范围</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+375) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">。带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-large-numbers-between-4294967296-4294967297-4294967298-4294967396\">模型能否比较大数字 [4294967296, 4294967297, 4294967298, ..., 4294967396]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--4294967296-4294967396---1-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--4294967296-4294967396-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想测试模型在比较非常大的数字时是否能判断语义相似性。与上一个实验的思路类似，我们将范围进一步移至一个大数字。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i+4294967296) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-float-numbers-between-00001-00002-00003-01-wo-fixed-digits\">模型能否比较浮点数 [0.0001, 0.0002, 0.0003, ...,0.1]？（无固定位数）</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in--0.0001-0.01-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想测试模型在比较浮点数时是否能判断语义相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i/1000) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-currency-numbers-between-1-2-3-100\">模型能否比较货币数字 [$1, $2, $3, ..., $100]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-numbers-in---1---100-.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想测试模型在比较货币数字时是否能判断语义相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = ['$'+str(i) for i in range(1, 101)]</span></code><span style=\"white-space: pre-wrap;\">带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-date-between-2024-07-24-2024-07-25-2024-07-26-2024-10-31\">模型能否比较日期 [2024-07-24, 2024-07-25, 2024-07-26, ..., 2024-10-31]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-date-between-2024-07-24-and-2024-10-31.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想测试模型在比较 YYYY-MM-DD 格式的日期数字时是否能判断语义相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>today = datetime.today(); documents = [(today + timedelta(days=i)).strftime('%Y-%m-%d') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">带有每个增量均值和方差的散点图。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"can-models-compare-time-between-190007-190008-190009-203907\">模型能否比较时间 [19:00:07, 19:00:08, 19:00:09,..., 20:39:07]？</h2><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Delta-of-a-pair-of-date-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Delta-of-a-pair-of-time-between-19_00_07-and-20_39_07.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">在这里，我们想要测试模型在比较时间格式的数字时（即 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>hh:mm:ss</span></code><span style=\"white-space: pre-wrap;\">）是否能识别语义相似性。</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>now = datetime.now(); documents = [(now + timedelta(minutes=i)).strftime('%H:%M:%S') for i in range(100)]</span></code><span style=\"white-space: pre-wrap;\">散点图显示了每个差值的平均值和方差。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"observations\">观察结果</h2><p>以下是对上述图表的一些观察：</p><h3 id=\"reranker-models\"><strong>重排序模型</strong></h3><ul><li>重排序模型在比较数字方面表现欠佳。即使在最简单的 [1, 100] 范围内的数字比较中，其表现也不理想。</li><li>需要注意的是，我们在使用重排序器时采用了特殊的查询提示构造方式，即 <code>what is the closest item to x</code>，这可能也会影响结果。</li></ul><h3 id=\"embedding-models\"><strong>嵌入模型</strong></h3><ul><li>嵌入模型在比较 [1, 100] 范围内的小整数或 [-100, 1] 范围内的负数时表现相对较好。但当移动这个范围到其他值、增加更多间隔或处理更大或更小的浮点数时，其性能会显著下降。</li><li>在某些固定间隔（通常是每 10 步）可以观察到规律性的峰值。这种行为可能与分词器如何处理字符串有关，可能将字符串分词为\"10\"或\"1\"和\"0\"。</li></ul><h3 id=\"date-and-time-understanding\"><strong>日期和时间理解</strong></h3><ul><li>有趣的是，嵌入模型似乎对日期和时间有很好的理解，在大多数情况下能正确比较它们。在日期图中，每 30/31 步出现峰值，对应于每月的天数。在时间图中，每 60 步出现峰值，对应于每小时的分钟数。</li><li>重排序模型在某种程度上也能捕捉到这种理解。</li></ul><h3 id=\"visualizing-similarity-to-zero\">可视化与\"零\"的相似度</h3><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-text\">更新于 2024 年 7 月 29 日</div></div><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://colab.research.google.com/drive/1S9qZQ0jjdKLNUT2GKqPbU4ogpDe6g9Qh?ref=jina-ai-gmbh.ghost.io#scrollTo=nvAX2GOpCiRt\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Google Colab</div><div class=\"kg-bookmark-description\"></div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://ssl.gstatic.com/colaboratory-static/common/00df39d73993c0a4c5694ba86c20cc85/img/favicon.ico\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://colab.research.google.com/img/colab_favicon_256px.png\" alt=\"\"></div></a></figure><p>另一个可能更直观的实验是直接可视化任何数字与零（即原点）之间的相似度或相关性分数。通过将参考点固定为零的嵌入，我们想看看随着数字变大，语义相似度是否线性下降。对于重排序器，我们可以将查询固定为 <code>\"0\"</code> 或 <code>\"What is the closest number to number zero?\"</code>，并对所有数字进行排序，看看它们的相关性分数是否随着数字增大而减小。结果如下所示：</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/e-Embedding-representation.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/r-Rerank-Documents.svg\" width=\"960\" height=\"960\" loading=\"lazy\" alt=\"\"></div></div></div><figcaption><p dir=\"ltr\"><span style=\"white-space: pre-wrap;\">在这里，我们将\"原点嵌入\"固定为\"零\"的嵌入，并检查任何数字与零之间的语义相似度是否与该数字的值成比例。具体来说，我们使用 </span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>documents = [str(i) for i in range(2048)]</span></code><span style=\"white-space: pre-wrap;\">。图中显示了每个差值的散点图及其均值和方差。左图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-embeddings-v2-base-en</span></code><span style=\"white-space: pre-wrap;\">；右图：</span><code spellcheck=\"false\" style=\"white-space: pre-wrap;\"><span>jina-reranker-v2-multilingual</span></code><span style=\"white-space: pre-wrap;\">。</span></p></figcaption></figure><h2 id=\"conclusion\">结论</h2><p>本文展示了我们当前的嵌入和重排序模型如何处理数字比较。尽管实验设置相对简单，但它揭示了当前模型的一些基本缺陷，并为我们下一代嵌入和重排序器的开发提供了宝贵的见解。</p><p>决定模型是否能准确比较数字的两个关键因素是：</p><p><strong>首先，分词：</strong>如果词汇表只包含数字 0-9，那么 11 可能被分词为单独的 1 和 1，或作为单个标记 11。这种选择会影响模型对数值的理解。</p><figure class=\"kg-card kg-gallery-card kg-width-wide kg-card-hascaption\"><div class=\"kg-gallery-container\"><div class=\"kg-gallery-row\"><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg\" width=\"1520\" height=\"1430\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-10.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-10.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-10.jpg 1520w\" sizes=\"(min-width: 720px) 720px\"></div><div class=\"kg-gallery-image\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg\" width=\"1502\" height=\"1420\" loading=\"lazy\" alt=\"\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/07/Untitled-1234.jpg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/07/Untitled-1234.jpg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/07/Untitled-1234.jpg 1502w\" sizes=\"(min-width: 720px) 720px\"></div></div></div><figcaption><p><span style=\"white-space: pre-wrap;\">不同的分词器会导致对 9.11 的不同解释。这可能影响下游的上下文学习。来源：</span><a href=\"https://huggingface.co/spaces/Xenova/the-tokenizer-playground?ref=jina-ai-gmbh.ghost.io\"><span style=\"white-space: pre-wrap;\">HuggingFace 上的 The Tokenizer Playground</span></a></p></figcaption></figure><p><strong>其次，训练数据：</strong>训练语料库显著影响模型的数值推理能力。例如，如果训练数据主要包含软件文档或常见语义版本控制的 GitHub 仓库，模型可能会认为 9.11 大于 9.9，因为 9.11 是 9.9 之后的次要版本。</p><p>密集检索模型（如嵌入和重排序器）的算术能力对于涉及 RAG 和高级检索推理的任务至关重要。强大的数值推理能力可以显著提高搜索质量，特别是在处理像 JSON 这样的结构化数据时。</p>",
  "comment_id": "66a15523ac62ce0001aa02c8",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/07/number-heading.png",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-07-24T21:25:23.000+02:00",
  "updated_at": "2024-07-29T18:47:03.000+02:00",
  "published_at": "2024-07-25T00:42:49.000+02:00",
  "custom_excerpt": "A lot of LLMs can't figure out that 9.11 is actually smaller than 9.9. Can our embedding and reranker models do any better?",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "633ffc6b393501004d1c8659",
      "name": "Han Xiao",
      "slug": "han",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
      "cover_image": null,
      "bio": "Founder & CEO of Jina AI",
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": "@hxiao",
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/han/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "633ffc6b393501004d1c8659",
    "name": "Han Xiao",
    "slug": "han",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2022/10/Untitled-2.png",
    "cover_image": null,
    "bio": "Founder & CEO of Jina AI",
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": "@hxiao",
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/han/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/can-embedding-reranker-models-compare-numbers/",
  "excerpt": "许多大语言模型都无法理解 9.11 实际上小于 9.9。我们的 embedding 和 reranker 模型在这方面表现能否更好？",
  "reading_time": 10,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Rows of numbered wooden pieces on a white background, ranging from single digits to high numbers.",
  "feature_image_caption": null
}
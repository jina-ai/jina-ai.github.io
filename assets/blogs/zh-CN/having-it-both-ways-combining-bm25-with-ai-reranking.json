{
  "slug": "having-it-both-ways-combining-bm25-with-ai-reranking",
  "id": "6628fe61da339c00015740b9",
  "uuid": "13ce7c1f-bcdf-4746-93dd-5095291a2ed8",
  "title": "兼得两全其美：BM25 结合 AI 重排序",
  "html": "<p>跟上新的信息检索技术固然重要，但同样重要的是不要破坏那些经过验证并已经展现出商业价值的组件。</p><p>尽管<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker?ref=jina-ai-gmbh.ghost.io\">AI 驱动的向量搜索</a>不断发展，但现实情况是大多数公司仍在依赖传统的搜索技术，通常使用 <a href=\"https://en.wikipedia.org/wiki/Okapi_BM25?ref=jina-ai-gmbh.ghost.io\">BM25 算法</a>的变体。这是一项可靠且经过时间考验的技术。切换到一个全新的系统不仅是一个重大步骤，而且往往不切实际，需要大量资源和彻底的运营改革。此外，BM25 是词法搜索引擎的基石，在 Elasticsearch 和 Solr 等广泛使用的搜索引擎平台中普遍应用。对于许多使用场景，它已经能够提供良好的结果。</p><p>因此，尽管有令人信服的证据表明基于 AI 的搜索能够<a href=\"https://db-engines.com/en/ranking_trend?ref=jina-ai-gmbh.ghost.io\" rel=\"noreferrer\">显著提高用户满意度和结果质量</a>，许多公司仍然对完全转向神经搜索持犹豫态度。</p><h2 id=\"retrieval-agnostic-neural-reranking\">检索无关的神经重排序</h2><p>Reranker 是搜索系统领域的一个突破性补充。它被设计用来提升现有搜索引擎（如 <a href=\"https://www.elastic.co/elasticsearch?ref=jina-ai-gmbh.ghost.io\">Elasticsearch</a>）的价值，作为一个额外的层级，像插件一样工作以提升搜索质量。它不需要知道它所连接的是什么类型的搜索技术，只需要接收匹配列表并重新排序以获得更好的结果。</p><p>Jina Reranker 为传统搜索技术增加了更深层次的理解能力。像 BM25 这样的算法在基于词频检索文档方面做得很好，但在根据用户意图评估所检索文本的含义方面却存在困难。这正是 AI 擅长的领域：Reranker 帮助产生更符合用户需求的结果。</p><p>因此，对于希望将 AI 模型的强大优势引入其搜索框架的企业来说，添加 Jina Reranker 可能是一个明智的决定，而且不会带来替换现有搜索底座设施的负担。这是关于优化搜索结果，使其不仅可以接受，而且卓越：更相关、更准确。</p><h2 id=\"why-jina-reranker\">为什么选择 Jina Reranker？</h2><p>在重排序模型中，<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">Jina Reranker 模型</a>以其在<a href=\"https://jina.ai/news/smaller-faster-cheaper-jina-rerankers-turbo-and-tiny?ref=jina-ai-gmbh.ghost.io\">性能基准测试</a>中的最先进成绩而<a href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\">脱颖而出</a>。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/news/maximizing-search-relevancy-and-rag-accuracy-with-jina-reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">使用 Jina Reranker 最大化搜索相关性和 RAG 准确性</div><div class=\"kg-bookmark-description\">使用 Jina Reranker 提升您的搜索和 RAG 准确性。我们的新模型相比简单的向量搜索提高了 20% 的准确性和相关性。立即免费试用！</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/02/Reranker1.png\" alt=\"\"></div></a></figure><p>在本文中，我们将展示如何为电子商务平台实现推荐系统。首先，我们将分析单独使用 BM25 检索器的性能。然后，我们将 Jina Reranker 添加到检索管道中，看看结果如何变得更相关和有效。</p><div class=\"kg-card kg-callout-card kg-callout-card-blue\"><div class=\"kg-callout-emoji\">💡</div><div class=\"kg-callout-text\">你可以在 <a href=\"https://colab.research.google.com/github/jina-ai/workshops/blob/main/notebooks/embeddings/bm25/Retrieval_Reranker.ipynb?ref=jina-ai-gmbh.ghost.io\">Colab</a> 上跟随操作或<a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/bm25/Retrieval_Reranker.ipynb?ref=jina-ai-gmbh.ghost.io\">下载 notebook</a>。</div></div><h2 id=\"add-jina-reranker-to-your-existing-workflow\">将 Jina Reranker 添加到现有工作流程中：</h2><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png\" class=\"kg-image\" alt=\"Screenshot 2024-04-08 at 11.44.21\" loading=\"lazy\" width=\"2000\" height=\"468\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 1000w, https://jina-ai-gmbh.ghost.io/content/images/size/w1600/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 1600w, https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_ead786ce675a16e1d2b30dcaf479c9f0.png 2000w\" sizes=\"(min-width: 720px) 720px\"></figure><p>以下是集成 Jina Reranker 的更新工作流程的细节：</p><ul><li><strong>初始检索</strong>：当输入查询时，BM25 搜索引擎主要根据查询词与文档的匹配来检索相关文档。</li><li><strong>重排序</strong>：<code>jina-reranker-v1-base-en</code> 接收这些初始结果，并使用最先进的 AI 根据用户的查询评估每个检索文档的相关性。</li><li><strong>返回结果</strong>：Jina Reranker 然后重新排序搜索结果，确保最相关的文档显示在顶部。</li></ul><p>我们的<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">易用的 API</a> 和全面的文档将指导您完成整个过程，只需对您的系统进行最小的更改。</p><figure class=\"kg-card kg-bookmark-card\"><a class=\"kg-bookmark-container\" href=\"https://jina.ai/reranker/?ref=jina-ai-gmbh.ghost.io\"><div class=\"kg-bookmark-content\"><div class=\"kg-bookmark-title\">Reranker API</div><div class=\"kg-bookmark-description\">轻松实现搜索相关性和 RAG 准确性的最大化</div><div class=\"kg-bookmark-metadata\"><img class=\"kg-bookmark-icon\" src=\"https://jina.ai/icons/favicon-128x128.png\" alt=\"\"></div></div><div class=\"kg-bookmark-thumbnail\"><img src=\"https://jina.ai/banner-reranker-api.png\" alt=\"\"></div></a></figure><h2 id=\"see-it-in-action-enhancing-e-commerce-search-with-jina-reranker\">实践展示：用 Jina Reranker 增强电子商务搜索</h2><figure class=\"kg-card kg-image-card kg-card-hascaption\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg\" class=\"kg-image\" alt=\"BM25+Rerank dark (1)\" loading=\"lazy\" width=\"1600\" height=\"900\" srcset=\"https://jina-ai-gmbh.ghost.io/content/images/size/w600/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 600w, https://jina-ai-gmbh.ghost.io/content/images/size/w1000/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 1000w, https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_25d8f98d26cab1a5375a4f3d8ffa9278-1.jpeg 1600w\" sizes=\"(min-width: 720px) 720px\"><figcaption><i><em class=\"italic\" style=\"white-space: pre-wrap;\">查询通过 BM25，检索到的文档由 Jina Reranker 优化。</em></i></figcaption></figure><p>让我们通过一个实际的电子商务示例来展示 Jina Reranker 在实际应用中的影响。这里的目标是基于用户的查询搜索产品列表。</p><p>为了说明这一点，我们将使用流行的 AI 搜索和编排框架 <a href=\"https://haystack.deepset.ai/?ref=jina-ai-gmbh.ghost.io\">Haystack by deepset</a> 设置两个搜索管道。第一个管道单独使用 BM25。第二个将 <code>jina-reranker-v1-base-en</code> 集成到 BM25 系统中。如果您有现有的 Elasticsearch 集群，可以轻松地用 <code>ElasticsearchDocumentStore</code> 替换 Haystack 的 <code>InMemoryDocumentStore</code> 组件来进行相同的实验。</p><p>我们将使用来自 Kaggle 的<a href=\"https://www.kaggle.com/datasets/kuchhbhi/fashion-ecommerce-data?ref=jina-ai-gmbh.ghost.io\">样本数据集</a>。您可以直接在<a href=\"https://raw.githubusercontent.com/jina-ai/workshops/main/notebooks/embeddings/bm25/fashion_data.csv?ref=jina-ai-gmbh.ghost.io\">这里</a>下载 CSV。这个并排比较展示了将 Jina Reranker 集成到搜索工作流程中带来的改进。</p><p>首先，安装所有必需的组件：</p><pre><code class=\"language-bash\">pip install --q haystack-ai jina-haystack\n</code></pre><p>将 Jina API Key 设置为环境变量。您可以在<a href=\"https://jina.ai/reranker?ref=jina-ai-gmbh.ghost.io\">这里</a>生成一个。</p><pre><code class=\"language-Python\">import os\nimport getpass\n\nos.environ[\"JINA_API_KEY\"] = getpass.getpass()\n</code></pre><p>根据产品名称查询产品。例如：</p><pre><code class=\"language-Python\">short_query = \"Nightwear for Women\"\n</code></pre><p>将每个 CSV 行转换为 <code>Document</code>:</p><pre><code class=\"language-Python\">import csv\nfrom haystack import Document\n\ndocuments = []\nwith open(\"fashion_data.csv\") as f:\n    data = csv.reader(f, delimiter=\";\")\n    for row in data:\n      row_text = ''.join(row)\n      row_doc = Document(content=row_text, meta={\"prod_id\": row[0], \"prod_image\": row[1]})\n      documents.append(row_doc)\n</code></pre><h2 id=\"pipeline-1-bm25-only\">Pipeline #1：仅使用 BM25</h2><pre><code class=\"language-Python\">from haystack import Pipeline\nfrom haystack.document_stores.types import DuplicatePolicy\nfrom haystack.document_stores.in_memory import InMemoryDocumentStore\nfrom haystack.components.retrievers.in_memory import InMemoryBM25Retriever\n\ndocument_store=InMemoryDocumentStore()\ndocument_store.write_documents(documents=documents, policy=DuplicatePolicy.OVERWRITE)\n\nretriever = InMemoryBM25Retriever(document_store=document_store)\n\nrag_pipeline = Pipeline()\nrag_pipeline.add_component(\"retriever\", retriever)\n</code></pre><pre><code class=\"language-Python\">result = rag_pipeline.run(\n            {\n                \"retriever\": {\"query\": query, \"top_k\": 50},\n            }\n        )\n\nfor doc in result[\"retriever\"][\"documents\"]:\n    print(\"Product ID:\", doc.meta[\"prod_id\"])\n    print(\"Product Image:\", doc.meta[\"prod_image\"])\n    print(\"Score:\", doc.score)\n    print(\"-\"*100)\n</code></pre><p>以下是 BM25 返回的 50 个结果的缩略图：<br></p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_f2dc26e35fe66ac84c1d641a47bebbce.png\" class=\"kg-image\" alt=\"image\" loading=\"lazy\" width=\"446\" height=\"1088\"></figure><p>我们可以看到，结果与睡衣相关，部分匹配查询，但最相关的匹配（网格中加粗的图片）似乎在 BM25 检索的众多产品中迷失了。在实践中，仅使用 BM25 意味着用户会在页面顶部看到主要不相关的结果。</p><h2 id=\"pipeline-2-bm25-jina-reranker\">Pipeline #2：BM25 + Jina Reranker</h2><p>以下脚本概述了如何逐步构建这个管道：</p><pre><code class=\"language-Python\">from haystack_integrations.components.rankers.jina import JinaRanker\n\nranker_retriever = InMemoryBM25Retriever(document_store=document_store)\n\nranker = JinaRanker()\n\nranker_pipeline = Pipeline()\nranker_pipeline.add_component(\"ranker_retriever\", ranker_retriever)\nranker_pipeline.add_component(\"ranker\", ranker)\n\nranker_pipeline.connect(\"ranker_retriever.documents\", \"ranker.documents\")\n</code></pre><pre><code class=\"language-Python\">result = ranker_pipeline.run(\n            {\n                \"ranker_retriever\": {\"query\": query, \"top_k\": 50},\n                \"ranker\": {\"query\": query, \"top_k\": 10},\n            }\n        )\n\nfor doc in result[\"ranker\"][\"documents\"]:\n    print(\"Product ID:\", doc.meta[\"prod_id\"])\n    print(\"Product Image:\", doc.meta[\"prod_image\"])\n    print(\"Score:\", doc.score)\n    print(\"-\"*100)\n</code></pre><p>以下是 Jina Reranker 返回的前 10 个结果：</p><figure class=\"kg-card kg-image-card\"><img src=\"https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_05929b0008a1ced2bf724dd8b89d0ec5.png\" class=\"kg-image\" alt=\"image\" loading=\"lazy\" width=\"442\" height=\"218\"></figure><p>与 BM25 相比，Jina Reranker 返回了更相关的结果集。在我们的电商环境中，这意味着更好的用户体验和更高的购买可能性。</p><h2 id=\"impact-of-integrating-jina-reranker-with-bm25\">将 Jina Reranker 与 BM25 集成的影响</h2><p>根据我们在电商领域的案例研究，很明显 Jina Reranker 与 Elasticsearch 等传统搜索引擎的集成标志着搜索技术的重大飞跃。以下是这种集成如何改善搜索体验的概述：</p><ul><li><strong>提升命中率</strong>：Jina Reranker 和传统搜索的融合显著提高了相关结果的频率。这使搜索过程更准确，更贴近用户查询。</li><li><strong>改善用户体验</strong>：搜索结果质量有明显提升。这表明 Jina Reranker 和 BM25 的组合能力更好地满足了用户的具体需求，提升了整体搜索体验。</li><li><strong>复杂查询的高精度</strong>：在处理困难搜索时，这种协同确保了对查询和相关内容更深入的理解。这转化为更精确、更准确的结果。</li></ul><h2 id=\"ready-to-elevate-your-search-experience\">准备提升您的搜索体验？</h2><p>Jina Reranker 是提高搜索结果相关性的理想解决方案。它可以无缝集成到您现有的搜索系统中，并且只需少量代码就能快速实现。</p><p>如果您对目前所读的内容感兴趣，并渴望看到 Jina Reranker 能带来的改变，为什么不试一试呢？开始您的旅程，亲身体验 <a href=\"https://jina.ai/?ref=jina-ai-gmbh.ghost.io\">Jina AI 的 Search Foundation 模型</a>在您自己环境中的变革力量。</p>",
  "comment_id": "6628fe61da339c00015740b9",
  "feature_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/upload_56e4debd659c41d7b40a33256ccdce6c.jpeg",
  "featured": false,
  "visibility": "public",
  "created_at": "2024-04-24T14:43:13.000+02:00",
  "updated_at": "2024-07-08T21:11:33.000+02:00",
  "published_at": "2024-04-24T15:38:08.000+02:00",
  "custom_excerpt": "Learn how to integrate Jina Reranker with lexical search engines to take advantage of superior semantic understanding while avoiding the downsides of migrating to a fully-fledged vector search infrastructure.",
  "codeinjection_head": null,
  "codeinjection_foot": null,
  "custom_template": null,
  "canonical_url": null,
  "authors": [
    {
      "id": "6620de1e7f510100015da95e",
      "name": "Yuting Zhang",
      "slug": "yuting",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/Yuting-Portrait-1.jpeg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/yuting/"
    },
    {
      "id": "65e85e35b22368000152a4bf",
      "name": "Francesco Kruk",
      "slug": "francesco",
      "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/03/Portrait-Picture_Low.jpg",
      "cover_image": null,
      "bio": null,
      "website": null,
      "location": null,
      "facebook": null,
      "twitter": null,
      "meta_title": null,
      "meta_description": null,
      "url": "https://jina-ai-gmbh.ghost.io/author/francesco/"
    }
  ],
  "tags": [
    {
      "id": "634a1a8ccebfc1003d8ab706",
      "name": "Tech Blog",
      "slug": "tech-blog",
      "description": null,
      "feature_image": null,
      "visibility": "public",
      "og_image": null,
      "og_title": null,
      "og_description": null,
      "twitter_image": null,
      "twitter_title": null,
      "twitter_description": null,
      "meta_title": null,
      "meta_description": null,
      "codeinjection_head": null,
      "codeinjection_foot": null,
      "canonical_url": null,
      "accent_color": null,
      "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
    }
  ],
  "primary_author": {
    "id": "6620de1e7f510100015da95e",
    "name": "Yuting Zhang",
    "slug": "yuting",
    "profile_image": "https://jina-ai-gmbh.ghost.io/content/images/2024/04/Yuting-Portrait-1.jpeg",
    "cover_image": null,
    "bio": null,
    "website": null,
    "location": null,
    "facebook": null,
    "twitter": null,
    "meta_title": null,
    "meta_description": null,
    "url": "https://jina-ai-gmbh.ghost.io/author/yuting/"
  },
  "primary_tag": {
    "id": "634a1a8ccebfc1003d8ab706",
    "name": "Tech Blog",
    "slug": "tech-blog",
    "description": null,
    "feature_image": null,
    "visibility": "public",
    "og_image": null,
    "og_title": null,
    "og_description": null,
    "twitter_image": null,
    "twitter_title": null,
    "twitter_description": null,
    "meta_title": null,
    "meta_description": null,
    "codeinjection_head": null,
    "codeinjection_foot": null,
    "canonical_url": null,
    "accent_color": null,
    "url": "https://jina-ai-gmbh.ghost.io/tag/tech-blog/"
  },
  "url": "https://jina-ai-gmbh.ghost.io/podcast/having-it-both-ways-combining-bm25-with-ai-reranking/",
  "excerpt": "了解如何将 Jina Reranker 与传统词法搜索引擎集成，以获得更优的语义理解能力，同时避免迁移到完整向量搜索底座设施所带来的不便。",
  "reading_time": 6,
  "access": true,
  "comments": false,
  "og_image": null,
  "og_title": null,
  "og_description": null,
  "twitter_image": null,
  "twitter_title": null,
  "twitter_description": null,
  "meta_title": null,
  "meta_description": null,
  "email_subject": null,
  "frontmatter": null,
  "feature_image_alt": "Black background embellished with binary code, featuring a central tech-inspired emblem with multicolored dots, BM25 tag, con",
  "feature_image_caption": null
}
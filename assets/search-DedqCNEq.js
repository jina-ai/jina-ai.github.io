import{dt as f,aN as y,ah as b,du as w,c0 as S}from"./index-B5Fh9r6K.js";import{u as C}from"./blogs-DDmd2Vqj.js";const L=f.value.map(t=>({...t,type:"product"}));var A=(t=>(t.PRODUCT="product",t.NEWS="news",t.COMPANY="company",t.ELLIPSIS="ellipsis",t.HEADER="header",t.SEPARATOR="separator",t.ON_PAGE_RAG="onPageRAG",t.ASK_SOLUTION="askSolution",t))(A||{});function m(t){return t.toLowerCase().replace(/[-_.,!?;:]/g," ").replace(/\s+/g," ").trim()}function P(t,i){const a=t.length,e=i.length,s=Array(a+1).fill(0).map(()=>Array(e+1).fill(0));for(let n=1;n<=a;n++)for(let o=1;o<=e;o++)t[n-1]===i[o-1]?s[n][o]=s[n-1][o-1]+1:s[n][o]=Math.max(s[n-1][o],s[n][o-1]);return s[a][e]}function d(t,i){const a=m(t),e=m(i);if(e.length>a.length)return 0;const n=P(a,e)/e.length*50;let o=0;return a.includes(e)&&(o+=30),a.split(" ").some(r=>r===e||r.startsWith(e+" ")||r.endsWith(" "+e))&&(o+=20),n+o}function k(t,i){if(!i.trim()||i.length<2)return[];const a=Math.min(40+i.length*2,60);return t.map(e=>{const s=d(e.label,i),n=d(e.description,i)*.7;return{score:Math.max(s,n),result:{type:"news",label:e.label,icon:e.icon,description:e.description,time:e.time,slug:e.slug}}}).filter(e=>e.score>=a).sort((e,s)=>s.score-e.score).map(e=>e.result)}function x(t,i,a){if(!i.length)return t;const e=[...t];e.length>0&&e.push({type:"separator"}),e.push({type:"header",label:"header.news",number:i.length});const s=i.slice(0,a);e.push(...s);const n=i.slice(a);return n.length>0&&e.push({type:"ellipsis",label:"header.see_all_news",number:n.length,moreResults:n}),e}const R=y("search",{state:()=>({answerChunks:"",isBusy:!1,isStreaming:!1,isComposing:!1,searchImmediate:!1}),getters:{},actions:{async composeResult(t){this.isComposing=!0;try{const i=C(),a=3,e=i.translatedAllBlogs.map(n=>({label:n.title,icon:n.featureImage,value:n.title,description:n.excerpt,time:b(n.publishedAt).format("MMMM DD, YYYY"),slug:n.slug,type:"news"}));let s=[];if(t){s.push({type:"onPageRAG",label:t}),s.push({type:"askSolution",label:t});const n=L.filter(r=>{const c=this.te(r.label)?this.t(r.label):r.label,h=this.te(r.description)?this.t(r.description):r.description;return c.toLowerCase().includes(t.toLowerCase())||h.toLowerCase().includes(t.toLowerCase())}).map(r=>({type:"product",label:r.label,icon:r.icon,link:r.link,description:r.description}));n.length&&(s.length&&s.push({type:"separator"}),s.push({label:"header.products",number:n.length,type:"header"}),s=s.concat(n.slice(0,a)),n.length>a&&s.push({label:"header.see_all_products",type:"ellipsis",number:n.length-a,moreResults:n.slice(a)}));const o=w.filter(r=>!r.external).filter(r=>this.t(r.label).toLowerCase().includes(t.toLowerCase())).map(r=>({type:"company",label:r.label,link:r.routerLink}));o.length&&(s.length&&s.push({type:"separator"}),s.push({label:"header.company",number:o.length,type:"header"}),s=s.concat(o.slice(0,a)),o.length>a&&s.push({label:"header.see_all_company",type:"ellipsis",number:o.length-a,moreResults:o.slice(a)}));const l=k(e,t);s=x(s,l,a)}return s}finally{this.isComposing=!1}},async search(t,i){var n,o;this.answerChunks="",this.isBusy=!0,this.isStreaming=!0;let a="";i==="onPageRAG"&&await fetch(`https://r.jina.ai/https://jina.ai${window.location.pathname}`).then(l=>l.text()).then(l=>{a=l});const e={parameters:{question:t,content:a}},s=i==="onPageRAG"?"https://api.promptperfect.jina.ai/BcHLFuKk3u9naJ4u4G1H":"https://api.promptperfect.jina.ai/EEBuotbLAugUDjr4mq1j";try{const l=await fetch(s,{headers:{"content-type":"application/json"},body:JSON.stringify(e),method:"POST"});if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);if((n=l.headers.get("content-type"))!=null&&n.includes("text/event-stream")){if(l.body){const r=l.body.getReader(),c=new TextDecoder;for(;;){const{done:h,value:p}=await r.read();if(h){this.isStreaming=!1;break}p&&(this.isBusy=!1,c.decode(p).split(`

`).forEach(g=>{const u=g.replace(/data: /g,"");u&&(this.answerChunks+=u)}))}}}else if((o=l.headers.get("content-type"))!=null&&o.includes("application/json")){const r=(await l.json()).data;this.answerChunks=r}else throw new Error("Unknown response type")}catch(l){S.create({color:"negative",message:this.t("landing_page.error",{message:l}),icon:"report_problem"})}finally{this.isBusy=!1}}}});export{A as R,R as u};

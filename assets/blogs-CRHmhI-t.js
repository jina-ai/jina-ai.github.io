import{aB as c,ai as o,d}from"./index-BPuhzzpH.js";const h=c("news",{state:()=>({authors:[],allBlogs:[],updatedAt:void 0,accessedAt:"",lastAccessedAt:"",initiating:!0,i18nMeta:{blogs:[],updatedAt:""}}),getters:{hasNewPost:s=>s.accessedAt?s.allBlogs.length?s.allBlogs.some(a=>new Date(a.publishedAt).getTime()>new Date(s.accessedAt).getTime()):!1:!0,featuredBlogs:s=>{const a=o();return s.allBlogs.filter(e=>e.featured).sort((e,t)=>new Date(t.publishedAt).getTime()-new Date(e.publishedAt).getTime()).map(e=>{const t=s.i18nMeta.blogs.find(l=>l.slug===e.slug&&l.lang===a.language);return{...e,title:(t==null?void 0:t.title)||e.title,excerpt:(t==null?void 0:t.excerpt)||e.excerpt}})},translatedAllBlogs:s=>{const a=o();return s.allBlogs.map(e=>{const t=s.i18nMeta.blogs.find(l=>l.slug===e.slug&&l.lang===a.language);return{...e,title:(t==null?void 0:t.title)||e.title,excerpt:(t==null?void 0:t.excerpt)||e.excerpt}})}},actions:{async getNews(s,a="authors,tags"){var l;const e=o();let t;if(e.language!==d){const i=await fetch(`/assets/blogs/${e.language}/${s}.json`);i.ok&&((l=i.headers.get("content-type"))!=null&&l.includes("application/json"))&&(t=await i.json())}if(!t){const i=await fetch(`https://jina-ai-gmbh.ghost.io/ghost/api/content/posts/slug/${s}/?${new URLSearchParams({key:"2652cf20335454671600707967",include:a})}`);if(i.ok){const{posts:g}=await i.json();g.length>0&&(t=g[0])}}if(t)return{id:t.id,url:t.url,html:t.html,excerpt:t.excerpt,featureImage:t.feature_image,featureImageAlt:t.feature_image_alt,publishedAt:t.published_at,updatedAt:t.updated_at,title:t.title,slug:t.slug,readingTime:t.reading_time,featured:t.featured,primaryTag:t.primary_tag,authors:t.authors.map(i=>({id:i.id,name:i.name,bio:i.bio,location:i.location,profileImage:i.profile_image,slug:i.slug,url:i.url,twitter:i.twitter})),tags:t.tags.map(i=>({id:i.id,name:i.name,slug:i.slug,url:i.url,visibility:i.visibility}))}},async getNewsList({filter:s,include:a="authors,tags",page:e,limit:t=6}){let l={include:a,limit:String(t),key:"2652cf20335454671600707967"};s!==void 0&&(l=Object.assign(l,{filter:s})),e!==void 0&&(l=Object.assign(l,{page:String(e)}));const i="https://jina-ai-gmbh.ghost.io/ghost/api/content/posts/?"+new URLSearchParams(l),g=await fetch(i),{posts:u}=await g.json();return u.map(n=>({id:n.id,url:n.url,html:n.html,excerpt:n.excerpt,featureImage:n.feature_image,featureImageAlt:n.feature_image_alt,publishedAt:n.published_at,updatedAt:n.updated_at,title:n.title,slug:n.slug,readingTime:n.reading_time,featured:n.featured,primaryTag:n.primary_tag,authors:n.authors.map(r=>({id:r.id,name:r.name,bio:r.bio,location:r.location,profileImage:r.profile_image,slug:r.slug,url:r.url,twitter:r.twitter})),tags:n.tags.map(r=>({id:r.id,name:r.name,slug:r.slug,url:r.url,visibility:r.visibility}))}))},async getSuggestionNews(s,a){var t;const e=[];if((t=a.tags)!=null&&t.length){const l=await this.getNewsList({limit:s,filter:`tag:${a.primaryTag.slug}+id:-${a.id}`,page:1});if(e.push(...l),e&&e.length<s){const g=await this.getNewsList({limit:"all",filter:`tag:-${a.primaryTag.slug}+id:-${a.id}`}),u=Math.floor(Math.random()*(g.length-1));e.push(...g.slice(u,u+s-e.length))}}else{const l=await this.getNewsList({limit:s,filter:`id:-${a.id}`,page:1});e.push(...l)}return e},async init(){try{this.initiating=!0,await this.getAllNews(),await this.getAuthors(),await this.getI18nMeta()}catch{}finally{this.initiating=!1}},async getI18nMeta(){var a;const s=await fetch("/assets/blogs/meta.json");if(s.ok&&((a=s.headers.get("content-type"))!=null&&a.includes("application/json"))){const e=await s.json();this.i18nMeta.blogs=e.blogs.map(t=>({lang:t.lang,slug:t.slug,translatedAt:t.translated_at,title:t.title,excerpt:t.excerpt})),this.i18nMeta.updatedAt=e.updated_at}},async getAllNews(){let s={limit:"all"};if(this.allBlogs.length>0&&this.updatedAt)s=Object.assign(s,{filter:`updated_at:>${this.updatedAt}`}),(await this.getNewsList(s)).reverse().forEach(e=>{const t=this.allBlogs.findIndex(l=>l.id===e.id);t!==-1?this.allBlogs[t]=e:this.allBlogs.unshift(e)});else{const a=await this.getNewsList(s);this.allBlogs=a}this.allBlogs=[...this.allBlogs.sort((a,e)=>new Date(e.publishedAt).getTime()-new Date(a.publishedAt).getTime())],this.updatedAt=new Date().toISOString()},async getAuthors(){const s="https://jina-ai-gmbh.ghost.io/ghost/api/content/authors/?"+new URLSearchParams({key:"2652cf20335454671600707967",limit:"all"}),a=await fetch(s),{authors:e}=await a.json();this.authors=e.map(t=>({id:t.id,name:t.name,bio:t.bio,location:t.location,profileImage:t.profile_image,slug:t.slug,url:t.url,twitter:t.twitter}))},async select(s){let a;return typeof s=="string"?a=[s]:a=s,this.allBlogs.filter(e=>a.some(t=>e.title.toLowerCase().includes(t.toLowerCase())))}},persist:{paths:["allBlogs","authors","updatedAt","accessedAt","lastAccessedAt"]}});export{h as u};

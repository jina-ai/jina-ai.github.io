<!DOCTYPE html><html lang="en"><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta property="og:title" content="Jina AI - a Neural Search Company"/><meta name="author" content="Jina AI"/><meta property="og:locale" content="en_US"/><meta property="og:site_name" content="Jina AI"/><meta property="og:image" content="https://jina.ai/assets/images/jina_banner_new.png"/><meta name="twitter:card" content="summary"/><meta property="twitter:image" content="https://jina.ai/assets/images/jina_banner_new.png"/><meta property="twitter:title" content="Jina AI - a Neural Search Company"/><meta name="twitter:site" content="@JinaAI_"/><meta name="twitter:creator" content="@Jina AI"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-96x96.png"/><link rel="icon" href="/favicon.ico"/><link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png"/><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700"/><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Open source neural search ecosystem for businesses and developers, allowing anyone to search any kind of data with high availability and scalability."/><meta property="og:url" content="https://jina.ai/"/><meta property="og:title" content="Jina AI | Jina AI is a Neural Search Company"/><meta property="og:description" content="Open source neural search ecosystem for businesses and developers, allowing anyone to search any kind of data with high availability and scalability."/><meta property="og:locale" content="en"/><meta property="og:site_name" content="Jina AI, Ltd"/><link rel="canonical" href="https://jina.ai/"/><title>Build a BERT-based Semantic Search System…For Star Trek | Jina AI</title><meta name="next-head-count" content="29"/><link rel="preload" href="/_next/static/css/d6299e18a01a0ac2808b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d6299e18a01a0ac2808b.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-8f6366ea4b5fafd77e96.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-94f262366e752bd48d82.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons-4667b98b62a60d7c050b.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-9a4182dc8e7736869bf9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-afcb035e0413b2214f0f.js" as="script"/><link rel="preload" href="/_next/static/chunks/596-13cdde2fb793b77184ee.js" as="script"/><link rel="preload" href="/_next/static/chunks/522-e45333ebcf36799b860c.js" as="script"/><link rel="preload" href="/_next/static/chunks/373-350caaa5387e56e8b807.js" as="script"/><link rel="preload" href="/_next/static/chunks/93-1a5bac9fdf2b2295fba2.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Bslug%5D-0d67fc13dbd9e7ddf27f.js" as="script"/><style id="__jsx-3792957869">.dropdown.jsx-3792957869{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));padding:1.5rem;--tw-text-opacity:1;color:rgba(74,85,104,var(--tw-text-opacity));top:5rem;width:24rem;border-radius:0.75rem;}.dropdown.jsx-3792957869>.jsx-3792957869:not([hidden])~.jsx-3792957869:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse));border-style:solid;--tw-divide-opacity:1;border-color:rgba(235,235,235,var(--tw-divide-opacity));}.dropdown.jsx-3792957869{box-shadow:3px 6px 33px rgba(205,205,205,0.25);}</style><style id="__jsx-3128403005">.dropdown.jsx-3128403005{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));--tw-text-opacity:1;color:rgba(74,85,104,var(--tw-text-opacity));top:5rem;width:100%;border-radius:0.75rem;}.dropdown.jsx-3128403005>.jsx-3128403005:not([hidden])~.jsx-3128403005:not([hidden]){--tw-divide-y-reverse:0;border-top-width:calc(1px * calc(1 - var(--tw-divide-y-reverse)));border-bottom-width:calc(1px * var(--tw-divide-y-reverse));border-style:solid;--tw-divide-opacity:1;border-color:rgba(235,235,235,var(--tw-divide-opacity));}</style><style id="__jsx-3949856645">.btn.jsx-3949856645{text-align:center;}.btn-base.jsx-3949856645{font-size:1.125rem;font-weight:600;}.btn-xl.jsx-3949856645{padding-top:1rem;padding-bottom:1rem;padding-left:1.5rem;padding-right:1.5rem;font-size:1.25rem;font-weight:800;}.btn-full-rounded.jsx-3949856645{border-radius:9999px;}.btn-primary.jsx-3949856645{border-radius:9999px;--tw-bg-opacity:1;background-color:rgba(0,129,129,var(--tw-bg-opacity));--tw-text-opacity:1;color:rgba(255,255,255,var(--tw-text-opacity));}.btn-primary.jsx-3949856645:hover{background-color:#009191;}.btn-secondary.jsx-3949856645{--tw-bg-opacity:1;background-color:rgba(251,203,103,var(--tw-bg-opacity));--tw-text-opacity:1;color:rgba(0,0,0,var(--tw-text-opacity));}.btn-secondary.jsx-3949856645:hover{background-color:#fbd076;}.btn-tertiary.jsx-3949856645{--tw-bg-opacity:1;background-color:rgba(255,255,255,var(--tw-bg-opacity));border:1px solid #999999;}.btn-tertiary.jsx-3949856645:hover{background-color:#f6f6f6;}.btn-outlined.jsx-3949856645{border-width:2px;border-style:solid;--tw-border-opacity:1;border-color:rgba(255,255,255,var(--tw-border-opacity));background-color:transparent;}.btn-outlined.jsx-3949856645:hover{background-color:#f6f6f622;}</style><style id="__jsx-223001487">.navbar.jsx-223001487 a{display:inline-block;width:100%;}.navbar.jsx-223001487 li:not(:first-child){margin-top:0.75rem;}.navbar.jsx-223001487 a .btn{width:100%;}.navbar.jsx-223001487 a:hover{--tw-text-opacity:1;color:rgba(0,129,129,var(--tw-text-opacity));}@media (min-width:640px){.navbar.jsx-223001487 a,.navbar.jsx-223001487 a .btn{width:auto;}.navbar.jsx-223001487 li:not(:first-child){margin-top:0px;}.navbar.jsx-223001487>(li:not(:last-child)){margin-right:1.25rem;}}</style><style id="__jsx-649517993">.top-nav-bar.jsx-649517993{box-shadow:3px 6px 33px 0px #cdcdcd40;z-index:200;position:fixed;width:100vw;background:white;top:0;}</style><style id="__jsx-4055754880">.markdown.jsx-4055754880{font-size:1.125rem;line-height:1.625;}.markdown.jsx-4055754880 p.jsx-4055754880,.markdown.jsx-4055754880 ul.jsx-4055754880,.markdown.jsx-4055754880 ol.jsx-4055754880,.markdown.jsx-4055754880 blockquote.jsx-4055754880{margin-top:1.5rem;margin-bottom:1.5rem;}.markdown.jsx-4055754880 h2.jsx-4055754880{margin-top:3rem;margin-bottom:1rem;font-size:1.875rem;line-height:1.375;}.markdown.jsx-4055754880 h3.jsx-4055754880{margin-top:2rem;margin-bottom:1rem;font-size:1.5rem;line-height:1.375;}</style><style id="__jsx-1324436386">.footer-links.jsx-1324436386 li{margin-top:0.25rem;}.footer-items-title.jsx-1324436386{font-size:1.375rem;line-height:1.5rem;-webkit-letter-spacing:0.22px;-moz-letter-spacing:0.22px;-ms-letter-spacing:0.22px;letter-spacing:0.22px;}</style><style id="__jsx-1956813867">.footer-left-margin.jsx-1956813867{width:20rem;height:inherit;background:no-repeat 40% 20% / 30% url('/assets/images/planet-beige.svg');}.footer-right-margin.jsx-1956813867{width:16rem;height:inherit;background:no-repeat 10% 10% / 50% url('/assets/images/planet-green.svg');}</style><style data-href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700">@font-face{font-family:'Poppins';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiEyp8kv8JHgFVrFJM.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLEj6V1g.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLCz7V1g.woff) format('woff')}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiEyp8kv8JHgFVrJJbecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiEyp8kv8JHgFVrJJnecnFHGPezSQ.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:400;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiEyp8kv8JHgFVrJJfecnFHGPc.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Poppins';font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLEj6Z11lFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLEj6Z1JlFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:600;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLEj6Z1xlFd2JQEk.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Poppins';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLCz7Z11lFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0900-097F,U+1CD0-1CF6,U+1CF8-1CF9,U+200C-200D,U+20A8,U+20B9,U+25CC,U+A830-A839,U+A8E0-A8FB}@font-face{font-family:'Poppins';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLCz7Z1JlFd2JQEl8qw.woff2) format('woff2');unicode-range:U+0100-024F,U+0259,U+1E00-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Poppins';font-style:normal;font-weight:700;src:url(https://fonts.gstatic.com/s/poppins/v15/pxiByp8kv8JHgFVrLCz7Z1xlFd2JQEk.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><script async="" src="https://www.googletagmanager.com/gtag/js?id=undefined"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'undefined', {
              page_path: window.location.pathname,
            });
          </script><body><div id="__next"><div class="jsx-649517993 top-nav-bar"><div class="md:max-w-screen-md lg:max-w-screen-lg xl:max-w-screen-2xl mx-auto px-3 py-6 undefined"><div class="jsx-223001487 flex flex-wrap justify-between items-center"><div class="jsx-223001487"><a class="jsx-223001487" href="/"><div class="text-gray-900 flex items-center font-semibold text-3xl"><img src="/assets/images/logo.svg" alt="Jina.ai logo" class="w-24"/></div></a></div><div class="jsx-223001487 sm:hidden"><button type="button" aria-label="show menu" class="jsx-223001487 p-3 text-gray-900 rounded-md hover:bg-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round" class="jsx-223001487 stroke-current h-6 w-6"><path d="M0 0h24v24H0z" stroke="none" class="jsx-223001487"></path><path d="M4 6h16M4 12h16M4 18h16" class="jsx-223001487"></path></svg></button></div><nav class="jsx-223001487 w-full sm:w-auto sm:block mt-2 sm:mt-0 hidden"><ul class="jsx-223001487 navbar flex flex-col sm:flex-row sm:items-center font-medium text-xl text-gray-800 pt-3 pb-5 px-5 sm:p-0 bg-white sm:bg-transparent rounded"><li class="jsx-649517993 hidden md:inline-block"><div class="jsx-3792957869 group inline-block relative"><button aria-label="Open Products dropdown" class="jsx-3792957869 text-gray-700 font-semibold py-2 px-4 rounded inline-flex items-center"><span class="jsx-3792957869 mr-1 font-bold">Products</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="jsx-3792957869 fill-current h-4 w-4 mt-2"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" class="jsx-3792957869"></path></svg></button><div class="jsx-3792957869 absolute hidden group-hover:block bg-transparent pt-7"><ul class="jsx-3792957869 dropdown"><li class="jsx-3792957869 hover:bg-gray-200"><a href="/core" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/core-icon.svg" alt="core icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Jina Core</span></div><span class="jsx-3792957869 text-xs text-gray-500">An open-source framework for building multimedia search applications.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/hub" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/hub-icon.svg" alt="hub icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Jina Hub</span></div><span class="jsx-3792957869 text-xs text-gray-500">Jina’s community-driven module marketplace for building your Flow</span></div></a></li></ul></div></div></li><li class="jsx-649517993 hidden md:inline-block"><div class="jsx-3792957869 group inline-block relative"><button aria-label="Open Developers dropdown" class="jsx-3792957869 text-gray-700 font-semibold py-2 px-4 rounded inline-flex items-center"><span class="jsx-3792957869 mr-1 font-bold">Developers</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="jsx-3792957869 fill-current h-4 w-4 mt-2"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" class="jsx-3792957869"></path></svg></button><div class="jsx-3792957869 absolute hidden group-hover:block bg-transparent pt-7"><ul class="jsx-3792957869 dropdown"><li class="jsx-3792957869 hover:bg-gray-200"><a href="/contribute" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/contribute-icon.svg" alt="contribute icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Contribute</span></div><span class="jsx-3792957869 text-xs text-gray-500">Want to shape the future of neural search? Find out how you can contribute to Jina here.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/join" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/join-icon.svg" alt="join icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Join</span></div><span class="jsx-3792957869 text-xs text-gray-500">Join the Jina Slack community to meet the team and get support.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/learn" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/learn-icon.svg" alt="learn icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Learn</span></div><span class="jsx-3792957869 text-xs text-gray-500">Docs, tutorials and examples for developers to get started with Jina. </span></div></a></li></ul></div></div></li><li class="jsx-649517993 hidden md:inline-block"><div class="jsx-3792957869 group inline-block relative"><button aria-label="Open Company dropdown" class="jsx-3792957869 text-gray-700 font-semibold py-2 px-4 rounded inline-flex items-center"><span class="jsx-3792957869 mr-1 font-bold">Company</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="jsx-3792957869 fill-current h-4 w-4 mt-2"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" class="jsx-3792957869"></path></svg></button><div class="jsx-3792957869 absolute hidden group-hover:block bg-transparent pt-7"><ul class="jsx-3792957869 dropdown"><li class="jsx-3792957869 hover:bg-gray-200"><a href="/about" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/about-icon.svg" alt="about icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">About</span></div><span class="jsx-3792957869 text-xs text-gray-500">Learn more about Jina AI as a company.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/careers" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/careers-icon.svg" alt="careers icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Careers</span></div><span class="jsx-3792957869 text-xs text-gray-500">Interested in joining us? Find out what it&#x27;s like to work at Jina AI.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/events" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/events-icon.svg" alt="events icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Events</span></div><span class="jsx-3792957869 text-xs text-gray-500">Online and offline meetups, hackathons, workshops and webinars.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/news" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/news-icon.svg" alt="news icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">News</span></div><span class="jsx-3792957869 text-xs text-gray-500">Check out the latest news about our company and products.</span></div></a></li><li class="jsx-3792957869 hover:bg-gray-200"><a href="/contact" class="jsx-3792957869 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3792957869 leading-4"><div class="jsx-3792957869 flex items-center"><div class=""><img src="/assets/images/icons/contact-icon.svg" alt="contact icon" class="w-full h-full"/></div><span class="jsx-3792957869 text-gray-800 font-semibold text-sm ml-2">Contact</span></div><span class="jsx-3792957869 text-xs text-gray-500">Interested in cooperating with Jina AI? Get in touch!</span></div></a></li></ul></div></div></li><li class="jsx-649517993 hidden md:inline-block mr-1 font-bold text-gray-700"><a href="/blog/">Blog</a></li><div class="jsx-3128403005 md:hidden h-96 overflow-y-scroll"><ul class="jsx-3128403005 dropdown"><div class="jsx-3128403005 linkItem.label divide-solid divide-gray-200 divide-y"><li class="jsx-3128403005 hover:bg-gray-200"><a href="/core" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/core-icon.svg" alt="core icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Jina Core</span></div><span class="jsx-3128403005 text-xs text-gray-500">An open-source framework for building multimedia search applications.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/hub" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/hub-icon.svg" alt="hub icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Jina Hub</span></div><span class="jsx-3128403005 text-xs text-gray-500">Jina’s community-driven module marketplace for building your Flow</span></div></a></li></div><div class="jsx-3128403005 linkItem.label divide-solid divide-gray-200 divide-y"><li class="jsx-3128403005 hover:bg-gray-200"><a href="/contribute" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/contribute-icon.svg" alt="contribute icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Contribute</span></div><span class="jsx-3128403005 text-xs text-gray-500">Want to shape the future of neural search? Find out how you can contribute to Jina here.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/join" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/join-icon.svg" alt="join icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Join</span></div><span class="jsx-3128403005 text-xs text-gray-500">Join the Jina Slack community to meet the team and get support.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/learn" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/learn-icon.svg" alt="learn icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Learn</span></div><span class="jsx-3128403005 text-xs text-gray-500">Docs, tutorials and examples for developers to get started with Jina. </span></div></a></li></div><div class="jsx-3128403005 linkItem.label divide-solid divide-gray-200 divide-y"><li class="jsx-3128403005 hover:bg-gray-200"><a href="/about" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/about-icon.svg" alt="about icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">About</span></div><span class="jsx-3128403005 text-xs text-gray-500">Learn more about Jina AI as a company.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/careers" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/careers-icon.svg" alt="careers icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Careers</span></div><span class="jsx-3128403005 text-xs text-gray-500">Interested in joining us? Find out what it&#x27;s like to work at Jina AI.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/events" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/events-icon.svg" alt="events icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Events</span></div><span class="jsx-3128403005 text-xs text-gray-500">Online and offline meetups, hackathons, workshops and webinars.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/news" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/news-icon.svg" alt="news icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">News</span></div><span class="jsx-3128403005 text-xs text-gray-500">Check out the latest news about our company and products.</span></div></a></li><li class="jsx-3128403005 hover:bg-gray-200"><a href="/contact" class="jsx-3128403005 py-2 px-4 block whitespace-no-wrap"><div class="jsx-3128403005 leading-4"><div class="jsx-3128403005 flex items-center"><div class=""><img src="/assets/images/icons/contact-icon.svg" alt="contact icon" class="w-full h-full"/></div><span class="jsx-3128403005 text-gray-800 font-semibold text-sm ml-2">Contact</span></div><span class="jsx-3128403005 text-xs text-gray-500">Interested in cooperating with Jina AI? Get in touch!</span></div></a></li></div></ul><span class="jsx-3128403005 text-gray-700 font-semibold text-sm ml-2 p-4">Blog</span></div><li class="jsx-223001487"><div class="jsx-3949856645 btn cursor-pointer flex items-center justify-center px-6 py-2 md:hidden btn-base btn-primary"><div class="mr-4 w-7"><img src="/assets/images/icons/GitHub-white-icon.svg" alt="GitHub-white icon" class="w-full h-full"/></div><span class="jsx-223001487 mr-4">Try it out!</span></div></li></ul></nav><div class="jsx-3949856645 btn cursor-pointer flex items-center justify-center px-6 py-2 hidden md:flex btn-base btn-primary"><div class="mr-4 w-7"><img src="/assets/images/icons/GitHub-white-icon.svg" alt="GitHub-white icon" class="w-full h-full"/></div><span class="jsx-223001487 mr-4">Try it out!</span></div></div></div></div><div class="mt-24"><div class="min-h-screen"><main><div class="container mx-auto px-5 flex flex-col"><img src="/assets/images/blog/startrek.png" alt="Build a BERT-based Semantic Search System…For Star Trek-image" class="mb-4 w-full"/><article class="mb-32 md:max-w-6xl md:shadow-lg xl:rounded-3xl md:px-32 md:py-20 md:mx-auto md:-mt-20 bg-white shadow"><div class="mb-3"><div class="inline-block px-2 py-0 rounded text-primary-500 bg-primary-500 bg-opacity-20 mr-2 mb-2">BERT</div><div class="inline-block px-2 py-0 rounded text-primary-500 bg-primary-500 bg-opacity-20 mr-2 mb-2">Tutorial</div><div class="inline-block px-2 py-0 rounded text-primary-500 bg-primary-500 bg-opacity-20 mr-2 mb-2">nlp</div></div><h1 class="text-xl md:text-4xl font-bold tracking-tighter leading-tight md:leading-none mb-6 md:text-left">Build a BERT-based Semantic Search System…For Star Trek</h1><div class="flex items-center justify-between text-gray-600 mb-12"><div class="flex items-center"><img src="/assets/images/defaultProfileImg.svg" class="w-8 h-auto rounded-full mr-4" alt="Alex C-G"/><div class="text-gray-600">Alex C-G</div></div><time dateTime="2020-08-05T15:58:12.918Z">5 August, 2020</time></div><div class="jsx-4055754880 mx-auto markdown"><div class="jsx-4055754880"><p><img src="https://cdn-images-1.medium.com/max/1200/1*RHWbExaw9Zz9h5-OOb_DnA.png" alt="Adapted from Wikimedia Commons">
Adapted from <a href="https://commons.wikimedia.org/wiki/File:U.S.S._Enterprise_NCC_1701-D.jpg">Wikimedia Commons</a></p>
<p>If you read my <a href="https://towardsdatascience.com/gpt-3-is-the-future-but-what-can-nlp-do-in-the-present-7aae3f21e8ed">previous article on Towards Data Science</a> you’ll know I’m a bit of a Star Trek nerd. There’s only one thing I like more than Star Trek, and that’s building cool new stuff with AI. So I thought I’d combine the two yet again!</p>
<p>In this tutorial we’re going to build our own search engine to search all the lines from <em>Star Trek: The Next Generation</em>. We’ll be using <a href="https://github.com/jina-ai/jina/">Jina</a>, a neural search framework which uses deep learning to power our NLP search, though we could easily use it for image, audio or video search if we wanted to.</p>
<p>We’ll cover:</p>
<ul>
<li>Basic setup</li>
<li>Running a demo of our app (yes, even before we code it)</li>
<li>Using cookiecutter to create project and boilerplate code</li>
<li>Downloading our Star Trek dataset</li>
<li>Loading, indexing, and searching our dataset</li>
<li>A deeper look behind the scenes</li>
<li>What to do if things go wrong</li>
</ul>
<p>If you’re new to AI or search, don’t worry. As long as you have some knowledge of Python and the command line you’ll be fine. If it helps, think of yourself as Lieutenant Commander Data Science.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*qfpyQ5XcGt82SjQD92t-LQ.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/reaction-229P3dnAW8RzceKbps">Giphy</a></p>
<h3>Try It Out</h3>
<p>Before going through the trouble of downloading, configuring and testing your search engine, let’s get an idea of the finished product. In this case, it’s exactly the same as what we’re building, but with lines from South Park instead of Star Trek:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*9wUmi0q1HgU6yThH54V9Zg.gif" alt="Via Jinabox">
Via <a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a></p>
<p>Jina has a pre-built Docker image with indexed data from South Park. You can run it with:</p>
<p>docker run -p 45678:45678 jinaai/hub.app.distilbert-southpark</p>
<p>After getting Docker up and running, you can start searching for those South Park lines.</p>
<h4>Query with Jinabox</h4>
<p><a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a> is a simple web-based front-end for neural search. You can see it in the graphic at the top of this tutorial.</p>
<ol>
<li>Go to <a href="https://jina.ai/jinabox.js">jinabox</a> in your browser</li>
<li>Ensure you have the server endpoint set to <code>[http://localhost:45678/api/search](http://localhost:45678/api/search)</code></li>
<li>Type a phrase into the search bar and see which South Park lines come up</li>
</ol>
<p><strong>Note:</strong> If it times out the first time, that’s because the query system is still warming up. Try again in a few seconds!</p>
<h4>Query with <code>curl</code></h4>
<p>Alternatively, you can open your shell and check the results via the RESTful API. The matched results are stored in <code>topkResults</code>.</p>
<p>curl --request POST -d '{"top_k": 10, "mode": "search", "data": ["text:hey, dude"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:45678/api/search'</p>
<p>You’ll see the results output in JSON format. Each result looks like:</p>
<p>Now go back to your terminal running Docker and hit <code>Ctrl-C</code> (or <code>Command-C</code> on Mac) a few times to ensure you've stopped everything.</p>
<h3>Engage!</h3>
<p>Now that you know what we’re building, let’s get started!</p>
<p>You will need:</p>
<ul>
<li>A basic knowledge of Python</li>
<li>Python 3.7 or higher installed, and <code>pip</code></li>
<li>A Mac or Linux computer (Jina doesn’t currently support Windows)</li>
<li>8 gigabytes or more of RAM</li>
</ul>
<h4>Clone the Repo</h4>
<p>Let’s get the basic files we need to get moving:</p>
<p>git clone git@github.com:alexcg1/my-first-jina-app.git<br>
cd my-first-jina-app</p>
<h4>Run Cookiecutter</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*80WNX16Ot0uoCXQy.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/sesame-street-cookies-cookie-monster-HGe4zsOVo7Jvy">Giphy</a></p>
<p>pip install -U cookiecutter<br>
cookiecutter gh:jina-ai/cookiecutter-jina</p>
<p>We use <a href="https://github.com/cookiecutter/cookiecutter">cookiecutter</a> to spin up a basic Jina app and save you having to do a lot of typing and setup.</p>
<p>For our Star Trek example, use the following settings:</p>
<ul>
<li><code>project_name</code>: <code>Star Trek</code></li>
<li><code>project_slug</code>: <code>star_trek</code> (default value)</li>
<li><code>task_type</code>: <code>nlp</code></li>
<li><code>index_type</code>: <code>strings</code></li>
<li><code>public_port</code>: <code>65481</code> (default value)</li>
</ul>
<p>Just use the defaults for all other fields. After cookiecutter has finished, let’s have a look at the files it created:</p>
<p>cd star_trek<br>
ls</p>
<p>You should see a bunch of files:</p>
<ul>
<li><code>app.py</code> - The main Python script where you initialize and pass data into your Flow</li>
<li><code>Dockerfile</code> - Lets you spin up a Docker instance running your app</li>
<li><code>flows/</code> - Folder to hold your Flows</li>
<li><code>pods/</code> - Folder to hold your Pods</li>
<li><code>README.md</code> - An auto-generated README file</li>
<li><code>requirements.txt</code> - A list of required Python packages</li>
</ul>
<p>In the <code>flows/</code> folder we can see <code>index.yml</code> and <code>query.yml</code> - these define the indexing and querying Flows for your app.</p>
<p>In <code>pods/</code> we see <code>chunk.yml</code>, <code>craft.yml</code>, <code>doc.yml</code>, and <code>encode.yml</code> - these Pods are called from the Flows to process data for indexing or querying.</p>
<p>More on Flows and Pods later!</p>
<h4>Install Requirements</h4>
<p>In your terminal run this command to download and install all the required Python packages:</p>
<p>pip install -r requirements.txt</p>
<h4>Download Dataset</h4>
<p>Our goal is to find out who said what in Star Trek episodes when a user queries a phrase. The <a href="https://www.kaggle.com/gjbroughton/start-trek-scripts">Star Trek dataset</a> from Kaggle contains all the scripts and individual character lines from <em>Star Trek: The Original Series</em> all the way through <em>Star Trek: Enterprise</em>.</p>
<p>We’re just using a subset in this example, containing the characters and lines from <em>Star Trek: The Next Generation</em>. This has also been converted from JSON to CSV format, which is more suitable for Jina to process.</p>
<p>Now let’s ensure we’re back in our base folder and download the dataset by running:</p>
<p>Once that’s finished downloading, let’s get back into the <code>star_trek</code> directory and make sure our dataset has everything we want:</p>
<p>cd star_trek<br>
head data/startrek_tng.csv</p>
<p>You should see output consisting of characters (like <code>MCCOY</code>), a separator, (<code>!</code>), and the lines spoken by the character ( <code>What about my age?</code>):</p>
<pre><code class="language-csv">BAILIFF!The prisoners will all stand.BAILIFF!All present, stand and make respectful attention to honouredJudge.BAILIFF!Before this gracious court now appear these prisoners to answer for the multiple and grievous savageries of their species. How plead you, criminal? BAILIFF!Criminals keep silence!BAILIFF!You will answer the charges, criminals. BAILIFF!Criminal, you will read the charges to the court.BAILIFF!All present, respectfully stand. QBAILIFF!This honourable court is adjourned. Stand respectfully. Q MCCOY!Hold it right there, boy.MCCOY!What about my age?
</code></pre>
<p>Note: Your character lines may be a little different. That’s okay!</p>
<h4>Load Data</h4>
<p>Now we we need to pass <code>startrek_tng.csv</code> into <code>app.py</code> so we can index it. <code>app.py</code> is a little too simple out of the box, so let's make some changes:</p>
<p>Open <code>app.py</code> in your editor and check the <code>index</code> function, we currently have:</p>
<p>As you can see, this indexes just 3 strings. Let’s load up our Star Trek file instead with the <code>filepath</code> parameter. Just replace the last line of the function:</p>
<h4>Index Fewer Documents</h4>
<p>While we’re here, let’s reduce the number of documents we’re indexing, just to speed things up while we’re testing. We don’t want to spend ages indexing only to have issues later on!</p>
<p>In the section above the <code>config</code> function, let's change:</p>
<p>to:</p>
<p>That should speed up our testing by a factor of 100! Once we’ve verified everything works we can set it back to <code>50000</code> to index more of our dataset.</p>
<p>Now that we’ve got the code to load our data, we’re going to dive into writing our app and running our Flows! Flows are the different tasks our app performs, like indexing or searching the data.</p>
<h3>Indexing</h3>
<p>First up we need to build up an index of our file. We’ll search through this index when we use the query Flow later.</p>
<p>python app.py index</p>
<p>Your app will show a lot of output in the terminal, but you’ll know it’s finished when you see the line:</p>
<p>Flow@133216[S]:flow is closed and all resources should be released already, current build level is 0</p>
<p>This may take a little while the first time, since Jina needs to download the language model and tokenizer to process the data. You can think of these as the brains behind the neural network that powers the search.</p>
<h3>Searching</h3>
<p>To start search mode run:</p>
<p>python app.py search</p>
<p>After a while you should see the terminal stop scrolling and display output like:</p>
<p>Flow@85144[S]:flow is started at 0.0.0.0:65481, you can now use client to send request!</p>
<p>⚠️ Be sure to note down the port number. We’ll need it for <code>curl</code> and jinabox! In our case we'll assume it's <code>65481</code>, and we use that in the below examples. If your port number is different, be sure to use that instead.</p>
<p>ℹ️ <code>python app.py search</code> doesn't pop up a search interface - for that you'll need to connect via <code>curl</code>, Jinabox, or another client.</p>
<h4>Search with Jinabox</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*uSuMyVICX45stZGX.gif" alt="Via Jinabox">
Via <a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a></p>
<ol>
<li>Go to <a href="https://jina.ai/jinabox.js">jinabox</a> in your browser</li>
<li>Ensure you have the server endpoint set to <code>[http://localhost:65481/api/search](http://localhost:65481/api/search)</code></li>
<li>Type a phrase into the search bar and see which Star Trek lines come up</li>
</ol>
<h4>Search with curl</h4>
<p>curl --request POST -d '{"top_k": 10, "mode": "search", "data": ["text:picard to riker"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:65481/api/search'</p>
<p><code>curl</code> will spit out a <em>lot</em> of information in JSON format - not just the lines you're searching for, but all sorts of metadata about the search and the lines it returns. Look for the lines starting with <code>"matchDoc"</code> to find the matches, like:</p>
<p>Congratulations! You’ve just built your very own search engine!</p>
<h3>How Does it Actually Work?</h3>
<p>For a more general overview of what neural search is and how it works, check one of <a href="https://towardsdatascience.com/what-is-neural-search-and-why-should-i-care-4a6cee6b2249">my other previous articles</a>. Jina itself is just one way to build a neural search engine, and it has a couple of important concepts: <strong>Flows</strong> and <strong>Pods</strong>:</p>
<ul>
<li>The Flow tells Jina <em>what</em> tasks to perform on the dataset, like indexing or searching. Each Flow is built from individual Pods.</li>
<li>The Pods comprise the Flow and tell Jina <em>how</em> to perform each task step by step, like breaking text into chunks, indexing it, and so on. They define the actual neural networks we use in neural search, namely the language models like <code>distilbert-base-cased</code>. (Which we can see in <code>pods/encode.yml</code>)</li>
</ul>
<h4>Flows</h4>
<p><img src="https://cdn-images-1.medium.com/max/600/0*4T73vRJqbP5MzAPw.png" alt="Via Jina 101">
Via <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a></p>
<p>Just as a plant manages nutrient flow and growth rate for its branches, a Flow manages the states and context of a group of Pods, orchestrating them to accomplish one task. Whether a Pod is remote or running in Docker, one Flow rules them all!</p>
<p>We define Flows in <code>app.py</code> to index and query the content in our Star Trek dataset.</p>
<p>In this case our Flows are written in YAML format and loaded into <code>app.py</code> with:</p>
<p>It really is that simple! Alternatively you can build Flows in <code>app.py</code> itself <a href="https://docs.jina.ai/chapters/flow/index.html">without specifying them in YAML</a>.</p>
<p>No matter whether you’re dealing with text, graphics, sound, or video, all datasets need to be indexed and queried, and the steps for doing each (chunking, vector encoding) are more or less the same (even if <em>how</em> you perform each step is different — that’s where Pods come in!)</p>
<h4>Indexing</h4>
<p>Every Flow has well, a flow to it. Different Pods pass data along the Flow, with one Pod’s output becoming another Pod’s input. Look at our indexing Flow as an example:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*CuwRBdSoJfSgXnJ8BBUOeA.png" alt="Via Jina Dashboard">
Via <a href="https://github.com/jina-ai/dashboard">Jina Dashboard</a></p>
<p>If you look at <code>startrek_tng.csv</code> you'll see it's just one big text file. Our Flow processes it into something more suitable for Jina, which is handled by the Pods in the Flow. Each Pod performs a different task.</p>
<p>You can see the following Pods in <code>flows/index.yml</code>:</p>
<ul>
<li><code>crafter</code> - Split the Document into Chunks</li>
<li><code>encoder</code> - Encode each Chunk into a vector</li>
<li><code>chunk_idx</code> - Build an index of Chunks</li>
<li><code>doc_idx</code> - Store the Document content</li>
<li><code>join_all</code> - Join the <code>chunk_idx</code> and <code>doc_idx</code> pathways</li>
</ul>
<p>The full file is essentially just a list of Pods with parameters and some setup at the top of the file:</p>
<p>Luckily, YAML is pretty human-readable. I regularly thank the <a href="https://memory-alpha.fandom.com/wiki/Great_bird_of_the_galaxy">Great Bird of the Galaxy</a> it’s not in Klingon, or even worse, XML!</p>
<ul>
<li>The first couple of lines initialize the Flow and enable the logserver (which we’re not using in this tutorial).</li>
<li>After that we can see the list of Pods, with their own YAML path and extra parameters being passed to each one.</li>
</ul>
<p>So, is that all of the Pods? Not quite! We always have another Pod working in silence — the <code>gateway</code> pod. Most of the time we can safely ignore it because it basically does all the dirty orchestration work for the Flow.</p>
<h4>Searching</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*cvwy8oYjPaQECsge.png" alt="Via Jina Dashboard">
Via <a href="https://github.com/jina-ai/dashboard">Jina Dashboard</a></p>
<p>In the query Flow we’ve got the following Pods:</p>
<ul>
<li><code>chunk_seg</code> - Segments the user query into meaningful Chunks</li>
<li><code>tf_encode</code> - Encode each word of the query into a vector</li>
<li><code>chunk_idx</code> - Build an index for the Chunks for fast lookup</li>
<li><code>ranker</code> - Sort results list</li>
<li><code>doc_idx</code> - Store the Document content</li>
</ul>
<p>Again, <code>flows/query.yml</code> gives some setup options and lists the Pods in order of use:</p>
<p>When we were indexing we broke the Document into Chunks to index it. For querying we do the same, but this time the Document is the query the user types in, not the Star Trek dataset. We’ll use many of the same Pods, but there are a few differences to bear in mind. In the big picture:</p>
<ul>
<li>Index has a two-pathway design which deals with both Document and Chunk indexing in parallel, which speeds up message passing</li>
<li>Query has a single pipeline</li>
</ul>
<p>And digging into the <code>flows/query.yml</code>, we can see it has an extra Pod and some more parameters compared to <code>flows/index.yml</code>:</p>
<ul>
<li><code>rest_api:true</code> - Use Jina's REST API, allowing clients like jinabox and <code>curl</code> to connect</li>
<li><code>port_expose: $JINA_PORT</code> - The port for connecting to Jina's API</li>
<li><code>polling: all</code> - Setting <code>polling</code> to <code>all</code> ensures all workers poll the message</li>
<li><code>reducing_yaml_path: _merge_topk_chunks</code> - Use <code>_merge_topk_chunks</code> to reduce results from all replicas</li>
<li><code>ranker:</code> - Rank results by relevance</li>
</ul>
<p>How does Jina know whether it should be indexing or searching? In our RESTful API we set the <code>mode</code> field in the JSON body and send the request to the corresponding API:</p>
<ul>
<li><code>api/index</code> - <code>{"mode": "index"}</code></li>
<li><code>api/search</code> - <code>{"mode": "search"}</code></li>
</ul>
<h4>Pods</h4>
<p><img src="https://cdn-images-1.medium.com/max/600/0*KsNdCg47DQ1mp9l9.png" alt="Via Jina 101">
Via <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a></p>
<p>As we discussed above, a Flow tells Jina <em>what</em> task to perform and is comprised of Pods. And a Pod tells Jina <em>how</em> to perform that task (i.e. what the right tool for job is). Both Pods and Flows are written in YAML.</p>
<p>Let’s start by looking at a Pod in our indexing Flow, <code>flows/index.yml</code>. Instead of the first Pod <code>crafter</code>, let's look at <code>encoder</code> which is a bit simpler:</p>
<p>As we can see in the code above, the <code>encoder</code> Pod’s YAML file is stored in <code>pods/encode.yml</code>, and looks like:</p>
<p>The Pods uses the built-in <code>TransformerTorchEncoder</code> as its Executor. Each Pod has a different Executor based on its task, and an Executor represents an algorithm, in this case encoding. The Executor differs based on what's being encoded. For video or audio you'd use a different one. The <code>with</code> field specifies the parameters passed to <code>TransformerTorchEncoder</code>.</p>
<ul>
<li><code>pooling_strategy</code> - Strategy to merge word embeddings into chunk embedding</li>
<li><code>model_name</code> - Name of the model we're using</li>
<li><code>max_length</code> - Maximum length to truncate tokenized sequences to</li>
</ul>
<p>When the Pod runs, data is passed in from the previous Pod, <code>TransformerTorchEncoder</code> encodes the data, and the Pod passes the data to the next Pod in the Flow.</p>
<p>For a deeper dive on Pods, Flows, Executors and everything else, you can refer to <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a>.</p>
<h3>Troubleshooting</h3>
<p><img src="https://cdn-images-1.medium.com/max/800/1*O4TEq098Y8EDfCxuXtbdmA.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/star-trek-riker-tng-tYelSVzQPtLdm">Giphy</a></p>
<h4>Module not found</h4>
<p>Be sure to run <code>pip install -r requirements.txt</code> before beginning, and ensure you have lots of RAM/swap and space in your <code>tmp</code> partition (see below issues). This may take a while since there are a lot of prerequisites to install.</p>
<p>If this error keeps popping up, look into the errors that were output onto the terminal to try to find which module is missing, and then run:</p>
<p><code>pip install &#x3C;module_name></code></p>
<h4>My computer hangs</h4>
<p>Machine learning requires a lot of resources, and if your machine hangs this is often due to running out of memory. To fix this, try <a href="https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/">creating a swap file</a> if you use Linux. This isn’t such an issue on macOS, since it allocates swap automatically.</p>
<h4><code>ERROR: Could not install packages due to an EnvironmentError: [Errno 28] No space left on device</code></h4>
<p>This is often due to your <code>/tmp</code> partition running out of space so you'll need to <a href="https://askubuntu.com/questions/199565/not-enough-space-on-tmp">increase its size</a>.</p>
<h4><code>command not found</code></h4>
<p>For this error you’ll need to install the relevant software package onto your system. In Ubuntu this can be done with:</p>
<p>sudo apt-get install &#x3C;package_name></p>
<h3>Congratulations! We Did It!</h3>
<p><img src="https://cdn-images-1.medium.com/max/800/0*uNyjB41NM_94Hbmi.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/star-trek-booze-scotty-3ornjJpj2rAla2DLCE">Giphy</a></p>
<p>In this tutorial you’ve learned:</p>
<ul>
<li>How to install the Jina neural search framework</li>
<li>How to load and index text data from files</li>
<li>How to query data with <code>curl</code> and Jinabox</li>
<li>The nitty-gritty behind Jina Flows and Pods</li>
<li>What do if it all goes wrong</li>
</ul>
<p>Now that you have a broad understanding of how things work, you can try out some of more <a href="https://github.com/jina-ai/examples">example tutorials</a> to build image or video search, or stay tuned for our next set of tutorials that build upon your Star Trek app.</p>
<p>Got an idea for a tutorial covering Star Trek and/or neural search? My commbadge is out of order right now, but you can leave a comment or note on this article for me to assimilate!</p>
<p><a href="http://www.twitter.com/alexcg">Alex C-G</a> is the Open Source Evangelist at <a href="https://github.com/jina-ai/jina/">Jina AI</a>, and a massive Star Trek geek.</p>
</div><div class="jsx-4055754880 hidden"><p><img src="https://cdn-images-1.medium.com/max/1200/1*RHWbExaw9Zz9h5-OOb_DnA.png" alt="Adapted from Wikimedia Commons">
Adapted from <a href="https://commons.wikimedia.org/wiki/File:U.S.S._Enterprise_NCC_1701-D.jpg">Wikimedia Commons</a></p>
<p>If you read my <a href="https://towardsdatascience.com/gpt-3-is-the-future-but-what-can-nlp-do-in-the-present-7aae3f21e8ed">previous article on Towards Data Science</a> you’ll know I’m a bit of a Star Trek nerd. There’s only one thing I like more than Star Trek, and that’s building cool new stuff with AI. So I thought I’d combine the two yet again!</p>
<p>In this tutorial we’re going to build our own search engine to search all the lines from <em>Star Trek: The Next Generation</em>. We’ll be using <a href="https://github.com/jina-ai/jina/">Jina</a>, a neural search framework which uses deep learning to power our NLP search, though we could easily use it for image, audio or video search if we wanted to.</p>
<p>We’ll cover:</p>
<ul>
<li>Basic setup</li>
<li>Running a demo of our app (yes, even before we code it)</li>
<li>Using cookiecutter to create project and boilerplate code</li>
<li>Downloading our Star Trek dataset</li>
<li>Loading, indexing, and searching our dataset</li>
<li>A deeper look behind the scenes</li>
<li>What to do if things go wrong</li>
</ul>
<p>If you’re new to AI or search, don’t worry. As long as you have some knowledge of Python and the command line you’ll be fine. If it helps, think of yourself as Lieutenant Commander Data Science.</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*qfpyQ5XcGt82SjQD92t-LQ.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/reaction-229P3dnAW8RzceKbps">Giphy</a></p>
<h3>Try It Out</h3>
<p>Before going through the trouble of downloading, configuring and testing your search engine, let’s get an idea of the finished product. In this case, it’s exactly the same as what we’re building, but with lines from South Park instead of Star Trek:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*9wUmi0q1HgU6yThH54V9Zg.gif" alt="Via Jinabox">
Via <a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a></p>
<p>Jina has a pre-built Docker image with indexed data from South Park. You can run it with:</p>
<p>docker run -p 45678:45678 jinaai/hub.app.distilbert-southpark</p>
<p>After getting Docker up and running, you can start searching for those South Park lines.</p>
<h4>Query with Jinabox</h4>
<p><a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a> is a simple web-based front-end for neural search. You can see it in the graphic at the top of this tutorial.</p>
<ol>
<li>Go to <a href="https://jina.ai/jinabox.js">jinabox</a> in your browser</li>
<li>Ensure you have the server endpoint set to <code>[http://localhost:45678/api/search](http://localhost:45678/api/search)</code></li>
<li>Type a phrase into the search bar and see which South Park lines come up</li>
</ol>
<p><strong>Note:</strong> If it times out the first time, that’s because the query system is still warming up. Try again in a few seconds!</p>
<h4>Query with <code>curl</code></h4>
<p>Alternatively, you can open your shell and check the results via the RESTful API. The matched results are stored in <code>topkResults</code>.</p>
<p>curl --request POST -d '{"top_k": 10, "mode": "search", "data": ["text:hey, dude"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:45678/api/search'</p>
<p>You’ll see the results output in JSON format. Each result looks like:</p>
<p>Now go back to your terminal running Docker and hit <code>Ctrl-C</code> (or <code>Command-C</code> on Mac) a few times to ensure you've stopped everything.</p>
<h3>Engage!</h3>
<p>Now that you know what we’re building, let’s get started!</p>
<p>You will need:</p>
<ul>
<li>A basic knowledge of Python</li>
<li>Python 3.7 or higher installed, and <code>pip</code></li>
<li>A Mac or Linux computer (Jina doesn’t currently support Windows)</li>
<li>8 gigabytes or more of RAM</li>
</ul>
<h4>Clone the Repo</h4>
<p>Let’s get the basic files we need to get moving:</p>
<p>git clone git@github.com:alexcg1/my-first-jina-app.git<br>
cd my-first-jina-app</p>
<h4>Run Cookiecutter</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*80WNX16Ot0uoCXQy.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/sesame-street-cookies-cookie-monster-HGe4zsOVo7Jvy">Giphy</a></p>
<p>pip install -U cookiecutter<br>
cookiecutter gh:jina-ai/cookiecutter-jina</p>
<p>We use <a href="https://github.com/cookiecutter/cookiecutter">cookiecutter</a> to spin up a basic Jina app and save you having to do a lot of typing and setup.</p>
<p>For our Star Trek example, use the following settings:</p>
<ul>
<li><code>project_name</code>: <code>Star Trek</code></li>
<li><code>project_slug</code>: <code>star_trek</code> (default value)</li>
<li><code>task_type</code>: <code>nlp</code></li>
<li><code>index_type</code>: <code>strings</code></li>
<li><code>public_port</code>: <code>65481</code> (default value)</li>
</ul>
<p>Just use the defaults for all other fields. After cookiecutter has finished, let’s have a look at the files it created:</p>
<p>cd star_trek<br>
ls</p>
<p>You should see a bunch of files:</p>
<ul>
<li><code>app.py</code> - The main Python script where you initialize and pass data into your Flow</li>
<li><code>Dockerfile</code> - Lets you spin up a Docker instance running your app</li>
<li><code>flows/</code> - Folder to hold your Flows</li>
<li><code>pods/</code> - Folder to hold your Pods</li>
<li><code>README.md</code> - An auto-generated README file</li>
<li><code>requirements.txt</code> - A list of required Python packages</li>
</ul>
<p>In the <code>flows/</code> folder we can see <code>index.yml</code> and <code>query.yml</code> - these define the indexing and querying Flows for your app.</p>
<p>In <code>pods/</code> we see <code>chunk.yml</code>, <code>craft.yml</code>, <code>doc.yml</code>, and <code>encode.yml</code> - these Pods are called from the Flows to process data for indexing or querying.</p>
<p>More on Flows and Pods later!</p>
<h4>Install Requirements</h4>
<p>In your terminal run this command to download and install all the required Python packages:</p>
<p>pip install -r requirements.txt</p>
<h4>Download Dataset</h4>
<p>Our goal is to find out who said what in Star Trek episodes when a user queries a phrase. The <a href="https://www.kaggle.com/gjbroughton/start-trek-scripts">Star Trek dataset</a> from Kaggle contains all the scripts and individual character lines from <em>Star Trek: The Original Series</em> all the way through <em>Star Trek: Enterprise</em>.</p>
<p>We’re just using a subset in this example, containing the characters and lines from <em>Star Trek: The Next Generation</em>. This has also been converted from JSON to CSV format, which is more suitable for Jina to process.</p>
<p>Now let’s ensure we’re back in our base folder and download the dataset by running:</p>
<p>Once that’s finished downloading, let’s get back into the <code>star_trek</code> directory and make sure our dataset has everything we want:</p>
<p>cd star_trek<br>
head data/startrek_tng.csv</p>
<p>You should see output consisting of characters (like <code>MCCOY</code>), a separator, (<code>!</code>), and the lines spoken by the character ( <code>What about my age?</code>):</p>
<pre class="rounded-xl m-2 md:mr-6" style="display:block;overflow-x:auto;padding:0.5em;background:#2d2b57;font-weight:normal;color:#e3dfff" data-reactroot=""><code class="language-python" style="white-space:pre"><span>BAILIFF!The prisoners will </span><span style="color:#fb9e00">all</span><span> stand.BAILIFF!All present, stand </span><span style="color:#fb9e00;font-weight:normal">and</span><span> make respectful attention to honouredJudge.BAILIFF!Before this gracious court now appear these prisoners to answer </span><span style="color:#fb9e00;font-weight:normal">for</span><span> the multiple </span><span style="color:#fb9e00;font-weight:normal">and</span><span> grievous savageries of their species. How plead you, criminal? BAILIFF!Criminals keep silence!BAILIFF!You will answer the charges, criminals. BAILIFF!Criminal, you will read the charges to the court.BAILIFF!All present, respectfully stand. QBAILIFF!This honourable court </span><span style="color:#fb9e00;font-weight:normal">is</span><span> adjourned. Stand respectfully. Q MCCOY!Hold it right there, boy.MCCOY!What about my age?
</span>
</code></pre>
<p>Note: Your character lines may be a little different. That’s okay!</p>
<h4>Load Data</h4>
<p>Now we we need to pass <code>startrek_tng.csv</code> into <code>app.py</code> so we can index it. <code>app.py</code> is a little too simple out of the box, so let's make some changes:</p>
<p>Open <code>app.py</code> in your editor and check the <code>index</code> function, we currently have:</p>
<p>As you can see, this indexes just 3 strings. Let’s load up our Star Trek file instead with the <code>filepath</code> parameter. Just replace the last line of the function:</p>
<h4>Index Fewer Documents</h4>
<p>While we’re here, let’s reduce the number of documents we’re indexing, just to speed things up while we’re testing. We don’t want to spend ages indexing only to have issues later on!</p>
<p>In the section above the <code>config</code> function, let's change:</p>
<p>to:</p>
<p>That should speed up our testing by a factor of 100! Once we’ve verified everything works we can set it back to <code>50000</code> to index more of our dataset.</p>
<p>Now that we’ve got the code to load our data, we’re going to dive into writing our app and running our Flows! Flows are the different tasks our app performs, like indexing or searching the data.</p>
<h3>Indexing</h3>
<p>First up we need to build up an index of our file. We’ll search through this index when we use the query Flow later.</p>
<p>python app.py index</p>
<p>Your app will show a lot of output in the terminal, but you’ll know it’s finished when you see the line:</p>
<p>Flow@133216[S]:flow is closed and all resources should be released already, current build level is 0</p>
<p>This may take a little while the first time, since Jina needs to download the language model and tokenizer to process the data. You can think of these as the brains behind the neural network that powers the search.</p>
<h3>Searching</h3>
<p>To start search mode run:</p>
<p>python app.py search</p>
<p>After a while you should see the terminal stop scrolling and display output like:</p>
<p>Flow@85144[S]:flow is started at 0.0.0.0:65481, you can now use client to send request!</p>
<p>⚠️ Be sure to note down the port number. We’ll need it for <code>curl</code> and jinabox! In our case we'll assume it's <code>65481</code>, and we use that in the below examples. If your port number is different, be sure to use that instead.</p>
<p>ℹ️ <code>python app.py search</code> doesn't pop up a search interface - for that you'll need to connect via <code>curl</code>, Jinabox, or another client.</p>
<h4>Search with Jinabox</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*uSuMyVICX45stZGX.gif" alt="Via Jinabox">
Via <a href="https://github.com/jina-ai/jinabox.js/">Jinabox</a></p>
<ol>
<li>Go to <a href="https://jina.ai/jinabox.js">jinabox</a> in your browser</li>
<li>Ensure you have the server endpoint set to <code>[http://localhost:65481/api/search](http://localhost:65481/api/search)</code></li>
<li>Type a phrase into the search bar and see which Star Trek lines come up</li>
</ol>
<h4>Search with curl</h4>
<p>curl --request POST -d '{"top_k": 10, "mode": "search", "data": ["text:picard to riker"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:65481/api/search'</p>
<p><code>curl</code> will spit out a <em>lot</em> of information in JSON format - not just the lines you're searching for, but all sorts of metadata about the search and the lines it returns. Look for the lines starting with <code>"matchDoc"</code> to find the matches, like:</p>
<p>Congratulations! You’ve just built your very own search engine!</p>
<h3>How Does it Actually Work?</h3>
<p>For a more general overview of what neural search is and how it works, check one of <a href="https://towardsdatascience.com/what-is-neural-search-and-why-should-i-care-4a6cee6b2249">my other previous articles</a>. Jina itself is just one way to build a neural search engine, and it has a couple of important concepts: <strong>Flows</strong> and <strong>Pods</strong>:</p>
<ul>
<li>The Flow tells Jina <em>what</em> tasks to perform on the dataset, like indexing or searching. Each Flow is built from individual Pods.</li>
<li>The Pods comprise the Flow and tell Jina <em>how</em> to perform each task step by step, like breaking text into chunks, indexing it, and so on. They define the actual neural networks we use in neural search, namely the language models like <code>distilbert-base-cased</code>. (Which we can see in <code>pods/encode.yml</code>)</li>
</ul>
<h4>Flows</h4>
<p><img src="https://cdn-images-1.medium.com/max/600/0*4T73vRJqbP5MzAPw.png" alt="Via Jina 101">
Via <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a></p>
<p>Just as a plant manages nutrient flow and growth rate for its branches, a Flow manages the states and context of a group of Pods, orchestrating them to accomplish one task. Whether a Pod is remote or running in Docker, one Flow rules them all!</p>
<p>We define Flows in <code>app.py</code> to index and query the content in our Star Trek dataset.</p>
<p>In this case our Flows are written in YAML format and loaded into <code>app.py</code> with:</p>
<p>It really is that simple! Alternatively you can build Flows in <code>app.py</code> itself <a href="https://docs.jina.ai/chapters/flow/index.html">without specifying them in YAML</a>.</p>
<p>No matter whether you’re dealing with text, graphics, sound, or video, all datasets need to be indexed and queried, and the steps for doing each (chunking, vector encoding) are more or less the same (even if <em>how</em> you perform each step is different — that’s where Pods come in!)</p>
<h4>Indexing</h4>
<p>Every Flow has well, a flow to it. Different Pods pass data along the Flow, with one Pod’s output becoming another Pod’s input. Look at our indexing Flow as an example:</p>
<p><img src="https://cdn-images-1.medium.com/max/800/1*CuwRBdSoJfSgXnJ8BBUOeA.png" alt="Via Jina Dashboard">
Via <a href="https://github.com/jina-ai/dashboard">Jina Dashboard</a></p>
<p>If you look at <code>startrek_tng.csv</code> you'll see it's just one big text file. Our Flow processes it into something more suitable for Jina, which is handled by the Pods in the Flow. Each Pod performs a different task.</p>
<p>You can see the following Pods in <code>flows/index.yml</code>:</p>
<ul>
<li><code>crafter</code> - Split the Document into Chunks</li>
<li><code>encoder</code> - Encode each Chunk into a vector</li>
<li><code>chunk_idx</code> - Build an index of Chunks</li>
<li><code>doc_idx</code> - Store the Document content</li>
<li><code>join_all</code> - Join the <code>chunk_idx</code> and <code>doc_idx</code> pathways</li>
</ul>
<p>The full file is essentially just a list of Pods with parameters and some setup at the top of the file:</p>
<p>Luckily, YAML is pretty human-readable. I regularly thank the <a href="https://memory-alpha.fandom.com/wiki/Great_bird_of_the_galaxy">Great Bird of the Galaxy</a> it’s not in Klingon, or even worse, XML!</p>
<ul>
<li>The first couple of lines initialize the Flow and enable the logserver (which we’re not using in this tutorial).</li>
<li>After that we can see the list of Pods, with their own YAML path and extra parameters being passed to each one.</li>
</ul>
<p>So, is that all of the Pods? Not quite! We always have another Pod working in silence — the <code>gateway</code> pod. Most of the time we can safely ignore it because it basically does all the dirty orchestration work for the Flow.</p>
<h4>Searching</h4>
<p><img src="https://cdn-images-1.medium.com/max/800/0*cvwy8oYjPaQECsge.png" alt="Via Jina Dashboard">
Via <a href="https://github.com/jina-ai/dashboard">Jina Dashboard</a></p>
<p>In the query Flow we’ve got the following Pods:</p>
<ul>
<li><code>chunk_seg</code> - Segments the user query into meaningful Chunks</li>
<li><code>tf_encode</code> - Encode each word of the query into a vector</li>
<li><code>chunk_idx</code> - Build an index for the Chunks for fast lookup</li>
<li><code>ranker</code> - Sort results list</li>
<li><code>doc_idx</code> - Store the Document content</li>
</ul>
<p>Again, <code>flows/query.yml</code> gives some setup options and lists the Pods in order of use:</p>
<p>When we were indexing we broke the Document into Chunks to index it. For querying we do the same, but this time the Document is the query the user types in, not the Star Trek dataset. We’ll use many of the same Pods, but there are a few differences to bear in mind. In the big picture:</p>
<ul>
<li>Index has a two-pathway design which deals with both Document and Chunk indexing in parallel, which speeds up message passing</li>
<li>Query has a single pipeline</li>
</ul>
<p>And digging into the <code>flows/query.yml</code>, we can see it has an extra Pod and some more parameters compared to <code>flows/index.yml</code>:</p>
<ul>
<li><code>rest_api:true</code> - Use Jina's REST API, allowing clients like jinabox and <code>curl</code> to connect</li>
<li><code>port_expose: $JINA_PORT</code> - The port for connecting to Jina's API</li>
<li><code>polling: all</code> - Setting <code>polling</code> to <code>all</code> ensures all workers poll the message</li>
<li><code>reducing_yaml_path: _merge_topk_chunks</code> - Use <code>_merge_topk_chunks</code> to reduce results from all replicas</li>
<li><code>ranker:</code> - Rank results by relevance</li>
</ul>
<p>How does Jina know whether it should be indexing or searching? In our RESTful API we set the <code>mode</code> field in the JSON body and send the request to the corresponding API:</p>
<ul>
<li><code>api/index</code> - <code>{"mode": "index"}</code></li>
<li><code>api/search</code> - <code>{"mode": "search"}</code></li>
</ul>
<h4>Pods</h4>
<p><img src="https://cdn-images-1.medium.com/max/600/0*KsNdCg47DQ1mp9l9.png" alt="Via Jina 101">
Via <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a></p>
<p>As we discussed above, a Flow tells Jina <em>what</em> task to perform and is comprised of Pods. And a Pod tells Jina <em>how</em> to perform that task (i.e. what the right tool for job is). Both Pods and Flows are written in YAML.</p>
<p>Let’s start by looking at a Pod in our indexing Flow, <code>flows/index.yml</code>. Instead of the first Pod <code>crafter</code>, let's look at <code>encoder</code> which is a bit simpler:</p>
<p>As we can see in the code above, the <code>encoder</code> Pod’s YAML file is stored in <code>pods/encode.yml</code>, and looks like:</p>
<p>The Pods uses the built-in <code>TransformerTorchEncoder</code> as its Executor. Each Pod has a different Executor based on its task, and an Executor represents an algorithm, in this case encoding. The Executor differs based on what's being encoded. For video or audio you'd use a different one. The <code>with</code> field specifies the parameters passed to <code>TransformerTorchEncoder</code>.</p>
<ul>
<li><code>pooling_strategy</code> - Strategy to merge word embeddings into chunk embedding</li>
<li><code>model_name</code> - Name of the model we're using</li>
<li><code>max_length</code> - Maximum length to truncate tokenized sequences to</li>
</ul>
<p>When the Pod runs, data is passed in from the previous Pod, <code>TransformerTorchEncoder</code> encodes the data, and the Pod passes the data to the next Pod in the Flow.</p>
<p>For a deeper dive on Pods, Flows, Executors and everything else, you can refer to <a href="https://github.com/jina-ai/jina/tree/master/docs/chapters/101">Jina 101</a>.</p>
<h3>Troubleshooting</h3>
<p><img src="https://cdn-images-1.medium.com/max/800/1*O4TEq098Y8EDfCxuXtbdmA.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/star-trek-riker-tng-tYelSVzQPtLdm">Giphy</a></p>
<h4>Module not found</h4>
<p>Be sure to run <code>pip install -r requirements.txt</code> before beginning, and ensure you have lots of RAM/swap and space in your <code>tmp</code> partition (see below issues). This may take a while since there are a lot of prerequisites to install.</p>
<p>If this error keeps popping up, look into the errors that were output onto the terminal to try to find which module is missing, and then run:</p>
<p><code>pip install &#x3C;module_name></code></p>
<h4>My computer hangs</h4>
<p>Machine learning requires a lot of resources, and if your machine hangs this is often due to running out of memory. To fix this, try <a href="https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/">creating a swap file</a> if you use Linux. This isn’t such an issue on macOS, since it allocates swap automatically.</p>
<h4><code>ERROR: Could not install packages due to an EnvironmentError: [Errno 28] No space left on device</code></h4>
<p>This is often due to your <code>/tmp</code> partition running out of space so you'll need to <a href="https://askubuntu.com/questions/199565/not-enough-space-on-tmp">increase its size</a>.</p>
<h4><code>command not found</code></h4>
<p>For this error you’ll need to install the relevant software package onto your system. In Ubuntu this can be done with:</p>
<p>sudo apt-get install &#x3C;package_name></p>
<h3>Congratulations! We Did It!</h3>
<p><img src="https://cdn-images-1.medium.com/max/800/0*uNyjB41NM_94Hbmi.gif" alt="Via Giphy">
Via <a href="https://giphy.com/gifs/star-trek-booze-scotty-3ornjJpj2rAla2DLCE">Giphy</a></p>
<p>In this tutorial you’ve learned:</p>
<ul>
<li>How to install the Jina neural search framework</li>
<li>How to load and index text data from files</li>
<li>How to query data with <code>curl</code> and Jinabox</li>
<li>The nitty-gritty behind Jina Flows and Pods</li>
<li>What do if it all goes wrong</li>
</ul>
<p>Now that you have a broad understanding of how things work, you can try out some of more <a href="https://github.com/jina-ai/examples">example tutorials</a> to build image or video search, or stay tuned for our next set of tutorials that build upon your Star Trek app.</p>
<p>Got an idea for a tutorial covering Star Trek and/or neural search? My commbadge is out of order right now, but you can leave a comment or note on this article for me to assimilate!</p>
<p><a href="http://www.twitter.com/alexcg">Alex C-G</a> is the Open Source Evangelist at <a href="https://github.com/jina-ai/jina/">Jina AI</a>, and a massive Star Trek geek.</p>
</div></div></article></div></main></div></div><div class="jsx-1956813867"><div class="bg-primary-500 pt-20 text-white"><div class="jsx-1956813867 flex flex-col md:flex-row justify-between px-6 md:px-0"><div class="jsx-1956813867 footer-left-margin"></div><div class="jsx-1956813867 pr-4 md:py-16 md:mr-16"><div class="text-center md:text-left"><div class="flex md:justify-start"><div class="text-gray-900 flex items-center font-semibold text-3xl"><img src="/assets/images/logo-white.svg" alt="Jina.ai logo" class="w-24"/></div></div></div></div><div class="jsx-1956813867 grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-16 py-16"><div class="jsx-1324436386 footer-links sm:text-left"><div class="jsx-1324436386 font-semibold text-white footer-items-title">Company</div><nav class="jsx-1324436386 mt-3"><ul class="jsx-1324436386"><li class="jsx-1956813867"><a class="jsx-1956813867" href="/about/">About us</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/careers/">Careers</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/contact/">Contact us</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/blog/">Blog</a></li></ul></nav></div><div class="jsx-1324436386 footer-links sm:text-left"><div class="jsx-1324436386 font-semibold text-white footer-items-title">Products</div><nav class="jsx-1324436386 mt-3"><ul class="jsx-1324436386"><li class="jsx-1956813867"><a class="jsx-1956813867" href="/core/">Core</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/hub/">Hub</a></li></ul></nav></div><div class="jsx-1324436386 footer-links sm:text-left"><div class="jsx-1324436386 font-semibold text-white footer-items-title">Developers</div><nav class="jsx-1324436386 mt-3"><ul class="jsx-1324436386"><li class="jsx-1956813867"><a class="jsx-1956813867" href="/contribute/">Contribute</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/learn/">Learn</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="/join/">Join</a></li></ul></nav></div><div class="jsx-1324436386 footer-links sm:text-left"><div class="jsx-1324436386 font-semibold text-white footer-items-title">Social</div><nav class="jsx-1324436386 mt-3"><ul class="jsx-1324436386"><li class="jsx-1956813867"><a class="jsx-1956813867" href="https://github.com/jina-ai/jina/">GitHub</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="https://www.linkedin.com/company/jinaai/">LinkedIn</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="https://twitter.com/jinaAI_/">Twitter</a></li><li class="jsx-1956813867"><a class="jsx-1956813867" href="https://jina-ai.slack.com/">Slack</a></li></ul></nav></div></div><div class="jsx-1956813867 footer-right-margin"></div></div><div class="text-center bg-primary-400 text-gray-100 text-sm mt-12 py-6"><span class="block md:inline-block">© 2021 Jina AI, Ltd. All rights reserved.</span><span class="mx-4 hidden md:inline-block">|</span><a href="/legal"><span>Terms of Service</span></a><span class="mx-4">|</span><a href="/legal"><span>Privacy Policy</span></a></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Build a BERT-based Semantic Search System…For Star Trek","date":"2020-08-05T15:58:12.918Z","slug":"Build-a-BERT-based-Semantic-Search-System-For-Star-Trek","author":"Alex C-G","content":"\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/1200/1*RHWbExaw9Zz9h5-OOb_DnA.png\" alt=\"Adapted from Wikimedia Commons\"\u003e\nAdapted from \u003ca href=\"https://commons.wikimedia.org/wiki/File:U.S.S._Enterprise_NCC_1701-D.jpg\"\u003eWikimedia Commons\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf you read my \u003ca href=\"https://towardsdatascience.com/gpt-3-is-the-future-but-what-can-nlp-do-in-the-present-7aae3f21e8ed\"\u003eprevious article on Towards Data Science\u003c/a\u003e you’ll know I’m a bit of a Star Trek nerd. There’s only one thing I like more than Star Trek, and that’s building cool new stuff with AI. So I thought I’d combine the two yet again!\u003c/p\u003e\n\u003cp\u003eIn this tutorial we’re going to build our own search engine to search all the lines from \u003cem\u003eStar Trek: The Next Generation\u003c/em\u003e. We’ll be using \u003ca href=\"https://github.com/jina-ai/jina/\"\u003eJina\u003c/a\u003e, a neural search framework which uses deep learning to power our NLP search, though we could easily use it for image, audio or video search if we wanted to.\u003c/p\u003e\n\u003cp\u003eWe’ll cover:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eBasic setup\u003c/li\u003e\n\u003cli\u003eRunning a demo of our app (yes, even before we code it)\u003c/li\u003e\n\u003cli\u003eUsing cookiecutter to create project and boilerplate code\u003c/li\u003e\n\u003cli\u003eDownloading our Star Trek dataset\u003c/li\u003e\n\u003cli\u003eLoading, indexing, and searching our dataset\u003c/li\u003e\n\u003cli\u003eA deeper look behind the scenes\u003c/li\u003e\n\u003cli\u003eWhat to do if things go wrong\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf you’re new to AI or search, don’t worry. As long as you have some knowledge of Python and the command line you’ll be fine. If it helps, think of yourself as Lieutenant Commander Data Science.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/1*qfpyQ5XcGt82SjQD92t-LQ.gif\" alt=\"Via Giphy\"\u003e\nVia \u003ca href=\"https://giphy.com/gifs/reaction-229P3dnAW8RzceKbps\"\u003eGiphy\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003eTry It Out\u003c/h3\u003e\n\u003cp\u003eBefore going through the trouble of downloading, configuring and testing your search engine, let’s get an idea of the finished product. In this case, it’s exactly the same as what we’re building, but with lines from South Park instead of Star Trek:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/1*9wUmi0q1HgU6yThH54V9Zg.gif\" alt=\"Via Jinabox\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/jinabox.js/\"\u003eJinabox\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eJina has a pre-built Docker image with indexed data from South Park. You can run it with:\u003c/p\u003e\n\u003cp\u003edocker run -p 45678:45678 jinaai/hub.app.distilbert-southpark\u003c/p\u003e\n\u003cp\u003eAfter getting Docker up and running, you can start searching for those South Park lines.\u003c/p\u003e\n\u003ch4\u003eQuery with Jinabox\u003c/h4\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/jina-ai/jinabox.js/\"\u003eJinabox\u003c/a\u003e is a simple web-based front-end for neural search. You can see it in the graphic at the top of this tutorial.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGo to \u003ca href=\"https://jina.ai/jinabox.js\"\u003ejinabox\u003c/a\u003e in your browser\u003c/li\u003e\n\u003cli\u003eEnsure you have the server endpoint set to \u003ccode\u003e[http://localhost:45678/api/search](http://localhost:45678/api/search)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eType a phrase into the search bar and see which South Park lines come up\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cstrong\u003eNote:\u003c/strong\u003e If it times out the first time, that’s because the query system is still warming up. Try again in a few seconds!\u003c/p\u003e\n\u003ch4\u003eQuery with \u003ccode\u003ecurl\u003c/code\u003e\u003c/h4\u003e\n\u003cp\u003eAlternatively, you can open your shell and check the results via the RESTful API. The matched results are stored in \u003ccode\u003etopkResults\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ecurl --request POST -d '{\"top_k\": 10, \"mode\": \"search\", \"data\": [\"text:hey, dude\"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:45678/api/search'\u003c/p\u003e\n\u003cp\u003eYou’ll see the results output in JSON format. Each result looks like:\u003c/p\u003e\n\u003cp\u003eNow go back to your terminal running Docker and hit \u003ccode\u003eCtrl-C\u003c/code\u003e (or \u003ccode\u003eCommand-C\u003c/code\u003e on Mac) a few times to ensure you've stopped everything.\u003c/p\u003e\n\u003ch3\u003eEngage!\u003c/h3\u003e\n\u003cp\u003eNow that you know what we’re building, let’s get started!\u003c/p\u003e\n\u003cp\u003eYou will need:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eA basic knowledge of Python\u003c/li\u003e\n\u003cli\u003ePython 3.7 or higher installed, and \u003ccode\u003epip\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eA Mac or Linux computer (Jina doesn’t currently support Windows)\u003c/li\u003e\n\u003cli\u003e8 gigabytes or more of RAM\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eClone the Repo\u003c/h4\u003e\n\u003cp\u003eLet’s get the basic files we need to get moving:\u003c/p\u003e\n\u003cp\u003egit clone git@github.com:alexcg1/my-first-jina-app.git\u003cbr\u003e\ncd my-first-jina-app\u003c/p\u003e\n\u003ch4\u003eRun Cookiecutter\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/0*80WNX16Ot0uoCXQy.gif\" alt=\"Via Giphy\"\u003e\nVia \u003ca href=\"https://giphy.com/gifs/sesame-street-cookies-cookie-monster-HGe4zsOVo7Jvy\"\u003eGiphy\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003epip install -U cookiecutter\u003cbr\u003e\ncookiecutter gh:jina-ai/cookiecutter-jina\u003c/p\u003e\n\u003cp\u003eWe use \u003ca href=\"https://github.com/cookiecutter/cookiecutter\"\u003ecookiecutter\u003c/a\u003e to spin up a basic Jina app and save you having to do a lot of typing and setup.\u003c/p\u003e\n\u003cp\u003eFor our Star Trek example, use the following settings:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eproject_name\u003c/code\u003e: \u003ccode\u003eStar Trek\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eproject_slug\u003c/code\u003e: \u003ccode\u003estar_trek\u003c/code\u003e (default value)\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etask_type\u003c/code\u003e: \u003ccode\u003enlp\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eindex_type\u003c/code\u003e: \u003ccode\u003estrings\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epublic_port\u003c/code\u003e: \u003ccode\u003e65481\u003c/code\u003e (default value)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eJust use the defaults for all other fields. After cookiecutter has finished, let’s have a look at the files it created:\u003c/p\u003e\n\u003cp\u003ecd star_trek\u003cbr\u003e\nls\u003c/p\u003e\n\u003cp\u003eYou should see a bunch of files:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapp.py\u003c/code\u003e - The main Python script where you initialize and pass data into your Flow\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eDockerfile\u003c/code\u003e - Lets you spin up a Docker instance running your app\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eflows/\u003c/code\u003e - Folder to hold your Flows\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epods/\u003c/code\u003e - Folder to hold your Pods\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eREADME.md\u003c/code\u003e - An auto-generated README file\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003erequirements.txt\u003c/code\u003e - A list of required Python packages\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn the \u003ccode\u003eflows/\u003c/code\u003e folder we can see \u003ccode\u003eindex.yml\u003c/code\u003e and \u003ccode\u003equery.yml\u003c/code\u003e - these define the indexing and querying Flows for your app.\u003c/p\u003e\n\u003cp\u003eIn \u003ccode\u003epods/\u003c/code\u003e we see \u003ccode\u003echunk.yml\u003c/code\u003e, \u003ccode\u003ecraft.yml\u003c/code\u003e, \u003ccode\u003edoc.yml\u003c/code\u003e, and \u003ccode\u003eencode.yml\u003c/code\u003e - these Pods are called from the Flows to process data for indexing or querying.\u003c/p\u003e\n\u003cp\u003eMore on Flows and Pods later!\u003c/p\u003e\n\u003ch4\u003eInstall Requirements\u003c/h4\u003e\n\u003cp\u003eIn your terminal run this command to download and install all the required Python packages:\u003c/p\u003e\n\u003cp\u003epip install -r requirements.txt\u003c/p\u003e\n\u003ch4\u003eDownload Dataset\u003c/h4\u003e\n\u003cp\u003eOur goal is to find out who said what in Star Trek episodes when a user queries a phrase. The \u003ca href=\"https://www.kaggle.com/gjbroughton/start-trek-scripts\"\u003eStar Trek dataset\u003c/a\u003e from Kaggle contains all the scripts and individual character lines from \u003cem\u003eStar Trek: The Original Series\u003c/em\u003e all the way through \u003cem\u003eStar Trek: Enterprise\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eWe’re just using a subset in this example, containing the characters and lines from \u003cem\u003eStar Trek: The Next Generation\u003c/em\u003e. This has also been converted from JSON to CSV format, which is more suitable for Jina to process.\u003c/p\u003e\n\u003cp\u003eNow let’s ensure we’re back in our base folder and download the dataset by running:\u003c/p\u003e\n\u003cp\u003eOnce that’s finished downloading, let’s get back into the \u003ccode\u003estar_trek\u003c/code\u003e directory and make sure our dataset has everything we want:\u003c/p\u003e\n\u003cp\u003ecd star_trek\u003cbr\u003e\nhead data/startrek_tng.csv\u003c/p\u003e\n\u003cp\u003eYou should see output consisting of characters (like \u003ccode\u003eMCCOY\u003c/code\u003e), a separator, (\u003ccode\u003e!\u003c/code\u003e), and the lines spoken by the character ( \u003ccode\u003eWhat about my age?\u003c/code\u003e):\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-csv\"\u003eBAILIFF!The prisoners will all stand.BAILIFF!All present, stand and make respectful attention to honouredJudge.BAILIFF!Before this gracious court now appear these prisoners to answer for the multiple and grievous savageries of their species. How plead you, criminal? BAILIFF!Criminals keep silence!BAILIFF!You will answer the charges, criminals. BAILIFF!Criminal, you will read the charges to the court.BAILIFF!All present, respectfully stand. QBAILIFF!This honourable court is adjourned. Stand respectfully. Q MCCOY!Hold it right there, boy.MCCOY!What about my age?\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNote: Your character lines may be a little different. That’s okay!\u003c/p\u003e\n\u003ch4\u003eLoad Data\u003c/h4\u003e\n\u003cp\u003eNow we we need to pass \u003ccode\u003estartrek_tng.csv\u003c/code\u003e into \u003ccode\u003eapp.py\u003c/code\u003e so we can index it. \u003ccode\u003eapp.py\u003c/code\u003e is a little too simple out of the box, so let's make some changes:\u003c/p\u003e\n\u003cp\u003eOpen \u003ccode\u003eapp.py\u003c/code\u003e in your editor and check the \u003ccode\u003eindex\u003c/code\u003e function, we currently have:\u003c/p\u003e\n\u003cp\u003eAs you can see, this indexes just 3 strings. Let’s load up our Star Trek file instead with the \u003ccode\u003efilepath\u003c/code\u003e parameter. Just replace the last line of the function:\u003c/p\u003e\n\u003ch4\u003eIndex Fewer Documents\u003c/h4\u003e\n\u003cp\u003eWhile we’re here, let’s reduce the number of documents we’re indexing, just to speed things up while we’re testing. We don’t want to spend ages indexing only to have issues later on!\u003c/p\u003e\n\u003cp\u003eIn the section above the \u003ccode\u003econfig\u003c/code\u003e function, let's change:\u003c/p\u003e\n\u003cp\u003eto:\u003c/p\u003e\n\u003cp\u003eThat should speed up our testing by a factor of 100! Once we’ve verified everything works we can set it back to \u003ccode\u003e50000\u003c/code\u003e to index more of our dataset.\u003c/p\u003e\n\u003cp\u003eNow that we’ve got the code to load our data, we’re going to dive into writing our app and running our Flows! Flows are the different tasks our app performs, like indexing or searching the data.\u003c/p\u003e\n\u003ch3\u003eIndexing\u003c/h3\u003e\n\u003cp\u003eFirst up we need to build up an index of our file. We’ll search through this index when we use the query Flow later.\u003c/p\u003e\n\u003cp\u003epython app.py index\u003c/p\u003e\n\u003cp\u003eYour app will show a lot of output in the terminal, but you’ll know it’s finished when you see the line:\u003c/p\u003e\n\u003cp\u003eFlow@133216[S]:flow is closed and all resources should be released already, current build level is 0\u003c/p\u003e\n\u003cp\u003eThis may take a little while the first time, since Jina needs to download the language model and tokenizer to process the data. You can think of these as the brains behind the neural network that powers the search.\u003c/p\u003e\n\u003ch3\u003eSearching\u003c/h3\u003e\n\u003cp\u003eTo start search mode run:\u003c/p\u003e\n\u003cp\u003epython app.py search\u003c/p\u003e\n\u003cp\u003eAfter a while you should see the terminal stop scrolling and display output like:\u003c/p\u003e\n\u003cp\u003eFlow@85144[S]:flow is started at 0.0.0.0:65481, you can now use client to send request!\u003c/p\u003e\n\u003cp\u003e⚠️ Be sure to note down the port number. We’ll need it for \u003ccode\u003ecurl\u003c/code\u003e and jinabox! In our case we'll assume it's \u003ccode\u003e65481\u003c/code\u003e, and we use that in the below examples. If your port number is different, be sure to use that instead.\u003c/p\u003e\n\u003cp\u003eℹ️ \u003ccode\u003epython app.py search\u003c/code\u003e doesn't pop up a search interface - for that you'll need to connect via \u003ccode\u003ecurl\u003c/code\u003e, Jinabox, or another client.\u003c/p\u003e\n\u003ch4\u003eSearch with Jinabox\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/0*uSuMyVICX45stZGX.gif\" alt=\"Via Jinabox\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/jinabox.js/\"\u003eJinabox\u003c/a\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eGo to \u003ca href=\"https://jina.ai/jinabox.js\"\u003ejinabox\u003c/a\u003e in your browser\u003c/li\u003e\n\u003cli\u003eEnsure you have the server endpoint set to \u003ccode\u003e[http://localhost:65481/api/search](http://localhost:65481/api/search)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eType a phrase into the search bar and see which Star Trek lines come up\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch4\u003eSearch with curl\u003c/h4\u003e\n\u003cp\u003ecurl --request POST -d '{\"top_k\": 10, \"mode\": \"search\", \"data\": [\"text:picard to riker\"]}' -H 'Content-Type: application/json' 'http://0.0.0.0:65481/api/search'\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ecurl\u003c/code\u003e will spit out a \u003cem\u003elot\u003c/em\u003e of information in JSON format - not just the lines you're searching for, but all sorts of metadata about the search and the lines it returns. Look for the lines starting with \u003ccode\u003e\"matchDoc\"\u003c/code\u003e to find the matches, like:\u003c/p\u003e\n\u003cp\u003eCongratulations! You’ve just built your very own search engine!\u003c/p\u003e\n\u003ch3\u003eHow Does it Actually Work?\u003c/h3\u003e\n\u003cp\u003eFor a more general overview of what neural search is and how it works, check one of \u003ca href=\"https://towardsdatascience.com/what-is-neural-search-and-why-should-i-care-4a6cee6b2249\"\u003emy other previous articles\u003c/a\u003e. Jina itself is just one way to build a neural search engine, and it has a couple of important concepts: \u003cstrong\u003eFlows\u003c/strong\u003e and \u003cstrong\u003ePods\u003c/strong\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe Flow tells Jina \u003cem\u003ewhat\u003c/em\u003e tasks to perform on the dataset, like indexing or searching. Each Flow is built from individual Pods.\u003c/li\u003e\n\u003cli\u003eThe Pods comprise the Flow and tell Jina \u003cem\u003ehow\u003c/em\u003e to perform each task step by step, like breaking text into chunks, indexing it, and so on. They define the actual neural networks we use in neural search, namely the language models like \u003ccode\u003edistilbert-base-cased\u003c/code\u003e. (Which we can see in \u003ccode\u003epods/encode.yml\u003c/code\u003e)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eFlows\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/600/0*4T73vRJqbP5MzAPw.png\" alt=\"Via Jina 101\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/jina/tree/master/docs/chapters/101\"\u003eJina 101\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eJust as a plant manages nutrient flow and growth rate for its branches, a Flow manages the states and context of a group of Pods, orchestrating them to accomplish one task. Whether a Pod is remote or running in Docker, one Flow rules them all!\u003c/p\u003e\n\u003cp\u003eWe define Flows in \u003ccode\u003eapp.py\u003c/code\u003e to index and query the content in our Star Trek dataset.\u003c/p\u003e\n\u003cp\u003eIn this case our Flows are written in YAML format and loaded into \u003ccode\u003eapp.py\u003c/code\u003e with:\u003c/p\u003e\n\u003cp\u003eIt really is that simple! Alternatively you can build Flows in \u003ccode\u003eapp.py\u003c/code\u003e itself \u003ca href=\"https://docs.jina.ai/chapters/flow/index.html\"\u003ewithout specifying them in YAML\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eNo matter whether you’re dealing with text, graphics, sound, or video, all datasets need to be indexed and queried, and the steps for doing each (chunking, vector encoding) are more or less the same (even if \u003cem\u003ehow\u003c/em\u003e you perform each step is different — that’s where Pods come in!)\u003c/p\u003e\n\u003ch4\u003eIndexing\u003c/h4\u003e\n\u003cp\u003eEvery Flow has well, a flow to it. Different Pods pass data along the Flow, with one Pod’s output becoming another Pod’s input. Look at our indexing Flow as an example:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/1*CuwRBdSoJfSgXnJ8BBUOeA.png\" alt=\"Via Jina Dashboard\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/dashboard\"\u003eJina Dashboard\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIf you look at \u003ccode\u003estartrek_tng.csv\u003c/code\u003e you'll see it's just one big text file. Our Flow processes it into something more suitable for Jina, which is handled by the Pods in the Flow. Each Pod performs a different task.\u003c/p\u003e\n\u003cp\u003eYou can see the following Pods in \u003ccode\u003eflows/index.yml\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ecrafter\u003c/code\u003e - Split the Document into Chunks\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eencoder\u003c/code\u003e - Encode each Chunk into a vector\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003echunk_idx\u003c/code\u003e - Build an index of Chunks\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edoc_idx\u003c/code\u003e - Store the Document content\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ejoin_all\u003c/code\u003e - Join the \u003ccode\u003echunk_idx\u003c/code\u003e and \u003ccode\u003edoc_idx\u003c/code\u003e pathways\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe full file is essentially just a list of Pods with parameters and some setup at the top of the file:\u003c/p\u003e\n\u003cp\u003eLuckily, YAML is pretty human-readable. I regularly thank the \u003ca href=\"https://memory-alpha.fandom.com/wiki/Great_bird_of_the_galaxy\"\u003eGreat Bird of the Galaxy\u003c/a\u003e it’s not in Klingon, or even worse, XML!\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eThe first couple of lines initialize the Flow and enable the logserver (which we’re not using in this tutorial).\u003c/li\u003e\n\u003cli\u003eAfter that we can see the list of Pods, with their own YAML path and extra parameters being passed to each one.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSo, is that all of the Pods? Not quite! We always have another Pod working in silence — the \u003ccode\u003egateway\u003c/code\u003e pod. Most of the time we can safely ignore it because it basically does all the dirty orchestration work for the Flow.\u003c/p\u003e\n\u003ch4\u003eSearching\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/0*cvwy8oYjPaQECsge.png\" alt=\"Via Jina Dashboard\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/dashboard\"\u003eJina Dashboard\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIn the query Flow we’ve got the following Pods:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003echunk_seg\u003c/code\u003e - Segments the user query into meaningful Chunks\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etf_encode\u003c/code\u003e - Encode each word of the query into a vector\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003echunk_idx\u003c/code\u003e - Build an index for the Chunks for fast lookup\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eranker\u003c/code\u003e - Sort results list\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edoc_idx\u003c/code\u003e - Store the Document content\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAgain, \u003ccode\u003eflows/query.yml\u003c/code\u003e gives some setup options and lists the Pods in order of use:\u003c/p\u003e\n\u003cp\u003eWhen we were indexing we broke the Document into Chunks to index it. For querying we do the same, but this time the Document is the query the user types in, not the Star Trek dataset. We’ll use many of the same Pods, but there are a few differences to bear in mind. In the big picture:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIndex has a two-pathway design which deals with both Document and Chunk indexing in parallel, which speeds up message passing\u003c/li\u003e\n\u003cli\u003eQuery has a single pipeline\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAnd digging into the \u003ccode\u003eflows/query.yml\u003c/code\u003e, we can see it has an extra Pod and some more parameters compared to \u003ccode\u003eflows/index.yml\u003c/code\u003e:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003erest_api:true\u003c/code\u003e - Use Jina's REST API, allowing clients like jinabox and \u003ccode\u003ecurl\u003c/code\u003e to connect\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eport_expose: $JINA_PORT\u003c/code\u003e - The port for connecting to Jina's API\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epolling: all\u003c/code\u003e - Setting \u003ccode\u003epolling\u003c/code\u003e to \u003ccode\u003eall\u003c/code\u003e ensures all workers poll the message\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ereducing_yaml_path: _merge_topk_chunks\u003c/code\u003e - Use \u003ccode\u003e_merge_topk_chunks\u003c/code\u003e to reduce results from all replicas\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eranker:\u003c/code\u003e - Rank results by relevance\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eHow does Jina know whether it should be indexing or searching? In our RESTful API we set the \u003ccode\u003emode\u003c/code\u003e field in the JSON body and send the request to the corresponding API:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapi/index\u003c/code\u003e - \u003ccode\u003e{\"mode\": \"index\"}\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapi/search\u003c/code\u003e - \u003ccode\u003e{\"mode\": \"search\"}\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003ePods\u003c/h4\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/600/0*KsNdCg47DQ1mp9l9.png\" alt=\"Via Jina 101\"\u003e\nVia \u003ca href=\"https://github.com/jina-ai/jina/tree/master/docs/chapters/101\"\u003eJina 101\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eAs we discussed above, a Flow tells Jina \u003cem\u003ewhat\u003c/em\u003e task to perform and is comprised of Pods. And a Pod tells Jina \u003cem\u003ehow\u003c/em\u003e to perform that task (i.e. what the right tool for job is). Both Pods and Flows are written in YAML.\u003c/p\u003e\n\u003cp\u003eLet’s start by looking at a Pod in our indexing Flow, \u003ccode\u003eflows/index.yml\u003c/code\u003e. Instead of the first Pod \u003ccode\u003ecrafter\u003c/code\u003e, let's look at \u003ccode\u003eencoder\u003c/code\u003e which is a bit simpler:\u003c/p\u003e\n\u003cp\u003eAs we can see in the code above, the \u003ccode\u003eencoder\u003c/code\u003e Pod’s YAML file is stored in \u003ccode\u003epods/encode.yml\u003c/code\u003e, and looks like:\u003c/p\u003e\n\u003cp\u003eThe Pods uses the built-in \u003ccode\u003eTransformerTorchEncoder\u003c/code\u003e as its Executor. Each Pod has a different Executor based on its task, and an Executor represents an algorithm, in this case encoding. The Executor differs based on what's being encoded. For video or audio you'd use a different one. The \u003ccode\u003ewith\u003c/code\u003e field specifies the parameters passed to \u003ccode\u003eTransformerTorchEncoder\u003c/code\u003e.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003epooling_strategy\u003c/code\u003e - Strategy to merge word embeddings into chunk embedding\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emodel_name\u003c/code\u003e - Name of the model we're using\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emax_length\u003c/code\u003e - Maximum length to truncate tokenized sequences to\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eWhen the Pod runs, data is passed in from the previous Pod, \u003ccode\u003eTransformerTorchEncoder\u003c/code\u003e encodes the data, and the Pod passes the data to the next Pod in the Flow.\u003c/p\u003e\n\u003cp\u003eFor a deeper dive on Pods, Flows, Executors and everything else, you can refer to \u003ca href=\"https://github.com/jina-ai/jina/tree/master/docs/chapters/101\"\u003eJina 101\u003c/a\u003e.\u003c/p\u003e\n\u003ch3\u003eTroubleshooting\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/1*O4TEq098Y8EDfCxuXtbdmA.gif\" alt=\"Via Giphy\"\u003e\nVia \u003ca href=\"https://giphy.com/gifs/star-trek-riker-tng-tYelSVzQPtLdm\"\u003eGiphy\u003c/a\u003e\u003c/p\u003e\n\u003ch4\u003eModule not found\u003c/h4\u003e\n\u003cp\u003eBe sure to run \u003ccode\u003epip install -r requirements.txt\u003c/code\u003e before beginning, and ensure you have lots of RAM/swap and space in your \u003ccode\u003etmp\u003c/code\u003e partition (see below issues). This may take a while since there are a lot of prerequisites to install.\u003c/p\u003e\n\u003cp\u003eIf this error keeps popping up, look into the errors that were output onto the terminal to try to find which module is missing, and then run:\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003epip install \u0026#x3C;module_name\u003e\u003c/code\u003e\u003c/p\u003e\n\u003ch4\u003eMy computer hangs\u003c/h4\u003e\n\u003cp\u003eMachine learning requires a lot of resources, and if your machine hangs this is often due to running out of memory. To fix this, try \u003ca href=\"https://linuxize.com/post/how-to-add-swap-space-on-ubuntu-20-04/\"\u003ecreating a swap file\u003c/a\u003e if you use Linux. This isn’t such an issue on macOS, since it allocates swap automatically.\u003c/p\u003e\n\u003ch4\u003e\u003ccode\u003eERROR: Could not install packages due to an EnvironmentError: [Errno 28] No space left on device\u003c/code\u003e\u003c/h4\u003e\n\u003cp\u003eThis is often due to your \u003ccode\u003e/tmp\u003c/code\u003e partition running out of space so you'll need to \u003ca href=\"https://askubuntu.com/questions/199565/not-enough-space-on-tmp\"\u003eincrease its size\u003c/a\u003e.\u003c/p\u003e\n\u003ch4\u003e\u003ccode\u003ecommand not found\u003c/code\u003e\u003c/h4\u003e\n\u003cp\u003eFor this error you’ll need to install the relevant software package onto your system. In Ubuntu this can be done with:\u003c/p\u003e\n\u003cp\u003esudo apt-get install \u0026#x3C;package_name\u003e\u003c/p\u003e\n\u003ch3\u003eCongratulations! We Did It!\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"https://cdn-images-1.medium.com/max/800/0*uNyjB41NM_94Hbmi.gif\" alt=\"Via Giphy\"\u003e\nVia \u003ca href=\"https://giphy.com/gifs/star-trek-booze-scotty-3ornjJpj2rAla2DLCE\"\u003eGiphy\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eIn this tutorial you’ve learned:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eHow to install the Jina neural search framework\u003c/li\u003e\n\u003cli\u003eHow to load and index text data from files\u003c/li\u003e\n\u003cli\u003eHow to query data with \u003ccode\u003ecurl\u003c/code\u003e and Jinabox\u003c/li\u003e\n\u003cli\u003eThe nitty-gritty behind Jina Flows and Pods\u003c/li\u003e\n\u003cli\u003eWhat do if it all goes wrong\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eNow that you have a broad understanding of how things work, you can try out some of more \u003ca href=\"https://github.com/jina-ai/examples\"\u003eexample tutorials\u003c/a\u003e to build image or video search, or stay tuned for our next set of tutorials that build upon your Star Trek app.\u003c/p\u003e\n\u003cp\u003eGot an idea for a tutorial covering Star Trek and/or neural search? My commbadge is out of order right now, but you can leave a comment or note on this article for me to assimilate!\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"http://www.twitter.com/alexcg\"\u003eAlex C-G\u003c/a\u003e is the Open Source Evangelist at \u003ca href=\"https://github.com/jina-ai/jina/\"\u003eJina AI\u003c/a\u003e, and a massive Star Trek geek.\u003c/p\u003e\n","coverImage":"/assets/images/blog/startrek.png","tags":["BERT","Tutorial","nlp"]}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"Build-a-BERT-based-Semantic-Search-System-For-Star-Trek"},"buildId":"KJvUyrCoh0MXs5cG--Qn6","runtimeConfig":{},"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="/_next/static/chunks/webpack-8f6366ea4b5fafd77e96.js" async=""></script><script src="/_next/static/chunks/framework-94f262366e752bd48d82.js" async=""></script><script src="/_next/static/chunks/commons-4667b98b62a60d7c050b.js" async=""></script><script src="/_next/static/chunks/main-9a4182dc8e7736869bf9.js" async=""></script><script src="/_next/static/chunks/pages/_app-afcb035e0413b2214f0f.js" async=""></script><script src="/_next/static/chunks/596-13cdde2fb793b77184ee.js" async=""></script><script src="/_next/static/chunks/522-e45333ebcf36799b860c.js" async=""></script><script src="/_next/static/chunks/373-350caaa5387e56e8b807.js" async=""></script><script src="/_next/static/chunks/93-1a5bac9fdf2b2295fba2.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-0d67fc13dbd9e7ddf27f.js" async=""></script><script src="/_next/static/KJvUyrCoh0MXs5cG--Qn6/_buildManifest.js" async=""></script><script src="/_next/static/KJvUyrCoh0MXs5cG--Qn6/_ssgManifest.js" async=""></script></body></html>